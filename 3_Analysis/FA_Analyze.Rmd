---
title: "FA_Analyze.rmd"
output:
  html_document:
    df_print: paged
---


***
### Begin Code Blocks:

Prepare the workspace: clean, set options, load packages, load and final formatting on inputs.
```{r, warning = FALSE, message=FALSE}
rm(list = ls()) # clear workspace
knitr::opts_chunk$set(tidy = TRUE, collapse = TRUE) # set global knitr options.
# load required packages
require(ggplot2); # used for plotting
require(pwr); # used for power analysis
require(lme4); # used for mixed effects models
require(lmerTest); # used to interpret mixed effects models
require(sjPlot); # used to output tables
require(weights); # used for weighted t.test
require(plyr); # used for dataframe manipulation
require(gridExtra) # used for multipanel plotting
require(barnard)
require(GGally)

options(scipen = 999) # turn off scientific notation
```
<br/><br/>

Explore extinction and extirpation.
```{r, warning = FALSE, message=FALSE}
load(file = "myd.Rdata")
myd$bc1cts_f_a <- apply(myd, 1, function(x) weighted.mean(as.numeric(x[c( "bc1cts_f_r1a", "bc1cts_f_r2a", "bc1cts_f_r3a", "bc1cts_f_r4a")]), 
                                                  as.numeric(x[c( "re_f_r1a","re_f_r2a","re_f_r3a","re_f_r4a")])))
my <- myd
# first need to collapse replicates such that there is only a single entry per bc per assay env. 
my1 <- my[my$mpar == 1,]
my2 <- my[my$mpar == 2,]; colnames(my2)[c(11, 110)] <- paste0(colnames(my2)[c(11, 110)], "_2")
my3 <- my[my$mpar == 3,]; colnames(my3)[c(11, 110)] <- paste0(colnames(my3)[c(11, 110)], "_3")
my4 <- my[my$mpar == 4,]; colnames(my4)[c(11, 110)] <- paste0(colnames(my4)[c(11, 110)], "_4")
# 
# myee <- cbind(my1, my2$bc1cts_f_e_2, my2$re_f_e_2, my3$bc1cts_f_e_3, my3$re_f_e_3, my4$bc1cts_f_e_4, my4$re_f_e_4)
# bc1cts_f_e <- apply(myee, 1, function(x) weighted.mean(as.numeric(x[c( "bc1cts_f_e", "bc1cts_f_e_2", "bc1cts_f_e_3", "bc1cts_f_e_4")]),
#                                                   as.numeric(x[c( "re_f_e","re_f_e_2","re_f_e_3","re_f_e_4")])))
# my <- cbind(my1, bc1cts_f_e)
my <- cbind(my1, my2$bc1cts_f_e_2,  my3$bc1cts_f_e_3,  my4$bc1cts_f_e_4)
colnames(my)[126:128] <- c("bc1cts_f_e_2", "bc1cts_f_e_3", "bc1cts_f_e_4")

mythresh <- 15

# SALT -----------------------------------------------------
mymat <- matrix(nrow = 7, ncol = 16)
mymatsum <- matrix(nrow = 7, ncol = 4)
# - EH0 ------------------------------------------
# --- in CM ------------------
myy <- my[my$epo %in% c("SALT_A", "SALT_B") & my$mpasp == 0.0,]
mymat[1,1] <- sum(myy$bc1cts_i_a[myy$treat == "EH0"] <= mythresh) #  were extinct at the start
mymat[1,2] <- sum(myy$bc1cts_f_a[myy$treat == "EH0"] <= mythresh) #  were extirpated in the fit0 assays
mymat[1,3] <- sum(myy$bc1cts_i_e[myy$treat == "EH0"] <= mythresh) #  extinct at start of fit500
mymat[1,4] <- sum(myy$bc1cts_f_e[myy$treat == "EH0"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH0"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH0"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH0"] <= mythresh)#  extirpated during the fit500 
mymatsum[1,1] <- sum(myy$bc1cts_i_a[myy$treat == "EH0"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH0"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH0"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH0"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH0"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH0"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH0"] <= mythresh))

# --- in salt 0.4 ------------------
myy <- my[my$epo %in% c("SALT_A", "SALT_B") & my$mpasp == 0.4,]
mymat[1,5] <- sum(myy$bc1cts_i_a[myy$treat == "EH0"] <= mythresh) #  were extinct at the start
mymat[1,6] <- sum(myy$bc1cts_f_a[myy$treat == "EH0"] <= mythresh) #  were extirpated in the fit0 assays
mymat[1,7] <- sum(myy$bc1cts_i_e[myy$treat == "EH0"] <= mythresh) #  extinct at start of fit500
mymat[1,8] <- sum(myy$bc1cts_f_e[myy$treat == "EH0"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH0"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH0"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH0"] <= mythresh)#  extirpated during the fit500 
mymatsum[1,2] <- sum(myy$bc1cts_i_a[myy$treat == "EH0"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH0"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH0"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH0"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH0"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH0"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH0"] <= mythresh))

# --- in salt 0.8 ------------------
myy <- my[my$epo %in% c("SALT_A", "SALT_B") & my$mpasp == 0.8,]
mymat[1,9] <- sum(myy$bc1cts_i_a[myy$treat == "EH0"] <= mythresh) #  were extinct at the start
mymat[1,10] <- sum(myy$bc1cts_f_a[myy$treat == "EH0"] <= mythresh) #  were extirpated in the fit0 assays
mymat[1,11] <- sum(myy$bc1cts_i_e[myy$treat == "EH0"] <= mythresh) #  extinct at start of fit500
mymat[1,12] <- sum(myy$bc1cts_f_e[myy$treat == "EH0"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH0"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH0"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH0"] <= mythresh)#  extirpated during the fit500 
mymatsum[1,3] <- sum(myy$bc1cts_i_a[myy$treat == "EH0"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH0"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH0"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH0"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH0"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH0"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH0"] <= mythresh))

# --- in salt 1.2 ------------------
myy <- my[my$epo %in% c("SALT_A", "SALT_B") & my$mpasp == 1.2,]
mymat[1,13] <- sum(myy$bc1cts_i_a[myy$treat == "EH0"] <= mythresh) #  were extinct at the start
mymat[1,14] <- sum(myy$bc1cts_f_a[myy$treat == "EH0"] <= mythresh) #  were extirpated in the fit0 assays
mymat[1,15] <- sum(myy$bc1cts_i_e[myy$treat == "EH0"] <= mythresh) #  extinct at start of fit500
mymat[1,16] <- sum(myy$bc1cts_f_e[myy$treat == "EH0"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH0"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH0"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH0"] <= mythresh)#  extirpated during the fit500 
mymatsum[1,4] <- sum(myy$bc1cts_i_a[myy$treat == "EH0"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH0"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH0"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH0"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH0"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH0"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH0"] <= mythresh))


# - EH40 ------------------------------------------
# --- in CM ------------------
myy <- my[my$epo %in% c("SALT_A", "SALT_B") & my$mpasp == 0.0,]
mymat[2,1] <- sum(myy$bc1cts_i_a[myy$treat == "EH40"] <= mythresh) #  were extinct at the start
mymat[2,2] <- sum(myy$bc1cts_f_a[myy$treat == "EH40"] <= mythresh) #  were extirpated in the fit0 assays
mymat[2,3] <- sum(myy$bc1cts_i_e[myy$treat == "EH40"] <= mythresh) #  extinct at start of fit500
mymat[2,4] <- sum(myy$bc1cts_f_e[myy$treat == "EH40"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH40"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH40"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH40"] <= mythresh)#  extirpated during the fit500 
mymatsum[2,1] <- sum(myy$bc1cts_i_a[myy$treat == "EH40"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH40"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH40"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH40"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH40"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH40"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH40"] <= mythresh))

# --- in salt 0.4 ------------------
myy <- my[my$epo %in% c("SALT_A", "SALT_B") & my$mpasp == 0.4,]
mymat[2,5] <- sum(myy$bc1cts_i_a[myy$treat == "EH40"] <= mythresh) #  were extinct at the start
mymat[2,6] <- sum(myy$bc1cts_f_a[myy$treat == "EH40"] <= mythresh) #  were extirpated in the fit0 assays
mymat[2,7] <- sum(myy$bc1cts_i_e[myy$treat == "EH40"] <= mythresh) #  extinct at start of fit500
mymat[2,8] <- sum(myy$bc1cts_f_e[myy$treat == "EH40"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH40"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH40"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH40"] <= mythresh)#  extirpated during the fit500 
mymatsum[2,2] <- sum(myy$bc1cts_i_a[myy$treat == "EH40"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH40"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH40"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH40"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH40"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH40"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH40"] <= mythresh))

# --- in salt 0.8 ------------------
myy <- my[my$epo %in% c("SALT_A", "SALT_B") & my$mpasp == 0.8,]
mymat[2,9] <- sum(myy$bc1cts_i_a[myy$treat == "EH40"] <= mythresh) #  were extinct at the start
mymat[2,10] <- sum(myy$bc1cts_f_a[myy$treat == "EH40"] <= mythresh) #  were extirpated in the fit0 assays
mymat[2,11] <- sum(myy$bc1cts_i_e[myy$treat == "EH40"] <= mythresh) #  extinct at start of fit500
mymat[2,12] <- sum(myy$bc1cts_f_e[myy$treat == "EH40"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH40"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH40"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH40"] <= mythresh)#  extirpated during the fit500 
mymatsum[2,3] <- sum(myy$bc1cts_i_a[myy$treat == "EH40"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH40"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH40"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH40"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH40"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH40"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH40"] <= mythresh))

# --- in salt 1.2 ------------------
myy <- my[my$epo %in% c("SALT_A", "SALT_B") & my$mpasp == 1.2,]
mymat[2,13] <- sum(myy$bc1cts_i_a[myy$treat == "EH40"] <= mythresh) #  were extinct at the start
mymat[2,14] <- sum(myy$bc1cts_f_a[myy$treat == "EH40"] <= mythresh) #  were extirpated in the fit0 assays
mymat[2,15] <- sum(myy$bc1cts_i_e[myy$treat == "EH40"] <= mythresh) #  extinct at start of fit500
mymat[2,16] <- sum(myy$bc1cts_f_e[myy$treat == "EH40"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH40"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH40"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH40"] <= mythresh)#  extirpated during the fit500 
mymatsum[2,4] <- sum(myy$bc1cts_i_a[myy$treat == "EH40"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH40"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH40"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH40"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH40"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH40"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH40"] <= mythresh))



# - EH80 ------------------------------------------
# --- in CM ------------------
myy <- my[my$epo %in% c("SALT_A", "SALT_B") & my$mpasp == 0.0,]
mymat[3,1] <- sum(myy$bc1cts_i_a[myy$treat == "EH80"] <= mythresh) #  were extinct at the start
mymat[3,2] <- sum(myy$bc1cts_f_a[myy$treat == "EH80"] <= mythresh) #  were extirpated in the fit0 assays
mymat[3,3] <- sum(myy$bc1cts_i_e[myy$treat == "EH80"] <= mythresh) #  extinct at start of fit500
mymat[3,4] <- sum(myy$bc1cts_f_e[myy$treat == "EH80"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH80"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH80"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH80"] <= mythresh)#  extirpated during the fit500 
mymatsum[3,1] <- sum(myy$bc1cts_i_a[myy$treat == "EH80"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH80"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH80"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH80"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH80"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH80"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH80"] <= mythresh))

# --- in salt 0.4 ------------------
myy <- my[my$epo %in% c("SALT_A", "SALT_B") & my$mpasp == 0.4,]
mymat[3,5] <- sum(myy$bc1cts_i_a[myy$treat == "EH80"] <= mythresh) #  were extinct at the start
mymat[3,6] <- sum(myy$bc1cts_f_a[myy$treat == "EH80"] <= mythresh) #  were extirpated in the fit0 assays
mymat[3,7] <- sum(myy$bc1cts_i_e[myy$treat == "EH80"] <= mythresh) #  extinct at start of fit500
mymat[3,8] <- sum(myy$bc1cts_f_e[myy$treat == "EH80"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH80"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH80"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH80"] <= mythresh)#  extirpated during the fit500 
mymatsum[3,2] <- sum(myy$bc1cts_i_a[myy$treat == "EH80"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH80"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH80"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH80"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH80"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH80"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH80"] <= mythresh))
# --- in salt 0.8 ------------------
myy <- my[my$epo %in% c("SALT_A", "SALT_B") & my$mpasp == 0.8,]
mymat[3,9] <- sum(myy$bc1cts_i_a[myy$treat == "EH80"] <= mythresh) #  were extinct at the start
mymat[3,10] <- sum(myy$bc1cts_f_a[myy$treat == "EH80"] <= mythresh) #  were extirpated in the fit0 assays
mymat[3,11] <- sum(myy$bc1cts_i_e[myy$treat == "EH80"] <= mythresh) #  extinct at start of fit500
mymat[3,12] <- sum(myy$bc1cts_f_e[myy$treat == "EH80"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH80"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH80"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH80"] <= mythresh)#  extirpated during the fit500 
mymatsum[3,3] <- sum(myy$bc1cts_i_a[myy$treat == "EH80"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH80"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH80"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH80"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH80"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH80"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH80"] <= mythresh))
# --- in salt 1.2 ------------------
myy <- my[my$epo %in% c("SALT_A", "SALT_B") & my$mpasp == 1.2,]
mymat[3,13] <- sum(myy$bc1cts_i_a[myy$treat == "EH80"] <= mythresh) #  were extinct at the start
mymat[3,14] <- sum(myy$bc1cts_f_a[myy$treat == "EH80"] <= mythresh) #  were extirpated in the fit0 assays
mymat[3,15] <- sum(myy$bc1cts_i_e[myy$treat == "EH80"] <= mythresh) #  extinct at start of fit500
mymat[3,16] <- sum(myy$bc1cts_f_e[myy$treat == "EH80"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH80"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH80"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH80"] <= mythresh)#  extirpated during the fit500 
mymatsum[3,4] <- sum(myy$bc1cts_i_a[myy$treat == "EH80"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH80"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH80"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH80"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH80"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH80"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH80"] <= mythresh))



# - EH0_40 ------------------------------------------
# --- in CM ------------------
myy <- my[my$epo %in% c("SALT_A", "SALT_B") & my$mpasp == 0.0,]
mymat[4,1] <- sum(myy$bc1cts_i_a[myy$treat == "EH0_40"] <= mythresh) #  were extinct at the start
mymat[4,2] <- sum(myy$bc1cts_f_a[myy$treat == "EH0_40"] <= mythresh) #  were extirpated in the fit0 assays
mymat[4,3] <- sum(myy$bc1cts_i_e[myy$treat == "EH0_40"] <= mythresh) #  extinct at start of fit500
mymat[4,4] <- sum(myy$bc1cts_f_e[myy$treat == "EH0_40"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH0_40"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH0_40"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH0_40"] <= mythresh)#  extirpated during the fit500 
mymatsum[4,1] <- sum(myy$bc1cts_i_a[myy$treat == "EH0_40"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH0_40"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH0_40"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH0_40"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH0_40"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH0_40"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH0_40"] <= mythresh))
# --- in salt 0.4 ------------------
myy <- my[my$epo %in% c("SALT_A", "SALT_B") & my$mpasp == 0.4,]
mymat[4,5] <- sum(myy$bc1cts_i_a[myy$treat == "EH0_40"] <= mythresh) #  were extinct at the start
mymat[4,6] <- sum(myy$bc1cts_f_a[myy$treat == "EH0_40"] <= mythresh) #  were extirpated in the fit0 assays
mymat[4,7] <- sum(myy$bc1cts_i_e[myy$treat == "EH0_40"] <= mythresh) #  extinct at start of fit500
mymat[4,8] <- sum(myy$bc1cts_f_e[myy$treat == "EH0_40"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH0_40"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH0_40"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH0_40"] <= mythresh)#  extirpated during the fit500 
mymatsum[4,2] <- sum(myy$bc1cts_i_a[myy$treat == "EH0_40"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH0_40"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH0_40"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH0_40"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH0_40"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH0_40"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH0_40"] <= mythresh))

# --- in salt 0.8 ------------------
myy <- my[my$epo %in% c("SALT_A", "SALT_B") & my$mpasp == 0.8,]
mymat[4,9] <- sum(myy$bc1cts_i_a[myy$treat == "EH0_40"] <= mythresh) #  were extinct at the start
mymat[4,10] <- sum(myy$bc1cts_f_a[myy$treat == "EH0_40"] <= mythresh) #  were extirpated in the fit0 assays
mymat[4,11] <- sum(myy$bc1cts_i_e[myy$treat == "EH0_40"] <= mythresh) #  extinct at start of fit500
mymat[4,12] <- sum(myy$bc1cts_f_e[myy$treat == "EH0_40"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH0_40"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH0_40"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH0_40"] <= mythresh)#  extirpated during the fit500 
mymatsum[4,3] <- sum(myy$bc1cts_i_a[myy$treat == "EH0_40"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH0_40"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH0_40"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH0_40"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH0_40"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH0_40"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH0_40"] <= mythresh))

# --- in salt 1.2 ------------------
myy <- my[my$epo %in% c("SALT_A", "SALT_B") & my$mpasp == 1.2,]
mymat[4,13] <- sum(myy$bc1cts_i_a[myy$treat == "EH0_40"] <= mythresh) #  were extinct at the start
mymat[4,14] <- sum(myy$bc1cts_f_a[myy$treat == "EH0_40"] <= mythresh) #  were extirpated in the fit0 assays
mymat[4,15] <- sum(myy$bc1cts_i_e[myy$treat == "EH0_40"] <= mythresh) #  extinct at start of fit500
mymat[4,16] <- sum(myy$bc1cts_f_e[myy$treat == "EH0_40"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH0_40"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH0_40"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH0_40"] <= mythresh)#  extirpated during the fit500 
mymatsum[4,4] <- sum(myy$bc1cts_i_a[myy$treat == "EH0_40"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH0_40"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH0_40"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH0_40"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH0_40"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH0_40"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH0_40"] <= mythresh))



# - EH20_60 ------------------------------------------
# --- in CM ------------------
myy <- my[my$epo %in% c("SALT_A", "SALT_B") & my$mpasp == 0.0,]
mymat[5,1] <- sum(myy$bc1cts_i_a[myy$treat == "EH20_60"] <= mythresh) #  were extinct at the start
mymat[5,2] <- sum(myy$bc1cts_f_a[myy$treat == "EH20_60"] <= mythresh) #  were extirpated in the fit0 assays
mymat[5,3] <- sum(myy$bc1cts_i_e[myy$treat == "EH20_60"] <= mythresh) #  extinct at start of fit500
mymat[5,4] <- sum(myy$bc1cts_f_e[myy$treat == "EH20_60"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH20_60"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH20_60"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH20_60"] <= mythresh)#  extirpated during the fit500 
mymatsum[5,1] <- sum(myy$bc1cts_i_a[myy$treat == "EH20_60"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH20_60"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH20_60"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH20_60"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH20_60"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH20_60"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH20_60"] <= mythresh))
# --- in salt 0.4 ------------------
myy <- my[my$epo %in% c("SALT_A", "SALT_B") & my$mpasp == 0.4,]
mymat[5,5] <- sum(myy$bc1cts_i_a[myy$treat == "EH20_60"] <= mythresh) #  were extinct at the start
mymat[5,6] <- sum(myy$bc1cts_f_a[myy$treat == "EH20_60"] <= mythresh) #  were extirpated in the fit0 assays
mymat[5,7] <- sum(myy$bc1cts_i_e[myy$treat == "EH20_60"] <= mythresh) #  extinct at start of fit500
mymat[5,8] <- sum(myy$bc1cts_f_e[myy$treat == "EH20_60"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH20_60"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH20_60"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH20_60"] <= mythresh)#  extirpated during the fit500 
mymatsum[5,2] <- sum(myy$bc1cts_i_a[myy$treat == "EH20_60"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH20_60"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH20_60"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH20_60"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH20_60"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH20_60"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH20_60"] <= mythresh))

# --- in salt 0.8 ------------------
myy <- my[my$epo %in% c("SALT_A", "SALT_B") & my$mpasp == 0.8,]
mymat[5,9] <- sum(myy$bc1cts_i_a[myy$treat == "EH20_60"] <= mythresh) #  were extinct at the start
mymat[5,10] <- sum(myy$bc1cts_f_a[myy$treat == "EH20_60"] <= mythresh) #  were extirpated in the fit0 assays
mymat[5,11] <- sum(myy$bc1cts_i_e[myy$treat == "EH20_60"] <= mythresh) #  extinct at start of fit500
mymat[5,12] <- sum(myy$bc1cts_f_e[myy$treat == "EH20_60"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH20_60"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH20_60"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH20_60"] <= mythresh)#  extirpated during the fit500 
mymatsum[5,3] <- sum(myy$bc1cts_i_a[myy$treat == "EH20_60"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH20_60"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH20_60"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH20_60"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH20_60"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH20_60"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH20_60"] <= mythresh))

# --- in salt 1.2 ------------------
myy <- my[my$epo %in% c("SALT_A", "SALT_B") & my$mpasp == 1.2,]
mymat[5,13] <- sum(myy$bc1cts_i_a[myy$treat == "EH20_60"] <= mythresh) #  were extinct at the start
mymat[5,14] <- sum(myy$bc1cts_f_a[myy$treat == "EH20_60"] <= mythresh) #  were extirpated in the fit0 assays
mymat[5,15] <- sum(myy$bc1cts_i_e[myy$treat == "EH20_60"] <= mythresh) #  extinct at start of fit500
mymat[5,16] <- sum(myy$bc1cts_f_e[myy$treat == "EH20_60"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH20_60"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH20_60"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH20_60"] <= mythresh)#  extirpated during the fit500 
mymatsum[5,4] <- sum(myy$bc1cts_i_a[myy$treat == "EH20_60"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH20_60"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH20_60"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH20_60"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH20_60"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH20_60"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH20_60"] <= mythresh))




# - EH0_80 ------------------------------------------
# --- in CM ------------------
myy <- my[my$epo %in% c("SALT_A", "SALT_B") & my$mpasp == 0.0,]
mymat[6,1] <- sum(myy$bc1cts_i_a[myy$treat == "EH0_80"] <= mythresh) #  were extinct at the start
mymat[6,2] <- sum(myy$bc1cts_f_a[myy$treat == "EH0_80"] <= mythresh) #  were extirpated in the fit0 assays
mymat[6,3] <- sum(myy$bc1cts_i_e[myy$treat == "EH0_80"] <= mythresh) #  extinct at start of fit500
mymat[6,4] <- sum(myy$bc1cts_f_e[myy$treat == "EH0_80"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH0_80"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH0_80"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH0_80"] <= mythresh)#  extirpated during the fit500 
mymatsum[6,1] <- sum(myy$bc1cts_i_a[myy$treat == "EH0_80"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH0_80"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH0_80"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH0_80"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH0_80"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH0_80"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH0_80"] <= mythresh))

# --- in salt 0.4 ------------------
myy <- my[my$epo %in% c("SALT_A", "SALT_B") & my$mpasp == 0.4,]
mymat[6,5] <- sum(myy$bc1cts_i_a[myy$treat == "EH0_80"] <= mythresh) #  were extinct at the start
mymat[6,6] <- sum(myy$bc1cts_f_a[myy$treat == "EH0_80"] <= mythresh) #  were extirpated in the fit0 assays
mymat[6,7] <- sum(myy$bc1cts_i_e[myy$treat == "EH0_80"] <= mythresh) #  extinct at start of fit500
mymat[6,8] <- sum(myy$bc1cts_f_e[myy$treat == "EH0_80"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH0_80"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH0_80"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH0_80"] <= mythresh)#  extirpated during the fit500 
mymatsum[6,2] <- sum(myy$bc1cts_i_a[myy$treat == "EH0_80"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH0_80"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH0_80"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH0_80"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH0_80"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH0_80"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH0_80"] <= mythresh))

# --- in salt 0.8 ------------------
myy <- my[my$epo %in% c("SALT_A", "SALT_B") & my$mpasp == 0.8,]
mymat[6,9] <- sum(myy$bc1cts_i_a[myy$treat == "EH0_80"] <= mythresh) #  were extinct at the start
mymat[6,10] <- sum(myy$bc1cts_f_a[myy$treat == "EH0_80"] <= mythresh) #  were extirpated in the fit0 assays
mymat[6,11] <- sum(myy$bc1cts_i_e[myy$treat == "EH0_80"] <= mythresh) #  extinct at start of fit500
mymat[6,12] <- sum(myy$bc1cts_f_e[myy$treat == "EH0_80"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH0_80"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH0_80"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH0_80"] <= mythresh)#  extirpated during the fit500 
mymatsum[6,3] <- sum(myy$bc1cts_i_a[myy$treat == "EH0_80"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH0_80"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH0_80"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH0_80"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH0_80"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH0_80"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH0_80"] <= mythresh))

# --- in salt 1.2 ------------------
myy <- my[my$epo %in% c("SALT_A", "SALT_B") & my$mpasp == 1.2,]
mymat[6,13] <- sum(myy$bc1cts_i_a[myy$treat == "EH0_80"] <= mythresh) #  were extinct at the start
mymat[6,14] <- sum(myy$bc1cts_f_a[myy$treat == "EH0_80"] <= mythresh) #  were extirpated in the fit0 assays
mymat[6,15] <- sum(myy$bc1cts_i_e[myy$treat == "EH0_80"] <= mythresh) #  extinct at start of fit500
mymat[6,16] <- sum(myy$bc1cts_f_e[myy$treat == "EH0_80"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH0_80"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH0_80"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH0_80"] <= mythresh)#  extirpated during the fit500 
mymatsum[6,4] <- sum(myy$bc1cts_i_a[myy$treat == "EH0_80"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH0_80"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH0_80"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH0_80"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH0_80"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH0_80"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH0_80"] <= mythresh))




# - EH40_80 ------------------------------------------
# --- in CM ------------------
myy <- my[my$epo %in% c("SALT_A", "SALT_B") & my$mpasp == 0.0,]
mymat[7,1] <- sum(myy$bc1cts_i_a[myy$treat == "EH40_80"] <= mythresh) #  were extinct at the start
mymat[7,2] <- sum(myy$bc1cts_f_a[myy$treat == "EH40_80"] <= mythresh) #  were extirpated in the fit0 assays
mymat[7,3] <- sum(myy$bc1cts_i_e[myy$treat == "EH40_80"] <= mythresh) #  extinct at start of fit500
mymat[7,4] <- sum(myy$bc1cts_f_e[myy$treat == "EH40_80"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH40_80"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH40_80"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH40_80"] <= mythresh)#  extirpated during the fit500 
mymatsum[7,1] <- sum(myy$bc1cts_i_a[myy$treat == "EH40_80"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH40_80"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH40_80"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH40_80"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH40_80"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH40_80"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH40_80"] <= mythresh))

# --- in salt 0.4 ------------------
myy <- my[my$epo %in% c("SALT_A", "SALT_B") & my$mpasp == 0.4,]
mymat[7,5] <- sum(myy$bc1cts_i_a[myy$treat == "EH40_80"] <= mythresh) #  were extinct at the start
mymat[7,6] <- sum(myy$bc1cts_f_a[myy$treat == "EH40_80"] <= mythresh) #  were extirpated in the fit0 assays
mymat[7,7] <- sum(myy$bc1cts_i_e[myy$treat == "EH40_80"] <= mythresh) #  extinct at start of fit500
mymat[7,8] <- sum(myy$bc1cts_f_e[myy$treat == "EH40_80"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH40_80"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH40_80"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH40_80"] <= mythresh)#  extirpated during the fit500 
mymatsum[7,2] <- sum(myy$bc1cts_i_a[myy$treat == "EH40_80"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH40_80"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH40_80"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH40_80"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH40_80"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH40_80"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH40_80"] <= mythresh))

# --- in salt 0.8 ------------------
myy <- my[my$epo %in% c("SALT_A", "SALT_B") & my$mpasp == 0.8,]
mymat[7,9] <- sum(myy$bc1cts_i_a[myy$treat == "EH40_80"] <= mythresh) #  were extinct at the start
mymat[7,10] <- sum(myy$bc1cts_f_a[myy$treat == "EH40_80"] <= mythresh) #  were extirpated in the fit0 assays
mymat[7,11] <- sum(myy$bc1cts_i_e[myy$treat == "EH40_80"] <= mythresh) #  extinct at start of fit500
mymat[7,12] <- sum(myy$bc1cts_f_e[myy$treat == "EH40_80"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH40_80"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH40_80"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH40_80"] <= mythresh)#  extirpated during the fit500 
mymatsum[7,3] <- sum(myy$bc1cts_i_a[myy$treat == "EH40_80"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH40_80"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH40_80"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH40_80"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH40_80"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH40_80"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH40_80"] <= mythresh))

# --- in salt 1.2 ------------------
myy <- my[my$epo %in% c("SALT_A", "SALT_B") & my$mpasp == 1.2,]
mymat[7,13] <- sum(myy$bc1cts_i_a[myy$treat == "EH40_80"] <= mythresh) #  were extinct at the start
mymat[7,14] <- sum(myy$bc1cts_f_a[myy$treat == "EH40_80"] <= mythresh) #  were extirpated in the fit0 assays
mymat[7,15] <- sum(myy$bc1cts_i_e[myy$treat == "EH40_80"] <= mythresh) #  extinct at start of fit500
mymat[7,16] <- sum(myy$bc1cts_f_e[myy$treat == "EH40_80"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH40_80"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH40_80"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH40_80"] <= mythresh)#  extirpated during the fit500 
mymatsum[7,4] <- sum(myy$bc1cts_i_a[myy$treat == "EH40_80"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH40_80"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH40_80"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH40_80"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH40_80"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH40_80"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH40_80"] <= mythresh))
mySALTee <- mymat
mySALTmatsum <- mymatsum
rownames(mySALTee) <- c("EH0", "EH40", "EH80", "EH0_40", "EH20_60", "EH0_80", "EH40_80")
colnames(mySALTee) <- c("0.0_xtinc_a", "0.0_xtirp_a", "0.0_xtinc_e", "0.0_xtirp_e", 
                        "0.4_xtinc_a", "0.4_xtirp_a", "0.4_xtinc_e", "0.4_xtirp_e", 
                        "0.8_xtinc_a", "0.8_xtirp_a", "0.8_xtinc_e", "0.8_xtirp_e", 
                        "1.2_xtinc_a", "1.2_xtirp_a", "1.2_xtinc_e", "1.2_xtirp_e")

# mye <- mySALTee# now want to make a matrix for the denominator of our proportion calculation...taking into account barcodes lost at previous stages.
# mye["EH0",] <- length(unique(myy$bcpID[myy$treat == "EH0"])) 
# mye["EH40",] <- length(unique(myy$bcpID[myy$treat == "EH40"])) 
# mye["EH80",] <- length(unique(myy$bcpID[myy$treat == "EH80"])) 
# mye["EH0_40",] <- length(unique(myy$bcpID[myy$treat == "EH0_40"])) 
# mye["EH20_60",] <- length(unique(myy$bcpID[myy$treat == "EH20_60"])) 
# mye["EH0_80",] <- length(unique(myy$bcpID[myy$treat == "EH0_80"])) 
# mye["EH40_80",] <- length(unique(myy$bcpID[myy$treat == "EH40_80"])) 
# 
# 
# mye[,2] <- mye[,2] - (mySALTee[,1]) # in CM
# mye[,3] <- mye[,3] - ((mySALTee[,2]) + (mySALTee[,1]))
# mye[,4] <- mye[,4] - ((mySALTee[,3]) + (mySALTee[,2]) + mySALTee[,1]) 
# 
# mye[,6] <- mye[,6] - (mySALTee[,5]) # in SALT 40
# mye[,7] <- mye[,7] - ((mySALTee[,6]) + (mySALTee[,5]))
# mye[,8] <- mye[,8] - ((mySALTee[,7]) + (mySALTee[,6]) + mySALTee[,5]) 
# 
# mye[,10] <- mye[,10] - (mySALTee[,9]) # in SALT 80
# mye[,11] <- mye[,11] - ((mySALTee[,10]) + (mySALTee[,9]))
# mye[,12] <- mye[,12] - ((mySALTee[,11]) + (mySALTee[,10]) + mySALTee[,9]) 
# 
# mye[,14] <- mye[,14] - (mySALTee[,13]) # in SALT 120
# mye[,15] <- mye[,15] - ((mySALTee[,14]) + (mySALTee[,13]))
# mye[,16] <- mye[,16] - ((mySALTee[,15]) + (mySALTee[,14]) + mySALTee[,13]) 
# 
# mySALTee_denom <- mye; rm(mye)
# mySALTee_p <- mySALTee / mySALTee_denom






# COPR -----------------------------------------------------
mymat <- matrix(nrow = 7, ncol = 16)
mymatsum <- matrix(nrow = 7, ncol = 4)
# - EH0 ------------------------------------------
# --- in CM ------------------
myy <- my[my$epo %in% c("COPR_A", "COPR_B") & my$mpasp == 0.0,]
mymat[1,1] <- sum(myy$bc1cts_i_a[myy$treat == "EH0"] <= mythresh) #  were extinct at the start
mymat[1,2] <- sum(myy$bc1cts_f_a[myy$treat == "EH0"] <= mythresh) #  were extirpated in the fit0 assays
mymat[1,3] <- sum(myy$bc1cts_i_e[myy$treat == "EH0"] <= mythresh) #  extinct at start of fit500
mymat[1,4] <- sum(myy$bc1cts_f_e[myy$treat == "EH0"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH0"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH0"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH0"] <= mythresh)#  extirpated during the fit500 
mymatsum[1,1] <- sum(myy$bc1cts_i_a[myy$treat == "EH0"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH0"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH0"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH0"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH0"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH0"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH0"] <= mythresh))

# --- in copr 0.4 ------------------
myy <- my[my$epo %in% c("COPR_A", "COPR_B") & my$mpasp == 0.4,]
mymat[1,5] <- sum(myy$bc1cts_i_a[myy$treat == "EH0"] <= mythresh) #  were extinct at the start
mymat[1,6] <- sum(myy$bc1cts_f_a[myy$treat == "EH0"] <= mythresh) #  were extirpated in the fit0 assays
mymat[1,7] <- sum(myy$bc1cts_i_e[myy$treat == "EH0"] <= mythresh) #  extinct at start of fit500
mymat[1,8] <- sum(myy$bc1cts_f_e[myy$treat == "EH0"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH0"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH0"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH0"] <= mythresh)#  extirpated during the fit500 
mymatsum[1,2] <- sum(myy$bc1cts_i_a[myy$treat == "EH0"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH0"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH0"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH0"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH0"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH0"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH0"] <= mythresh))

# --- in copr 0.8 ------------------
myy <- my[my$epo %in% c("COPR_A", "COPR_B") & my$mpasp == 0.8,]
mymat[1,9] <- sum(myy$bc1cts_i_a[myy$treat == "EH0"] <= mythresh) #  were extinct at the start
mymat[1,10] <- sum(myy$bc1cts_f_a[myy$treat == "EH0"] <= mythresh) #  were extirpated in the fit0 assays
mymat[1,11] <- sum(myy$bc1cts_i_e[myy$treat == "EH0"] <= mythresh) #  extinct at start of fit500
mymat[1,12] <- sum(myy$bc1cts_f_e[myy$treat == "EH0"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH0"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH0"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH0"] <= mythresh)#  extirpated during the fit500 
mymatsum[1,3] <- sum(myy$bc1cts_i_a[myy$treat == "EH0"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH0"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH0"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH0"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH0"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH0"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH0"] <= mythresh))

# --- in copr 1.2 ------------------
myy <- my[my$epo %in% c("COPR_A", "COPR_B") & my$mpasp == 1.2,]
mymat[1,13] <- sum(myy$bc1cts_i_a[myy$treat == "EH0"] <= mythresh) #  were extinct at the start
mymat[1,14] <- sum(myy$bc1cts_f_a[myy$treat == "EH0"] <= mythresh) #  were extirpated in the fit0 assays
mymat[1,15] <- sum(myy$bc1cts_i_e[myy$treat == "EH0"] <= mythresh) #  extinct at start of fit500
mymat[1,16] <- sum(myy$bc1cts_f_e[myy$treat == "EH0"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH0"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH0"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH0"] <= mythresh)#  extirpated during the fit500 
mymatsum[1,4] <- sum(myy$bc1cts_i_a[myy$treat == "EH0"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH0"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH0"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH0"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH0"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH0"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH0"] <= mythresh))


# - EH40 ------------------------------------------
# --- in CM ------------------
myy <- my[my$epo %in% c("COPR_A", "COPR_B") & my$mpasp == 0.0,]
mymat[2,1] <- sum(myy$bc1cts_i_a[myy$treat == "EH40"] <= mythresh) #  were extinct at the start
mymat[2,2] <- sum(myy$bc1cts_f_a[myy$treat == "EH40"] <= mythresh) #  were extirpated in the fit0 assays
mymat[2,3] <- sum(myy$bc1cts_i_e[myy$treat == "EH40"] <= mythresh) #  extinct at start of fit500
mymat[2,4] <- sum(myy$bc1cts_f_e[myy$treat == "EH40"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH40"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH40"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH40"] <= mythresh)#  extirpated during the fit500 
mymatsum[2,1] <- sum(myy$bc1cts_i_a[myy$treat == "EH40"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH40"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH40"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH40"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH40"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH40"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH40"] <= mythresh))

# --- in copr 0.4 ------------------
myy <- my[my$epo %in% c("COPR_A", "COPR_B") & my$mpasp == 0.4,]
mymat[2,5] <- sum(myy$bc1cts_i_a[myy$treat == "EH40"] <= mythresh) #  were extinct at the start
mymat[2,6] <- sum(myy$bc1cts_f_a[myy$treat == "EH40"] <= mythresh) #  were extirpated in the fit0 assays
mymat[2,7] <- sum(myy$bc1cts_i_e[myy$treat == "EH40"] <= mythresh) #  extinct at start of fit500
mymat[2,8] <- sum(myy$bc1cts_f_e[myy$treat == "EH40"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH40"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH40"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH40"] <= mythresh)#  extirpated during the fit500 
mymatsum[2,2] <- sum(myy$bc1cts_i_a[myy$treat == "EH40"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH40"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH40"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH40"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH40"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH40"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH40"] <= mythresh))

# --- in copr 0.8 ------------------
myy <- my[my$epo %in% c("COPR_A", "COPR_B") & my$mpasp == 0.8,]
mymat[2,9] <- sum(myy$bc1cts_i_a[myy$treat == "EH40"] <= mythresh) #  were extinct at the start
mymat[2,10] <- sum(myy$bc1cts_f_a[myy$treat == "EH40"] <= mythresh) #  were extirpated in the fit0 assays
mymat[2,11] <- sum(myy$bc1cts_i_e[myy$treat == "EH40"] <= mythresh) #  extinct at start of fit500
mymat[2,12] <- sum(myy$bc1cts_f_e[myy$treat == "EH40"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH40"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH40"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH40"] <= mythresh)#  extirpated during the fit500 
mymatsum[2,3] <- sum(myy$bc1cts_i_a[myy$treat == "EH40"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH40"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH40"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH40"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH40"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH40"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH40"] <= mythresh))

# --- in copr 1.2 ------------------
myy <- my[my$epo %in% c("COPR_A", "COPR_B") & my$mpasp == 1.2,]
mymat[2,13] <- sum(myy$bc1cts_i_a[myy$treat == "EH40"] <= mythresh) #  were extinct at the start
mymat[2,14] <- sum(myy$bc1cts_f_a[myy$treat == "EH40"] <= mythresh) #  were extirpated in the fit0 assays
mymat[2,15] <- sum(myy$bc1cts_i_e[myy$treat == "EH40"] <= mythresh) #  extinct at start of fit500
mymat[2,16] <- sum(myy$bc1cts_f_e[myy$treat == "EH40"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH40"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH40"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH40"] <= mythresh)#  extirpated during the fit500 
mymatsum[2,4] <- sum(myy$bc1cts_i_a[myy$treat == "EH40"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH40"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH40"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH40"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH40"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH40"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH40"] <= mythresh))



# - EH80 ------------------------------------------
# --- in CM ------------------
myy <- my[my$epo %in% c("COPR_A", "COPR_B") & my$mpasp == 0.0,]
mymat[3,1] <- sum(myy$bc1cts_i_a[myy$treat == "EH80"] <= mythresh) #  were extinct at the start
mymat[3,2] <- sum(myy$bc1cts_f_a[myy$treat == "EH80"] <= mythresh) #  were extirpated in the fit0 assays
mymat[3,3] <- sum(myy$bc1cts_i_e[myy$treat == "EH80"] <= mythresh) #  extinct at start of fit500
mymat[3,4] <- sum(myy$bc1cts_f_e[myy$treat == "EH80"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH80"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH80"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH80"] <= mythresh)#  extirpated during the fit500 
mymatsum[3,1] <- sum(myy$bc1cts_i_a[myy$treat == "EH80"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH80"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH80"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH80"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH80"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH80"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH80"] <= mythresh))

# --- in copr 0.4 ------------------
myy <- my[my$epo %in% c("COPR_A", "COPR_B") & my$mpasp == 0.4,]
mymat[3,5] <- sum(myy$bc1cts_i_a[myy$treat == "EH80"] <= mythresh) #  were extinct at the start
mymat[3,6] <- sum(myy$bc1cts_f_a[myy$treat == "EH80"] <= mythresh) #  were extirpated in the fit0 assays
mymat[3,7] <- sum(myy$bc1cts_i_e[myy$treat == "EH80"] <= mythresh) #  extinct at start of fit500
mymat[3,8] <- sum(myy$bc1cts_f_e[myy$treat == "EH80"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH80"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH80"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH80"] <= mythresh)#  extirpated during the fit500 
mymatsum[3,2] <- sum(myy$bc1cts_i_a[myy$treat == "EH80"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH80"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH80"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH80"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH80"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH80"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH80"] <= mythresh))
# --- in copr 0.8 ------------------
myy <- my[my$epo %in% c("COPR_A", "COPR_B") & my$mpasp == 0.8,]
mymat[3,9] <- sum(myy$bc1cts_i_a[myy$treat == "EH80"] <= mythresh) #  were extinct at the start
mymat[3,10] <- sum(myy$bc1cts_f_a[myy$treat == "EH80"] <= mythresh) #  were extirpated in the fit0 assays
mymat[3,11] <- sum(myy$bc1cts_i_e[myy$treat == "EH80"] <= mythresh) #  extinct at start of fit500
mymat[3,12] <- sum(myy$bc1cts_f_e[myy$treat == "EH80"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH80"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH80"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH80"] <= mythresh)#  extirpated during the fit500 
mymatsum[3,3] <- sum(myy$bc1cts_i_a[myy$treat == "EH80"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH80"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH80"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH80"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH80"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH80"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH80"] <= mythresh))
# --- in copr 1.2 ------------------
myy <- my[my$epo %in% c("COPR_A", "COPR_B") & my$mpasp == 1.2,]
mymat[3,13] <- sum(myy$bc1cts_i_a[myy$treat == "EH80"] <= mythresh) #  were extinct at the start
mymat[3,14] <- sum(myy$bc1cts_f_a[myy$treat == "EH80"] <= mythresh) #  were extirpated in the fit0 assays
mymat[3,15] <- sum(myy$bc1cts_i_e[myy$treat == "EH80"] <= mythresh) #  extinct at start of fit500
mymat[3,16] <- sum(myy$bc1cts_f_e[myy$treat == "EH80"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH80"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH80"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH80"] <= mythresh)#  extirpated during the fit500 
mymatsum[3,4] <- sum(myy$bc1cts_i_a[myy$treat == "EH80"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH80"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH80"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH80"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH80"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH80"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH80"] <= mythresh))



# - EH0_40 ------------------------------------------
# --- in CM ------------------
myy <- my[my$epo %in% c("COPR_A", "COPR_B") & my$mpasp == 0.0,]
mymat[4,1] <- sum(myy$bc1cts_i_a[myy$treat == "EH0_40"] <= mythresh) #  were extinct at the start
mymat[4,2] <- sum(myy$bc1cts_f_a[myy$treat == "EH0_40"] <= mythresh) #  were extirpated in the fit0 assays
mymat[4,3] <- sum(myy$bc1cts_i_e[myy$treat == "EH0_40"] <= mythresh) #  extinct at start of fit500
mymat[4,4] <- sum(myy$bc1cts_f_e[myy$treat == "EH0_40"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH0_40"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH0_40"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH0_40"] <= mythresh)#  extirpated during the fit500 
mymatsum[4,1] <- sum(myy$bc1cts_i_a[myy$treat == "EH0_40"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH0_40"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH0_40"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH0_40"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH0_40"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH0_40"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH0_40"] <= mythresh))
# --- in copr 0.4 ------------------
myy <- my[my$epo %in% c("COPR_A", "COPR_B") & my$mpasp == 0.4,]
mymat[4,5] <- sum(myy$bc1cts_i_a[myy$treat == "EH0_40"] <= mythresh) #  were extinct at the start
mymat[4,6] <- sum(myy$bc1cts_f_a[myy$treat == "EH0_40"] <= mythresh) #  were extirpated in the fit0 assays
mymat[4,7] <- sum(myy$bc1cts_i_e[myy$treat == "EH0_40"] <= mythresh) #  extinct at start of fit500
mymat[4,8] <- sum(myy$bc1cts_f_e[myy$treat == "EH0_40"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH0_40"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH0_40"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH0_40"] <= mythresh)#  extirpated during the fit500 
mymatsum[4,2] <- sum(myy$bc1cts_i_a[myy$treat == "EH0_40"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH0_40"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH0_40"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH0_40"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH0_40"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH0_40"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH0_40"] <= mythresh))

# --- in copr 0.8 ------------------
myy <- my[my$epo %in% c("COPR_A", "COPR_B") & my$mpasp == 0.8,]
mymat[4,9] <- sum(myy$bc1cts_i_a[myy$treat == "EH0_40"] <= mythresh) #  were extinct at the start
mymat[4,10] <- sum(myy$bc1cts_f_a[myy$treat == "EH0_40"] <= mythresh) #  were extirpated in the fit0 assays
mymat[4,11] <- sum(myy$bc1cts_i_e[myy$treat == "EH0_40"] <= mythresh) #  extinct at start of fit500
mymat[4,12] <- sum(myy$bc1cts_f_e[myy$treat == "EH0_40"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH0_40"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH0_40"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH0_40"] <= mythresh)#  extirpated during the fit500 
mymatsum[4,3] <- sum(myy$bc1cts_i_a[myy$treat == "EH0_40"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH0_40"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH0_40"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH0_40"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH0_40"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH0_40"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH0_40"] <= mythresh))

# --- in copr 1.2 ------------------
myy <- my[my$epo %in% c("COPR_A", "COPR_B") & my$mpasp == 1.2,]
mymat[4,13] <- sum(myy$bc1cts_i_a[myy$treat == "EH0_40"] <= mythresh) #  were extinct at the start
mymat[4,14] <- sum(myy$bc1cts_f_a[myy$treat == "EH0_40"] <= mythresh) #  were extirpated in the fit0 assays
mymat[4,15] <- sum(myy$bc1cts_i_e[myy$treat == "EH0_40"] <= mythresh) #  extinct at start of fit500
mymat[4,16] <- sum(myy$bc1cts_f_e[myy$treat == "EH0_40"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH0_40"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH0_40"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH0_40"] <= mythresh)#  extirpated during the fit500 
mymatsum[4,4] <- sum(myy$bc1cts_i_a[myy$treat == "EH0_40"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH0_40"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH0_40"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH0_40"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH0_40"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH0_40"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH0_40"] <= mythresh))



# - EH20_60 ------------------------------------------
# --- in CM ------------------
myy <- my[my$epo %in% c("COPR_A", "COPR_B") & my$mpasp == 0.0,]
mymat[5,1] <- sum(myy$bc1cts_i_a[myy$treat == "EH20_60"] <= mythresh) #  were extinct at the start
mymat[5,2] <- sum(myy$bc1cts_f_a[myy$treat == "EH20_60"] <= mythresh) #  were extirpated in the fit0 assays
mymat[5,3] <- sum(myy$bc1cts_i_e[myy$treat == "EH20_60"] <= mythresh) #  extinct at start of fit500
mymat[5,4] <- sum(myy$bc1cts_f_e[myy$treat == "EH20_60"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH20_60"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH20_60"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH20_60"] <= mythresh)#  extirpated during the fit500 
mymatsum[5,1] <- sum(myy$bc1cts_i_a[myy$treat == "EH20_60"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH20_60"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH20_60"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH20_60"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH20_60"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH20_60"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH20_60"] <= mythresh))
# --- in copr 0.4 ------------------
myy <- my[my$epo %in% c("COPR_A", "COPR_B") & my$mpasp == 0.4,]
mymat[5,5] <- sum(myy$bc1cts_i_a[myy$treat == "EH20_60"] <= mythresh) #  were extinct at the start
mymat[5,6] <- sum(myy$bc1cts_f_a[myy$treat == "EH20_60"] <= mythresh) #  were extirpated in the fit0 assays
mymat[5,7] <- sum(myy$bc1cts_i_e[myy$treat == "EH20_60"] <= mythresh) #  extinct at start of fit500
mymat[5,8] <- sum(myy$bc1cts_f_e[myy$treat == "EH20_60"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH20_60"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH20_60"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH20_60"] <= mythresh)#  extirpated during the fit500 
mymatsum[5,2] <- sum(myy$bc1cts_i_a[myy$treat == "EH20_60"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH20_60"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH20_60"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH20_60"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH20_60"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH20_60"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH20_60"] <= mythresh))

# --- in copr 0.8 ------------------
myy <- my[my$epo %in% c("COPR_A", "COPR_B") & my$mpasp == 0.8,]
mymat[5,9] <- sum(myy$bc1cts_i_a[myy$treat == "EH20_60"] <= mythresh) #  were extinct at the start
mymat[5,10] <- sum(myy$bc1cts_f_a[myy$treat == "EH20_60"] <= mythresh) #  were extirpated in the fit0 assays
mymat[5,11] <- sum(myy$bc1cts_i_e[myy$treat == "EH20_60"] <= mythresh) #  extinct at start of fit500
mymat[5,12] <- sum(myy$bc1cts_f_e[myy$treat == "EH20_60"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH20_60"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH20_60"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH20_60"] <= mythresh)#  extirpated during the fit500 
mymatsum[5,3] <- sum(myy$bc1cts_i_a[myy$treat == "EH20_60"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH20_60"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH20_60"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH20_60"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH20_60"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH20_60"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH20_60"] <= mythresh))

# --- in copr 1.2 ------------------
myy <- my[my$epo %in% c("COPR_A", "COPR_B") & my$mpasp == 1.2,]
mymat[5,13] <- sum(myy$bc1cts_i_a[myy$treat == "EH20_60"] <= mythresh) #  were extinct at the start
mymat[5,14] <- sum(myy$bc1cts_f_a[myy$treat == "EH20_60"] <= mythresh) #  were extirpated in the fit0 assays
mymat[5,15] <- sum(myy$bc1cts_i_e[myy$treat == "EH20_60"] <= mythresh) #  extinct at start of fit500
mymat[5,16] <- sum(myy$bc1cts_f_e[myy$treat == "EH20_60"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH20_60"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH20_60"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH20_60"] <= mythresh)#  extirpated during the fit500 
mymatsum[5,4] <- sum(myy$bc1cts_i_a[myy$treat == "EH20_60"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH20_60"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH20_60"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH20_60"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH20_60"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH20_60"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH20_60"] <= mythresh))




# - EH0_80 ------------------------------------------
# --- in CM ------------------
myy <- my[my$epo %in% c("COPR_A", "COPR_B") & my$mpasp == 0.0,]
mymat[6,1] <- sum(myy$bc1cts_i_a[myy$treat == "EH0_80"] <= mythresh) #  were extinct at the start
mymat[6,2] <- sum(myy$bc1cts_f_a[myy$treat == "EH0_80"] <= mythresh) #  were extirpated in the fit0 assays
mymat[6,3] <- sum(myy$bc1cts_i_e[myy$treat == "EH0_80"] <= mythresh) #  extinct at start of fit500
mymat[6,4] <- sum(myy$bc1cts_f_e[myy$treat == "EH0_80"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH0_80"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH0_80"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH0_80"] <= mythresh)#  extirpated during the fit500 
mymatsum[6,1] <- sum(myy$bc1cts_i_a[myy$treat == "EH0_80"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH0_80"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH0_80"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH0_80"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH0_80"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH0_80"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH0_80"] <= mythresh))

# --- in copr 0.4 ------------------
myy <- my[my$epo %in% c("COPR_A", "COPR_B") & my$mpasp == 0.4,]
mymat[6,5] <- sum(myy$bc1cts_i_a[myy$treat == "EH0_80"] <= mythresh) #  were extinct at the start
mymat[6,6] <- sum(myy$bc1cts_f_a[myy$treat == "EH0_80"] <= mythresh) #  were extirpated in the fit0 assays
mymat[6,7] <- sum(myy$bc1cts_i_e[myy$treat == "EH0_80"] <= mythresh) #  extinct at start of fit500
mymat[6,8] <- sum(myy$bc1cts_f_e[myy$treat == "EH0_80"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH0_80"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH0_80"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH0_80"] <= mythresh)#  extirpated during the fit500 
mymatsum[6,2] <- sum(myy$bc1cts_i_a[myy$treat == "EH0_80"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH0_80"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH0_80"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH0_80"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH0_80"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH0_80"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH0_80"] <= mythresh))

# --- in copr 0.8 ------------------
myy <- my[my$epo %in% c("COPR_A", "COPR_B") & my$mpasp == 0.8,]
mymat[6,9] <- sum(myy$bc1cts_i_a[myy$treat == "EH0_80"] <= mythresh) #  were extinct at the start
mymat[6,10] <- sum(myy$bc1cts_f_a[myy$treat == "EH0_80"] <= mythresh) #  were extirpated in the fit0 assays
mymat[6,11] <- sum(myy$bc1cts_i_e[myy$treat == "EH0_80"] <= mythresh) #  extinct at start of fit500
mymat[6,12] <- sum(myy$bc1cts_f_e[myy$treat == "EH0_80"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH0_80"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH0_80"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH0_80"] <= mythresh)#  extirpated during the fit500 
mymatsum[6,3] <- sum(myy$bc1cts_i_a[myy$treat == "EH0_80"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH0_80"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH0_80"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH0_80"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH0_80"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH0_80"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH0_80"] <= mythresh))

# --- in copr 1.2 ------------------
myy <- my[my$epo %in% c("COPR_A", "COPR_B") & my$mpasp == 1.2,]
mymat[6,13] <- sum(myy$bc1cts_i_a[myy$treat == "EH0_80"] <= mythresh) #  were extinct at the start
mymat[6,14] <- sum(myy$bc1cts_f_a[myy$treat == "EH0_80"] <= mythresh) #  were extirpated in the fit0 assays
mymat[6,15] <- sum(myy$bc1cts_i_e[myy$treat == "EH0_80"] <= mythresh) #  extinct at start of fit500
mymat[6,16] <- sum(myy$bc1cts_f_e[myy$treat == "EH0_80"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH0_80"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH0_80"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH0_80"] <= mythresh)#  extirpated during the fit500 
mymatsum[6,4] <- sum(myy$bc1cts_i_a[myy$treat == "EH0_80"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH0_80"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH0_80"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH0_80"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH0_80"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH0_80"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH0_80"] <= mythresh))




# - EH40_80 ------------------------------------------
# --- in CM ------------------
myy <- my[my$epo %in% c("COPR_A", "COPR_B") & my$mpasp == 0.0,]
mymat[7,1] <- sum(myy$bc1cts_i_a[myy$treat == "EH40_80"] <= mythresh) #  were extinct at the start
mymat[7,2] <- sum(myy$bc1cts_f_a[myy$treat == "EH40_80"] <= mythresh) #  were extirpated in the fit0 assays
mymat[7,3] <- sum(myy$bc1cts_i_e[myy$treat == "EH40_80"] <= mythresh) #  extinct at start of fit500
mymat[7,4] <- sum(myy$bc1cts_f_e[myy$treat == "EH40_80"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH40_80"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH40_80"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH40_80"] <= mythresh)#  extirpated during the fit500 
mymatsum[7,1] <- sum(myy$bc1cts_i_a[myy$treat == "EH40_80"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH40_80"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH40_80"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH40_80"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH40_80"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH40_80"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH40_80"] <= mythresh))

# --- in copr 0.4 ------------------
myy <- my[my$epo %in% c("COPR_A", "COPR_B") & my$mpasp == 0.4,]
mymat[7,5] <- sum(myy$bc1cts_i_a[myy$treat == "EH40_80"] <= mythresh) #  were extinct at the start
mymat[7,6] <- sum(myy$bc1cts_f_a[myy$treat == "EH40_80"] <= mythresh) #  were extirpated in the fit0 assays
mymat[7,7] <- sum(myy$bc1cts_i_e[myy$treat == "EH40_80"] <= mythresh) #  extinct at start of fit500
mymat[7,8] <- sum(myy$bc1cts_f_e[myy$treat == "EH40_80"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH40_80"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH40_80"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH40_80"] <= mythresh)#  extirpated during the fit500 
mymatsum[7,2] <- sum(myy$bc1cts_i_a[myy$treat == "EH40_80"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH40_80"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH40_80"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH40_80"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH40_80"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH40_80"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH40_80"] <= mythresh))

# --- in copr 0.8 ------------------
myy <- my[my$epo %in% c("COPR_A", "COPR_B") & my$mpasp == 0.8,]
mymat[7,9] <- sum(myy$bc1cts_i_a[myy$treat == "EH40_80"] <= mythresh) #  were extinct at the start
mymat[7,10] <- sum(myy$bc1cts_f_a[myy$treat == "EH40_80"] <= mythresh) #  were extirpated in the fit0 assays
mymat[7,11] <- sum(myy$bc1cts_i_e[myy$treat == "EH40_80"] <= mythresh) #  extinct at start of fit500
mymat[7,12] <- sum(myy$bc1cts_f_e[myy$treat == "EH40_80"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH40_80"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH40_80"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH40_80"] <= mythresh)#  extirpated during the fit500 
mymatsum[7,3] <- sum(myy$bc1cts_i_a[myy$treat == "EH40_80"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH40_80"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH40_80"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH40_80"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH40_80"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH40_80"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH40_80"] <= mythresh))

# --- in copr 1.2 ------------------
myy <- my[my$epo %in% c("COPR_A", "COPR_B") & my$mpasp == 1.2,]
mymat[7,13] <- sum(myy$bc1cts_i_a[myy$treat == "EH40_80"] <= mythresh) #  were extinct at the start
mymat[7,14] <- sum(myy$bc1cts_f_a[myy$treat == "EH40_80"] <= mythresh) #  were extirpated in the fit0 assays
mymat[7,15] <- sum(myy$bc1cts_i_e[myy$treat == "EH40_80"] <= mythresh) #  extinct at start of fit500
mymat[7,16] <- sum(myy$bc1cts_f_e[myy$treat == "EH40_80"] <= mythresh & 
                    myy$bc1cts_f_e_2[myy$treat == "EH40_80"] <= mythresh & 
                    myy$bc1cts_f_e_3[myy$treat == "EH40_80"] <= mythresh  & 
                    myy$bc1cts_f_e_4[myy$treat == "EH40_80"] <= mythresh)#  extirpated during the fit500 
mymatsum[7,4] <- sum(myy$bc1cts_i_a[myy$treat == "EH40_80"] <= mythresh |
                       myy$bc1cts_f_a[myy$treat == "EH40_80"] <= mythresh |
                       myy$bc1cts_i_e[myy$treat == "EH40_80"] <= mythresh |
                       (myy$bc1cts_f_e[myy$treat == "EH40_80"] <= mythresh & 
                          myy$bc1cts_f_e_2[myy$treat == "EH40_80"] <= mythresh & 
                          myy$bc1cts_f_e_3[myy$treat == "EH40_80"] <= mythresh  & 
                          myy$bc1cts_f_e_4[myy$treat == "EH40_80"] <= mythresh))


myCOPRee <- mymat
myCOPRmatsum <- mymatsum
rownames(myCOPRee) <- rownames(mySALTee); colnames(myCOPRee) <- colnames(mySALTee)

# mye <- myCOPRee # now want to make a matrix for the denominator of our proportion calculation...taking into account barcodes lost at previous stages.
# mye["EH0",] <- length(unique(myy$bcpID[myy$treat == "EH0"])) 
# mye["EH40",] <- length(unique(myy$bcpID[myy$treat == "EH40"])) 
# mye["EH80",] <- length(unique(myy$bcpID[myy$treat == "EH80"])) 
# mye["EH0_40",] <- length(unique(myy$bcpID[myy$treat == "EH0_40"])) 
# mye["EH20_60",] <- length(unique(myy$bcpID[myy$treat == "EH20_60"])) 
# mye["EH0_80",] <- length(unique(myy$bcpID[myy$treat == "EH0_80"])) 
# mye["EH40_80",] <- length(unique(myy$bcpID[myy$treat == "EH40_80"])) 
# 
# 
# mye[,2] <- mye[,2] - (myCOPRee[,1]) # in CM
# mye[,3] <- mye[,3] - ((myCOPRee[,2]) + (myCOPRee[,1]))
# mye[,4] <- mye[,4] - ((myCOPRee[,3]) + (myCOPRee[,2]) + myCOPRee[,1]) 
# 
# mye[,6] <- mye[,6] - (myCOPRee[,5]) # in COPR 40
# mye[,7] <- mye[,7] - ((myCOPRee[,6]) + (myCOPRee[,5]))
# mye[,8] <- mye[,8] - ((myCOPRee[,7]) + (myCOPRee[,6]) + myCOPRee[,5]) 
# 
# mye[,10] <- mye[,10] - (myCOPRee[,9]) # in COPR 80
# mye[,11] <- mye[,11] - ((myCOPRee[,10]) + (myCOPRee[,9]))
# mye[,12] <- mye[,12] - ((myCOPRee[,11]) + (myCOPRee[,10]) + myCOPRee[,9]) 
# 
# mye[,14] <- mye[,14] - (myCOPRee[,13]) # in COPR 120
# mye[,15] <- mye[,15] - ((myCOPRee[,14]) + (myCOPRee[,13]))
# mye[,16] <- mye[,16] - ((myCOPRee[,15]) + (myCOPRee[,14]) + myCOPRee[,13]) 
# 
# myCOPRee_denom <- mye; rm(mye)
# myCOPRee_p <- myCOPRee / myCOPRee_denom


mycollapsed <- my
rm(my, my1, my2, my3, my4, myee, mymat, myy, bc1cts_f_e)
```


Load datasets
```{r, warning = FALSE, message=FALSE}
my <- myd
# view the most sensitive measure -- those barcodes that are actually omit at generation 500 (not present at start of the fit  assay)
hist((my$bc1cts_i_e[my$bc1cts_i_e <= 1000000]), breaks = 100)
hist((my$bc1cts_i_e[my$bc1cts_i_e <= 1000]), breaks = 100)
hist((my$bc1cts_i_e[my$bc1cts_i_e <= 200]), breaks = 100)
hist((my$bc1cts_i_e[my$bc1cts_i_e <= 100]), breaks = 100)
hist((my$bc1cts_i_e[my$bc1cts_i_e <= 50]), breaks = 100) # lets omit below 15, this look like a natural break -- we will apply this value at 4 timepoints...

# first take a look at how many entries fall w/in each category
sum(my$bc1cts_i_e <= 15) # entries with generation 500 fitness assay initial counts <= 15
sum(my$bc1cts_f_e <= 15) # "" generation 500 fitness assay final counts ""
sum(my$bc1cts_i_a <= 15) # "" generation 0 fitness assay initial counts ""
sum(my$bc1cts_f_a <= 15) # "" generation 0 fitness assay final counts ""

my$omit <- FALSE # initially set to false (was T for all < 2 counts originally)
my$omit[my$bc1cts_i_e <= 15] <- T # see prev block comments, just assignment here. 
my$omit[my$bc1cts_f_e <= 15] <- T
my$omit[my$bc1cts_i_a <= 15] <- T
my$omit[my$bc1cts_f_a <= 15] <- T

my$fit0[my$bc1cts_i_a <= 15 | my$bc1cts_f_a <= 15] <- NA # NA the data fields to ensure the ommision of these entires. 
my$fit500[my$omit == T] <- NA
my$dw[my$omit == T] <- NA


myd <- my
```
<br/><br/>





Create helper functions for linear model residual plotting and data transformation.
```{r, warning = FALSE, message=FALSE}
# expand_residuals creates a modified histogram of residuals. Each entry in the model output is plotted a number of times equal to its reads.
expand_residuals <- function(model, reads){
  myfr <- NA
  for(i in 1:length(residuals(model))){
    times <- (((reads[i] - min(reads, na.rm = T))/(max(reads) - min(reads)))*1000) + 1 
    myfr <- c(myfr, rep(residuals(model)[i], times = times))
  }
  return(myfr)
}

# log transformation for modeling. 
log_transform <- function(myvar){
  myvar <- log(((myvar - min(myvar))/(max(myvar) - min(myvar))) + 1) 
  return(myvar)
}

# no accepted way to do se on the weighted mean, suggest bootstrapping. There are 3 methods for empirical estimation, the one that performs closes to the bootstrap method is presented here. 
# https://stats.stackexchange.com/questions/25895/computing-standard-error-in-weighted-mean-estimation
weighted.var.se <- function(x, w, na.rm=FALSE)
#  Computes the variance of a weighted mean following Cochran 1977 definition
{
  if (na.rm) { w <- w[i <- !is.na(x)]; x <- x[i] }
  n = length(w)
  xWbar = weighted.mean(x,w,na.rm=na.rm)
  wbar = mean(w)
  out = n/((n-1)*sum(w)^2)*(sum((w*x-wbar*xWbar)^2)-2*xWbar*sum((w-wbar)*(w*x-wbar*xWbar))+xWbar^2*sum((w-wbar)^2))
  return(out)
}


my_dens <- function(data, mapping, ...) {
  ggplot(data = data, mapping=mapping) +
    geom_density(..., alpha = 0.7) 
}
```
<br/><br/>


Set color palette options for all plots
```{r}
setpalette <- RColorBrewer::brewer.pal(7, "Dark2") # current preferred palette
#setpalette <- c("#993404","#d95f0e","#fe9929","#41b6c4","#2c7fb8","#253494") # option 2
#setpalette <- c("#8c510a","#d8b365","#f6e8c3", "#c7eae5","#5ab4ac","#01665e") # option 3
```
<br/><br/>


Plot initial fitness
```{r}
my <- myd
# Visualize -------------------------------------------------------------------
# myx <- my$fit0 - weighted.mean(my$fit0, my$re_fit_a) # non-mean-corrected are more interpretable. 
myx <- my$fit0
myr <- my$re_fit_a / mean(my$re_fit_a)
myc <- paste0(my$mpamt, my$mpasp)
mybinwidth <- 0.0025

mytitle <- NULL
myylab <- "Count"
myxlab <- "Ancestral Fitness (in Seven Environments)"

myhighlight <- "black"
myfillapha <- 0.8
myptalpha <- 0.35
mylinealpha <- 0.35
mypalette <- setpalette

mytextsize <- 8
myheight <- 7 
mywidth <- 7




p <- ggplot(my, aes(x=myx,color = myc, fill = myc, weight = myr)) + 
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = 0.05)+
  #xlim(c(-0.06, 0.06)) +
  geom_vline(xintercept = 1.0, linetype = "dashed", color = myhighlight) +
  scale_color_manual(values =mypalette, guide = FALSE) + 
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= c(0.8,0.6)) +
  labs(fill = "Fitness Assay Environment") +
  ggtitle(mytitle)+ ylab(myylab)+ xlab(myxlab)+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))+
  scale_x_continuous(breaks = seq(.75,1.25,by=0.05),
                     labels = c("0.75", "0.8", "0.85", "0.9", "0.95", "1.0","1.05", "1.1","1.15","1.2", "1.25"),
                     limits = c(.75, 1.25))+
  scale_y_continuous(breaks = seq(0, 1000, by = 100), limits = c(0, 700))
p
# -----------------------------------------------------------------------------

# figure output ---------------------------------------------------------------
pdf(file = "000_ancfit_cbyenv.pdf", width = mywidth, height = myheight); p; dev.off() # one column wide, equal height
# -----------------------------------------------------------------------------
rm(my, p, mybinwidth, myc, myfillapha, myheight, myhighlight, mylinealpha, mypalette, myptalpha, myr, mytextsize,
   mytitle, mywidth, myx, myxlab, myylab)
```
<br/><br/>


fit0 ~ treatment 
```{r}
# in CM ------------------------------------------------------------------------
my <- myd[myd$mpamt == "CM" & myd$mpasp == 0.0 & myd$epo == "SALT_A" & myd$mpar == 1,]
myt1 <- my[,c("bc1", "treat", "re_fit_r1a", "fit0r1")]; colnames(myt1) <- c("bc1","treat", "re_fit_a", "fit0")
myt2 <- my[,c("bc1", "treat", "re_fit_r2a", "fit0r2")]; colnames(myt2) <- c("bc1","treat", "re_fit_a", "fit0")
myt3 <- my[,c("bc1", "treat", "re_fit_r3a", "fit0r3")]; colnames(myt3) <- c("bc1","treat", "re_fit_a", "fit0")
myt4 <- my[,c("bc1", "treat", "re_fit_r4a", "fit0r4")]; colnames(myt4) <- c("bc1","treat", "re_fit_a", "fit0")
myt <- rbind(myt1, myt2, myt3, myt4)

myt$treat <- relevel(myt$treat, ref = "EH0")
mymod <- lmer(myt$fit0 ~ myt$treat + (1|myt$bc1), weights = myt$re_fit_a, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x
anova(mymod)

# in SALT40 ------------------------------------------------------------------------
my <- myd[myd$mpamt == "SALT" & myd$mpasp == 0.4 & myd$epo == "SALT_A" & myd$mpar == 1,]
myt1 <- my[,c("bc1", "treat", "re_fit_r1a", "fit0r1")]; colnames(myt1) <- c("bc1","treat", "re_fit_a", "fit0")
myt2 <- my[,c("bc1", "treat", "re_fit_r2a", "fit0r2")]; colnames(myt2) <- c("bc1","treat", "re_fit_a", "fit0")
myt3 <- my[,c("bc1", "treat", "re_fit_r3a", "fit0r3")]; colnames(myt3) <- c("bc1","treat", "re_fit_a", "fit0")
myt4 <- my[,c("bc1", "treat", "re_fit_r4a", "fit0r4")]; colnames(myt4) <- c("bc1","treat", "re_fit_a", "fit0")
myt <- rbind(myt1, myt2, myt3, myt4)

myt$treat <- relevel(myt$treat, ref = "EH0")
mymod <- lmer(myt$fit0 ~ myt$treat + (1|myt$bc1), weights = myt$re_fit_a, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x
anova(mymod)

# in SALT80 ------------------------------------------------------------------------
my <- myd[myd$mpamt == "SALT" & myd$mpasp == 0.8 & myd$epo == "SALT_A" & myd$mpar == 1,]
myt1 <- my[,c("bc1", "treat", "re_fit_r1a", "fit0r1")]; colnames(myt1) <- c("bc1","treat", "re_fit_a", "fit0")
myt2 <- my[,c("bc1", "treat", "re_fit_r2a", "fit0r2")]; colnames(myt2) <- c("bc1","treat", "re_fit_a", "fit0")
myt3 <- my[,c("bc1", "treat", "re_fit_r3a", "fit0r3")]; colnames(myt3) <- c("bc1","treat", "re_fit_a", "fit0")
myt4 <- my[,c("bc1", "treat", "re_fit_r4a", "fit0r4")]; colnames(myt4) <- c("bc1","treat", "re_fit_a", "fit0")
myt <- rbind(myt1, myt2, myt3, myt4)

myt$treat <- relevel(myt$treat, ref = "EH0")
mymod <- lmer(myt$fit0 ~ myt$treat + (1|myt$bc1), weights = myt$re_fit_a, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x
anova(mymod)

# in SALT120 ------------------------------------------------------------------------
my <- myd[myd$mpamt == "SALT" & myd$mpasp == 1.2 & myd$epo == "SALT_A" & myd$mpar == 1,]
myt1 <- my[,c("bc1", "treat", "re_fit_r1a", "fit0r1")]; colnames(myt1) <- c("bc1","treat", "re_fit_a", "fit0")
myt2 <- my[,c("bc1", "treat", "re_fit_r2a", "fit0r2")]; colnames(myt2) <- c("bc1","treat", "re_fit_a", "fit0")
myt3 <- my[,c("bc1", "treat", "re_fit_r3a", "fit0r3")]; colnames(myt3) <- c("bc1","treat", "re_fit_a", "fit0")
myt4 <- my[,c("bc1", "treat", "re_fit_r4a", "fit0r4")]; colnames(myt4) <- c("bc1","treat", "re_fit_a", "fit0")
myt <- rbind(myt1, myt2, myt3, myt4)

myt$treat <- relevel(myt$treat, ref = "EH0")
mymod <- lmer(myt$fit0 ~ myt$treat + (1|myt$bc1), weights = myt$re_fit_a, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x
anova(mymod)

# in COPR40 ------------------------------------------------------------------------
my <- myd[myd$mpamt == "COPR" & myd$mpasp == 0.4 & myd$epo == "COPR_A" & myd$mpar == 1,]
myt1 <- my[,c("bc1", "treat", "re_fit_r1a", "fit0r1")]; colnames(myt1) <- c("bc1","treat", "re_fit_a", "fit0")
myt2 <- my[,c("bc1", "treat", "re_fit_r2a", "fit0r2")]; colnames(myt2) <- c("bc1","treat", "re_fit_a", "fit0")
myt3 <- my[,c("bc1", "treat", "re_fit_r3a", "fit0r3")]; colnames(myt3) <- c("bc1","treat", "re_fit_a", "fit0")
myt4 <- my[,c("bc1", "treat", "re_fit_r4a", "fit0r4")]; colnames(myt4) <- c("bc1","treat", "re_fit_a", "fit0")
myt <- rbind(myt1, myt2, myt3, myt4)

myt$treat <- relevel(myt$treat, ref = "EH0")
mymod <- lmer(myt$fit0 ~ myt$treat + (1|myt$bc1), weights = myt$re_fit_a, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x

anova(mymod)

# in COPR80 ------------------------------------------------------------------------
my <- myd[myd$mpamt == "COPR" & myd$mpasp == 0.8 & myd$epo == "COPR_A" & myd$mpar == 1,]
myt1 <- my[,c("bc1", "treat", "re_fit_r1a", "fit0r1")]; colnames(myt1) <- c("bc1","treat", "re_fit_a", "fit0")
myt2 <- my[,c("bc1", "treat", "re_fit_r2a", "fit0r2")]; colnames(myt2) <- c("bc1","treat", "re_fit_a", "fit0")
myt3 <- my[,c("bc1", "treat", "re_fit_r3a", "fit0r3")]; colnames(myt3) <- c("bc1","treat", "re_fit_a", "fit0")
myt4 <- my[,c("bc1", "treat", "re_fit_r4a", "fit0r4")]; colnames(myt4) <- c("bc1","treat", "re_fit_a", "fit0")
myt <- rbind(myt1, myt2, myt3, myt4)

myt$treat <- relevel(myt$treat, ref = "EH0")
mymod <- lmer(myt$fit0 ~ myt$treat + (1|myt$bc1), weights = myt$re_fit_a, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x
anova(mymod)

# in COPR120 ------------------------------------------------------------------------
my <- myd[myd$mpamt == "COPR" & myd$mpasp == 1.2 & myd$epo == "COPR_A" & myd$mpar == 1,]
myt1 <- my[,c("bc1", "treat", "re_fit_r1a", "fit0r1")]; colnames(myt1) <- c("bc1","treat", "re_fit_a", "fit0")
myt2 <- my[,c("bc1", "treat", "re_fit_r2a", "fit0r2")]; colnames(myt2) <- c("bc1","treat", "re_fit_a", "fit0")
myt3 <- my[,c("bc1", "treat", "re_fit_r3a", "fit0r3")]; colnames(myt3) <- c("bc1","treat", "re_fit_a", "fit0")
myt4 <- my[,c("bc1", "treat", "re_fit_r4a", "fit0r4")]; colnames(myt4) <- c("bc1","treat", "re_fit_a", "fit0")
myt <- rbind(myt1, myt2, myt3, myt4)

myt$treat <- relevel(myt$treat, ref = "EH0")
mymod <- lmer(myt$fit0 ~ myt$treat + (1|myt$bc1), weights = myt$re_fit_a, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x
anova(mymod)


# create temporary plotting dataframe -----------------------------------------
myres <- as.data.frame(coef(summary(mymod)), stringsAsFactors = F) # create a myres dataframe to aid in plotting. 
myres$p.adjust <- p.adjust(myres$`Pr(>|t|)`, method = "fdr")
```
<br/><br/>

dw associated with weight?
```{r}
my <- myd[myd$omit == F,]
# untransformed -- looks like there is some kind of pattern
hist(my$dw)
hist(my$re_dw)
plot(my$dw ~ my$re_dw) # linear model wouldnt be appropriate here. 
plot(my$re_dw ~ my$dw) # OBSERVATION: data distribution is approximately hump shaped with mean near 0 (no change in fitness). Higher weights are likely to have fitness values closer to hump mean. This makes sense -- higher weight means more counts recovered at all timepoints means more confidence in fitness calculation, means less likely to pick up spurious increases / decreases in fitness caused by stocahsticity in sampling

# look at everything together --------------------------------------------------
myx <- my$dw
myy <- my$re_dw
# myx <- scale(my$dw)
# myy <- scale(my$re_dw)
myc <- paste0(my$mpamt, my$mpasp)
mys <- my$treat

mytitle <- NULL
myylab <- "Weight (reads)"
myxlab <- "dw"

myhighlight <- "black"
myfillapha <- 0.35
myptalpha <- 0.35
mylinealpha <- 0.35
mypalette <- setpalette

mytextsize <- 8
myheight <- 7
mywidth <- 7
myptsize <- 0.75
mystroke <- 1.5

mymod <- lmer(myy ~ myx + (myx||paste0(my$mpamt, my$mpasp))); summary(mymod)
p <- ggplot(my, aes(x=myx, y=myy, color = myc))+
  geom_point(aes(color=myc, pch = mys), alpha = myptalpha, stroke = mystroke)+
  geom_line(aes(y=predict(mymod), group = myc, color = myc), size = 1, alpha = myptalpha)+
  # geom_abline(intercept = 0, slope = 1)+
  scale_shape_manual(values=1:nlevels(mys))+
  geom_rug(alpha = myptalpha)+
  scale_color_manual(values = setpalette)+
  theme_classic() +
  labs(color = "Treatment") +
  ggtitle(mytitle) + ylab(myylab)+ xlab(myxlab) +
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
p
# figure output ----
pdf(file = "000_FitAndWeight_All.pdf", width = mywidth, height = myheight); p; dev.off() # one column wide, equal height
# ------------------------------------------------------------------------------




# look at SALT  --------------------------------------------------
my <- myd[myd$epo %in% c("SALT_A", "SALT_B") & myd$omit == F,]
myx <- my$dw
myy <- my$re_dw
myc <- paste0(my$mpamt, my$mpasp)
mys <- my$treat


mymod <- lmer(myy ~ myx + (myx||paste0(my$mpasp))); summary(mymod)
p <- ggplot(my, aes(x=myx, y=myy, color = myc))+
  geom_point(aes(color=myc, pch = mys), alpha = myptalpha, stroke = mystroke)+
  geom_line(aes(y=predict(mymod), group = myc, color = myc), size = 1, alpha = myptalpha)+
  scale_shape_manual(values=1:nlevels(mys))+
  geom_rug(alpha = myptalpha)+
  scale_color_manual(values = setpalette)+
  theme_classic() +
  labs(color = "Treatment") +
  ggtitle(mytitle) + ylab(myylab)+ xlab(myxlab) +
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
p
# figure output ----
pdf(file = "000_FitAndWeight_SALT.pdf", width = mywidth, height = myheight); p; dev.off() # one column wide, equal height
# ------------------------------------------------------------------------------





# look at COPR  --------------------------------------------------
my <- myd[myd$epo %in% c("COPR_A", "COPR_B") & myd$omit == F,]
myx <- my$dw
myy <- my$re_dw
myc <- paste0(my$mpamt, my$mpasp)
mys <- my$treat

mymod <- lmer(myy ~ myx + (myx||paste0(my$mpasp))); summary(mymod)
p <- ggplot(my, aes(x=myx, y=myy, color = myc))+
  geom_point(aes(color=myc, pch = mys), alpha = myptalpha, stroke = mystroke)+
  geom_line(aes(y=predict(mymod), group = myc, color = myc), size = 1, alpha = myptalpha)+
  scale_shape_manual(values=1:nlevels(mys))+
  geom_rug(alpha = myptalpha)+
  scale_color_manual(values = setpalette)+
  theme_classic() +
  labs(color = "Treatment") +
  ggtitle(mytitle) + ylab(myylab)+ xlab(myxlab) +
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
p
# figure output ----
pdf(file = "000_FitAndWeight_COPR.pdf", width = mywidth, height = myheight); p; dev.off() # one column wide, equal height
# ------------------------------------------------------------------------------


```
<br/><br/>





Test for fitness increase SALT
```{r}
mysig <- 0.05

# SALT RESULTS OUTPUT TABLES --------------------
mySALTin <- matrix(nrow = 7, ncol = 4)
mySALTdec <- matrix(nrow = 7, ncol = 4)
rownames(mySALTin) <- c("EH0", "EH40", "EH80", "EH0_40", "EH20_60", "EH0_80", "EH40_80")
rownames(mySALTdec) <- c("EH0", "EH40", "EH80", "EH0_40", "EH20_60", "EH0_80", "EH40_80")
colnames(mySALTin) <- c(0.0, 0.4, 0.8, 1.2)
colnames(mySALTdec) <- c(0.0, 0.4, 0.8, 1.2)
mySALTno <- matrix(nrow = 7, ncol = 4)

my <- myd[order(myd$bcpID),] # SALT in CM --------------------------------------------------------------------------------------------------
my <- my[my$epo %in% c("SALT_A", "SALT_B"),]
my <- my[my$mpasp == 0.0 & !is.na(my$dw),]

# model & diagnostic plots ----------------------------------------------------
mymod <- lm(my$dw ~ my$bcpID + 0, weights = my$re_dw); summary(mymod)
hist(residuals(mymod), breaks = 100); hist(expand_residuals(mymod, my$re_dw), breaks = 100); plot(mymod)

# model output -----------------------------------------------------------------
tab_model(mymod, digits = 5, digits.p = 8, show.stat = T, wrap.labels = 100, file = "salt00.html") # table does not have corrected p-values. 

# create results dataframe ----------------------------------------------------
myres <- as.data.frame(coef(summary(mymod)), stringsAsFactors = F)
myres$p1s_l <- pt(coef(summary(mymod))[, 3], mymod$df, lower = T) # one-sided test p-values for lower
myres$p1s_h <- pt(coef(summary(mymod))[, 3], mymod$df, lower = F) # one-sided test p-values for higher
myres$p1s_l.adj <- p.adjust(myres$p1s_l, method = "fdr") # fdr adjusted p value (for 1-sided lower)
myres$p1s_h.adj <- p.adjust(myres$p1s_h, method = "fdr") # fdr adjusted p value (for 1-sided higher)
myres$bcid <-  gsub("^.*?D","",rownames(myres)) # fix barcode id names
myres$m_dw <- ddply(my, ~bcpID, function(my) weighted.mean(my$dw, my$re_dw))[,2]
myres$m_re_dw <- ddply(my, ~bcpID, function(my) mean(my$re_dw))[,2]
myres$mcm_dw <- myres$m_dw - weighted.mean(myres$m_dw, myres$m_re_dw)
myres$in_color <- "fdr > 0.01"; myres$in_color[myres$p1s_h.adj <= mysig] <- "fdr <= mysig"
myres$in_color <- as.factor(myres$in_color); myres$in_color <- relevel(myres$in_color, "fdr > 0.01")
myres$dec_color <- "fdr > 0.01"; myres$dec_color[myres$p1s_l.adj <= mysig] <- "fdr <= mysig"
myres$dec_color <- as.factor(myres$dec_color); myres$dec_color <- relevel(myres$dec_color, "fdr > 0.01")
myres$treat <- NA
for (i in 1:length(myres$treat)) {
  myres$treat[i] <- as.character(my$treat)[my$bcpID == myres$bcid[i]][1]
}
# -----------------------------------------------------------------------------
tmp <- myres[myres$treat == "EH0",];mySALTdec[1,1] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[1,1] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[1,1] <- nrow(tmp)
tmp <- myres[myres$treat == "EH40",];mySALTdec[2,1] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[2,1] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[2,1] <- nrow(tmp)
tmp <- myres[myres$treat == "EH80",];mySALTdec[3,1] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[3,1] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[3,1] <- nrow(tmp)
tmp <- myres[myres$treat == "EH0_40",];mySALTdec[4,1] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[4,1] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[4,1] <- nrow(tmp)
tmp <- myres[myres$treat == "EH20_60",];mySALTdec[5,1] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[5,1] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[5,1] <- nrow(tmp)
tmp <- myres[myres$treat == "EH0_80",];mySALTdec[6,1] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[6,1] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[6,1] <- nrow(tmp)
tmp <- myres[myres$treat == "EH40_80",];mySALTdec[7,1] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[7,1] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[7,1] <- nrow(tmp)


my <- myd[order(myd$bcpID),] # SALT in 40 --------------------------------------------------------------------------------------------------
my <- my[my$epo %in% c("SALT_A", "SALT_B"),] 
my <- my[my$mpasp == 0.4 & !is.na(my$dw),]

# model & diagnostic plots ----------------------------------------------------
mymod <- lm(my$dw ~ my$bcpID + 0, weights = my$re_dw); summary(mymod)
hist(residuals(mymod), breaks = 100); hist(expand_residuals(mymod, my$re_dw), breaks = 100); plot(mymod)

# model output -----------------------------------------------------------------
tab_model(mymod, digits = 5, digits.p = 8, show.stat = T, wrap.labels = 100, file = "salt40.html") # table does not have corrected p-values. 

# create results dataframe ----------------------------------------------------
myres <- as.data.frame(coef(summary(mymod)), stringsAsFactors = F)
myres$p1s_l <- pt(coef(summary(mymod))[, 3], mymod$df, lower = T) # one-sided test p-values for lower
myres$p1s_h <- pt(coef(summary(mymod))[, 3], mymod$df, lower = F) # one-sided test p-values for higher
myres$p1s_l.adj <- p.adjust(myres$p1s_l, method = "fdr") # fdr adjusted p value (for 1-sided lower)
myres$p1s_h.adj <- p.adjust(myres$p1s_h, method = "fdr") # fdr adjusted p value (for 1-sided higher)
myres$bcid <-  gsub("^.*?D","",rownames(myres)) # fix barcode id names
myres$treat <- NA
for (i in 1:length(myres$treat)) {
  myres$treat[i] <- as.character(my$treat)[my$bcpID == myres$bcid[i]][1]
}
# -----------------------------------------------------------------------------
tmp <- myres[myres$treat == "EH0",];mySALTdec[1,2] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[1,2] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[1,2] <- nrow(tmp)
tmp <- myres[myres$treat == "EH40",];mySALTdec[2,2] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[2,2] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[2,2] <- nrow(tmp)
tmp <- myres[myres$treat == "EH80",];mySALTdec[3,2] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[3,2] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[3,2] <- nrow(tmp)
tmp <- myres[myres$treat == "EH0_40",];mySALTdec[4,2] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[4,2] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[4,2] <- nrow(tmp)
tmp <- myres[myres$treat == "EH20_60",];mySALTdec[5,2] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[5,2] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[5,2] <- nrow(tmp)
tmp <- myres[myres$treat == "EH0_80",];mySALTdec[6,2] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[6,2] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[6,2] <- nrow(tmp)
tmp <- myres[myres$treat == "EH40_80",];mySALTdec[7,2] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[7,2] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[7,2] <- nrow(tmp)


my <- myd[order(myd$bcpID),] # SALT in 80 --------------------------------------------------------------------------------------------------
my <- my[my$epo %in% c("SALT_A", "SALT_B"),] 
my <- my[my$mpasp == 0.8 & !is.na(my$dw),]

# model & diagnostic plots ----------------------------------------------------
mymod <- lm(my$dw ~ my$bcpID + 0, weights = my$re_dw); summary(mymod)
hist(residuals(mymod), breaks = 100); hist(expand_residuals(mymod, my$re_dw), breaks = 100); plot(mymod)

# model output -----------------------------------------------------------------
tab_model(mymod, digits = 5, digits.p = 8, show.stat = T, wrap.labels = 100, file = "salt80.html") # table does not have corrected p-values. 

# create results dataframe ----------------------------------------------------
myres <- as.data.frame(coef(summary(mymod)), stringsAsFactors = F)
myres$p1s_l <- pt(coef(summary(mymod))[, 3], mymod$df, lower = T) # one-sided test p-values for lower
myres$p1s_h <- pt(coef(summary(mymod))[, 3], mymod$df, lower = F) # one-sided test p-values for higher
myres$p1s_l.adj <- p.adjust(myres$p1s_l, method = "fdr") # fdr adjusted p value (for 1-sided lower)
myres$p1s_h.adj <- p.adjust(myres$p1s_h, method = "fdr") # fdr adjusted p value (for 1-sided higher)
myres$bcid <-  gsub("^.*?D","",rownames(myres)) # fix barcode id names
myres$treat <- NA
for (i in 1:length(myres$treat)) {
  myres$treat[i] <- as.character(my$treat)[my$bcpID == myres$bcid[i]][1]
}
# -----------------------------------------------------------------------------
tmp <- myres[myres$treat == "EH0",];mySALTdec[1,3] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[1,3] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[1,3] <- nrow(tmp)
tmp <- myres[myres$treat == "EH40",];mySALTdec[2,3] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[2,3] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[2,3] <- nrow(tmp)
tmp <- myres[myres$treat == "EH80",];mySALTdec[3,3] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[3,3] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[3,3] <- nrow(tmp)
tmp <- myres[myres$treat == "EH0_40",];mySALTdec[4,3] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[4,3] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[4,3] <- nrow(tmp)
tmp <- myres[myres$treat == "EH20_60",];mySALTdec[5,3] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[5,3] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[5,3] <- nrow(tmp)
tmp <- myres[myres$treat == "EH0_80",];mySALTdec[6,3] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[6,3] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[6,3] <- nrow(tmp)
tmp <- myres[myres$treat == "EH40_80",];mySALTdec[7,3] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[7,3] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[7,3] <- nrow(tmp)


my <- myd[order(myd$bcpID),] # SALT in 120 --------------------------------------------------------------------------------------------------
my <- my[my$epo %in% c("SALT_A", "SALT_B"),] 
my <- my[my$mpasp == 1.2 & !is.na(my$dw),]

# model & diagnostic plots ----------------------------------------------------
mymod <- lm(my$dw ~ my$bcpID + 0, weights = my$re_dw); summary(mymod)
hist(residuals(mymod), breaks = 100); hist(expand_residuals(mymod, my$re_dw), breaks = 100); plot(mymod)

# model output -----------------------------------------------------------------
tab_model(mymod, digits = 5, digits.p = 8, show.stat = T, wrap.labels = 100, file = "salt120.html") # table does not have corrected p-values. 

# create results dataframe ----------------------------------------------------
myres <- as.data.frame(coef(summary(mymod)), stringsAsFactors = F)
myres$p1s_l <- pt(coef(summary(mymod))[, 3], mymod$df, lower = T) # one-sided test p-values for lower
myres$p1s_h <- pt(coef(summary(mymod))[, 3], mymod$df, lower = F) # one-sided test p-values for higher
myres$p1s_l.adj <- p.adjust(myres$p1s_l, method = "fdr") # fdr adjusted p value (for 1-sided lower)
myres$p1s_h.adj <- p.adjust(myres$p1s_h, method = "fdr") # fdr adjusted p value (for 1-sided higher)
myres$bcid <-  gsub("^.*?D","",rownames(myres)) # fix barcode id names
myres$treat <- NA
for (i in 1:length(myres$treat)) {
  myres$treat[i] <- as.character(my$treat)[my$bcpID == myres$bcid[i]][1]
}
# -----------------------------------------------------------------------------
tmp <- myres[myres$treat == "EH0",];mySALTdec[1,4] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[1,4] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[1,4] <- nrow(tmp)
tmp <- myres[myres$treat == "EH40",];mySALTdec[2,4] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[2,4] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[2,4] <- nrow(tmp)
tmp <- myres[myres$treat == "EH80",];mySALTdec[3,4] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[3,4] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[3,4] <- nrow(tmp)
tmp <- myres[myres$treat == "EH0_40",];mySALTdec[4,4] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[4,4] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[4,4] <- nrow(tmp)
tmp <- myres[myres$treat == "EH20_60",];mySALTdec[5,4] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[5,4] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[5,4] <- nrow(tmp)
tmp <- myres[myres$treat == "EH0_80",];mySALTdec[6,4] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[6,4] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[6,4] <- nrow(tmp)
tmp <- myres[myres$treat == "EH40_80",];mySALTdec[7,4] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[7,4] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[7,4] <- nrow(tmp)

mySALTin_p <- mySALTin / mySALTno
mySALTdec_p <- mySALTdec / mySALTno
```







Test for fitness increase COPR
```{r}
mysig <- 0.05

# COPR RESULTS OUTPUT TABLES --------------------
myCOPRin <- matrix(nrow = 7, ncol = 4)
myCOPRdec <- matrix(nrow = 7, ncol = 4)
rownames(myCOPRin) <- c("EH0", "EH40", "EH80", "EH0_40", "EH20_60", "EH0_80", "EH40_80")
rownames(myCOPRdec) <- c("EH0", "EH40", "EH80", "EH0_40", "EH20_60", "EH0_80", "EH40_80")
colnames(myCOPRin) <- c(0.0, 0.4, 0.8, 1.2)
colnames(myCOPRdec) <- c(0.0, 0.4, 0.8, 1.2)
myCOPRno <- matrix(nrow = 7, ncol = 4)

my <- myd[order(myd$bcpID),] # COPR in CM --------------------------------------------------------------------------------------------------
my <- my[my$epo %in% c("COPR_A", "COPR_B"),]
my <- my[my$mpasp == 0.0 & !is.na(my$dw),]

# model & diagnostic plots ----------------------------------------------------
mymod <- lm(my$dw ~ my$bcpID + 0, weights = my$re_dw); summary(mymod)
hist(residuals(mymod), breaks = 100); hist(expand_residuals(mymod, my$re_dw), breaks = 100); plot(mymod)

# model output -----------------------------------------------------------------
tab_model(mymod, digits = 5, digits.p = 8, show.stat = T, wrap.labels = 100, file = "copr00.html") # table does not have corrected p-values. 

# create results dataframe ----------------------------------------------------
myres <- as.data.frame(coef(summary(mymod)), stringsAsFactors = F)
myres$p1s_l <- pt(coef(summary(mymod))[, 3], mymod$df, lower = T) # one-sided test p-values for lower
myres$p1s_h <- pt(coef(summary(mymod))[, 3], mymod$df, lower = F) # one-sided test p-values for higher
myres$p1s_l.adj <- p.adjust(myres$p1s_l, method = "fdr") # fdr adjusted p value (for 1-sided lower)
myres$p1s_h.adj <- p.adjust(myres$p1s_h, method = "fdr") # fdr adjusted p value (for 1-sided higher)
myres$bcid <-  gsub("^.*?D","",rownames(myres)) # fix barcode id names
myres$m_dw <- ddply(my, ~bcpID, function(my) weighted.mean(my$dw, my$re_dw))[,2]
myres$m_re_dw <- ddply(my, ~bcpID, function(my) mean(my$re_dw))[,2]
myres$mcm_dw <- myres$m_dw - weighted.mean(myres$m_dw, myres$m_re_dw)
myres$in_color <- "fdr > 0.01"; myres$in_color[myres$p1s_h.adj <= mysig] <- "fdr <= mysig"
myres$in_color <- as.factor(myres$in_color); myres$in_color <- relevel(myres$in_color, "fdr > 0.01")
myres$dec_color <- "fdr > 0.01"; myres$dec_color[myres$p1s_l.adj <= mysig] <- "fdr <= mysig"
myres$dec_color <- as.factor(myres$dec_color); myres$dec_color <- relevel(myres$dec_color, "fdr > 0.01")
myres$treat <- NA
for (i in 1:length(myres$treat)) {
  myres$treat[i] <- as.character(my$treat)[my$bcpID == myres$bcid[i]][1]
}
# -----------------------------------------------------------------------------
tmp <- myres[myres$treat == "EH0",];myCOPRdec[1,1] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[1,1] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[1,1] <- nrow(tmp)
tmp <- myres[myres$treat == "EH40",];myCOPRdec[2,1] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[2,1] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[2,1] <- nrow(tmp)
tmp <- myres[myres$treat == "EH80",];myCOPRdec[3,1] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[3,1] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[3,1] <- nrow(tmp)
tmp <- myres[myres$treat == "EH0_40",];myCOPRdec[4,1] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[4,1] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[4,1] <- nrow(tmp)
tmp <- myres[myres$treat == "EH20_60",];myCOPRdec[5,1] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[5,1] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[5,1] <- nrow(tmp)
tmp <- myres[myres$treat == "EH0_80",];myCOPRdec[6,1] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[6,1] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[6,1] <- nrow(tmp)
tmp <- myres[myres$treat == "EH40_80",];myCOPRdec[7,1] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[7,1] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[7,1] <- nrow(tmp)


my <- myd[order(myd$bcpID),] # COPR in 40 --------------------------------------------------------------------------------------------------
my <- my[my$epo %in% c("COPR_A", "COPR_B"),] 
my <- my[my$mpasp == 0.4 & !is.na(my$dw),]

# model & diagnostic plots ----------------------------------------------------
mymod <- lm(my$dw ~ my$bcpID + 0, weights = my$re_dw); summary(mymod)
hist(residuals(mymod), breaks = 100); hist(expand_residuals(mymod, my$re_dw), breaks = 100); plot(mymod)

# model output -----------------------------------------------------------------
tab_model(mymod, digits = 5, digits.p = 8, show.stat = T, wrap.labels = 100, file = "copr40.html") # table does not have corrected p-values. 

# create results dataframe ----------------------------------------------------
myres <- as.data.frame(coef(summary(mymod)), stringsAsFactors = F)
myres$p1s_l <- pt(coef(summary(mymod))[, 3], mymod$df, lower = T) # one-sided test p-values for lower
myres$p1s_h <- pt(coef(summary(mymod))[, 3], mymod$df, lower = F) # one-sided test p-values for higher
myres$p1s_l.adj <- p.adjust(myres$p1s_l, method = "fdr") # fdr adjusted p value (for 1-sided lower)
myres$p1s_h.adj <- p.adjust(myres$p1s_h, method = "fdr") # fdr adjusted p value (for 1-sided higher)
myres$bcid <-  gsub("^.*?D","",rownames(myres)) # fix barcode id names
myres$treat <- NA
for (i in 1:length(myres$treat)) {
  myres$treat[i] <- as.character(my$treat)[my$bcpID == myres$bcid[i]][1]
}
# -----------------------------------------------------------------------------
tmp <- myres[myres$treat == "EH0",];myCOPRdec[1,2] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[1,2] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[1,2] <- nrow(tmp)
tmp <- myres[myres$treat == "EH40",];myCOPRdec[2,2] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[2,2] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[2,2] <- nrow(tmp)
tmp <- myres[myres$treat == "EH80",];myCOPRdec[3,2] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[3,2] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[3,2] <- nrow(tmp)
tmp <- myres[myres$treat == "EH0_40",];myCOPRdec[4,2] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[4,2] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[4,2] <- nrow(tmp)
tmp <- myres[myres$treat == "EH20_60",];myCOPRdec[5,2] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[5,2] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[5,2] <- nrow(tmp)
tmp <- myres[myres$treat == "EH0_80",];myCOPRdec[6,2] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[6,2] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[6,2] <- nrow(tmp)
tmp <- myres[myres$treat == "EH40_80",];myCOPRdec[7,2] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[7,2] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[7,2] <- nrow(tmp)


my <- myd[order(myd$bcpID),] # COPR in 80 --------------------------------------------------------------------------------------------------
my <- my[my$epo %in% c("COPR_A", "COPR_B"),] 
my <- my[my$mpasp == 0.8 & !is.na(my$dw),]

# model & diagnostic plots ----------------------------------------------------
mymod <- lm(my$dw ~ my$bcpID + 0, weights = my$re_dw); summary(mymod)
hist(residuals(mymod), breaks = 100); hist(expand_residuals(mymod, my$re_dw), breaks = 100); plot(mymod)

# model output -----------------------------------------------------------------
tab_model(mymod, digits = 5, digits.p = 8, show.stat = T, wrap.labels = 100, file = "copr80.html") # table does not have corrected p-values. 

# create results dataframe ----------------------------------------------------
myres <- as.data.frame(coef(summary(mymod)), stringsAsFactors = F)
myres$p1s_l <- pt(coef(summary(mymod))[, 3], mymod$df, lower = T) # one-sided test p-values for lower
myres$p1s_h <- pt(coef(summary(mymod))[, 3], mymod$df, lower = F) # one-sided test p-values for higher
myres$p1s_l.adj <- p.adjust(myres$p1s_l, method = "fdr") # fdr adjusted p value (for 1-sided lower)
myres$p1s_h.adj <- p.adjust(myres$p1s_h, method = "fdr") # fdr adjusted p value (for 1-sided higher)
myres$bcid <-  gsub("^.*?D","",rownames(myres)) # fix barcode id names
myres$treat <- NA
for (i in 1:length(myres$treat)) {
  myres$treat[i] <- as.character(my$treat)[my$bcpID == myres$bcid[i]][1]
}
# -----------------------------------------------------------------------------
tmp <- myres[myres$treat == "EH0",];myCOPRdec[1,3] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[1,3] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[1,3] <- nrow(tmp)
tmp <- myres[myres$treat == "EH40",];myCOPRdec[2,3] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[2,3] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[2,3] <- nrow(tmp)
tmp <- myres[myres$treat == "EH80",];myCOPRdec[3,3] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[3,3] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[3,3] <- nrow(tmp)
tmp <- myres[myres$treat == "EH0_40",];myCOPRdec[4,3] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[4,3] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[4,3] <- nrow(tmp)
tmp <- myres[myres$treat == "EH20_60",];myCOPRdec[5,3] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[5,3] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[5,3] <- nrow(tmp)
tmp <- myres[myres$treat == "EH0_80",];myCOPRdec[6,3] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[6,3] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[6,3] <- nrow(tmp)
tmp <- myres[myres$treat == "EH40_80",];myCOPRdec[7,3] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[7,3] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[7,3] <- nrow(tmp)


my <- myd[order(myd$bcpID),] # COPR in 120 --------------------------------------------------------------------------------------------------
my <- my[my$epo %in% c("COPR_A", "COPR_B"),] 
my <- my[my$mpasp == 1.2 & !is.na(my$dw),]

# model & diagnostic plots ----------------------------------------------------
mymod <- lm(my$dw ~ my$bcpID + 0, weights = my$re_dw); summary(mymod)
hist(residuals(mymod), breaks = 100); hist(expand_residuals(mymod, my$re_dw), breaks = 100); plot(mymod)

# model output -----------------------------------------------------------------
tab_model(mymod, digits = 5, digits.p = 8, show.stat = T, wrap.labels = 100, file = "copr120.html") # table does not have corrected p-values. 

# create results dataframe ----------------------------------------------------
myres <- as.data.frame(coef(summary(mymod)), stringsAsFactors = F)
myres$p1s_l <- pt(coef(summary(mymod))[, 3], mymod$df, lower = T) # one-sided test p-values for lower
myres$p1s_h <- pt(coef(summary(mymod))[, 3], mymod$df, lower = F) # one-sided test p-values for higher
myres$p1s_l.adj <- p.adjust(myres$p1s_l, method = "fdr") # fdr adjusted p value (for 1-sided lower)
myres$p1s_h.adj <- p.adjust(myres$p1s_h, method = "fdr") # fdr adjusted p value (for 1-sided higher)
myres$bcid <-  gsub("^.*?D","",rownames(myres)) # fix barcode id names
myres$treat <- NA
for (i in 1:length(myres$treat)) {
  myres$treat[i] <- as.character(my$treat)[my$bcpID == myres$bcid[i]][1]
}
# -----------------------------------------------------------------------------
tmp <- myres[myres$treat == "EH0",];myCOPRdec[1,4] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[1,4] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[1,4] <- nrow(tmp)
tmp <- myres[myres$treat == "EH40",];myCOPRdec[2,4] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[2,4] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[2,4] <- nrow(tmp)
tmp <- myres[myres$treat == "EH80",];myCOPRdec[3,4] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[3,4] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[3,4] <- nrow(tmp)
tmp <- myres[myres$treat == "EH0_40",];myCOPRdec[4,4] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[4,4] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[4,4] <- nrow(tmp)
tmp <- myres[myres$treat == "EH20_60",];myCOPRdec[5,4] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[5,4] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[5,4] <- nrow(tmp)
tmp <- myres[myres$treat == "EH0_80",];myCOPRdec[6,4] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[6,4] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[6,4] <- nrow(tmp)
tmp <- myres[myres$treat == "EH40_80",];myCOPRdec[7,4] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[7,4] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[7,4] <- nrow(tmp)

myCOPRin_p <- myCOPRin / myCOPRno
myCOPRdec_p <- myCOPRdec / myCOPRno
```







Plot evolved fitness in CM
```{r}
my <- myd
# Visualize -------------------------------------------------------------------

mybinwidth <- 0.01

mytitle <- NULL
myylab <- "Count"
myxlab <- "fitness"

myhighlight <- "black"
myfillapha <- 0.85
myptalpha <- 0.35
mylinealpha <- 0
mypalette <- setpalette

mytextsize <- 8
myheight <- 8
mywidth <- 8.5

# summary(my$fit500[my$epo %in% c("SALT_A", "SALT_B")]) # 0.7258 -- 1.4820
# summary(my$dw[my$epo %in% c("SALT_A", "SALT_B")]) # -0.27508 -- 0.45753
# summary(my$fit500[my$epo %in% c("COPR_A", "COPR_B")]) # 0.7893 -- 1.7746
# summary(my$dw[my$epo %in% c("COPR_A", "COPR_B")]) # -0.2620 -- 0.8507


p <- ggplot(my[my$epo %in% c("SALT_A", "SALT_B"),], aes(x=fit0, color = paste0(mpasp), fill = paste0(mpasp), weight = re_fit_a / mean(re_fit_a))) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = 0.05)+
  xlim(c(.6, 1.6)) +
  ylim(c(NA,800)) +
  scale_color_manual(values =mypalette, guide = FALSE) +
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= c(0.8,0.8)) +
  labs(fill = "Assay Environment") +
  ggtitle(mytitle)+ ylab(myylab)+ xlab(myxlab)+
  # geom_hline(yintercept=-0.01, colour="white", size=1.01)+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))


library(gridExtra)
get_legend<-function(myggplot){
  tmp <- ggplot_gtable(ggplot_build(myggplot))
  leg <- which(sapply(tmp$grobs, function(x) x$name) == "guide-box")
  legend <- tmp$grobs[[leg]]
  return(legend)
}
legend <- get_legend(p)
p <- p + theme(legend.position="none")
psanc <- p

p <- ggplot(my[my$epo %in% c("SALT_A", "SALT_B"),], aes(x=fit500, color = paste0(mpamt, mpasp), fill = paste0(mpasp), weight = re_fit_e / mean(re_fit_e))) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = 0.05)+
  xlim(c(.6, 1.6)) +
  ylim(c(NA,300)) +
  scale_color_manual(values =mypalette, guide = FALSE) +
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= "none") +
  labs(fill = "Significance") +
  ggtitle(mytitle)+ ylab(myylab)+ xlab(myxlab)+
  # geom_hline(yintercept=-0.01, colour="white", size=1.01)+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
psevo <- p


p <- ggplot(my[my$epo %in% c("SALT_A", "SALT_B"),], aes(x=dw, color = paste0(mpamt, mpasp), fill = paste0(mpasp), weight = re_dw / mean(re_dw))) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = 0.05)+
  xlim(c(-.5, .5)) +
  ylim(c(NA,300)) +
  scale_color_manual(values =mypalette, guide = FALSE) +
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= "none") +
  labs(fill = "Significance") +
  ggtitle(mytitle)+ ylab(myylab)+ xlab(myxlab)+
  # geom_hline(yintercept=-0.01, colour="white", size=1.01)+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
psdel <- p







p <- ggplot(my[my$epo %in% c("COPR_A", "COPR_B"),], aes(x=fit0, color = paste0(mpamt, mpasp), fill = paste0(mpasp), weight = re_fit_a / mean(re_fit_a))) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = 0.05)+
  xlim(c(.6, 1.8)) +
  ylim(c(NA,1250)) +
  scale_color_manual(values =mypalette, guide = FALSE) +
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= "none") +
  labs(fill = "Significance") +
  ggtitle(mytitle)+ ylab(myylab)+ xlab(myxlab)+
  # geom_hline(yintercept=-0.01, colour="white", size=1.01)+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
pcanc <- p


p <- ggplot(my[my$epo %in% c("COPR_A", "COPR_B"),], aes(x=fit500, color = paste0(mpamt, mpasp),fill = paste0(mpasp), weight = re_fit_e / mean(re_fit_e))) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = 0.05)+
  xlim(c(.6, 1.8)) +
  ylim(c(NA,400)) +
  scale_color_manual(values =mypalette, guide = FALSE) +
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= "none") +
  labs(fill = "Significance") +
  ggtitle(mytitle)+ ylab(myylab)+ xlab(myxlab)+
  # geom_hline(yintercept=-0.01, colour="white", size=1.01)+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
pcevo <- p


p <- ggplot(my[my$epo %in% c("COPR_A", "COPR_B"),], aes(x=dw, color = paste0(mpamt, mpasp), fill = paste0(mpasp), weight = re_dw / mean(re_dw))) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = 0.05)+
  xlim(c(-.3, .9)) +
  ylim(c(NA,400)) +
  scale_color_manual(values =mypalette, guide = FALSE) +
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= "none") +
  labs(fill = "Significance") +
  ggtitle(mytitle)+ ylab(myylab)+ xlab(myxlab)+
  # geom_hline(yintercept=-0.01, colour="white", size=1.01)+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
pcdel <- p



# plot it together -------------------------------------------------------------
pdf(file = "000_fit_cbyenv_full.pdf", width = mywidth, height = myheight)
grid.arrange( grid::textGrob("SALT", gp =grid::gpar(fontsize = 8, fontface = "bold"), rot = 90),
              grid::textGrob("COPR", gp =grid::gpar(fontsize = 8, fontface = "bold"), rot = 90),
              psanc, psevo, psdel,
              pcanc, pcevo, pcdel,
              legend, 
              grid::textGrob("", gp =grid::gpar(fontsize = 8)),
              grid::textGrob("Generation-0", gp =grid::gpar(fontsize = 12, fontface = "bold")),
              grid::textGrob("Generation-500", gp =grid::gpar(fontsize = 12, fontface = "bold")),
              grid::textGrob("Delta", gp =grid::gpar(fontsize = 12, fontface = "bold")),
  layout_matrix = rbind(c(10, 10,11,11,10, 10,12,12,10,  10,13,13,10,  10, 10),
                        c(1,  3,3,3,3,     4,4,4,4,      5,5,5,5,      9, 10),
                        c(1,  3,3,3,3,     4,4,4,4,      5,5,5,5,      10, 10),
                        c(2,  6,6,6,6,     7,7,7,7,      8,8,8,8,      10, 10),
                        c(2,  6,6,6,6,     7,7,7,7,      8,8,8,8,      10, 10)),
  top = grid::textGrob("\n Yeast Fitness in SALT and COPR", gp =grid::gpar(fontsize = 14, fontface = "bold")))
dev.off() # one column wide, equal height

# -----------------------------------------------------------------------------
rm(my, p, mybinwidth, myc, myfillapha, myheight, myhighlight, mylinealpha, mypalette, myptalpha, myr, mytextsize,
   mytitle, mywidth, myx, myxlab, myylab)
```


# Plot: SALTA SALTB ancestral and evolved fitness in CM,salt40, salt80, salt120
```{R}
my <- myd
# Visualize -------------------------------------------------------------------

mybinwidth <- 0.01

mytitle <- NULL
myylab <- "Count"
myxlab <- "fitness"

myhighlight <- "black"
myfillapha <- 0.85
myptalpha <- 0.35
mylinealpha <- 0
mypalette <- setpalette

mytextsize <- 8
myheight <- 11
mywidth <- 8.5

# summary(my$fit500[my$epo %in% c("SALT_A", "SALT_B")]) # 0.7258 -- 1.4820
# summary(my$dw[my$epo %in% c("SALT_A", "SALT_B")]) # -0.27508 -- 0.45753

# salt anc -----------------------------
# salt anc in 0
p <- ggplot(my[my$mpasp == 0.0 & my$epo %in% c("SALT_A", "SALT_B"),], aes(x=fit0, color = treat, fill = treat), weight = re_fit_a / mean(re_fit_a)) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = 0.05)+
  xlim(c(0.6, 1.6)) +
  ylim(c(NA,400)) +
  scale_color_manual(values =mypalette, guide = FALSE) + 
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= c(0.7,0.7), legend.key.size = unit(.20, "cm")) +
  labs(fill = "Treatment") +
  ggtitle(mytitle)+ ylab(myylab)+ xlab("")+
  #geom_hline(yintercept=-0.01, colour="white", size=1.01)+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))


library(gridExtra)
get_legend<-function(myggplot){
  tmp <- ggplot_gtable(ggplot_build(myggplot))
  leg <- which(sapply(tmp$grobs, function(x) x$name) == "guide-box")
  legend <- tmp$grobs[[leg]]
  return(legend)
}
legend <- get_legend(p)
p <- p + theme(legend.position="none")
p_salt_anc_0 <- p

# salt anc in 40
p <- ggplot(my[my$mpasp == 0.4 & my$epo %in% c("SALT_A", "SALT_B"),], aes(x=fit0, color = treat, fill = treat), weight = re_fit_a / mean(re_fit_a)) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = 0.05)+
  xlim(c(0.6, 1.6)) +
  ylim(c(NA,350)) +
  scale_color_manual(values =mypalette, guide = FALSE) + 
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= "none") +
  labs(fill = "Significance") +
  ggtitle(mytitle)+ ylab(myylab)+ xlab("")+
  #geom_hline(yintercept=-0.01, colour="white", size=1.01)+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
#p
p_salt_anc_40 <- p

# salt anc in 80
p <- ggplot(my[my$mpasp == 0.8 & my$epo %in% c("SALT_A", "SALT_B"),], aes(x=fit0, color = treat, fill = treat), weight = re_fit_a / mean(re_fit_a)) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = 0.05)+
  xlim(c(0.6, 1.6)) +
  ylim(c(NA,250)) +
  scale_color_manual(values =mypalette, guide = FALSE) + 
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= "none") +
  labs(fill = "Significance") +
  ggtitle(mytitle)+ ylab(myylab)+ xlab("")+
  #geom_hline(yintercept=-0.01, colour="white", size=1.01)+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
#p
p_salt_anc_80 <- p

# salt anc in 120
p <- ggplot(my[my$mpasp == 1.2 & my$epo %in% c("SALT_A", "SALT_B"),], aes(x=fit0, color = treat, fill = treat), weight = re_fit_a / mean(re_fit_a)) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = 0.05)+
  xlim(c(0.6, 1.6)) +
  ylim(c(NA,250)) +
  scale_color_manual(values =mypalette, guide = FALSE) + 
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= "none") +
  labs(fill = "Significance") +
  ggtitle(mytitle)+ ylab(myylab)+ xlab(myxlab)+
  #geom_hline(yintercept=-0.01, colour="white", size=1.01)+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
#p
p_salt_anc_120 <- p

# salt evo -----------------------------
# salt evo in 0
p <- ggplot(my[my$mpasp == 0.0 & my$epo %in% c("SALT_A", "SALT_B"),], aes(x=fit500, color = treat, fill = treat), weight = re_fit_e / mean(re_fit_e)) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = 0.05)+
  xlim(c(0.6, 1.6)) +
  ylim(c(NA,100)) +
  scale_color_manual(values =mypalette, guide = FALSE) + 
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= "none") +
  labs(fill = "Significance") +
  ggtitle(mytitle)+ ylab("")+ xlab("")+
  #geom_hline(yintercept=-0.01, colour="white", size=1.01)+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
#p
p_salt_evo_0 <- p

# salt evo in 40
p <- ggplot(my[my$mpasp == 0.4 & my$epo %in% c("SALT_A", "SALT_B"),], aes(x=fit500, color = treat, fill = treat), weight = re_fit_e / mean(re_fit_e)) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = 0.05)+
  xlim(c(0.6, 1.6)) +
  ylim(c(NA,80)) +
  scale_color_manual(values =mypalette, guide = FALSE) + 
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= "none") +
  labs(fill = "Significance") +
  ggtitle(mytitle)+ ylab("")+ xlab("")+
  #geom_hline(yintercept=-0.01, colour="white", size=1.01)+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
#p
p_salt_evo_40 <- p

# salt evo in 80
p <- ggplot(my[my$mpasp == 0.8 & my$epo %in% c("SALT_A", "SALT_B"),], aes(x=fit500, color = treat, fill = treat), weight = re_fit_e / mean(re_fit_e)) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = 0.05)+
  xlim(c(0.6, 1.6)) +
  ylim(c(NA,40)) +
  scale_color_manual(values =mypalette, guide = FALSE) + 
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= "none") +
  labs(fill = "Significance") +
  ggtitle(mytitle)+ ylab("")+ xlab("")+
  #geom_hline(yintercept=-0.01, colour="white", size=1.01)+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
#p
p_salt_evo_80 <- p

# salt evo in 120
p <- ggplot(my[my$mpasp == 1.2 & my$epo %in% c("SALT_A", "SALT_B"),], aes(x=fit500, color = treat, fill = treat), weight = re_fit_e / mean(re_fit_e)) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = 0.05)+
  xlim(c(0.6, 1.6)) +
  ylim(c(NA,50)) +
  scale_color_manual(values =mypalette, guide = FALSE) + 
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= "none") +
  labs(fill = "Significance") +
  ggtitle(mytitle)+ ylab("")+ xlab(myxlab)+
  #geom_hline(yintercept=-0.01, colour="white", size=1.01)+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
#p
p_salt_evo_120 <- p

# salt delta -----------------------------
# salt delta in 0
p <- ggplot(my[my$mpasp == 0.0 & my$epo %in% c("SALT_A", "SALT_B"),], aes(x=dw, color = treat, fill = treat), weight = re_dw / mean(re_dw)) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = 0.05)+
  xlim(c(-0.5, 0.5)) +
  ylim(c(NA,100)) +
  scale_color_manual(values =mypalette, guide = FALSE) + 
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= "none") +
  labs(fill = "Significance") +
  ggtitle(mytitle)+ ylab("")+ xlab("")+
  #geom_hline(yintercept=-0.01, colour="white", size=1.01)+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
#p
p_salt_del_0 <- p

# salt evo in 40
p <- ggplot(my[my$mpasp == 0.4 & my$epo %in% c("SALT_A", "SALT_B"),], aes(x=dw, color = treat, fill = treat), weight = re_dw / mean(re_dw)) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = 0.05)+
  xlim(c(-0.5, 0.5)) +
  ylim(c(NA,80)) +
  scale_color_manual(values =mypalette, guide = FALSE) + 
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= "none") +
  labs(fill = "Significance") +
  ggtitle(mytitle)+ ylab("")+ xlab("")+
  #geom_hline(yintercept=-0.01, colour="white", size=1.01)+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
#p
p_salt_del_40 <- p

# salt evo in 80
p <- ggplot(my[my$mpasp == 0.8 & my$epo %in% c("SALT_A", "SALT_B"),], aes(x=dw, color = treat, fill = treat), weight = re_dw / mean(re_dw)) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = 0.05)+
  xlim(c(-0.5, 0.5)) +
  ylim(c(NA,40)) +
  scale_color_manual(values =mypalette, guide = FALSE) + 
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= "none") +
  labs(fill = "Significance") +
  ggtitle(mytitle)+ ylab("")+ xlab("")+
  #geom_hline(yintercept=-0.01, colour="white", size=1.01)+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
#p
p_salt_del_80 <- p

# salt evo in 120
p <- ggplot(my[my$mpasp == 1.2 & my$epo %in% c("SALT_A", "SALT_B"),], aes(x=dw, color = treat, fill = treat), weight = re_dw / mean(re_dw)) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = 0.05)+
  xlim(c(-0.5, 0.5)) +
  ylim(c(NA,50)) +
  scale_color_manual(values =mypalette, guide = FALSE) + 
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= "none") +
  labs(fill = "Significance") +
  ggtitle(mytitle)+ ylab("")+ xlab(myxlab)+
  #geom_hline(yintercept=-0.01, colour="white", size=1.01)+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
#p
p_salt_del_120 <- p

# plot it together -------------------------------------------------------------
pdf(file = "000_SALT_fit_byenv_cbytreat_full.pdf", width = mywidth, height = myheight)
grid.arrange( grid::textGrob("CM, No Stress", gp =grid::gpar(fontsize = 8, fontface = "bold"), rot = 90),
              grid::textGrob("CM + Salt 40", gp =grid::gpar(fontsize = 8, fontface = "bold"), rot = 90),
              grid::textGrob("CM + Salt 80", gp =grid::gpar(fontsize = 8, fontface = "bold"), rot = 90),
              grid::textGrob("CM + Salt 120", gp =grid::gpar(fontsize = 8, fontface = "bold"), rot = 90),
              p_salt_anc_0,p_salt_anc_40,p_salt_anc_80,p_salt_anc_120,
              p_salt_evo_0,p_salt_evo_40,p_salt_evo_80,p_salt_evo_120,
              p_salt_del_0,p_salt_del_40,p_salt_del_80,p_salt_del_120,
             legend, 
             grid::textGrob("", gp =grid::gpar(fontsize = 8)),
             grid::textGrob("Generation-0", gp =grid::gpar(fontsize = 12, fontface = "bold")),
             grid::textGrob("Generation-500", gp =grid::gpar(fontsize = 12, fontface = "bold")),
             grid::textGrob("Delta", gp =grid::gpar(fontsize = 12, fontface = "bold")),
  layout_matrix = rbind(c(18, 18,19,19,18, 18,20,20,18,  18,21,21,18,  18, 18),
                        c(1,  5,5,5,5,     9,9,9,9,      13,13,13,13,  17, 18),
                        c(1,  5,5,5,5,     9,9,9,9,      13,13,13,13,  18, 18),
                        c(2,  6,6,6,6,     10,10,10,10,  14,14,14,14,  18, 18),
                        c(2,  6,6,6,6,     10,10,10,10,  14,14,14,14,  18, 18),
                        c(3,  7,7,7,7,     11,11,11,11,  15,15,15,15,  18, 18),
                        c(3,  7,7,7,7,     11,11,11,11,  15,15,15,15,  18, 18),
                        c(4,  8,8,8,8,     12,12,12,12,  16,16,16,16,  18, 18),
                        c(4,  8,8,8,8,     12,12,12,12,  16,16,16,16,  18, 18)),
  top = grid::textGrob("\n Yeast Fitness (SALT) in Complete Media and Salt Stress Environments", gp =grid::gpar(fontsize = 14, fontface = "bold")))
dev.off() # one column wide, equal height
```



# Plot: COPRA COPRB ancestral and evolved fitness in CM,copr40, copr80, copr120
```{R}
my <- myd
# Visualize -------------------------------------------------------------------

mybinwidth <- 0.01

mytitle <- NULL
myylab <- "Count"
myxlab <- "fitness"

myhighlight <- "black"
myfillapha <- 0.85
myptalpha <- 0.35
mylinealpha <- 0
mypalette <- setpalette

mytextsize <- 8
myheight <- 11
mywidth <- 8.5

# summary(my$fit500[my$epo %in% c("COPR_A", "COPR_B")]) # 0.7893 -- 1.7746
# summary(my$dw[my$epo %in% c("COPR_A", "COPR_B")]) # -0.2620 -- 0.8507

# copr anc -----------------------------
# copr anc in 0
p <- ggplot(my[my$mpasp == 0.0 & my$epo %in% c("COPR_A", "COPR_B"),], aes(x=fit0, color = treat, fill = treat), weight = re_fit_a / mean(re_fit_a)) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth,  lwd = 0, lty = 0) +
  geom_rug(alpha = 0.05)+
  xlim(c(0.6, 1.8)) +
  ylim(c(NA,400)) +
  scale_color_manual(values =mypalette, guide = FALSE) + 
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= c(0.7,0.7), legend.key.size = unit(.20, "cm")) +
  labs(fill = "Treatment") +
  ggtitle(mytitle)+ ylab(myylab)+ xlab("")+
  geom_hline(yintercept=-0.01, colour="white", size=1.01)+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))


library(gridExtra)
get_legend<-function(myggplot){
  tmp <- ggplot_gtable(ggplot_build(myggplot))
  leg <- which(sapply(tmp$grobs, function(x) x$name) == "guide-box")
  legend <- tmp$grobs[[leg]]
  return(legend)
}
legend <- get_legend(p)
p <- p + theme(legend.position="none")
p_copr_anc_0 <- p

# copr anc in 40
p <- ggplot(my[my$mpasp == 0.4 & my$epo %in% c("COPR_A", "COPR_B"),], aes(x=fit0, color = treat, fill = treat), weight = re_fit_a / mean(re_fit_a)) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth,  lwd = 0, lty = 0) +
  geom_rug(alpha = 0.05)+
  xlim(c(0.6, 1.8)) +
  ylim(c(NA,400)) +
  scale_color_manual(values =mypalette, guide = FALSE) + 
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= "none") +
  labs(fill = "Significance") +
  ggtitle(mytitle)+ ylab(myylab)+ xlab("")+
  geom_hline(yintercept=-0.01, colour="white", size=1.01)+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
#p
p_copr_anc_40 <- p

# copr anc in 80
p <- ggplot(my[my$mpasp == 0.8 & my$epo %in% c("COPR_A", "COPR_B"),], aes(x=fit0, color = treat, fill = treat), weight = re_fit_a / mean(re_fit_a)) + 
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth,  lwd = 0, lty = 0) +
  geom_rug(alpha = 0.05)+
  xlim(c(0.6, 1.8)) +
  ylim(c(NA,400)) +
  scale_color_manual(values =mypalette, guide = FALSE) + 
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= "none") +
  labs(fill = "Significance") +
  ggtitle(mytitle)+ ylab(myylab)+ xlab("")+
  geom_hline(yintercept=-0.01, colour="white", size=1.01)+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
#p
p_copr_anc_80 <- p

# copr anc in 120
p <- ggplot(my[my$mpasp == 1.2 & my$epo %in% c("COPR_A", "COPR_B"),], aes(x=fit0, color = treat, fill = treat), weight = re_fit_a / mean(re_fit_a)) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth,  lwd = 0, lty = 0) +
  geom_rug(alpha = 0.05)+
  xlim(c(0.6, 1.8)) +
  ylim(c(NA,120)) +
  scale_color_manual(values =mypalette, guide = FALSE) + 
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= "none") +
  labs(fill = "Significance") +
  ggtitle(mytitle)+ ylab(myylab)+ xlab(myxlab)+
  geom_hline(yintercept=-0.01, colour="white", size=1.01)+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
#p
p_copr_anc_120 <- p

# copr evo -----------------------------
# copr evo in 0
p <- ggplot(my[my$mpasp == 0.0 & my$epo %in% c("COPR_A", "COPR_B"),], aes(x=fit500, color = treat, fill = treat), weight = re_fit_e / mean(re_fit_e)) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth,  lwd = 0, lty = 0) +
  geom_rug(alpha = 0.05)+
  xlim(c(0.6, 1.8)) +
  ylim(c(NA,60)) +
  scale_color_manual(values =mypalette, guide = FALSE) + 
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= "none") +
  labs(fill = "Significance") +
  ggtitle(mytitle)+ ylab("")+ xlab("")+
  geom_hline(yintercept=-0.01, colour="white", size=1.01)+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
#p
p_copr_evo_0 <- p

# copr evo in 40
p <- ggplot(my[my$mpasp == 0.4 & my$epo %in% c("COPR_A", "COPR_B"),], aes(x=fit500, color = treat, fill = treat), weight = re_fit_e / mean(re_fit_e)) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = 0.05)+
  xlim(c(0.6, 1.8)) +
  ylim(c(NA,60)) +
  scale_color_manual(values =mypalette, guide = FALSE) + 
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= "none") +
  labs(fill = "Significance") +
  ggtitle(mytitle)+ ylab("")+ xlab("")+
  geom_hline(yintercept=-0.01, colour="white", size=1.01)+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
#p
p_copr_evo_40 <- p

# copr evo in 80
p <- ggplot(my[my$mpasp == 0.8 & my$epo %in% c("COPR_A", "COPR_B"),], aes(x=fit500, color = treat, fill = treat), weight = re_fit_e / mean(re_fit_e)) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = 0.05)+
  xlim(c(0.6, 1.8)) +
  ylim(c(NA,20)) +
  scale_color_manual(values =mypalette, guide = FALSE) + 
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= "none") +
  labs(fill = "Significance") +
  ggtitle(mytitle)+ ylab("")+ xlab("")+
  geom_hline(yintercept=-0.01, colour="white", size=1.01)+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
#p
p_copr_evo_80 <- p

# copr evo in 120
p <- ggplot(my[my$mpasp == 1.2 & my$epo %in% c("COPR_A", "COPR_B"),], aes(x=fit500, color = treat, fill = treat), weight = re_fit_e / mean(re_fit_e)) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = 0.05)+
  xlim(c(0.6, 1.8)) +
  ylim(c(NA,15)) +
  scale_color_manual(values =mypalette, guide = FALSE) + 
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= "none") +
  labs(fill = "Significance") +
  ggtitle(mytitle)+ ylab("")+ xlab(myxlab)+
  geom_hline(yintercept=-0.01, colour="white", size=1.01)+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
#p
p_copr_evo_120 <- p

# copr delta -----------------------------
# copr delta in 0
p <- ggplot(my[my$mpasp == 0.0 & my$epo %in% c("COPR_A", "COPR_B"),], aes(x=dw, color = treat, fill = treat), weight = re_dw / mean(re_dw)) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = 0.05)+
  xlim(c(-0.5, 0.9)) +
  ylim(c(NA,60)) +
  scale_color_manual(values =mypalette, guide = FALSE) + 
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= "none") +
  labs(fill = "Significance") +
  ggtitle(mytitle)+ ylab("")+ xlab("")+
  geom_hline(yintercept=-0.01, colour="white", size=1.01)+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
#p
p_copr_del_0 <- p

# copr evo in 40
p <- ggplot(my[my$mpasp == 0.4 & my$epo %in% c("COPR_A", "COPR_B"),], aes(x=dw, color = treat, fill = treat), weight = re_dw / mean(re_dw)) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = 0.05)+
  xlim(c(-0.5, 0.9)) +
  ylim(c(NA,60)) +
  scale_color_manual(values =mypalette, guide = FALSE) + 
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= "none") +
  labs(fill = "Significance") +
  ggtitle(mytitle)+ ylab("")+ xlab("")+
  geom_hline(yintercept=-0.01, colour="white", size=1.01)+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
#p
p_copr_del_40 <- p

# copr evo in 80
p <- ggplot(my[my$mpasp == 0.8 & my$epo %in% c("COPR_A", "COPR_B"),], aes(x=dw, color = treat, fill = treat), weight = re_dw / mean(re_dw)) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = 0.05)+
  xlim(c(-0.5, 0.9)) +
  ylim(c(NA,20)) +
  scale_color_manual(values =mypalette, guide = FALSE) + 
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= "none") +
  labs(fill = "Significance") +
  ggtitle(mytitle)+ ylab("")+ xlab("")+
  geom_hline(yintercept=-0.01, colour="white", size=1.01)+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
#p
p_copr_del_80 <- p

# copr evo in 120
p <- ggplot(my[my$mpasp == 1.2 & my$epo %in% c("COPR_A", "COPR_B"),], aes(x=dw, color = treat, fill = treat), weight = re_dw / mean(re_dw)) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = 0.05)+
  xlim(c(-0.5, 0.9)) +
  ylim(c(NA,15)) +
  scale_color_manual(values =mypalette, guide = FALSE) + 
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= "none") +
  labs(fill = "Significance") +
  ggtitle(mytitle)+ ylab("")+ xlab(myxlab)+
  geom_hline(yintercept=-0.01, colour="white", size=1.01)+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
#p
p_copr_del_120 <- p

# plot it together -------------------------------------------------------------
pdf(file = "000_COPR_fit_byenv_cbytreat_full.pdf", width = mywidth, height = myheight)
grid.arrange( grid::textGrob("CM, No Stress", gp =grid::gpar(fontsize = 8, fontface = "bold"), rot = 90),
              grid::textGrob("CM + Copr 40", gp =grid::gpar(fontsize = 8, fontface = "bold"), rot = 90),
              grid::textGrob("CM + Copr 80", gp =grid::gpar(fontsize = 8, fontface = "bold"), rot = 90),
              grid::textGrob("CM + Copr 120", gp =grid::gpar(fontsize = 8, fontface = "bold"), rot = 90),
              p_copr_anc_0,p_copr_anc_40,p_copr_anc_80,p_copr_anc_120,
              p_copr_evo_0,p_copr_evo_40,p_copr_evo_80,p_copr_evo_120,
              p_copr_del_0,p_copr_del_40,p_copr_del_80,p_copr_del_120,
             legend, 
             grid::textGrob("", gp =grid::gpar(fontsize = 8)),
             grid::textGrob("Generation-0", gp =grid::gpar(fontsize = 12, fontface = "bold")),
             grid::textGrob("Generation-500", gp =grid::gpar(fontsize = 12, fontface = "bold")),
             grid::textGrob("Delta", gp =grid::gpar(fontsize = 12, fontface = "bold")),
  layout_matrix = rbind(c(18, 18,19,19,18, 18,20,20,18,  18,21,21,18,  18, 18),
                        c(1,  5,5,5,5,     9,9,9,9,      13,13,13,13,  17, 18),
                        c(1,  5,5,5,5,     9,9,9,9,      13,13,13,13,  18, 18),
                        c(2,  6,6,6,6,     10,10,10,10,  14,14,14,14,  18, 18),
                        c(2,  6,6,6,6,     10,10,10,10,  14,14,14,14,  18, 18),
                        c(3,  7,7,7,7,     11,11,11,11,  15,15,15,15,  18, 18),
                        c(3,  7,7,7,7,     11,11,11,11,  15,15,15,15,  18, 18),
                        c(4,  8,8,8,8,     12,12,12,12,  16,16,16,16,  18, 18),
                        c(4,  8,8,8,8,     12,12,12,12,  16,16,16,16,  18, 18)),
  top = grid::textGrob("\n Yeast Fitness (COPR) in Complete Media and Copper Stress Environments", gp =grid::gpar(fontsize = 14, fontface = "bold")))
dev.off() # one column wide, equal height
```












































ASSESS: FITNESS CHANGE IN 500 GENERATIONS OF EVOLUTION
SALTA, SALTB in CM
```{r}
my <- myd[!is.na(myd$dw),]
my <- my[my$mpamt == "CM" & my$mpasp == 0.0 & my$epo %in% c("SALT_A", "SALT_B"),]
summary(my$dw)

# check weighted mean and se for all treatments in this env. [SE IS TOO SMALL TO PLOT HERE!]
my0 <- my[my$treat == "EH0",]; print("EH0"); weighted.mean(my0$dw, my0$re_dw); weighted.var.se(x = my0$dw, w = my0$re_dw, na.rm = T)
my40 <- my[my$treat == "EH40",]; print("EH40"); weighted.mean(my40$dw, my40$re_dw); weighted.var.se(x = my40$dw, w = my40$re_dw, na.rm = T)
my80 <- my[my$treat == "EH80",]; print("EH80"); weighted.mean(my80$dw, my80$re_dw); weighted.var.se(x = my80$dw, w = my80$re_dw, na.rm = T)
my040 <- my[my$treat == "EH0_40",]; print("EH0_40"); weighted.mean(my040$dw, my040$re_dw); weighted.var.se(x = my040$dw, w = my040$re_dw, na.rm = T)
my2060 <- my[my$treat == "EH20_60",]; print("EH20_60"); weighted.mean(my2060$dw, my2060$re_dw); weighted.var.se(x = my2060$dw, w = my2060$re_dw, na.rm = T)
my4080 <- my[my$treat == "EH40_80",]; print("EH40_80"); weighted.mean(my4080$dw, my4080$re_dw); weighted.var.se(x = my4080$dw, w = my4080$re_dw, na.rm = T)
my080 <- my[my$treat == "EH0_80",]; print("EH0_80"); weighted.mean(my080$dw, my080$re_dw); weighted.var.se(x = my080$dw, w = my080$re_dw, na.rm = T)


# Visualize -------------------------------------------------------------------
my$treat <- factor(my$treat, levels = c("EH0", "EH40", "EH80", "EH0_40", "EH20_60", "EH0_80", "EH40_80"))
myx <- my$treat
myy <- my$dw
myr <- my$re_dw
myc <- my$treat

mytitle <- NULL
myylab <- "Fitness change"
myxlab <- "Treatment"

myoutline <-  "grey20"
myfill <-  "grey90"
myfillapha <- 0.35
myptalpha <- 0.35
mylinealpha <- 0.35

mypalette <- setpalette
mytextsize <- 8
myheight <- 3.5
mywidth <- 7
myptsize <- ((((myr/max(myr))*10)*((myheight*mywidth)/(7^2))) - min(((myr/max(myr))*10)*((myheight*mywidth)/(7^2))))+0.01

p <- ggplot(my, aes(x=myx, y=myy, weight = myr, color = myc)) +
  geom_violin(color = myoutline, fill = myfill, draw_quantiles = NULL, inherit.aes = F, aes( x=myx, y=myy), trim = T) + 
  geom_jitter(width =0.15, height = 0, alpha = myptalpha, size = myptsize) +
  geom_segment(x=6.90, xend=7.10, y = weighted.mean(myy[myx == "EH40_80"], myr[myx == "EH40_80"], na.rm = T), yend = weighted.mean(myy[myx == "EH40_80"], myr[myx == "EH40_80"], na.rm = T), color = myoutline) +
  geom_segment(x=5.90, xend=6.10, y = weighted.mean(myy[myx == "EH0_80"], myr[myx == "EH0_80"], na.rm = T), yend = weighted.mean(myy[myx == "EH0_80"], myr[myx == "EH0_80"], na.rm = T), color = myoutline) +
  geom_segment(x=4.90, xend=5.10, y = weighted.mean(myy[myx == "EH20_60"], myr[myx == "EH20_60"], na.rm = T), yend = weighted.mean(myy[myx == "EH20_60"], myr[myx == "EH20_60"], na.rm = T), color = myoutline) +
  geom_segment(x=3.90, xend=4.10, y = weighted.mean(myy[myx == "EH0_40"], myr[myx == "EH0_40"], na.rm = T), yend = weighted.mean(myy[myx == "EH0_40"], myr[myx == "EH0_40"], na.rm = T), color = myoutline) +
  geom_segment(x=2.90, xend=3.10, y = weighted.mean(myy[myx == "EH80"], myr[myx == "EH80"], na.rm = T), yend = weighted.mean(myy[myx == "EH80"], myr[myx == "EH80"], na.rm = T), color = myoutline) +
  geom_segment(x=1.90, xend=2.10, y = weighted.mean(myy[myx == "EH40"], myr[myx == "EH40"], na.rm = T), yend = weighted.mean(myy[myx == "EH40"], myr[myx == "EH40"], na.rm = T), color = myoutline) +
  geom_segment(x=0.90, xend=1.10, y = weighted.mean(myy[myx == "EH0"], myr[myx == "EH0"], na.rm = T), yend = weighted.mean(myy[myx == "EH0"], myr[myx == "EH0"], na.rm = T), color = myoutline) +
  geom_rug(sides = "b" , position = position_nudge(x=-0.75), alpha = myptalpha)+
  scale_color_manual(values =mypalette) + 
  geom_hline(yintercept = 0, lty = "dotted") + 
  coord_flip() +
  theme_classic()+
  theme(legend.position="none") +
  ggtitle(mytitle) + ylab(myylab) + xlab(myxlab)+
  scale_x_discrete(labels = c("EH0", "EH40", "EH80", "EH0_40", "EH20_60", "EH0_80", "EH40_80")) +
  scale_y_continuous(breaks = seq(-.3,.5,by=.05),
                     limits = c(-.3, .5),
                     labels = scales::number_format(accuracy = 0.01))+
  theme(axis.title.y = element_text(size = 8, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = 8, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = 8, angle = 0))+
  theme(axis.text.x = element_text(size = 8, angle = 0))
  # annotate("text", x=c(2,3,5,6), y=c(.14,.55,.15,.46), label = c("**", "***", "***", "*"), size = 8, fontface = "bold")
p 
# -----------------------------------------------------------------------------

# figure output ---------------------------------------------------------------
pdf(file = "000_SALTinCM.pdf", width = mywidth, height = myheight); p; dev.off()
# -----------------------------------------------------------------------------



# MODELS -----------------------------------------------------------------------
my$treat <- relevel(my$treat, ref = "EH0")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x

# model eval ---------------------------
hist(residuals(mymod), breaks = 100)
hist(expand_residuals(mymod, my$re_dw), breaks = 100) # this more accurately represents the distribution of residuals in the model output. -- tails look fine here. 
anova(mymod) # test term significance
# --------------------------------------

# run same model with ea of the 7 treats as base level ---
my$treat <- relevel(my$treat, ref = "EH40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x
my$treat <- relevel(my$treat, ref = "EH80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x
my$treat <- relevel(my$treat, ref = "EH0_40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x
my$treat <- relevel(my$treat, ref = "EH20_60")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x
my$treat <- relevel(my$treat, ref = "EH0_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x
my$treat <- relevel(my$treat, ref = "EH40_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x
# ------------------------------------------------------------------------------
rm(my, mymod, p, myc, myfill, myfillapha, myheight, mylinealpha, myoutline, mypalette, myptalpha, myptsize, myr, 
   mytextsize, mytitle, mywidth, myx, myxlab, myy, myylab)
```




SALTA, SALTB in SALT 0.4
```{r}
my <- myd[!is.na(myd$dw),]
my <- my[my$mpamt == "SALT" & my$mpasp == 0.4 & my$epo %in% c("SALT_A", "SALT_B"),]
summary(my$dw)

# check weighted mean and se for all treatments in this env. [SE IS TOO SMALL TO PLOT HERE!]
my0 <- my[my$treat == "EH0",]; print("EH0"); weighted.mean(my0$dw, my0$re_dw); weighted.var.se(x = my0$dw, w = my0$re_dw, na.rm = T)
my40 <- my[my$treat == "EH40",]; print("EH40"); weighted.mean(my40$dw, my40$re_dw); weighted.var.se(x = my40$dw, w = my40$re_dw, na.rm = T)
my80 <- my[my$treat == "EH80",]; print("EH80"); weighted.mean(my80$dw, my80$re_dw); weighted.var.se(x = my80$dw, w = my80$re_dw, na.rm = T)
my040 <- my[my$treat == "EH0_40",]; print("EH0_40"); weighted.mean(my040$dw, my040$re_dw); weighted.var.se(x = my040$dw, w = my040$re_dw, na.rm = T)
my2060 <- my[my$treat == "EH20_60",]; print("EH20_60"); weighted.mean(my2060$dw, my2060$re_dw); weighted.var.se(x = my2060$dw, w = my2060$re_dw, na.rm = T)
my4080 <- my[my$treat == "EH40_80",]; print("EH40_80"); weighted.mean(my4080$dw, my4080$re_dw); weighted.var.se(x = my4080$dw, w = my4080$re_dw, na.rm = T)
my080 <- my[my$treat == "EH0_80",]; print("EH0_80"); weighted.mean(my080$dw, my080$re_dw); weighted.var.se(x = my080$dw, w = my080$re_dw, na.rm = T)



# Visualize -------------------------------------------------------------------
my$treat <- factor(my$treat, levels = c("EH0", "EH40", "EH80", "EH0_40", "EH20_60", "EH0_80", "EH40_80"))
myx <- my$treat
myy <- my$dw
myr <- my$re_dw
myc <- my$treat

mytitle <- NULL
myylab <- "Fitness change"
myxlab <- "Treatment"

myoutline <-  "grey20"
myfill <-  "grey90"
myfillapha <- 0.35
myptalpha <- 0.35
mylinealpha <- 0.35

mypalette <- setpalette
mytextsize <- 8
myheight <- 3.5
mywidth <- 7
myptsize <- ((((myr/max(myr))*10)*((myheight*mywidth)/(7^2))) - min(((myr/max(myr))*10)*((myheight*mywidth)/(7^2))))+0.01

p <- ggplot(my, aes(x=myx, y=myy, weight = myr, color = myc)) +
  geom_violin(color = myoutline, fill = myfill, draw_quantiles = NULL, inherit.aes = F, aes( x=myx, y=myy), trim = T) + 
  geom_jitter(width =0.15, height = 0, alpha = myptalpha, size = myptsize) +
  geom_segment(x=6.90, xend=7.10, y = weighted.mean(myy[myx == "EH40_80"], myr[myx == "EH40_80"], na.rm = T), yend = weighted.mean(myy[myx == "EH40_80"], myr[myx == "EH40_80"], na.rm = T), color = myoutline) +
  geom_segment(x=5.90, xend=6.10, y = weighted.mean(myy[myx == "EH0_80"], myr[myx == "EH0_80"], na.rm = T), yend = weighted.mean(myy[myx == "EH0_80"], myr[myx == "EH0_80"], na.rm = T), color = myoutline) +
  geom_segment(x=4.90, xend=5.10, y = weighted.mean(myy[myx == "EH20_60"], myr[myx == "EH20_60"], na.rm = T), yend = weighted.mean(myy[myx == "EH20_60"], myr[myx == "EH20_60"], na.rm = T), color = myoutline) +
  geom_segment(x=3.90, xend=4.10, y = weighted.mean(myy[myx == "EH0_40"], myr[myx == "EH0_40"], na.rm = T), yend = weighted.mean(myy[myx == "EH0_40"], myr[myx == "EH0_40"], na.rm = T), color = myoutline) +
  geom_segment(x=2.90, xend=3.10, y = weighted.mean(myy[myx == "EH80"], myr[myx == "EH80"], na.rm = T), yend = weighted.mean(myy[myx == "EH80"], myr[myx == "EH80"], na.rm = T), color = myoutline) +
  geom_segment(x=1.90, xend=2.10, y = weighted.mean(myy[myx == "EH40"], myr[myx == "EH40"], na.rm = T), yend = weighted.mean(myy[myx == "EH40"], myr[myx == "EH40"], na.rm = T), color = myoutline) +
  geom_segment(x=0.90, xend=1.10, y = weighted.mean(myy[myx == "EH0"], myr[myx == "EH0"], na.rm = T), yend = weighted.mean(myy[myx == "EH0"], myr[myx == "EH0"], na.rm = T), color = myoutline) +
  geom_rug(sides = "b" , position = position_nudge(x=-0.75), alpha = myptalpha)+
  scale_color_manual(values =mypalette) + 
  geom_hline(yintercept = 0, lty = "dotted") + 
  coord_flip() +
  theme_classic()+
  theme(legend.position="none") +
  ggtitle(mytitle) + ylab(myylab) + xlab(myxlab)+
  scale_x_discrete(labels = c("EH0", "EH40", "EH80", "EH0_40", "EH20_60", "EH0_80", "EH40_80")) +
  scale_y_continuous(breaks = seq(-.3,.5,by=.05),
                     limits = c(-.3, .5),
                     labels = scales::number_format(accuracy = 0.01))+
  theme(axis.title.y = element_text(size = 8, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = 8, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = 8, angle = 0))+
  theme(axis.text.x = element_text(size = 8, angle = 0))
  # annotate("text", x=c(2,3,5,6), y=c(.14,.55,.15,.46), label = c("**", "***", "***", "*"), size = 8, fontface = "bold")
p 
# -----------------------------------------------------------------------------

# figure output ---------------------------------------------------------------
pdf(file = "000_SALTinSALT40.pdf", width = mywidth, height = myheight); p; dev.off()
# -----------------------------------------------------------------------------



# MODELS -----------------------------------------------------------------------
my$treat <- relevel(my$treat, ref = "EH0")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x
# Model is nearly unidentifiable: very large eigenvalue - Rescale variables?
# Try scaling---------
# mymod <- lmer(scale(my$dw, center = T, scale = T) ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
# # no effect.

# check for singularity ---
# tt <- getME(mymod,"theta")
# ll <- getME(mymod,"lower")
# min(tt[ll==0]) 
# # not singular fit. 

# look at an lm just to see what we would get here ---
# mymod <- lm(my$dw ~ my$treat, weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

# model eval ---------------------------
hist(residuals(mymod), breaks = 100)
hist(expand_residuals(mymod, my$re_dw), breaks = 100) # this more accurately represents the distribution of residuals in the model output. -- tails look fine here. 
anova(mymod) # test term significance
# --------------------------------------

# run same model with ea of the 7 treats as base level ---
my$treat <- relevel(my$treat, ref = "EH40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x
my$treat <- relevel(my$treat, ref = "EH80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x
my$treat <- relevel(my$treat, ref = "EH0_40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x
my$treat <- relevel(my$treat, ref = "EH20_60")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x
my$treat <- relevel(my$treat, ref = "EH0_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x
my$treat <- relevel(my$treat, ref = "EH40_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x
# ------------------------------------------------------------------------------
rm(my, mymod, p, myc, myfill, myfillapha, myheight, mylinealpha, myoutline, mypalette, myptalpha, myptsize, myr, 
   mytextsize, mytitle, mywidth, myx, myxlab, myy, myylab)
```

SALTA, SALTB in SALT 0.8
```{r}
my <- myd[!is.na(myd$dw),]
my <- my[my$mpamt == "SALT" & my$mpasp == 0.8 & my$epo %in% c("SALT_A", "SALT_B"),]
summary(my$dw)

# check weighted mean and se for all treatments in this env. [SE IS TOO SMALL TO PLOT HERE!]
my0 <- my[my$treat == "EH0",]; print("EH0"); weighted.mean(my0$dw, my0$re_dw); weighted.var.se(x = my0$dw, w = my0$re_dw, na.rm = T)
my40 <- my[my$treat == "EH40",]; print("EH40"); weighted.mean(my40$dw, my40$re_dw); weighted.var.se(x = my40$dw, w = my40$re_dw, na.rm = T)
my80 <- my[my$treat == "EH80",]; print("EH80"); weighted.mean(my80$dw, my80$re_dw); weighted.var.se(x = my80$dw, w = my80$re_dw, na.rm = T)
my040 <- my[my$treat == "EH0_40",]; print("EH0_40"); weighted.mean(my040$dw, my040$re_dw); weighted.var.se(x = my040$dw, w = my040$re_dw, na.rm = T)
my2060 <- my[my$treat == "EH20_60",]; print("EH20_60"); weighted.mean(my2060$dw, my2060$re_dw); weighted.var.se(x = my2060$dw, w = my2060$re_dw, na.rm = T)
my4080 <- my[my$treat == "EH40_80",]; print("EH40_80"); weighted.mean(my4080$dw, my4080$re_dw); weighted.var.se(x = my4080$dw, w = my4080$re_dw, na.rm = T)
my080 <- my[my$treat == "EH0_80",]; print("EH0_80"); weighted.mean(my080$dw, my080$re_dw); weighted.var.se(x = my080$dw, w = my080$re_dw, na.rm = T)


# Visualize -------------------------------------------------------------------
my$treat <- factor(my$treat, levels = c("EH0", "EH40", "EH80", "EH0_40", "EH20_60", "EH0_80", "EH40_80"))
myx <- my$treat
myy <- my$dw
myr <- my$re_dw
myc <- my$treat

mytitle <- NULL
myylab <- "Fitness change"
myxlab <- "Treatment"

myoutline <-  "grey20"
myfill <-  "grey90"
myfillapha <- 0.35
myptalpha <- 0.35
mylinealpha <- 0.35

mypalette <- setpalette
mytextsize <- 8
myheight <- 3.5
mywidth <- 7
myptsize <- ((((myr/max(myr))*10)*((myheight*mywidth)/(7^2))) - min(((myr/max(myr))*10)*((myheight*mywidth)/(7^2))))+0.01

p <- ggplot(my, aes(x=myx, y=myy, weight = myr, color = myc)) +
  geom_violin(color = myoutline, fill = myfill, draw_quantiles = NULL, inherit.aes = F, aes( x=myx, y=myy), trim = T) + 
  geom_jitter(width =0.15, height = 0, alpha = myptalpha, size = myptsize) +
  geom_segment(x=6.90, xend=7.10, y = weighted.mean(myy[myx == "EH40_80"], myr[myx == "EH40_80"], na.rm = T), yend = weighted.mean(myy[myx == "EH40_80"], myr[myx == "EH40_80"], na.rm = T), color = myoutline) +
  geom_segment(x=5.90, xend=6.10, y = weighted.mean(myy[myx == "EH0_80"], myr[myx == "EH0_80"], na.rm = T), yend = weighted.mean(myy[myx == "EH0_80"], myr[myx == "EH0_80"], na.rm = T), color = myoutline) +
  geom_segment(x=4.90, xend=5.10, y = weighted.mean(myy[myx == "EH20_60"], myr[myx == "EH20_60"], na.rm = T), yend = weighted.mean(myy[myx == "EH20_60"], myr[myx == "EH20_60"], na.rm = T), color = myoutline) +
  geom_segment(x=3.90, xend=4.10, y = weighted.mean(myy[myx == "EH0_40"], myr[myx == "EH0_40"], na.rm = T), yend = weighted.mean(myy[myx == "EH0_40"], myr[myx == "EH0_40"], na.rm = T), color = myoutline) +
  geom_segment(x=2.90, xend=3.10, y = weighted.mean(myy[myx == "EH80"], myr[myx == "EH80"], na.rm = T), yend = weighted.mean(myy[myx == "EH80"], myr[myx == "EH80"], na.rm = T), color = myoutline) +
  geom_segment(x=1.90, xend=2.10, y = weighted.mean(myy[myx == "EH40"], myr[myx == "EH40"], na.rm = T), yend = weighted.mean(myy[myx == "EH40"], myr[myx == "EH40"], na.rm = T), color = myoutline) +
  geom_segment(x=0.90, xend=1.10, y = weighted.mean(myy[myx == "EH0"], myr[myx == "EH0"], na.rm = T), yend = weighted.mean(myy[myx == "EH0"], myr[myx == "EH0"], na.rm = T), color = myoutline) +
  geom_rug(sides = "b" , position = position_nudge(x=-0.75), alpha = myptalpha)+
  scale_color_manual(values =mypalette) + 
  geom_hline(yintercept = 0, lty = "dotted") + 
  coord_flip() +
  theme_classic()+
  theme(legend.position="none") +
  ggtitle(mytitle) + ylab(myylab) + xlab(myxlab)+
  scale_x_discrete(labels = c("EH0", "EH40", "EH80", "EH0_40", "EH20_60", "EH0_80", "EH40_80")) +
  scale_y_continuous(breaks = seq(-.3,.5,by=.05),
                     limits = c(-.3, .5),
                     labels = scales::number_format(accuracy = 0.01))+
  theme(axis.title.y = element_text(size = 8, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = 8, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = 8, angle = 0))+
  theme(axis.text.x = element_text(size = 8, angle = 0))
  # annotate("text", x=c(2,3,5,6), y=c(.14,.55,.15,.46), label = c("**", "***", "***", "*"), size = 8, fontface = "bold")
p 
# -----------------------------------------------------------------------------

# figure output ---------------------------------------------------------------
pdf(file = "000_SALTinSALT80.pdf", width = mywidth, height = myheight); p; dev.off()
# -----------------------------------------------------------------------------



# MODELS -----------------------------------------------------------------------
my$treat <- relevel(my$treat, ref = "EH0")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x

# model eval ---------------------------
hist(residuals(mymod), breaks = 100)
hist(expand_residuals(mymod, my$re_dw), breaks = 100) # this more accurately represents the distribution of residuals in the model output. -- tails look fine here. 
anova(mymod) # test term significance
# --------------------------------------

# run same model with ea of the 7 treats as base level ---
my$treat <- relevel(my$treat, ref = "EH40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x
my$treat <- relevel(my$treat, ref = "EH80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x
my$treat <- relevel(my$treat, ref = "EH0_40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x
my$treat <- relevel(my$treat, ref = "EH20_60")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x
my$treat <- relevel(my$treat, ref = "EH0_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x
my$treat <- relevel(my$treat, ref = "EH40_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x
# ------------------------------------------------------------------------------
rm(my, mymod, p, myc, myfill, myfillapha, myheight, mylinealpha, myoutline, mypalette, myptalpha, myptsize, myr, 
   mytextsize, mytitle, mywidth, myx, myxlab, myy, myylab)
```











SALTA, SALTB in SALT 1.2
```{r}
my <- myd[!is.na(myd$dw),]
my <- my[my$mpamt == "SALT" & my$mpasp == 1.2 & my$epo %in% c("SALT_A", "SALT_B"),]
summary(my$dw)

# check weighted mean and se for all treatments in this env. [SE IS TOO SMALL TO PLOT HERE!]
my0 <- my[my$treat == "EH0",]; print("EH0"); weighted.mean(my0$dw, my0$re_dw); weighted.var.se(x = my0$dw, w = my0$re_dw, na.rm = T)
my40 <- my[my$treat == "EH40",]; print("EH40"); weighted.mean(my40$dw, my40$re_dw); weighted.var.se(x = my40$dw, w = my40$re_dw, na.rm = T)
my80 <- my[my$treat == "EH80",]; print("EH80"); weighted.mean(my80$dw, my80$re_dw); weighted.var.se(x = my80$dw, w = my80$re_dw, na.rm = T)
my040 <- my[my$treat == "EH0_40",]; print("EH0_40"); weighted.mean(my040$dw, my040$re_dw); weighted.var.se(x = my040$dw, w = my040$re_dw, na.rm = T)
my2060 <- my[my$treat == "EH20_60",]; print("EH20_60"); weighted.mean(my2060$dw, my2060$re_dw); weighted.var.se(x = my2060$dw, w = my2060$re_dw, na.rm = T)
my4080 <- my[my$treat == "EH40_80",]; print("EH40_80"); weighted.mean(my4080$dw, my4080$re_dw); weighted.var.se(x = my4080$dw, w = my4080$re_dw, na.rm = T)
my080 <- my[my$treat == "EH0_80",]; print("EH0_80"); weighted.mean(my080$dw, my080$re_dw); weighted.var.se(x = my080$dw, w = my080$re_dw, na.rm = T)




# Visualize -------------------------------------------------------------------
my$treat <- factor(my$treat, levels = c("EH0", "EH40", "EH80", "EH0_40", "EH20_60", "EH0_80", "EH40_80"))
myx <- my$treat
myy <- my$dw
myr <- my$re_dw
myc <- my$treat

mytitle <- NULL
myylab <- "Fitness change"
myxlab <- "Treatment"

myoutline <-  "grey20"
myfill <-  "grey90"
myfillapha <- 0.35
myptalpha <- 0.35
mylinealpha <- 0.35

mypalette <- setpalette
mytextsize <- 8
myheight <- 3.5
mywidth <- 7
myptsize <- ((((myr/max(myr))*10)*((myheight*mywidth)/(7^2))) - min(((myr/max(myr))*10)*((myheight*mywidth)/(7^2))))+0.01

p <- ggplot(my, aes(x=myx, y=myy, weight = myr, color = myc)) +
  geom_violin(color = myoutline, fill = myfill, draw_quantiles = NULL, inherit.aes = F, aes( x=myx, y=myy), trim = T) + 
  geom_jitter(width =0.15, height = 0, alpha = myptalpha, size = myptsize) +
  geom_segment(x=6.90, xend=7.10, y = weighted.mean(myy[myx == "EH40_80"], myr[myx == "EH40_80"], na.rm = T), yend = weighted.mean(myy[myx == "EH40_80"], myr[myx == "EH40_80"], na.rm = T), color = myoutline) +
  geom_segment(x=5.90, xend=6.10, y = weighted.mean(myy[myx == "EH0_80"], myr[myx == "EH0_80"], na.rm = T), yend = weighted.mean(myy[myx == "EH0_80"], myr[myx == "EH0_80"], na.rm = T), color = myoutline) +
  geom_segment(x=4.90, xend=5.10, y = weighted.mean(myy[myx == "EH20_60"], myr[myx == "EH20_60"], na.rm = T), yend = weighted.mean(myy[myx == "EH20_60"], myr[myx == "EH20_60"], na.rm = T), color = myoutline) +
  geom_segment(x=3.90, xend=4.10, y = weighted.mean(myy[myx == "EH0_40"], myr[myx == "EH0_40"], na.rm = T), yend = weighted.mean(myy[myx == "EH0_40"], myr[myx == "EH0_40"], na.rm = T), color = myoutline) +
  geom_segment(x=2.90, xend=3.10, y = weighted.mean(myy[myx == "EH80"], myr[myx == "EH80"], na.rm = T), yend = weighted.mean(myy[myx == "EH80"], myr[myx == "EH80"], na.rm = T), color = myoutline) +
  geom_segment(x=1.90, xend=2.10, y = weighted.mean(myy[myx == "EH40"], myr[myx == "EH40"], na.rm = T), yend = weighted.mean(myy[myx == "EH40"], myr[myx == "EH40"], na.rm = T), color = myoutline) +
  geom_segment(x=0.90, xend=1.10, y = weighted.mean(myy[myx == "EH0"], myr[myx == "EH0"], na.rm = T), yend = weighted.mean(myy[myx == "EH0"], myr[myx == "EH0"], na.rm = T), color = myoutline) +
  geom_rug(sides = "b" , position = position_nudge(x=-0.75), alpha = myptalpha)+
  scale_color_manual(values =mypalette) + 
  geom_hline(yintercept = 0, lty = "dotted") + 
  coord_flip() +
  theme_classic()+
  theme(legend.position="none") +
  ggtitle(mytitle) + ylab(myylab) + xlab(myxlab)+
  scale_x_discrete(labels = c("EH0", "EH40", "EH80", "EH0_40", "EH20_60", "EH0_80", "EH40_80")) +
  scale_y_continuous(breaks = seq(-.3,.5,by=.05),
                     limits = c(-.3, .5),
                     labels = scales::number_format(accuracy = 0.01))+
  theme(axis.title.y = element_text(size = 8, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = 8, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = 8, angle = 0))+
  theme(axis.text.x = element_text(size = 8, angle = 0))
  # annotate("text", x=c(2,3,5,6), y=c(.14,.55,.15,.46), label = c("**", "***", "***", "*"), size = 8, fontface = "bold")
p 
# -----------------------------------------------------------------------------

# figure output ---------------------------------------------------------------
pdf(file = "000_SALTinSALT120.pdf", width = mywidth, height = myheight); p; dev.off()
# -----------------------------------------------------------------------------



# MODELS -----------------------------------------------------------------------
my$treat <- relevel(my$treat, ref = "EH0")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x

# model eval ---------------------------
hist(residuals(mymod), breaks = 100)
hist(expand_residuals(mymod, my$re_dw), breaks = 100) # this more accurately represents the distribution of residuals in the model output. -- tails look fine here. 
anova(mymod) # test term significance
# --------------------------------------

# run same model with ea of the 7 treats as base level ---
my$treat <- relevel(my$treat, ref = "EH40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x
my$treat <- relevel(my$treat, ref = "EH80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x
my$treat <- relevel(my$treat, ref = "EH0_40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x
my$treat <- relevel(my$treat, ref = "EH20_60")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x
my$treat <- relevel(my$treat, ref = "EH0_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x
my$treat <- relevel(my$treat, ref = "EH40_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x
# ------------------------------------------------------------------------------
rm(my, mymod, p, myc, myfill, myfillapha, myheight, mylinealpha, myoutline, mypalette, myptalpha, myptsize, myr, 
   mytextsize, mytitle, mywidth, myx, myxlab, myy, myylab)
```


COPRA, COPRB in CM
```{r}
my <- myd[!is.na(myd$dw),]
my <- my[my$mpamt == "CM" & my$mpasp == 0.0 & my$epo %in% c("COPR_A", "COPR_B"),]


# check weighted mean and se for all treatments in this env. [SE IS TOO SMALL TO PLOT HERE!]
my0 <- my[my$treat == "EH0",]; print("EH0"); weighted.mean(my0$dw, my0$re_dw); weighted.var.se(x = my0$dw, w = my0$re_dw, na.rm = T)
my40 <- my[my$treat == "EH40",]; print("EH40"); weighted.mean(my40$dw, my40$re_dw); weighted.var.se(x = my40$dw, w = my40$re_dw, na.rm = T)
my80 <- my[my$treat == "EH80",]; print("EH80"); weighted.mean(my80$dw, my80$re_dw); weighted.var.se(x = my80$dw, w = my80$re_dw, na.rm = T)
my040 <- my[my$treat == "EH0_40",]; print("EH0_40"); weighted.mean(my040$dw, my040$re_dw); weighted.var.se(x = my040$dw, w = my040$re_dw, na.rm = T)
my2060 <- my[my$treat == "EH20_60",]; print("EH20_60"); weighted.mean(my2060$dw, my2060$re_dw); weighted.var.se(x = my2060$dw, w = my2060$re_dw, na.rm = T)
my4080 <- my[my$treat == "EH40_80",]; print("EH40_80"); weighted.mean(my4080$dw, my4080$re_dw); weighted.var.se(x = my4080$dw, w = my4080$re_dw, na.rm = T)
my080 <- my[my$treat == "EH0_80",]; print("EH0_80"); weighted.mean(my080$dw, my080$re_dw); weighted.var.se(x = my080$dw, w = my080$re_dw, na.rm = T)



# Visualize -------------------------------------------------------------------
my$treat <- factor(my$treat, levels = c("EH0", "EH40", "EH80", "EH0_40", "EH20_60", "EH0_80", "EH40_80"))
myx <- my$treat
myy <- my$dw
myr <- my$re_dw
myc <- my$treat

mytitle <- NULL
myylab <- "Fitness change"
myxlab <- "Treatment"

myoutline <-  "grey20"
myfill <-  "grey90"
myfillapha <- 0.35
myptalpha <- 0.35
mylinealpha <- 0.35

mypalette <- setpalette
mytextsize <- 8
myheight <- 3.5
mywidth <- 7
myptsize <- ((((myr/max(myr))*10)*((myheight*mywidth)/(7^2))) - min(((myr/max(myr))*10)*((myheight*mywidth)/(7^2))))+0.01

p <- ggplot(my, aes(x=myx, y=myy, weight = myr, color = myc)) +
  geom_violin(color = myoutline, fill = myfill, draw_quantiles = NULL, inherit.aes = F, aes( x=myx, y=myy), trim = T) + 
  geom_jitter(width =0.15, height = 0, alpha = myptalpha, size = myptsize) +
  geom_segment(x=6.90, xend=7.10, y = weighted.mean(myy[myx == "EH40_80"], myr[myx == "EH40_80"], na.rm = T), yend = weighted.mean(myy[myx == "EH40_80"], myr[myx == "EH40_80"], na.rm = T), color = myoutline) +
  geom_segment(x=5.90, xend=6.10, y = weighted.mean(myy[myx == "EH0_80"], myr[myx == "EH0_80"], na.rm = T), yend = weighted.mean(myy[myx == "EH0_80"], myr[myx == "EH0_80"], na.rm = T), color = myoutline) +
  geom_segment(x=4.90, xend=5.10, y = weighted.mean(myy[myx == "EH20_60"], myr[myx == "EH20_60"], na.rm = T), yend = weighted.mean(myy[myx == "EH20_60"], myr[myx == "EH20_60"], na.rm = T), color = myoutline) +
  geom_segment(x=3.90, xend=4.10, y = weighted.mean(myy[myx == "EH0_40"], myr[myx == "EH0_40"], na.rm = T), yend = weighted.mean(myy[myx == "EH0_40"], myr[myx == "EH0_40"], na.rm = T), color = myoutline) +
  geom_segment(x=2.90, xend=3.10, y = weighted.mean(myy[myx == "EH80"], myr[myx == "EH80"], na.rm = T), yend = weighted.mean(myy[myx == "EH80"], myr[myx == "EH80"], na.rm = T), color = myoutline) +
  geom_segment(x=1.90, xend=2.10, y = weighted.mean(myy[myx == "EH40"], myr[myx == "EH40"], na.rm = T), yend = weighted.mean(myy[myx == "EH40"], myr[myx == "EH40"], na.rm = T), color = myoutline) +
  geom_segment(x=0.90, xend=1.10, y = weighted.mean(myy[myx == "EH0"], myr[myx == "EH0"], na.rm = T), yend = weighted.mean(myy[myx == "EH0"], myr[myx == "EH0"], na.rm = T), color = myoutline) +
  geom_rug(sides = "b" , position = position_nudge(x=-0.75), alpha = myptalpha)+
  scale_color_manual(values =mypalette) + 
  geom_hline(yintercept = 0, lty = "dotted") + 
  coord_flip() +
  theme_classic()+
  theme(legend.position="none") +
  ggtitle(mytitle) + ylab(myylab) + xlab(myxlab)+
  scale_x_discrete(labels = c("EH0", "EH40", "EH80", "EH0_40", "EH20_60", "EH0_80", "EH40_80")) +
  scale_y_continuous(breaks = seq(-.3,.9,by=.05),
                     limits = c(-.3, .9),
                     labels = scales::number_format(accuracy = 0.01))+
  theme(axis.title.y = element_text(size = 8, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = 8, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = 8, angle = 0))+
  theme(axis.text.x = element_text(size = 8, angle = 0))
  # annotate("text", x=c(2,3,5,6), y=c(.14,.55,.15,.46), label = c("**", "***", "***", "*"), size = 8, fontface = "bold")
p 
# -----------------------------------------------------------------------------

# figure output ---------------------------------------------------------------
pdf(file = "000_COPRinCM.pdf", width = mywidth, height = myheight); p; dev.off()
# -----------------------------------------------------------------------------



# MODELS -----------------------------------------------------------------------
my$treat <- relevel(my$treat, ref = "EH0")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x

# model eval ---------------------------
hist(residuals(mymod), breaks = 100)
hist(expand_residuals(mymod, my$re_dw), breaks = 100) # this more accurately represents the distribution of residuals in the model output. -- tails look fine here. 
anova(mymod) # test term significance
# --------------------------------------

# run same model with ea of the 7 treats as base level ---
my$treat <- relevel(my$treat, ref = "EH40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x
my$treat <- relevel(my$treat, ref = "EH80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x
my$treat <- relevel(my$treat, ref = "EH0_40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x
my$treat <- relevel(my$treat, ref = "EH20_60")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x
my$treat <- relevel(my$treat, ref = "EH0_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x
my$treat <- relevel(my$treat, ref = "EH40_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x
# ------------------------------------------------------------------------------
rm(my, mymod, p, myc, myfill, myfillapha, myheight, mylinealpha, myoutline, mypalette, myptalpha, myptsize, myr, 
   mytextsize, mytitle, mywidth, myx, myxlab, myy, myylab)
```


COPRA, COPRB in COPR 0.4
```{r}
my <- myd[!is.na(myd$dw),]
my <- my[my$mpamt == "COPR" & my$mpasp == 0.4 & my$epo %in% c("COPR_A", "COPR_B"),]


# check weighted mean and se for all treatments in this env. [SE IS TOO SMALL TO PLOT HERE!]
my0 <- my[my$treat == "EH0",]; print("EH0"); weighted.mean(my0$dw, my0$re_dw); weighted.var.se(x = my0$dw, w = my0$re_dw, na.rm = T)
my40 <- my[my$treat == "EH40",]; print("EH40"); weighted.mean(my40$dw, my40$re_dw); weighted.var.se(x = my40$dw, w = my40$re_dw, na.rm = T)
my80 <- my[my$treat == "EH80",]; print("EH80"); weighted.mean(my80$dw, my80$re_dw); weighted.var.se(x = my80$dw, w = my80$re_dw, na.rm = T)
my040 <- my[my$treat == "EH0_40",]; print("EH0_40"); weighted.mean(my040$dw, my040$re_dw); weighted.var.se(x = my040$dw, w = my040$re_dw, na.rm = T)
my2060 <- my[my$treat == "EH20_60",]; print("EH20_60"); weighted.mean(my2060$dw, my2060$re_dw); weighted.var.se(x = my2060$dw, w = my2060$re_dw, na.rm = T)
my4080 <- my[my$treat == "EH40_80",]; print("EH40_80"); weighted.mean(my4080$dw, my4080$re_dw); weighted.var.se(x = my4080$dw, w = my4080$re_dw, na.rm = T)
my080 <- my[my$treat == "EH0_80",]; print("EH0_80"); weighted.mean(my080$dw, my080$re_dw); weighted.var.se(x = my080$dw, w = my080$re_dw, na.rm = T)



# Visualize -------------------------------------------------------------------
my$treat <- factor(my$treat, levels = c("EH0", "EH40", "EH80", "EH0_40", "EH20_60", "EH0_80", "EH40_80"))
myx <- my$treat
myy <- my$dw
myr <- my$re_dw
myc <- my$treat

mytitle <- NULL
myylab <- "Fitness change"
myxlab <- "Treatment"

myoutline <-  "grey20"
myfill <-  "grey90"
myfillapha <- 0.35
myptalpha <- 0.35
mylinealpha <- 0.35

mypalette <- setpalette
mytextsize <- 8
myheight <- 3.5
mywidth <- 7
myptsize <- ((((myr/max(myr))*10)*((myheight*mywidth)/(7^2))) - min(((myr/max(myr))*10)*((myheight*mywidth)/(7^2))))+0.01

p <- ggplot(my, aes(x=myx, y=myy, weight = myr, color = myc)) +
  geom_violin(color = myoutline, fill = myfill, draw_quantiles = NULL, inherit.aes = F, aes( x=myx, y=myy), trim = T) + 
  geom_jitter(width =0.15, height = 0, alpha = myptalpha, size = myptsize) +
  geom_segment(x=6.90, xend=7.10, y = weighted.mean(myy[myx == "EH40_80"], myr[myx == "EH40_80"], na.rm = T), yend = weighted.mean(myy[myx == "EH40_80"], myr[myx == "EH40_80"], na.rm = T), color = myoutline) +
  geom_segment(x=5.90, xend=6.10, y = weighted.mean(myy[myx == "EH0_80"], myr[myx == "EH0_80"], na.rm = T), yend = weighted.mean(myy[myx == "EH0_80"], myr[myx == "EH0_80"], na.rm = T), color = myoutline) +
  geom_segment(x=4.90, xend=5.10, y = weighted.mean(myy[myx == "EH20_60"], myr[myx == "EH20_60"], na.rm = T), yend = weighted.mean(myy[myx == "EH20_60"], myr[myx == "EH20_60"], na.rm = T), color = myoutline) +
  geom_segment(x=3.90, xend=4.10, y = weighted.mean(myy[myx == "EH0_40"], myr[myx == "EH0_40"], na.rm = T), yend = weighted.mean(myy[myx == "EH0_40"], myr[myx == "EH0_40"], na.rm = T), color = myoutline) +
  geom_segment(x=2.90, xend=3.10, y = weighted.mean(myy[myx == "EH80"], myr[myx == "EH80"], na.rm = T), yend = weighted.mean(myy[myx == "EH80"], myr[myx == "EH80"], na.rm = T), color = myoutline) +
  geom_segment(x=1.90, xend=2.10, y = weighted.mean(myy[myx == "EH40"], myr[myx == "EH40"], na.rm = T), yend = weighted.mean(myy[myx == "EH40"], myr[myx == "EH40"], na.rm = T), color = myoutline) +
  geom_segment(x=0.90, xend=1.10, y = weighted.mean(myy[myx == "EH0"], myr[myx == "EH0"], na.rm = T), yend = weighted.mean(myy[myx == "EH0"], myr[myx == "EH0"], na.rm = T), color = myoutline) +
  geom_rug(sides = "b" , position = position_nudge(x=-0.75), alpha = myptalpha)+
  scale_color_manual(values =mypalette) + 
  geom_hline(yintercept = 0, lty = "dotted") + 
  coord_flip() +
  theme_classic()+
  theme(legend.position="none") +
  ggtitle(mytitle) + ylab(myylab) + xlab(myxlab)+
  scale_x_discrete(labels = c("EH0", "EH40", "EH80", "EH0_40", "EH20_60", "EH0_80", "EH40_80")) +
  scale_y_continuous(breaks = seq(-.3,.9,by=.05),
                     limits = c(-.3, .9),
                     labels = scales::number_format(accuracy = 0.01))+
  theme(axis.title.y = element_text(size = 8, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = 8, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = 8, angle = 0))+
  theme(axis.text.x = element_text(size = 8, angle = 0))
  # annotate("text", x=c(2,3,5,6), y=c(.14,.55,.15,.46), label = c("**", "***", "***", "*"), size = 8, fontface = "bold")
p 
# -----------------------------------------------------------------------------

# figure output ---------------------------------------------------------------
pdf(file = "000_COPRinCOPR40.pdf", width = mywidth, height = myheight); p; dev.off()
# -----------------------------------------------------------------------------



# MODELS -----------------------------------------------------------------------
my$treat <- relevel(my$treat, ref = "EH0")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x

# model eval ---------------------------
hist(residuals(mymod), breaks = 100)
hist(expand_residuals(mymod, my$re_dw), breaks = 100) # this more accurately represents the distribution of residuals in the model output. -- tails look fine here. 
anova(mymod) # test term significance
# --------------------------------------

# run same model with ea of the 7 treats as base level ---
my$treat <- relevel(my$treat, ref = "EH40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x
my$treat <- relevel(my$treat, ref = "EH80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x
my$treat <- relevel(my$treat, ref = "EH0_40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x
my$treat <- relevel(my$treat, ref = "EH20_60")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x
my$treat <- relevel(my$treat, ref = "EH0_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x
my$treat <- relevel(my$treat, ref = "EH40_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x
# ------------------------------------------------------------------------------
rm(my, mymod, p, myc, myfill, myfillapha, myheight, mylinealpha, myoutline, mypalette, myptalpha, myptsize, myr, 
   mytextsize, mytitle, mywidth, myx, myxlab, myy, myylab)
```


COPRA, COPRB in COPR 0.8
```{r}
my <- myd[!is.na(myd$dw),]
my <- my[my$mpamt == "COPR" & my$mpasp == 0.8 & my$epo %in% c("COPR_A", "COPR_B"),]


# check weighted mean and se for all treatments in this env. [SE IS TOO SMALL TO PLOT HERE!]
my0 <- my[my$treat == "EH0",]; print("EH0"); weighted.mean(my0$dw, my0$re_dw); weighted.var.se(x = my0$dw, w = my0$re_dw, na.rm = T)
my40 <- my[my$treat == "EH40",]; print("EH40"); weighted.mean(my40$dw, my40$re_dw); weighted.var.se(x = my40$dw, w = my40$re_dw, na.rm = T)
my80 <- my[my$treat == "EH80",]; print("EH80"); weighted.mean(my80$dw, my80$re_dw); weighted.var.se(x = my80$dw, w = my80$re_dw, na.rm = T)
my040 <- my[my$treat == "EH0_40",]; print("EH0_40"); weighted.mean(my040$dw, my040$re_dw); weighted.var.se(x = my040$dw, w = my040$re_dw, na.rm = T)
my2060 <- my[my$treat == "EH20_60",]; print("EH20_60"); weighted.mean(my2060$dw, my2060$re_dw); weighted.var.se(x = my2060$dw, w = my2060$re_dw, na.rm = T)
my4080 <- my[my$treat == "EH40_80",]; print("EH40_80"); weighted.mean(my4080$dw, my4080$re_dw); weighted.var.se(x = my4080$dw, w = my4080$re_dw, na.rm = T)
my080 <- my[my$treat == "EH0_80",]; print("EH0_80"); weighted.mean(my080$dw, my080$re_dw); weighted.var.se(x = my080$dw, w = my080$re_dw, na.rm = T)



# Visualize -------------------------------------------------------------------
my$treat <- factor(my$treat, levels = c("EH0", "EH40", "EH80", "EH0_40", "EH20_60", "EH0_80", "EH40_80"))
myx <- my$treat
myy <- my$dw
myr <- my$re_dw
myc <- my$treat

mytitle <- NULL
myylab <- "Fitness change"
myxlab <- "Treatment"

myoutline <-  "grey20"
myfill <-  "grey90"
myfillapha <- 0.35
myptalpha <- 0.35
mylinealpha <- 0.35

mypalette <- setpalette
mytextsize <- 8
myheight <- 3.5
mywidth <- 7
myptsize <- ((((myr/max(myr))*10)*((myheight*mywidth)/(7^2))) - min(((myr/max(myr))*10)*((myheight*mywidth)/(7^2))))+0.01

p <- ggplot(my, aes(x=myx, y=myy, weight = myr, color = myc)) +
  geom_violin(color = myoutline, fill = myfill, draw_quantiles = NULL, inherit.aes = F, aes( x=myx, y=myy), trim = T) + 
  geom_jitter(width =0.15, height = 0, alpha = myptalpha, size = myptsize) +
  geom_segment(x=6.90, xend=7.10, y = weighted.mean(myy[myx == "EH40_80"], myr[myx == "EH40_80"], na.rm = T), yend = weighted.mean(myy[myx == "EH40_80"], myr[myx == "EH40_80"], na.rm = T), color = myoutline) +
  geom_segment(x=5.90, xend=6.10, y = weighted.mean(myy[myx == "EH0_80"], myr[myx == "EH0_80"], na.rm = T), yend = weighted.mean(myy[myx == "EH0_80"], myr[myx == "EH0_80"], na.rm = T), color = myoutline) +
  geom_segment(x=4.90, xend=5.10, y = weighted.mean(myy[myx == "EH20_60"], myr[myx == "EH20_60"], na.rm = T), yend = weighted.mean(myy[myx == "EH20_60"], myr[myx == "EH20_60"], na.rm = T), color = myoutline) +
  geom_segment(x=3.90, xend=4.10, y = weighted.mean(myy[myx == "EH0_40"], myr[myx == "EH0_40"], na.rm = T), yend = weighted.mean(myy[myx == "EH0_40"], myr[myx == "EH0_40"], na.rm = T), color = myoutline) +
  geom_segment(x=2.90, xend=3.10, y = weighted.mean(myy[myx == "EH80"], myr[myx == "EH80"], na.rm = T), yend = weighted.mean(myy[myx == "EH80"], myr[myx == "EH80"], na.rm = T), color = myoutline) +
  geom_segment(x=1.90, xend=2.10, y = weighted.mean(myy[myx == "EH40"], myr[myx == "EH40"], na.rm = T), yend = weighted.mean(myy[myx == "EH40"], myr[myx == "EH40"], na.rm = T), color = myoutline) +
  geom_segment(x=0.90, xend=1.10, y = weighted.mean(myy[myx == "EH0"], myr[myx == "EH0"], na.rm = T), yend = weighted.mean(myy[myx == "EH0"], myr[myx == "EH0"], na.rm = T), color = myoutline) +
  geom_rug(sides = "b" , position = position_nudge(x=-0.75), alpha = myptalpha)+
  scale_color_manual(values =mypalette) + 
  geom_hline(yintercept = 0, lty = "dotted") + 
  coord_flip() +
  theme_classic()+
  theme(legend.position="none") +
  ggtitle(mytitle) + ylab(myylab) + xlab(myxlab)+
  scale_x_discrete(labels = c("EH0", "EH40", "EH80", "EH0_40", "EH20_60", "EH0_80", "EH40_80")) +
  scale_y_continuous(breaks = seq(-.3,.9,by=.05),
                     limits = c(-.3, .9),
                     labels = scales::number_format(accuracy = 0.01))+
  theme(axis.title.y = element_text(size = 8, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = 8, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = 8, angle = 0))+
  theme(axis.text.x = element_text(size = 8, angle = 0))
  # annotate("text", x=c(2,3,5,6), y=c(.14,.55,.15,.46), label = c("**", "***", "***", "*"), size = 8, fontface = "bold")
p 
# -----------------------------------------------------------------------------

# figure output ---------------------------------------------------------------
pdf(file = "000_COPRinCOPR80.pdf", width = mywidth, height = myheight); p; dev.off()
# -----------------------------------------------------------------------------



# MODELS -----------------------------------------------------------------------
my$treat <- relevel(my$treat, ref = "EH0")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x

# model eval ---------------------------
hist(residuals(mymod), breaks = 100)
hist(expand_residuals(mymod, my$re_dw), breaks = 100) # this more accurately represents the distribution of residuals in the model output. -- tails look fine here. 
anova(mymod) # test term significance
# --------------------------------------

# run same model with ea of the 7 treats as base level ---
my$treat <- relevel(my$treat, ref = "EH40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x
my$treat <- relevel(my$treat, ref = "EH80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x
my$treat <- relevel(my$treat, ref = "EH0_40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x
my$treat <- relevel(my$treat, ref = "EH20_60")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x
my$treat <- relevel(my$treat, ref = "EH0_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x
my$treat <- relevel(my$treat, ref = "EH40_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x
# ------------------------------------------------------------------------------
rm(my, mymod, p, myc, myfill, myfillapha, myheight, mylinealpha, myoutline, mypalette, myptalpha, myptsize, myr, 
   mytextsize, mytitle, mywidth, myx, myxlab, myy, myylab)
```



COPRA, COPRB in COPR 1.2
```{r}
my <- myd[!is.na(myd$dw),]
my <- my[my$mpamt == "COPR" & my$mpasp == 1.2 & my$epo %in% c("COPR_A", "COPR_B"),]

# check weighted mean and se for all treatments in this env. [SE IS TOO SMALL TO PLOT HERE!]
my0 <- my[my$treat == "EH0",]; print("EH0"); weighted.mean(my0$dw, my0$re_dw); weighted.var.se(x = my0$dw, w = my0$re_dw, na.rm = T)
my40 <- my[my$treat == "EH40",]; print("EH40"); weighted.mean(my40$dw, my40$re_dw); weighted.var.se(x = my40$dw, w = my40$re_dw, na.rm = T)
my80 <- my[my$treat == "EH80",]; print("EH80"); weighted.mean(my80$dw, my80$re_dw); weighted.var.se(x = my80$dw, w = my80$re_dw, na.rm = T)
my040 <- my[my$treat == "EH0_40",]; print("EH0_40"); weighted.mean(my040$dw, my040$re_dw); weighted.var.se(x = my040$dw, w = my040$re_dw, na.rm = T)
my2060 <- my[my$treat == "EH20_60",]; print("EH20_60"); weighted.mean(my2060$dw, my2060$re_dw); weighted.var.se(x = my2060$dw, w = my2060$re_dw, na.rm = T)
my4080 <- my[my$treat == "EH40_80",]; print("EH40_80"); weighted.mean(my4080$dw, my4080$re_dw); weighted.var.se(x = my4080$dw, w = my4080$re_dw, na.rm = T)
my080 <- my[my$treat == "EH0_80",]; print("EH0_80"); weighted.mean(my080$dw, my080$re_dw); weighted.var.se(x = my080$dw, w = my080$re_dw, na.rm = T)




# Visualize -------------------------------------------------------------------
my$treat <- factor(my$treat, levels = c("EH0", "EH40", "EH80", "EH0_40", "EH20_60", "EH0_80", "EH40_80"))
myx <- my$treat
myy <- my$dw
myr <- my$re_dw
myc <- my$treat

mytitle <- NULL
myylab <- "Fitness change"
myxlab <- "Treatment"

myoutline <-  "grey20"
myfill <-  "grey90"
myfillapha <- 0.35
myptalpha <- 0.35
mylinealpha <- 0.35

mypalette <- setpalette
mytextsize <- 8
myheight <- 3.5
mywidth <- 7
myptsize <- ((((myr/max(myr))*10)*((myheight*mywidth)/(7^2))) - min(((myr/max(myr))*10)*((myheight*mywidth)/(7^2))))+0.01

p <- ggplot(my, aes(x=myx, y=myy, weight = myr, color = myc)) +
  geom_violin(color = myoutline, fill = myfill, draw_quantiles = NULL, inherit.aes = F, aes( x=myx, y=myy), trim = T) + 
  geom_jitter(width =0.15, height = 0, alpha = myptalpha, size = myptsize) +
  geom_segment(x=6.90, xend=7.10, y = weighted.mean(myy[myx == "EH40_80"], myr[myx == "EH40_80"], na.rm = T), yend = weighted.mean(myy[myx == "EH40_80"], myr[myx == "EH40_80"], na.rm = T), color = myoutline) +
  geom_segment(x=5.90, xend=6.10, y = weighted.mean(myy[myx == "EH0_80"], myr[myx == "EH0_80"], na.rm = T), yend = weighted.mean(myy[myx == "EH0_80"], myr[myx == "EH0_80"], na.rm = T), color = myoutline) +
  geom_segment(x=4.90, xend=5.10, y = weighted.mean(myy[myx == "EH20_60"], myr[myx == "EH20_60"], na.rm = T), yend = weighted.mean(myy[myx == "EH20_60"], myr[myx == "EH20_60"], na.rm = T), color = myoutline) +
  geom_segment(x=3.90, xend=4.10, y = weighted.mean(myy[myx == "EH0_40"], myr[myx == "EH0_40"], na.rm = T), yend = weighted.mean(myy[myx == "EH0_40"], myr[myx == "EH0_40"], na.rm = T), color = myoutline) +
  geom_segment(x=2.90, xend=3.10, y = weighted.mean(myy[myx == "EH80"], myr[myx == "EH80"], na.rm = T), yend = weighted.mean(myy[myx == "EH80"], myr[myx == "EH80"], na.rm = T), color = myoutline) +
  geom_segment(x=1.90, xend=2.10, y = weighted.mean(myy[myx == "EH40"], myr[myx == "EH40"], na.rm = T), yend = weighted.mean(myy[myx == "EH40"], myr[myx == "EH40"], na.rm = T), color = myoutline) +
  geom_segment(x=0.90, xend=1.10, y = weighted.mean(myy[myx == "EH0"], myr[myx == "EH0"], na.rm = T), yend = weighted.mean(myy[myx == "EH0"], myr[myx == "EH0"], na.rm = T), color = myoutline) +
  geom_rug(sides = "b" , position = position_nudge(x=-0.75), alpha = myptalpha)+
  scale_color_manual(values =mypalette) + 
  geom_hline(yintercept = 0, lty = "dotted") + 
  coord_flip() +
  theme_classic()+
  theme(legend.position="none") +
  ggtitle(mytitle) + ylab(myylab) + xlab(myxlab)+
  scale_x_discrete(labels = c("EH0", "EH40", "EH80", "EH0_40", "EH20_60", "EH0_80", "EH40_80")) +
  scale_y_continuous(breaks = seq(-.3,.9,by=.05),
                     limits = c(-.3, .9),
                     labels = scales::number_format(accuracy = 0.01))+
  theme(axis.title.y = element_text(size = 8, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = 8, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = 8, angle = 0))+
  theme(axis.text.x = element_text(size = 8, angle = 0))
  # annotate("text", x=c(2,3,5,6), y=c(.14,.55,.15,.46), label = c("**", "***", "***", "*"), size = 8, fontface = "bold")
p 
# -----------------------------------------------------------------------------

# figure output ---------------------------------------------------------------
pdf(file = "000_COPRinCOPR120.pdf", width = mywidth, height = myheight); p; dev.off()
# -----------------------------------------------------------------------------



# MODELS -----------------------------------------------------------------------
my$treat <- relevel(my$treat, ref = "EH0")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x

# model eval ---------------------------
hist(residuals(mymod), breaks = 100)
hist(expand_residuals(mymod, my$re_dw), breaks = 100) # this more accurately represents the distribution of residuals in the model output. -- tails look fine here. 
anova(mymod) # test term significance
# --------------------------------------

# run same model with ea of the 7 treats as base level ---
my$treat <- relevel(my$treat, ref = "EH40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x
my$treat <- relevel(my$treat, ref = "EH80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x
my$treat <- relevel(my$treat, ref = "EH0_40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x
my$treat <- relevel(my$treat, ref = "EH20_60")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x
my$treat <- relevel(my$treat, ref = "EH0_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x
my$treat <- relevel(my$treat, ref = "EH40_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
x <- summary(mymod);x#x$coefficients[,"Pr(>|t|)"]<- p.adjust(x$coefficients[,"Pr(>|t|)"], method = "fdr");x
# ------------------------------------------------------------------------------
rm(my, mymod, p, myc, myfill, myfillapha, myheight, mylinealpha, myoutline, mypalette, myptalpha, myptsize, myr, 
   mytextsize, mytitle, mywidth, myx, myxlab, myy, myylab)
```







```{r}
mydata <- mycollapsed[mycollapsed$epo %in% c("SALT_A", "SALT_B"),]
myspread <- matrix(nrow = 7, ncol = 36)
colnames(myspread) <- c("tot_0.0", "ext_0.0",  "ext_p_0.0","inc_0.0", "inc_p_0.0", "dec_0.0", "dec_p_0.0", "unc_0.0", "unc_p_0.0",
                        "tot_0.4", "ext_0.4",  "ext_p_0.4","inc_0.4", "inc_p_0.4", "dec_0.4", "dec_p_0.4", "unc_0.4", "unc_p_0.4",
                        "tot_0.8", "ext_0.8",  "ext_p_0.8","inc_0.8", "inc_p_0.8", "dec_0.8", "dec_p_0.8", "unc_0.8", "unc_p_0.8",
                        "tot_1.2", "ext_1.2",  "ext_p_1.2","inc_1.2", "inc_p_1.2", "dec_1.2", "dec_p_1.2", "unc_1.2", "unc_p_1.2")
rownames(myspread) <- rownames(mySALTin)

# EH0 --------------------------------------------------------------------------
mytreat <- "EH0"
mywritereadrow <- 1
# 0.0----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 0.0 & mydata$treat == mytreat,]) # total number of barcodes
y <- mySALTin[mywritereadrow,1] # number that increase
z <- mySALTdec[mywritereadrow,1] # number that decrease
a <- mySALTmatsum[mywritereadrow,1]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 1:9] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)
paste0("EH0, 0.0")
paste0("total n = ", x)
paste0("n extinct = ", a, ", ", "(", a/x, ")")
paste0("n increase = ", y, ", ", "(", y/x, ")")
paste0("n decrease = ", z, ", ", "(", z/x, ")")
paste0("n unchnaged = ", b, ", ", "(", b/x, ")")

# 0.4----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 0.4 & mydata$treat == mytreat,]) # total number of barcodes
y <- mySALTin[mywritereadrow,2] # number that increase
z <- mySALTdec[mywritereadrow,2] # number that decrease
a <- mySALTmatsum[mywritereadrow,2]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 10:18] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)

# 0.8----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 0.8 & mydata$treat == mytreat,]) # total number of barcodes
y <- mySALTin[mywritereadrow,3] # number that increase
z <- mySALTdec[mywritereadrow,3] # number that decrease
a <- mySALTmatsum[mywritereadrow,3]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 19:27] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)

# 1.2----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 1.2 & mydata$treat == mytreat,]) # total number of barcodes
y <- mySALTin[mywritereadrow,4] # number that increase
z <- mySALTdec[mywritereadrow,4] # number that decrease
a <- mySALTmatsum[mywritereadrow,4]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 28:36] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)






# EH40 --------------------------------------------------------------------------
mytreat <- "EH40"
mywritereadrow <- 2
# 0.0----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 0.0 & mydata$treat == mytreat,]) # total number of barcodes
y <- mySALTin[mywritereadrow,1] # number that increase
z <- mySALTdec[mywritereadrow,1] # number that decrease
a <- mySALTmatsum[mywritereadrow,1]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 1:9] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)
paste0("EH40, 0.0")
paste0("total n = ", x)
paste0("n extinct = ", a, ", ", "(", a/x, ")")
paste0("n increase = ", y, ", ", "(", y/x, ")")
paste0("n decrease = ", z, ", ", "(", z/x, ")")
paste0("n unchnaged = ", b, ", ", "(", b/x, ")")

# 0.4----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 0.4 & mydata$treat == mytreat,]) # total number of barcodes
y <- mySALTin[mywritereadrow,2] # number that increase
z <- mySALTdec[mywritereadrow,2] # number that decrease
a <- mySALTmatsum[mywritereadrow,2]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 10:18] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)

# 0.8----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 0.8 & mydata$treat == mytreat,]) # total number of barcodes
y <- mySALTin[mywritereadrow,3] # number that increase
z <- mySALTdec[mywritereadrow,3] # number that decrease
a <- mySALTmatsum[mywritereadrow,3]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 19:27] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)

# 1.2----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 1.2 & mydata$treat == mytreat,]) # total number of barcodes
y <- mySALTin[mywritereadrow,4] # number that increase
z <- mySALTdec[mywritereadrow,4] # number that decrease
a <- mySALTmatsum[mywritereadrow,4]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 28:36] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)






# EH80 --------------------------------------------------------------------------
mytreat <- "EH80"
mywritereadrow <- 3
# 0.0----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 0.0 & mydata$treat == mytreat,]) # total number of barcodes
y <- mySALTin[mywritereadrow,1] # number that increase
z <- mySALTdec[mywritereadrow,1] # number that decrease
a <- mySALTmatsum[mywritereadrow,1]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 1:9] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)
paste0("EH80, 0.0")
paste0("total n = ", x)
paste0("n extinct = ", a, ", ", "(", a/x, ")")
paste0("n increase = ", y, ", ", "(", y/x, ")")
paste0("n decrease = ", z, ", ", "(", z/x, ")")
paste0("n unchnaged = ", b, ", ", "(", b/x, ")")

# 0.4----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 0.4 & mydata$treat == mytreat,]) # total number of barcodes
y <- mySALTin[mywritereadrow,2] # number that increase
z <- mySALTdec[mywritereadrow,2] # number that decrease
a <- mySALTmatsum[mywritereadrow,2]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 10:18] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)

# 0.8----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 0.8 & mydata$treat == mytreat,]) # total number of barcodes
y <- mySALTin[mywritereadrow,3] # number that increase
z <- mySALTdec[mywritereadrow,3] # number that decrease
a <- mySALTmatsum[mywritereadrow,3]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 19:27] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)

# 1.2----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 1.2 & mydata$treat == mytreat,]) # total number of barcodes
y <- mySALTin[mywritereadrow,4] # number that increase
z <- mySALTdec[mywritereadrow,4] # number that decrease
a <- mySALTmatsum[mywritereadrow,4]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 28:36] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)






# EH0_40 --------------------------------------------------------------------------
mytreat <- "EH0_40"
mywritereadrow <- 4
# 0.0----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 0.0 & mydata$treat == mytreat,]) # total number of barcodes
y <- mySALTin[mywritereadrow,1] # number that increase
z <- mySALTdec[mywritereadrow,1] # number that decrease
a <- mySALTmatsum[mywritereadrow,1]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 1:9] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)
paste0("EH0_40, 0.0")
paste0("total n = ", x)
paste0("n extinct = ", a, ", ", "(", a/x, ")")
paste0("n increase = ", y, ", ", "(", y/x, ")")
paste0("n decrease = ", z, ", ", "(", z/x, ")")
paste0("n unchnaged = ", b, ", ", "(", b/x, ")")

# 0.4----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 0.4 & mydata$treat == mytreat,]) # total number of barcodes
y <- mySALTin[mywritereadrow,2] # number that increase
z <- mySALTdec[mywritereadrow,2] # number that decrease
a <- mySALTmatsum[mywritereadrow,2]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 10:18] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)

# 0.8----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 0.8 & mydata$treat == mytreat,]) # total number of barcodes
y <- mySALTin[mywritereadrow,3] # number that increase
z <- mySALTdec[mywritereadrow,3] # number that decrease
a <- mySALTmatsum[mywritereadrow,3]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 19:27] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)

# 1.2----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 1.2 & mydata$treat == mytreat,]) # total number of barcodes
y <- mySALTin[mywritereadrow,4] # number that increase
z <- mySALTdec[mywritereadrow,4] # number that decrease
a <- mySALTmatsum[mywritereadrow,4]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 28:36] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)






# EH20_60 --------------------------------------------------------------------------
mytreat <- "EH20_60"
mywritereadrow <- 5
# 0.0----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 0.0 & mydata$treat == mytreat,]) # total number of barcodes
y <- mySALTin[mywritereadrow,1] # number that increase
z <- mySALTdec[mywritereadrow,1] # number that decrease
a <- mySALTmatsum[mywritereadrow,1]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 1:9] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)
paste0("EH20_60, 0.0")
paste0("total n = ", x)
paste0("n extinct = ", a, ", ", "(", a/x, ")")
paste0("n increase = ", y, ", ", "(", y/x, ")")
paste0("n decrease = ", z, ", ", "(", z/x, ")")
paste0("n unchnaged = ", b, ", ", "(", b/x, ")")

# 0.4----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 0.4 & mydata$treat == mytreat,]) # total number of barcodes
y <- mySALTin[mywritereadrow,2] # number that increase
z <- mySALTdec[mywritereadrow,2] # number that decrease
a <- mySALTmatsum[mywritereadrow,2]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 10:18] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)

# 0.8----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 0.8 & mydata$treat == mytreat,]) # total number of barcodes
y <- mySALTin[mywritereadrow,3] # number that increase
z <- mySALTdec[mywritereadrow,3] # number that decrease
a <- mySALTmatsum[mywritereadrow,3]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 19:27] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)

# 1.2----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 1.2 & mydata$treat == mytreat,]) # total number of barcodes
y <- mySALTin[mywritereadrow,4] # number that increase
z <- mySALTdec[mywritereadrow,4] # number that decrease
a <- mySALTmatsum[mywritereadrow,4]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 28:36] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)






# EH0_80 --------------------------------------------------------------------------
mytreat <- "EH0_80"
mywritereadrow <- 6
# 0.0----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 0.0 & mydata$treat == mytreat,]) # total number of barcodes
y <- mySALTin[mywritereadrow,1] # number that increase
z <- mySALTdec[mywritereadrow,1] # number that decrease
a <- mySALTmatsum[mywritereadrow,1]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 1:9] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)
paste0("EH0_80, 0.0")
paste0("total n = ", x)
paste0("n extinct = ", a, ", ", "(", a/x, ")")
paste0("n increase = ", y, ", ", "(", y/x, ")")
paste0("n decrease = ", z, ", ", "(", z/x, ")")
paste0("n unchnaged = ", b, ", ", "(", b/x, ")")

# 0.4----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 0.4 & mydata$treat == mytreat,]) # total number of barcodes
y <- mySALTin[mywritereadrow,2] # number that increase
z <- mySALTdec[mywritereadrow,2] # number that decrease
a <- mySALTmatsum[mywritereadrow,2]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 10:18] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)

# 0.8----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 0.8 & mydata$treat == mytreat,]) # total number of barcodes
y <- mySALTin[mywritereadrow,3] # number that increase
z <- mySALTdec[mywritereadrow,3] # number that decrease
a <- mySALTmatsum[mywritereadrow,3]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 19:27] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)

# 1.2----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 1.2 & mydata$treat == mytreat,]) # total number of barcodes
y <- mySALTin[mywritereadrow,4] # number that increase
z <- mySALTdec[mywritereadrow,4] # number that decrease
a <- mySALTmatsum[mywritereadrow,4]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 28:36] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)






# EH40_80 --------------------------------------------------------------------------
mytreat <- "EH40_80"
mywritereadrow <- 7
# 0.0----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 0.0 & mydata$treat == mytreat,]) # total number of barcodes
y <- mySALTin[mywritereadrow,1] # number that increase
z <- mySALTdec[mywritereadrow,1] # number that decrease
a <- mySALTmatsum[mywritereadrow,1]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 1:9] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)
paste0("EH40_80, 0.0")
paste0("total n = ", x)
paste0("n extinct = ", a, ", ", "(", a/x, ")")
paste0("n increase = ", y, ", ", "(", y/x, ")")
paste0("n decrease = ", z, ", ", "(", z/x, ")")
paste0("n unchnaged = ", b, ", ", "(", b/x, ")")

# 0.4----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 0.4 & mydata$treat == mytreat,]) # total number of barcodes
y <- mySALTin[mywritereadrow,2] # number that increase
z <- mySALTdec[mywritereadrow,2] # number that decrease
a <- mySALTmatsum[mywritereadrow,2]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 10:18] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)

# 0.8----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 0.8 & mydata$treat == mytreat,]) # total number of barcodes
y <- mySALTin[mywritereadrow,3] # number that increase
z <- mySALTdec[mywritereadrow,3] # number that decrease
a <- mySALTmatsum[mywritereadrow,3]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 19:27] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)

# 1.2----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 1.2 & mydata$treat == mytreat,]) # total number of barcodes
y <- mySALTin[mywritereadrow,4] # number that increase
z <- mySALTdec[mywritereadrow,4] # number that decrease
a <- mySALTmatsum[mywritereadrow,4]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 28:36] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)

mySALTspread <- myspread
```


```{r}
mydata <- mycollapsed[mycollapsed$epo %in% c("COPR_A", "COPR_B"),]
myspread <- matrix(nrow = 7, ncol = 36)
colnames(myspread) <- c("tot_0.0", "ext_0.0",  "ext_p_0.0","inc_0.0", "inc_p_0.0", "dec_0.0", "dec_p_0.0", "unc_0.0", "unc_p_0.0",
                        "tot_0.4", "ext_0.4",  "ext_p_0.4","inc_0.4", "inc_p_0.4", "dec_0.4", "dec_p_0.4", "unc_0.4", "unc_p_0.4",
                        "tot_0.8", "ext_0.8",  "ext_p_0.8","inc_0.8", "inc_p_0.8", "dec_0.8", "dec_p_0.8", "unc_0.8", "unc_p_0.8",
                        "tot_1.2", "ext_1.2",  "ext_p_1.2","inc_1.2", "inc_p_1.2", "dec_1.2", "dec_p_1.2", "unc_1.2", "unc_p_1.2")
rownames(myspread) <- rownames(myCOPRin)

# EH0 --------------------------------------------------------------------------
mytreat <- "EH0"
mywritereadrow <- 1
# 0.0----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 0.0 & mydata$treat == mytreat,]) # total number of barcodes
y <- myCOPRin[mywritereadrow,1] # number that increase
z <- myCOPRdec[mywritereadrow,1] # number that decrease
a <- myCOPRmatsum[mywritereadrow,1]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 1:9] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)
paste0("EH0, 0.0")
paste0("total n = ", x)
paste0("n extinct = ", a, ", ", "(", a/x, ")")
paste0("n increase = ", y, ", ", "(", y/x, ")")
paste0("n decrease = ", z, ", ", "(", z/x, ")")
paste0("n unchnaged = ", b, ", ", "(", b/x, ")")

# 0.4----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 0.4 & mydata$treat == mytreat,]) # total number of barcodes
y <- myCOPRin[mywritereadrow,2] # number that increase
z <- myCOPRdec[mywritereadrow,2] # number that decrease
a <- myCOPRmatsum[mywritereadrow,2]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 10:18] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)

# 0.8----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 0.8 & mydata$treat == mytreat,]) # total number of barcodes
y <- myCOPRin[mywritereadrow,3] # number that increase
z <- myCOPRdec[mywritereadrow,3] # number that decrease
a <- myCOPRmatsum[mywritereadrow,3]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 19:27] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)

# 1.2----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 1.2 & mydata$treat == mytreat,]) # total number of barcodes
y <- myCOPRin[mywritereadrow,4] # number that increase
z <- myCOPRdec[mywritereadrow,4] # number that decrease
a <- myCOPRmatsum[mywritereadrow,4]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 28:36] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)






# EH40 --------------------------------------------------------------------------
mytreat <- "EH40"
mywritereadrow <- 2
# 0.0----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 0.0 & mydata$treat == mytreat,]) # total number of barcodes
y <- myCOPRin[mywritereadrow,1] # number that increase
z <- myCOPRdec[mywritereadrow,1] # number that decrease
a <- myCOPRmatsum[mywritereadrow,1]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 1:9] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)
paste0("EH40, 0.0")
paste0("total n = ", x)
paste0("n extinct = ", a, ", ", "(", a/x, ")")
paste0("n increase = ", y, ", ", "(", y/x, ")")
paste0("n decrease = ", z, ", ", "(", z/x, ")")
paste0("n unchnaged = ", b, ", ", "(", b/x, ")")

# 0.4----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 0.4 & mydata$treat == mytreat,]) # total number of barcodes
y <- myCOPRin[mywritereadrow,2] # number that increase
z <- myCOPRdec[mywritereadrow,2] # number that decrease
a <- myCOPRmatsum[mywritereadrow,2]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 10:18] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)

# 0.8----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 0.8 & mydata$treat == mytreat,]) # total number of barcodes
y <- myCOPRin[mywritereadrow,3] # number that increase
z <- myCOPRdec[mywritereadrow,3] # number that decrease
a <- myCOPRmatsum[mywritereadrow,3]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 19:27] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)

# 1.2----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 1.2 & mydata$treat == mytreat,]) # total number of barcodes
y <- myCOPRin[mywritereadrow,4] # number that increase
z <- myCOPRdec[mywritereadrow,4] # number that decrease
a <- myCOPRmatsum[mywritereadrow,4]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 28:36] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)






# EH80 --------------------------------------------------------------------------
mytreat <- "EH80"
mywritereadrow <- 3
# 0.0----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 0.0 & mydata$treat == mytreat,]) # total number of barcodes
y <- myCOPRin[mywritereadrow,1] # number that increase
z <- myCOPRdec[mywritereadrow,1] # number that decrease
a <- myCOPRmatsum[mywritereadrow,1]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 1:9] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)
paste0("EH80, 0.0")
paste0("total n = ", x)
paste0("n extinct = ", a, ", ", "(", a/x, ")")
paste0("n increase = ", y, ", ", "(", y/x, ")")
paste0("n decrease = ", z, ", ", "(", z/x, ")")
paste0("n unchnaged = ", b, ", ", "(", b/x, ")")

# 0.4----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 0.4 & mydata$treat == mytreat,]) # total number of barcodes
y <- myCOPRin[mywritereadrow,2] # number that increase
z <- myCOPRdec[mywritereadrow,2] # number that decrease
a <- myCOPRmatsum[mywritereadrow,2]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 10:18] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)

# 0.8----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 0.8 & mydata$treat == mytreat,]) # total number of barcodes
y <- myCOPRin[mywritereadrow,3] # number that increase
z <- myCOPRdec[mywritereadrow,3] # number that decrease
a <- myCOPRmatsum[mywritereadrow,3]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 19:27] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)

# 1.2----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 1.2 & mydata$treat == mytreat,]) # total number of barcodes
y <- myCOPRin[mywritereadrow,4] # number that increase
z <- myCOPRdec[mywritereadrow,4] # number that decrease
a <- myCOPRmatsum[mywritereadrow,4]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 28:36] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)






# EH0_40 --------------------------------------------------------------------------
mytreat <- "EH0_40"
mywritereadrow <- 4
# 0.0----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 0.0 & mydata$treat == mytreat,]) # total number of barcodes
y <- myCOPRin[mywritereadrow,1] # number that increase
z <- myCOPRdec[mywritereadrow,1] # number that decrease
a <- myCOPRmatsum[mywritereadrow,1]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 1:9] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)
paste0("EH0_40, 0.0")
paste0("total n = ", x)
paste0("n extinct = ", a, ", ", "(", a/x, ")")
paste0("n increase = ", y, ", ", "(", y/x, ")")
paste0("n decrease = ", z, ", ", "(", z/x, ")")
paste0("n unchnaged = ", b, ", ", "(", b/x, ")")

# 0.4----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 0.4 & mydata$treat == mytreat,]) # total number of barcodes
y <- myCOPRin[mywritereadrow,2] # number that increase
z <- myCOPRdec[mywritereadrow,2] # number that decrease
a <- myCOPRmatsum[mywritereadrow,2]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 10:18] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)

# 0.8----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 0.8 & mydata$treat == mytreat,]) # total number of barcodes
y <- myCOPRin[mywritereadrow,3] # number that increase
z <- myCOPRdec[mywritereadrow,3] # number that decrease
a <- myCOPRmatsum[mywritereadrow,3]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 19:27] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)

# 1.2----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 1.2 & mydata$treat == mytreat,]) # total number of barcodes
y <- myCOPRin[mywritereadrow,4] # number that increase
z <- myCOPRdec[mywritereadrow,4] # number that decrease
a <- myCOPRmatsum[mywritereadrow,4]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 28:36] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)






# EH20_60 --------------------------------------------------------------------------
mytreat <- "EH20_60"
mywritereadrow <- 5
# 0.0----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 0.0 & mydata$treat == mytreat,]) # total number of barcodes
y <- myCOPRin[mywritereadrow,1] # number that increase
z <- myCOPRdec[mywritereadrow,1] # number that decrease
a <- myCOPRmatsum[mywritereadrow,1]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 1:9] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)
paste0("EH20_60, 0.0")
paste0("total n = ", x)
paste0("n extinct = ", a, ", ", "(", a/x, ")")
paste0("n increase = ", y, ", ", "(", y/x, ")")
paste0("n decrease = ", z, ", ", "(", z/x, ")")
paste0("n unchnaged = ", b, ", ", "(", b/x, ")")

# 0.4----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 0.4 & mydata$treat == mytreat,]) # total number of barcodes
y <- myCOPRin[mywritereadrow,2] # number that increase
z <- myCOPRdec[mywritereadrow,2] # number that decrease
a <- myCOPRmatsum[mywritereadrow,2]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 10:18] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)

# 0.8----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 0.8 & mydata$treat == mytreat,]) # total number of barcodes
y <- myCOPRin[mywritereadrow,3] # number that increase
z <- myCOPRdec[mywritereadrow,3] # number that decrease
a <- myCOPRmatsum[mywritereadrow,3]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 19:27] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)

# 1.2----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 1.2 & mydata$treat == mytreat,]) # total number of barcodes
y <- myCOPRin[mywritereadrow,4] # number that increase
z <- myCOPRdec[mywritereadrow,4] # number that decrease
a <- myCOPRmatsum[mywritereadrow,4]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 28:36] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)






# EH0_80 --------------------------------------------------------------------------
mytreat <- "EH0_80"
mywritereadrow <- 6
# 0.0----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 0.0 & mydata$treat == mytreat,]) # total number of barcodes
y <- myCOPRin[mywritereadrow,1] # number that increase
z <- myCOPRdec[mywritereadrow,1] # number that decrease
a <- myCOPRmatsum[mywritereadrow,1]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 1:9] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)
paste0("EH0_80, 0.0")
paste0("total n = ", x)
paste0("n extinct = ", a, ", ", "(", a/x, ")")
paste0("n increase = ", y, ", ", "(", y/x, ")")
paste0("n decrease = ", z, ", ", "(", z/x, ")")
paste0("n unchnaged = ", b, ", ", "(", b/x, ")")

# 0.4----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 0.4 & mydata$treat == mytreat,]) # total number of barcodes
y <- myCOPRin[mywritereadrow,2] # number that increase
z <- myCOPRdec[mywritereadrow,2] # number that decrease
a <- myCOPRmatsum[mywritereadrow,2]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 10:18] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)

# 0.8----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 0.8 & mydata$treat == mytreat,]) # total number of barcodes
y <- myCOPRin[mywritereadrow,3] # number that increase
z <- myCOPRdec[mywritereadrow,3] # number that decrease
a <- myCOPRmatsum[mywritereadrow,3]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 19:27] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)

# 1.2----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 1.2 & mydata$treat == mytreat,]) # total number of barcodes
y <- myCOPRin[mywritereadrow,4] # number that increase
z <- myCOPRdec[mywritereadrow,4] # number that decrease
a <- myCOPRmatsum[mywritereadrow,4]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 28:36] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)






# EH40_80 --------------------------------------------------------------------------
mytreat <- "EH40_80"
mywritereadrow <- 7
# 0.0----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 0.0 & mydata$treat == mytreat,]) # total number of barcodes
y <- myCOPRin[mywritereadrow,1] # number that increase
z <- myCOPRdec[mywritereadrow,1] # number that decrease
a <- myCOPRmatsum[mywritereadrow,1]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 1:9] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)
paste0("EH40_80, 0.0")
paste0("total n = ", x)
paste0("n extinct = ", a, ", ", "(", a/x, ")")
paste0("n increase = ", y, ", ", "(", y/x, ")")
paste0("n decrease = ", z, ", ", "(", z/x, ")")
paste0("n unchnaged = ", b, ", ", "(", b/x, ")")

# 0.4----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 0.4 & mydata$treat == mytreat,]) # total number of barcodes
y <- myCOPRin[mywritereadrow,2] # number that increase
z <- myCOPRdec[mywritereadrow,2] # number that decrease
a <- myCOPRmatsum[mywritereadrow,2]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 10:18] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)

# 0.8----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 0.8 & mydata$treat == mytreat,]) # total number of barcodes
y <- myCOPRin[mywritereadrow,3] # number that increase
z <- myCOPRdec[mywritereadrow,3] # number that decrease
a <- myCOPRmatsum[mywritereadrow,3]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 19:27] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)

# 1.2----------------------------------------------------------
x <- nrow(mydata[mydata$mpasp == 1.2 & mydata$treat == mytreat,]) # total number of barcodes
y <- myCOPRin[mywritereadrow,4] # number that increase
z <- myCOPRdec[mywritereadrow,4] # number that decrease
a <- myCOPRmatsum[mywritereadrow,4]# number that become extinct by the end of the generation 500 fit assay
b <- x - (y + z + a)# number unchanged in fitness
myspread[mywritereadrow, 28:36] <- c(x, a, a/x, y, y/x, z, z/x, b, b/x)

myCOPRspread <- myspread
```

# lets take a look at extinction in salt...
```{R}
my <- mySALTspread[,c("ext_0.0", "ext_p_0.0", "ext_0.4", "ext_p_0.4", "ext_0.8", "ext_p_0.8", "ext_1.2", "ext_p_1.2")]
my <- mySALTspread[,c("ext_0.0", "ext_0.4", "ext_0.8", "ext_1.2")]
myres <- matrix(nrow = 7, ncol = 3); rownames(myres) <- rownames(my)
colnames(myres) <- c("ext_n", "ext_se", "ext_p")
myres[,1] <- apply(my, 1, mean)
myres[,2] <- apply(my, 1, sjstats::se)
myres[,3] <- myres[,1] / mySALTspread[,"tot_0.0"]

```



Need to collapse replicates for the pairs plots...
```{R}
my <- myd
my <- my[,c(1:7, 83:88, 112, 123, 126)]
my1 <- my[my$mpar == 1,]
my2 <- my[my$mpar == 2,]; colnames(my2) <- paste0(colnames(my2), "_2")
my3 <- my[my$mpar == 3,]; colnames(my3) <- paste0(colnames(my3), "_3")
my4 <- my[my$mpar == 4,]; colnames(my4) <- paste0(colnames(my4), "_4")
my <- cbind(my1, my2$re_dw_2, my2$dw_2, my3$re_dw_3, my3$dw_3, my4$re_dw_4, my4$dw_4)
colnames(my)[c((ncol(my)-5)):ncol(my)] <- c("re_dw_2", "dw_2", "re_dw_3", "dw_3", "re_dw_4", "dw_4")
mn_dw <- apply(my, 1, function(x) weighted.mean(as.numeric(x[c( "dw", "dw_2", "dw_3", "dw_4")]), 
                                                  as.numeric(x[c( "re_dw","re_dw_2","re_dw_3","re_dw_4")]), na.rm = T))
my$mn_dw <- mn_dw; my$mn_dw[is.nan(my$mn_dw)] <- NA
mn_re_dw <- apply(my, 1, function(x) mean(as.numeric(x[c( "dw", "dw_2", "dw_3", "dw_4")])))
my$mn_re_dw <- mn_re_dw

mydwc <- my 

# now lets make a wide version as well.
my <- mydwc
my0 <- my[my$mpasp == 0.0,]
my40 <- my[my$mpasp == 0.4,]
my80 <- my[my$mpasp == 0.8,]
my120 <- my[my$mpasp == 1.2,]
sum(my0$bcpID != my40$bcpID)
my <- cbind(my0, my40$mn_dw, my40$mn_re_dw, my80$mn_dw, my80$mn_re_dw, my120$mn_dw, my120$mn_re_dw)
colnames(my)[c(23:30)] <- c("mn_dw_0", "mn_re_dw_0","mn_dw_40", "mn_re_dw_40", "mn_dw_80", "mn_re_dw_80", "mn_dw_120", "mn_re_dw_120")

mydwcw <- my
```


Now for some pairs plots
```{R}
mywidth <- 8
myheight <- mywidth

my <- mydwcw
my <- my[,c("treat", "mn_dw_0", "mn_dw_80")]
levels(my$treat) <- relevel
ggpairs(my,aes(color = treat, alpha = 0.7), title = "ALL")

my <- mydwcw
my <- my[,c("treat", "mn_dw_0", "mn_dw_120")]
levels(my$treat) <- relevel
ggpairs(my,aes(color = treat, alpha = 0.7), title = "ALL")



my <- mydwcw[mydwcw$treat %in% c("EH0", "EH40", "EH0_40"),]
my <- my[,c("treat", "mn_dw_0", "mn_dw_40")]
p <- ggpairs(my,aes(color = treat, alpha = 0.7), title = "specialist vs. generalists: low stress end")
pdf(file = "EH0_EH40_EH0-40_in_000_&_040.pdf", width = mywidth, height = myheight); p; dev.off()

my <- mydwcw[mydwcw$treat %in% c("EH0", "EH80", "EH0_80"),]
my <- my[,c("treat", "mn_dw_0", "mn_dw_80")]
p <- ggpairs(my,aes(color = treat, alpha = 0.7), title = "specialist vs. generalists: full spectrum")
pdf(file = "EH0_EH80_EH0-80_in_000_&_080.pdf", width = mywidth, height = myheight); p; dev.off()

my <- mydwcw[mydwcw$treat %in% c("EH40", "EH80", "EH40_80"),]
my <- my[,c("treat", "mn_dw_40", "mn_dw_80")]
p <- ggpairs(my,aes(color = treat, alpha = 0.7), title = "specialist vs. generalists: high stress end")
pdf(file = "EH40_EH80_EH40-80_in_040_&_080.pdf", width = mywidth, height = myheight); p; dev.off()

my <- mydwcw[mydwcw$treat %in% c("EH0", "EH40", "EH80"),]
my <- my[,c("treat", "mn_dw_0", "mn_dw_80")]
p <- ggpairs(my,aes(color = treat, alpha = 0.7), title = "specialists with different means compared")
pdf(file = "EH0_EH40_EH80_in_000_&_080.pdf", width = mywidth, height = myheight); p; dev.off()

my <- mydwcw[mydwcw$treat %in% c("EH0_40", "EH20_60", "EH40_80"),]
my <- my[,c("treat", "mn_dw_0", "mn_dw_80")]
p <- ggpairs(my,aes(color = treat, alpha = 0.7), title = "generalists with same flux degree, different means compared")
pdf(file = "EH0-40_EH20-60_EH40-80_in_000_&_080.pdf", width = mywidth, height = myheight); p; dev.off()

my <- mydwcw[mydwcw$treat %in% c("EH0", "EH0_40", "EH0_80"),]
my <- my[,c("treat", "mn_dw_0", "mn_dw_80")]
p <- ggpairs(my,aes(color = treat, alpha = 0.7), title = "shared minimum with variable degree of flux up")
pdf(file = "EH0_EH0-40_EH0-80_in_000_&_080.pdf", width = mywidth, height = myheight); p; dev.off()

my <- mydwcw[mydwcw$treat %in% c("EH80", "EH40_80", "EH0_80"),]
my <- my[,c("treat", "mn_dw_0", "mn_dw_80")]
p <- ggpairs(my,aes(color = treat, alpha = 0.7), title = "shared maximum with variable degree of flux down")
pdf(file = "EH80_EH40-80_EH0-80_in_000_&_080.pdf", width = mywidth, height = myheight); p; dev.off()

my <- mydwcw[mydwcw$treat %in% c("EH40", "EH20_60", "EH0_80"),]
my <- my[,c("treat", "mn_dw_0", "mn_dw_80")]
p <- ggpairs(my,aes(color = treat, alpha = 0.7), title = "shared mean with variable degree of flux around mean")
pdf(file = "EH40_EH20_60_EH0-80_in_000_&_080.pdf", width = mywidth, height = myheight); p; dev.off()



```


3d plots
```{R}
library(plotly)


Sys.setenv("plotly_username"="vincefasanello")
Sys.setenv("plotly_api_key"="oLHyGo5FrZP6CQ96OZM4")

# all treats -----------------------------------------------
my <-  mydwcw[!is.na(mydwcw$mn_dw_0) &!is.na(mydwcw$mn_dw_40) &!is.na(mydwcw$mn_dw_80),] 
p <- plot_ly(my, x = ~mn_dw_0, y = ~mn_dw_40, z = ~mn_dw_80, color = ~treat, colors = setpalette, type = "scatter3d", mode = "markers") %>%
  layout(title ="All Treatments"); p
chart_link = api_create(p, filename="FS_scatter3d_AllTreats_000_040_080");chart_link

# specialists vs. generalists ------------------------------
# eh0, eh0_40, eh40 --------------------
my <-  mydwcw[!is.na(mydwcw$mn_dw_0) &!is.na(mydwcw$mn_dw_40) &!is.na(mydwcw$mn_dw_80),] 
my <- my[my$treat %in% c("EH0", "EH0_40", "EH40"),]
p <- plot_ly(my, x = ~mn_dw_0, y = ~mn_dw_40, z = ~mn_dw_80, color = ~treat, colors = setpalette, type = "scatter3d", mode = "markers") %>%
  layout(title ="specialist vs. generalists: low stress end"); p
chart_link = api_create(p, filename="FS_scatter3d_EH0_EH0-40_EH40_in_000_040_080");chart_link

# eh40, eh40_80, eh80 ------------------
my <-  mydwcw[!is.na(mydwcw$mn_dw_0) &!is.na(mydwcw$mn_dw_40) &!is.na(mydwcw$mn_dw_80),] 
my <- my[my$treat %in% c("EH40", "EH40_80", "EH80"),]
p <- plot_ly(my, x = ~mn_dw_0, y = ~mn_dw_40, z = ~mn_dw_80, color = ~treat, colors = setpalette, type = "scatter3d", mode = "markers") %>%
  layout(title ="specialist vs. generalists: high stress end"); p
chart_link = api_create(p, filename="FS_scatter3d_EH40_EH40-80_EH80_in_000_040_080");chart_link

# eh0, eh0_80, eh80 --------------------
my <-  mydwcw[!is.na(mydwcw$mn_dw_0) &!is.na(mydwcw$mn_dw_40) &!is.na(mydwcw$mn_dw_80),] 
my <- my[my$treat %in% c("EH0", "EH0_80", "EH80"),]
p <- plot_ly(my, x = ~mn_dw_0, y = ~mn_dw_40, z = ~mn_dw_80, color = ~treat, colors = setpalette, type = "scatter3d", mode = "markers") %>%
  layout(title ="specialist vs. generalists: full spectrum"); p
chart_link = api_create(p, filename="FS_scatter3d_EH0_EH0-80_EH80_in_000_040_080");chart_link


# Shared mean, variable flux -------------------------------
# eh0_40, eh20_60, eh40_80 -------------
my <-  mydwcw[!is.na(mydwcw$mn_dw_0) &!is.na(mydwcw$mn_dw_40) &!is.na(mydwcw$mn_dw_80),] 
my <- my[my$treat %in% c("EH40", "EH20_60", "EH0_80"),]
p <- plot_ly(my, x = ~mn_dw_0, y = ~mn_dw_40, z = ~mn_dw_80, color = ~treat, colors = setpalette, type = "scatter3d", mode = "markers") %>%
  layout(title ="shared mean with variable degree of flux around mean"); p
chart_link = api_create(p, filename="FS_scatter3d_EH40_EH20-60_EH0-80_in_000_040_080");chart_link

# Shared min, variable flux -------------------------------
# eh0, eh0_40, eh0_80 ------------------
my <-  mydwcw[!is.na(mydwcw$mn_dw_0) &!is.na(mydwcw$mn_dw_40) &!is.na(mydwcw$mn_dw_80),] 
my <- my[my$treat %in% c("EH0", "EH0_40", "EH0_80"),]
p <- plot_ly(my, x = ~mn_dw_0, y = ~mn_dw_40, z = ~mn_dw_80, color = ~treat, colors = setpalette, type = "scatter3d", mode = "markers") %>%
  layout(title ="shared minimum with variable degree of flux up"); p
chart_link = api_create(p, filename="FS_scatter3d_EH0_EH0-40_EH0-80_in_000_040_080");chart_link

# # Shared max, variable flux -------------------------------
# eh80, e40_80, eh0_80 -----------------
my <-  mydwcw[!is.na(mydwcw$mn_dw_0) &!is.na(mydwcw$mn_dw_40) &!is.na(mydwcw$mn_dw_80),] 
my <- my[my$treat %in% c("EH80", "EH40_80", "EH0_80"),]
p <- plot_ly(my, x = ~mn_dw_0, y = ~mn_dw_40, z = ~mn_dw_80, color = ~treat, colors = setpalette, type = "scatter3d", mode = "markers") %>%
  layout(title ="shared maximum with variable degree of flux down"); p
chart_link = api_create(p, filename="FS_scatter3d_EH80_EH40-80_EH0-80_in_000_040_080");chart_link

# variable mean (min, max), shared flux --------------------
# eh0, eh40, eh80 ----------------------
my <-  mydwcw[!is.na(mydwcw$mn_dw_0) &!is.na(mydwcw$mn_dw_40) &!is.na(mydwcw$mn_dw_80),] 
my <- my[my$treat %in% c("EH0", "EH40", "EH80"),]
p <- plot_ly(my, x = ~mn_dw_0, y = ~mn_dw_40, z = ~mn_dw_80, color = ~treat, colors = setpalette, type = "scatter3d", mode = "markers") %>%
  layout(title ="specialists with different means compared"); p
chart_link = api_create(p, filename="FS_scatter3d_EH0_EH40_EH80_in_000_040_080");chart_link

# eh0_40, eh20_60, eh40_80 -------------
my <-  mydwcw[!is.na(mydwcw$mn_dw_0) &!is.na(mydwcw$mn_dw_40) &!is.na(mydwcw$mn_dw_80),] 
my <- my[my$treat %in% c("EH0_40", "EH20_60", "EH40_80"),]
p <- plot_ly(my, x = ~mn_dw_0, y = ~mn_dw_40, z = ~mn_dw_80, color = ~treat, colors = setpalette, type = "scatter3d", mode = "markers") %>%
  layout(title ="generalists with same flux degree, different means compared"); p
chart_link = api_create(p, filename="FS_scatter3d_EH0_EH40_EH80_in_000_040_080");chart_link



```









# explore the new analysis framework. 

# 0, 0_40, 40 (in .00, .40, .80. 1.20)
```{r}
# TREAT EFFECTS ------------------------------------------------------------------------------------
# IN 0.00 ----------------------------------------------------------------------
my <- myd[!is.na(myd$dw),]
my <- my[my$mpasp == 0.0 & my$epo %in% c("SALT_A", "SALT_B") & my$treat %in% c("EH0", "EH0_40", "EH40"),]
my$treat <- drop.levels(my$treat);my$treat <- relevel(my$treat, ref = "EH0")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH0_40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

# IN 0.40 ----------------------------------------------------------------------
my <- myd[!is.na(myd$dw),]
my <- my[my$mpasp == 0.4 & my$epo %in% c("SALT_A", "SALT_B") & my$treat %in% c("EH0", "EH0_40", "EH40"),]
my$treat <- drop.levels(my$treat);my$treat <- relevel(my$treat, ref = "EH0")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH0_40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

# IN 0.80 ----------------------------------------------------------------------
my <- myd[!is.na(myd$dw),]
my <- my[my$mpasp == 0.8 & my$epo %in% c("SALT_A", "SALT_B") & my$treat %in% c("EH0", "EH0_40", "EH40"),]
my$treat <- drop.levels(my$treat);my$treat <- relevel(my$treat, ref = "EH0")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH0_40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

# IN 1.20 ----------------------------------------------------------------------
my <- myd[!is.na(myd$dw),]
my <- my[my$mpasp == 1.2 & my$epo %in% c("SALT_A", "SALT_B") & my$treat %in% c("EH0", "EH0_40", "EH40"),]
my$treat <- drop.levels(my$treat);my$treat <- relevel(my$treat, ref = "EH0")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH0_40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
# --------------------------------------------------------------------------------------------------


# Fishers exact tests ------------------------------------------------------------------------------
# 0.00 -------------------------------------------------------------------------
# 0.00 -- EXTINCT
my <- mySALTspread[c("EH0", "EH0_40", "EH40"), c(2,1)]; my[,2] <- my[,2] - my[,1]
my
Barnard::barnard.test(n1 = my[1,1], my[2,1], my[1,2], my[2,2])
Barnard::barnard.test(n1 = my[1,2], my[2,2], my[1,1], my[2,1])

fisher.test(x = my[c(1,3),], alternative = "g") #EH0 > #EH40? YES! 
fisher.test(x = my[c(1,2),], alternative = "g") #EH0 > #EH0_40?  NO! -- fail to reject equality
fisher.test(x = my[c(2,3),], alternative = "g") #EH0_40 > #EH40? YES! 

# 0.00  -- INCREASE
my <- mySALTspread[c("EH0", "EH0_40", "EH40"), c(4,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,3),], alternative = "g") #EH0 > #EH40? YES!
fisher.test(x = my[c(1,2),], alternative = "g") #EH0 > #EH0_40? YES!
fisher.test(x = my[c(2,3),], alternative = "g") #EH0_40 > #EH40? NO! -- fail to reject equality

# 0.00 -- DECREASE -- NO DIFFERENCES IN DECREASE DATA.
my <- mySALTspread[c("EH0", "EH0_40", "EH40"), c(6,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,2),], alternative = "g") # 40 > 0_40
fisher.test(x = my[c(3,1),], alternative = "g") # 40 > 0
fisher.test(x = my[c(2,1),], alternative = "g") # 0_40 > 0

# 0.40 -------------------------------------------------------------------------
# 0.40  -- EXTINCT
my <- mySALTspread[c("EH0", "EH0_40", "EH40"), c(11,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,3),], alternative = "g") #EH0 > #EH40? YES! 
fisher.test(x = my[c(1,2),], alternative = "g") #EH0 > #EH0_40?  NO! -- fail to reject equality
fisher.test(x = my[c(2,3),], alternative = "g") #EH0_40 > #EH40? YES! 

# 0.40  -- INCREASE
my <- mySALTspread[c("EH0", "EH0_40", "EH40"), c(13,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") #EH40 > #EH0?  NO! -- fail to reject equality
fisher.test(x = my[c(3,2),], alternative = "g") #EH40 > #EH0_40? YES!
fisher.test(x = my[c(1,2),], alternative = "g") #EH0 > #EH0_40? NO! -- fail to reject equality

# 0.40  -- DECREASE -- NO DIFFERENCES IN DECREASE DATA.
my <- mySALTspread[c("EH0", "EH0_40", "EH40"), c(15,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,2),], alternative = "g") # 0 > 0_40
fisher.test(x = my[c(1,3),], alternative = "g") # 0 > 40
fisher.test(x = my[c(2,3),], alternative = "g") # 0_40 > 40

# 0.80 -------------------------------------------------------------------------
# 0.80  -- EXTINCT
my <- mySALTspread[c("EH0", "EH0_40", "EH40"), c(20,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,3),], alternative = "g") #EH0 > #EH40? YES! 
fisher.test(x = my[c(1,2),], alternative = "g") #EH0 > #EH0_40?  NO! -- fail to reject equality
fisher.test(x = my[c(2,3),], alternative = "g") #EH0_40 > #EH40?  NO! -- fail to reject equality

# 0.80  -- INCREASE
my <- mySALTspread[c("EH0", "EH0_40", "EH40"), c(22,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") #EH40 > #EH0? YES!
fisher.test(x = my[c(3,2),], alternative = "g") #EH40 > #EH0_40? YES!
fisher.test(x = my[c(2,1),], alternative = "g") #EH0_40 > #EH0? NO! -- fail to reject equality

# 0.80  -- DECREASE
my <- mySALTspread[c("EH0", "EH0_40", "EH40"), c(24,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,3),], alternative = "g") #EH0 > #EH40? YES!
fisher.test(x = my[c(2,3),], alternative = "g") #EH0_40 > #EH40? NO! -- fail to reject equality
fisher.test(x = my[c(1,3),], alternative = "g") #EH0 > #EH0_40? YES!


# 1.2 -------------------------------------------------------------------------
# 1.20  -- EXTINCT
my <- mySALTspread[c("EH0", "EH0_40", "EH40"), c(29,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,3),], alternative = "g") #EH0 > #EH40? YES! 
fisher.test(x = my[c(1,2),], alternative = "g") #EH0 > #EH0_40?  NO! -- fail to reject equality
fisher.test(x = my[c(2,3),], alternative = "g") #EH0_40 > #EH40?  YES!

# 1.20  -- INCREASE
my <- mySALTspread[c("EH0", "EH0_40", "EH40"), c(31,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") #EH40 > #EH0? YES!
fisher.test(x = my[c(3,2),], alternative = "g") #EH40 > #EH0_40? YES!
fisher.test(x = my[c(2,1),], alternative = "g") #EH0_40 > #EH0? NO! -- fail to reject equality

# 1.20  -- DECREASE
my <- mySALTspread[c("EH0", "EH0_40", "EH40"), c(33,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,3),], alternative = "g") #EH0 > #EH40? YES!
fisher.test(x = my[c(2,3),], alternative = "g") #EH0_40 > #EH40? NO! -- fail to reject equality
fisher.test(x = my[c(1,2),], alternative = "g") #EH0 > #EH0_40? NO! -- fail to reject equality


# 0.0 + 0.4 --------------------------------------------------------------------
# inc
my1 <- mySALTspread[c("EH0", "EH0_40", "EH40"), c(4,1)]; my[,2] <- my[,2] - my[,1]
my2 <- mySALTspread[c("EH0", "EH0_40", "EH40"), c(13,1)]; my[,2] <- my[,2] - my[,1]
my <- my1 + my2
my
fisher.test(x = my[c(1,3),], alternative = "g") # 0 > 40
fisher.test(x = my[c(1,2),], alternative = "g") # 0 > 0_40
fisher.test(x = my[c(3,2),], alternative = "g") # 40 > 0_40

# dec
my1 <- mySALTspread[c("EH0", "EH0_40", "EH40"), c(6,1)]; my[,2] <- my[,2] - my[,1]
my2 <- mySALTspread[c("EH0", "EH0_40", "EH40"), c(15,1)]; my[,2] <- my[,2] - my[,1]
my <- my1 + my2
my
fisher.test(x = my[c(2,3),], alternative = "g") # 0_40 > 40
fisher.test(x = my[c(2,1),], alternative = "g") # 0_40 > 0
fisher.test(x = my[c(3,1),], alternative = "g") # 40 > 0


```



# 0, 0_80, 80
``` {r}
# TREAT EFFECTS ------------------------------------------------------------------------------------
# IN 0.00 ----------------------------------------------------------------------
my <- myd[!is.na(myd$dw),]
my <- my[my$mpasp == 0.0 & my$epo %in% c("SALT_A", "SALT_B") & my$treat %in% c("EH0", "EH0_80", "EH80"),]
my$treat <- drop.levels(my$treat);my$treat <- relevel(my$treat, ref = "EH0")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH0_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

# IN 0.40 ----------------------------------------------------------------------
my <- myd[!is.na(myd$dw),]
my <- my[my$mpasp == 0.4 & my$epo %in% c("SALT_A", "SALT_B") & my$treat %in% c("EH0", "EH0_80", "EH80"),]
my$treat <- drop.levels(my$treat);my$treat <- relevel(my$treat, ref = "EH0")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH0_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

# IN 0.80 ----------------------------------------------------------------------
my <- myd[!is.na(myd$dw),]
my <- my[my$mpasp == 0.8 & my$epo %in% c("SALT_A", "SALT_B") & my$treat %in% c("EH0", "EH0_80", "EH80"),]
my$treat <- drop.levels(my$treat);my$treat <- relevel(my$treat, ref = "EH0")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH0_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

# IN 1.20 ----------------------------------------------------------------------
my <- myd[!is.na(myd$dw),]
my <- my[my$mpasp == 1.2 & my$epo %in% c("SALT_A", "SALT_B") & my$treat %in% c("EH0", "EH0_80", "EH80"),]
my$treat <- drop.levels(my$treat);my$treat <- relevel(my$treat, ref = "EH0")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH0_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
# --------------------------------------------------------------------------------------------------


# Fishers exact tests ------------------------------------------------------------------------------
# 0.00 -------------------------------------------------------------------------
# 0.00 -- EXTINCT
my <- mySALTspread[c("EH0", "EH0_80", "EH80"), c(2,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") #EH80 > #EH0? 
fisher.test(x = my[c(3,2),], alternative = "g") #EH80 > #EH0_80?
fisher.test(x = my[c(1,2),], alternative = "g") #EH0 > #EH0_80? 

# 0.00  -- INCREASE
my <- mySALTspread[c("EH0", "EH0_80", "EH80"), c(4,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,3),], alternative = "g") #EH0 > #EH80?
fisher.test(x = my[c(1,2),], alternative = "g") #EH0 > #EH0_80?
fisher.test(x = my[c(2,3),], alternative = "g") #EH0_80 > #EH80

# 0.00 -- DECREASE -- NO DIFFERENCES IN DECREASE DATA.
my <- mySALTspread[c("EH0", "EH0_80", "EH80"), c(6,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") #EH80 > #EH0?
fisher.test(x = my[c(3,2),], alternative = "g") #EH80 > #EH0_80?
fisher.test(x = my[c(2,1),], alternative = "g") #EH0_80 > #EH0


# 0.40 -------------------------------------------------------------------------
# 0.40  -- EXTINCT
my <- mySALTspread[c("EH0", "EH0_80", "EH80"), c(11,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,3),], alternative = "g") #EH0 > #EH80? 
fisher.test(x = my[c(1,2),], alternative = "g") #EH0 > #EH0_80?  
fisher.test(x = my[c(3,2),], alternative = "g") #EH80 > #EH0_80? 

# 0.40  -- INCREASE
my <- mySALTspread[c("EH0", "EH0_80", "EH80"), c(13,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") #EH80 > #EH0?  
fisher.test(x = my[c(2,1),], alternative = "g") #EH0_80 > #EH0? 
fisher.test(x = my[c(2,3),], alternative = "g") #EH0_80 > #EH80? 

# 0.40  -- DECREASE -- NO DIFFERENCES IN DECREASE DATA.
my <- mySALTspread[c("EH0", "EH0_80", "EH80"), c(15,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,3),], alternative = "g") #EH0 > #EH80?  
fisher.test(x = my[c(1,2),], alternative = "g") #EH0 > #EH0_80? 
fisher.test(x = my[c(2,3),], alternative = "g") #EH0_80 > #EH80? 

# 0.80 -------------------------------------------------------------------------
# 0.80  -- EXTINCT
my <- mySALTspread[c("EH0", "EH0_80", "EH80"), c(20,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,3),], alternative = "g") #EH0 > #EH80? 
fisher.test(x = my[c(1,2),], alternative = "g") #EH0 > #EH0_80?  
fisher.test(x = my[c(3,2),], alternative = "g") #EH80 > #EH0_80? 

# 0.80  -- INCREASE
my <- mySALTspread[c("EH0", "EH0_80", "EH80"), c(22,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") #EH80 > #EH0?  
fisher.test(x = my[c(2,1),], alternative = "g") #EH0_80 > #EH0? 
fisher.test(x = my[c(2,3),], alternative = "g") #EH0_80 > #EH80? 

# 0.80  -- DECREASE
my <- mySALTspread[c("EH0", "EH0_80", "EH80"), c(24,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,3),], alternative = "g") #EH0 > #EH80?  
fisher.test(x = my[c(1,2),], alternative = "g") #EH0 > #EH0_80? 
fisher.test(x = my[c(2,3),], alternative = "g") #EH0_80 > #EH80? 


# 1.2 -------------------------------------------------------------------------
# 1.20  -- EXTINCT
my <- mySALTspread[c("EH0", "EH0_80", "EH80"), c(29,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,3),], alternative = "g") #EH0 > #EH80? 
fisher.test(x = my[c(1,2),], alternative = "g") #EH0 > #EH0_80?  
fisher.test(x = my[c(3,2),], alternative = "g") #EH80 > #EH0_80? 

# 1.20  -- INCREASE
my <- mySALTspread[c("EH0", "EH0_80", "EH80"), c(31,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") #EH80 > #EH0?  
fisher.test(x = my[c(2,1),], alternative = "g") #EH0_80 > #EH0? 
fisher.test(x = my[c(3,2),], alternative = "g") #EH80 > #EH0_80? 

# 1.20  -- DECREASE
my <- mySALTspread[c("EH0", "EH0_80", "EH80"), c(33,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,3),], alternative = "g") #EH0 > #EH80?  
fisher.test(x = my[c(1,2),], alternative = "g") #EH0 > #EH0_80? 
fisher.test(x = my[c(2,3),], alternative = "g") #EH0_80 > #EH80? 


# 0.0 + 0.8 --------------------------------------------------------------------
# inc
my1 <- mySALTspread[c("EH0", "EH0_80", "EH80"), c(4,1)]; my[,2] <- my[,2] - my[,1]
my2 <- mySALTspread[c("EH0", "EH0_80", "EH80"), c(22,1)]; my[,2] <- my[,2] - my[,1]
my <- my1 + my2
my
fisher.test(x = my[c(2,3),], alternative = "g") # 80 > 0
fisher.test(x = my[c(2,1),], alternative = "g") # 80 > 0_80
fisher.test(x = my[c(3,1),], alternative = "g") # 0 > 0_80

# dec
my1 <- mySALTspread[c("EH0", "EH0_80", "EH80"), c(6,1)]; my[,2] <- my[,2] - my[,1]
my2 <- mySALTspread[c("EH0", "EH0_80", "EH80"), c(24,1)]; my[,2] <- my[,2] - my[,1]
my <- my1 + my2
my
fisher.test(x = my[c(3,1),], alternative = "g") # 80 > 0
fisher.test(x = my[c(3,2),], alternative = "g") # 80 > 0_80
fisher.test(x = my[c(1,2),], alternative = "g") # 0 > 0_80
```


# 40, 40_80, 80
``` {r}
# TREAT EFFECTS ------------------------------------------------------------------------------------
# IN 0.00 ----------------------------------------------------------------------
my <- myd[!is.na(myd$dw),]
my <- my[my$mpasp == 0.0 & my$epo %in% c("SALT_A", "SALT_B") & my$treat %in% c("EH40", "EH40_80", "EH80"),]
my$treat <- drop.levels(my$treat);my$treat <- relevel(my$treat, ref = "EH40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH40_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

# IN 0.40 ----------------------------------------------------------------------
my <- myd[!is.na(myd$dw),]
my <- my[my$mpasp == 0.4 & my$epo %in% c("SALT_A", "SALT_B") & my$treat %in% c("EH40", "EH40_80", "EH80"),]
my$treat <- drop.levels(my$treat);my$treat <- relevel(my$treat, ref = "EH40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH40_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

# IN 0.80 ----------------------------------------------------------------------
my <- myd[!is.na(myd$dw),]
my <- my[my$mpasp == 0.8 & my$epo %in% c("SALT_A", "SALT_B") & my$treat %in% c("EH40", "EH40_80", "EH80"),]
my$treat <- drop.levels(my$treat);my$treat <- relevel(my$treat, ref = "EH40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH40_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

# IN 1.20 ----------------------------------------------------------------------
my <- myd[!is.na(myd$dw),]
my <- my[my$mpasp == 1.2 & my$epo %in% c("SALT_A", "SALT_B") & my$treat %in% c("EH40", "EH40_80", "EH80"),]
my$treat <- drop.levels(my$treat);my$treat <- relevel(my$treat, ref = "EH40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH40_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
# --------------------------------------------------------------------------------------------------


# Fishers exact tests ------------------------------------------------------------------------------
# 0.00 -------------------------------------------------------------------------
# 0.00 -- EXTINCT
my <- mySALTspread[c("EH40", "EH40_80", "EH80"), c(2,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") #EH80 > #EH40? 
fisher.test(x = my[c(3,2),], alternative = "g") #EH80 > #EH40_80?
fisher.test(x = my[c(2,1),], alternative = "g") #EH40_80 > #EH40? 

# 0.00  -- INCREASE
my <- mySALTspread[c("EH40", "EH40_80", "EH80"), c(4,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,2),], alternative = "g") #EH40 > #EH40_80?
fisher.test(x = my[c(1,3),], alternative = "g") #EH40 > #EH80?
fisher.test(x = my[c(2,3),], alternative = "g") #EH40_80 > #EH80

# 0.00 -- DECREASE -- NO DIFFERENCES IN DECREASE DATA.
my <- mySALTspread[c("EH40", "EH40_80", "EH80"), c(6,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") #EH80 > #EH40?
fisher.test(x = my[c(3,2),], alternative = "g") #EH80 > #EH40_80?
fisher.test(x = my[c(2,1),], alternative = "g") #EH40_80 > #EH40


# 0.40 -------------------------------------------------------------------------
# 0.40  -- EXTINCT
my <- mySALTspread[c("EH40", "EH40_80", "EH80"), c(11,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") #EH80 > #EH40? 
fisher.test(x = my[c(3,2),], alternative = "g") #EH80 > 40_80?
fisher.test(x = my[c(2,1),], alternative = "g") #EH40_80 > #EH80? 

# 0.40  -- INCREASE
my <- mySALTspread[c("EH40", "EH40_80", "EH80"), c(13,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") #EH80 > #EH40?  
fisher.test(x = my[c(2,1),], alternative = "g") #EH40_80 > #EH40? 
fisher.test(x = my[c(2,3),], alternative = "g") #EH40_80 > #EH80? 

# 0.40  -- DECREASE -- NO DIFFERENCES IN DECREASE DATA.
my <- mySALTspread[c("EH40", "EH40_80", "EH80"), c(15,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") #80 > 40
fisher.test(x = my[c(2,1),], alternative = "g") #40_80 > #40? 
fisher.test(x = my[c(2,3),], alternative = "g") #40_80 > #80? 

# 0.80 -------------------------------------------------------------------------
# 0.80  -- EXTINCT
my <- mySALTspread[c("EH40", "EH40_80", "EH80"), c(20,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") #EH80 > #EH40? 
fisher.test(x = my[c(3,2),], alternative = "g") #EH80 > 40_80?
fisher.test(x = my[c(2,1),], alternative = "g") #EH40_80 > #EH80? 

# 0.80  -- INCREASE
my <- mySALTspread[c("EH40", "EH40_80", "EH80"), c(22,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") #EH80 > #EH40?  
fisher.test(x = my[c(2,1),], alternative = "g") #EH40_80 > #EH40? 
fisher.test(x = my[c(2,3),], alternative = "g") #EH40_80 > #EH80? 

# 0.80  -- DECREASE
my <- mySALTspread[c("EH40", "EH40_80", "EH80"), c(24,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,3),], alternative = "g") #EH40 > #EH80?  
fisher.test(x = my[c(1,2),], alternative = "g") #EH40 > #EH40_80? 
fisher.test(x = my[c(2,3),], alternative = "g") #EH40_80 > #EH80? 


# 1.2 -------------------------------------------------------------------------
# 1.20  -- EXTINCT
my <- mySALTspread[c("EH40", "EH40_80", "EH80"), c(29,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") #EH80 > #EH40? 
fisher.test(x = my[c(3,2),], alternative = "g") #EH80 > 40_80?
fisher.test(x = my[c(2,1),], alternative = "g") #EH40_80 > #EH80? 

# 1.20  -- INCREASE
my <- mySALTspread[c("EH40", "EH40_80", "EH80"), c(31,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") #EH80 > #EH40?  
fisher.test(x = my[c(2,1),], alternative = "g") #EH40_80 > #EH40? 
fisher.test(x = my[c(2,3),], alternative = "g") #EH40_80 > #EH80? 

# 1.20  -- DECREASE
my <- mySALTspread[c("EH40", "EH40_80", "EH80"), c(33,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,3),], alternative = "g") #EH40 > #EH80?  
fisher.test(x = my[c(1,2),], alternative = "g") #EH40 > #EH40_80? 
fisher.test(x = my[c(2,3),], alternative = "g") #EH40_80 > #EH80? 


# 0.4 + 0.8 --------------------------------------------------------------------
# inc
my1 <- mySALTspread[c("EH40", "EH40_80", "EH80"), c(13,1)]; my[,2] <- my[,2] - my[,1]
my2 <- mySALTspread[c("EH40", "EH40_80", "EH80"), c(22,1)]; my[,2] <- my[,2] - my[,1]
my <- my1 + my2
my
fisher.test(x = my[c(2,3),], alternative = "g") # 40_80 > 80
fisher.test(x = my[c(2,1),], alternative = "g") # 40_80 > 40
fisher.test(x = my[c(3,1),], alternative = "g") # 80 > 40

# dec
my1 <- mySALTspread[c("EH40", "EH40_80", "EH80"), c(15,1)]; my[,2] <- my[,2] - my[,1]
my2 <- mySALTspread[c("EH40", "EH40_80", "EH80"), c(24,1)]; my[,2] <- my[,2] - my[,1]
my <- my1 + my2
my
fisher.test(x = my[c(1,3),], alternative = "g") #EH40 > #EH80?  
fisher.test(x = my[c(1,2),], alternative = "g") #EH40 > #EH40_80? 
fisher.test(x = my[c(2,3),], alternative = "g") #EH40_80 > #EH80? 
```

# 40, 20_60, 40_80
``` {r}
# TREAT EFFECTS ------------------------------------------------------------------------------------
# IN 0.00 ----------------------------------------------------------------------
my <- myd[!is.na(myd$dw),]
my <- my[my$mpasp == 0.0 & my$epo %in% c("SALT_A", "SALT_B") & my$treat %in% c("EH40", "EH20_60", "EH0_80"),]
my$treat <- drop.levels(my$treat);my$treat <- relevel(my$treat, ref = "EH40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH20_60")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH0_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

# IN 0.40 ----------------------------------------------------------------------
my <- myd[!is.na(myd$dw),]
my <- my[my$mpasp == 0.4 & my$epo %in% c("SALT_A", "SALT_B") & my$treat %in% c("EH40", "EH20_60", "EH0_80"),]
my$treat <- drop.levels(my$treat);my$treat <- relevel(my$treat, ref = "EH40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH20_60")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH0_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

# IN 0.80 ----------------------------------------------------------------------
my <- myd[!is.na(myd$dw),]
my <- my[my$mpasp == 0.8 & my$epo %in% c("SALT_A", "SALT_B") & my$treat %in% c("EH40", "EH20_60", "EH0_80"),]
my$treat <- drop.levels(my$treat);my$treat <- relevel(my$treat, ref = "EH40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH20_60")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH0_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

# IN 1.20 ----------------------------------------------------------------------
my <- myd[!is.na(myd$dw),]
my <- my[my$mpasp == 1.2 & my$epo %in% c("SALT_A", "SALT_B") & my$treat %in% c("EH40", "EH20_60", "EH0_80"),]
my$treat <- drop.levels(my$treat);my$treat <- relevel(my$treat, ref = "EH40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH20_60")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH0_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
# --------------------------------------------------------------------------------------------------


# Fishers exact tests ------------------------------------------------------------------------------
# 0.00 -------------------------------------------------------------------------
# 0.00 -- EXTINCT
my <- mySALTspread[c("EH40", "EH20_60", "EH0_80"), c(2,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") # 0_80 > 40
fisher.test(x = my[c(3,2),], alternative = "g") # 0_80 > 20_60
fisher.test(x = my[c(2,1),], alternative = "g") # 20_60 > 40

# 0.00  -- INCREASE
my <- mySALTspread[c("EH40", "EH20_60", "EH0_80"), c(4,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,2),], alternative = "g") # 40 > 20_60
fisher.test(x = my[c(1,3),], alternative = "g") # 40 > 0_80
fisher.test(x = my[c(2,3),], alternative = "g") # 20_60 > 0_80

# 0.00 -- DECREASE -- NO DIFFERENCES IN DECREASE DATA.
my <- mySALTspread[c("EH40", "EH20_60", "EH0_80"), c(6,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(2,1),], alternative = "g") # 20_60 > 40
fisher.test(x = my[c(3,1),], alternative = "g") # 0_80 > 40
fisher.test(x = my[c(3,2),], alternative = "g") # 0_80 > 20_60


# 0.40 -------------------------------------------------------------------------
# 0.40  -- EXTINCT
my <- mySALTspread[c("EH40", "EH20_60", "EH0_80"), c(11,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") # 0_80 > 40
fisher.test(x = my[c(3,2),], alternative = "g") # 0_80 > 20_60
fisher.test(x = my[c(2,1),], alternative = "g") # 20_60 > 40

# 0.40  -- INCREASE
my <- mySALTspread[c("EH40", "EH20_60", "EH0_80"), c(13,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") # 0_80 > 40
fisher.test(x = my[c(3,2),], alternative = "g") # 0_80 > 20_60
fisher.test(x = my[c(2,1),], alternative = "g") # 20_60 > 40

# 0.40  -- DECREASE -- NO DIFFERENCES IN DECREASE DATA.
my <- mySALTspread[c("EH40", "EH20_60", "EH0_80"), c(15,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(2,1),], alternative = "g") # 20_60 > 40
fisher.test(x = my[c(3,1),], alternative = "g") # 0_80 > 40
fisher.test(x = my[c(3,2),], alternative = "g") # 0_80 > 20_60

# 0.80 -------------------------------------------------------------------------
# 0.80  -- EXTINCT
my <- mySALTspread[c("EH40", "EH20_60", "EH0_80"), c(20,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") # 0_80 > 40
fisher.test(x = my[c(3,2),], alternative = "g") # 0_80 > 20_60
fisher.test(x = my[c(2,1),], alternative = "g") # 20_60 > 40

# 0.80  -- INCREASE
my <- mySALTspread[c("EH40", "EH20_60", "EH0_80"), c(22,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") # 0_80 > 40
fisher.test(x = my[c(3,2),], alternative = "g") # 0_80 > 20_60
fisher.test(x = my[c(2,1),], alternative = "g") # 20_60 > 40

# 0.80  -- DECREASE
my <- mySALTspread[c("EH40", "EH20_60", "EH0_80"), c(24,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(2,1),], alternative = "g") # 20_60 > 40
fisher.test(x = my[c(3,1),], alternative = "g") # 0_80 > 40
fisher.test(x = my[c(3,2),], alternative = "g") # 0_80 > 20_60


# 1.2 -------------------------------------------------------------------------
# 1.20  -- EXTINCT
my <- mySALTspread[c("EH40", "EH20_60", "EH0_80"), c(29,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") # 0_80 > 40
fisher.test(x = my[c(2,3),], alternative = "g") # 20_60 > 0_80
fisher.test(x = my[c(2,1),], alternative = "g") # 20_60 > 40

# 1.20  -- INCREASE
my <- mySALTspread[c("EH40", "EH20_60", "EH0_80"), c(31,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") # 0_80 > 40
fisher.test(x = my[c(2,3),], alternative = "g") # 20_60 > 0_80
fisher.test(x = my[c(2,1),], alternative = "g") # 20_60 > 40

# 1.20  -- DECREASE
my <- mySALTspread[c("EH40", "EH20_60", "EH0_80"), c(33,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(2,1),], alternative = "g") # 20_60 > 40
fisher.test(x = my[c(3,1),], alternative = "g") # 0_80 > 40
fisher.test(x = my[c(3,2),], alternative = "g") # 0_80 > 20_60 
```



# 0, 0_40, 0_80
``` {r}
# TREAT EFFECTS ------------------------------------------------------------------------------------
# IN 0.00 ----------------------------------------------------------------------
my <- myd[!is.na(myd$dw),]
my <- my[my$mpasp == 0.0 & my$epo %in% c("SALT_A", "SALT_B") & my$treat %in% c("EH0", "EH0_40", "EH0_80"),]
my$treat <- drop.levels(my$treat);my$treat <- relevel(my$treat, ref = "EH0")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH0_40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH0_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

# IN 0.40 ----------------------------------------------------------------------
my <- myd[!is.na(myd$dw),]
my <- my[my$mpasp == 0.4 & my$epo %in% c("SALT_A", "SALT_B") & my$treat %in% c("EH0", "EH0_40", "EH0_80"),]
my$treat <- drop.levels(my$treat);my$treat <- relevel(my$treat, ref = "EH0")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH0_40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH0_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

# IN 0.80 ----------------------------------------------------------------------
my <- myd[!is.na(myd$dw),]
my <- my[my$mpasp == 0.8 & my$epo %in% c("SALT_A", "SALT_B") & my$treat %in% c("EH0", "EH0_40", "EH0_80"),]
my$treat <- drop.levels(my$treat);my$treat <- relevel(my$treat, ref = "EH0")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH0_40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH0_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

# IN 1.20 ----------------------------------------------------------------------
my <- myd[!is.na(myd$dw),]
my <- my[my$mpasp == 1.2 & my$epo %in% c("SALT_A", "SALT_B") & my$treat %in% c("EH0", "EH0_40", "EH0_80"),]
my$treat <- drop.levels(my$treat);my$treat <- relevel(my$treat, ref = "EH0")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH0_40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH0_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
# --------------------------------------------------------------------------------------------------


# Fishers exact tests ------------------------------------------------------------------------------
# 0.00 -------------------------------------------------------------------------
# 0.00 -- EXTINCT
my <- mySALTspread[c("EH0", "EH0_40", "EH0_80"), c(2,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,2),], alternative = "g") # 0 > 0_40
fisher.test(x = my[c(1,3),], alternative = "g") # 0 > 0_80
fisher.test(x = my[c(2,3),], alternative = "g") # 0_40 > 0_80

# 0.00  -- INCREASE
my <- mySALTspread[c("EH0", "EH0_40", "EH0_80"), c(4,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,2),], alternative = "g") # 0 > 0_40
fisher.test(x = my[c(1,3),], alternative = "g") # 0 > 0_80
fisher.test(x = my[c(2,3),], alternative = "g") # 0_40 > 0_80

# 0.00 -- DECREASE -- NO DIFFERENCES IN DECREASE DATA.
my <- mySALTspread[c("EH0", "EH0_40", "EH0_80"), c(6,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") # 0_80 > 0
fisher.test(x = my[c(3,2),], alternative = "g") # 0_80 > 0_40
fisher.test(x = my[c(2,1),], alternative = "g") # 0_40 > 0


# 0.40 -------------------------------------------------------------------------
# 0.40  -- EXTINCT
my <- mySALTspread[c("EH0", "EH0_40", "EH0_80"), c(11,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,2),], alternative = "g") # 0 > 0_40
fisher.test(x = my[c(1,3),], alternative = "g") # 0 > 0_80
fisher.test(x = my[c(2,3),], alternative = "g") # 0_40 > 0_80

# 0.40  -- INCREASE
my <- mySALTspread[c("EH0", "EH0_40", "EH0_80"), c(13,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") # 0_80 > 0
fisher.test(x = my[c(3,2),], alternative = "g") # 0_80 > 0_40
fisher.test(x = my[c(1,2),], alternative = "g") # 0 > 0.40

# 0.40  -- DECREASE -- NO DIFFERENCES IN DECREASE DATA.
my <- mySALTspread[c("EH0", "EH0_40", "EH0_80"), c(15,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,3),], alternative = "g") # 0 > 0_80
fisher.test(x = my[c(2,3),], alternative = "g") # 0_40 > 0_80
fisher.test(x = my[c(1,2),], alternative = "g") # 0 > 0_40

# 0.80 -------------------------------------------------------------------------
# 0.80  -- EXTINCT
my <- mySALTspread[c("EH0", "EH0_40", "EH0_80"), c(20,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,3),], alternative = "g") # 0 > 0_80
fisher.test(x = my[c(1,2),], alternative = "g") # 0 > 0_40
fisher.test(x = my[c(3,2),], alternative = "g") # 0_80 > 0_40

# 0.80  -- INCREASE
my <- mySALTspread[c("EH0", "EH0_40", "EH0_80"), c(22,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") # 0_80 > 0
fisher.test(x = my[c(3,2),], alternative = "g") # 0_80 > 0_40
fisher.test(x = my[c(2,1),], alternative = "g") # 0_40 > 0

# 0.80  -- DECREASE
my <- mySALTspread[c("EH0", "EH0_40", "EH0_80"), c(24,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,2),], alternative = "g") # 0 > 0_40
fisher.test(x = my[c(1,3),], alternative = "g") # 0 > 0_80
fisher.test(x = my[c(2,3),], alternative = "g") # 0_40 > 0_80


# 1.2 -------------------------------------------------------------------------
# 1.20  -- EXTINCT
my <- mySALTspread[c("EH0", "EH0_40", "EH0_80"), c(29,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,3),], alternative = "g") # 0 > 0_80
fisher.test(x = my[c(1,2),], alternative = "g") # 0 > 0_40
fisher.test(x = my[c(2,3),], alternative = "g") # 0_40 > 0_80

# 1.20  -- INCREASE
my <- mySALTspread[c("EH0", "EH0_40", "EH0_80"), c(31,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") # 0_80 > 0
fisher.test(x = my[c(3,2),], alternative = "g") # 0_80 > 0_40
fisher.test(x = my[c(2,1),], alternative = "g") # 0_40 > 0

# 1.20  -- DECREASE
my <- mySALTspread[c("EH0", "EH0_40", "EH0_80"), c(33,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,2),], alternative = "g") # 0 > 0_40
fisher.test(x = my[c(1,3),], alternative = "g") # 0 > 0_80
fisher.test(x = my[c(2,3),], alternative = "g") # 0_40 > 0_80
```




# 80, 40_80, 0_80
``` {r}
# TREAT EFFECTS ------------------------------------------------------------------------------------
# IN 0.00 ----------------------------------------------------------------------
my <- myd[!is.na(myd$dw),]
my <- my[my$mpasp == 0.0 & my$epo %in% c("SALT_A", "SALT_B") & my$treat %in% c("EH80", "EH40_80", "EH0_80"),]
my$treat <- drop.levels(my$treat);my$treat <- relevel(my$treat, ref = "EH80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH40_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH0_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

# IN 0.40 ----------------------------------------------------------------------
my <- myd[!is.na(myd$dw),]
my <- my[my$mpasp == 0.4 & my$epo %in% c("SALT_A", "SALT_B") & my$treat %in% c("EH80", "EH40_80", "EH0_80"),]
my$treat <- drop.levels(my$treat);my$treat <- relevel(my$treat, ref = "EH80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH40_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH0_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

# IN 0.80 ----------------------------------------------------------------------
my <- myd[!is.na(myd$dw),]
my <- my[my$mpasp == 0.8 & my$epo %in% c("SALT_A", "SALT_B") & my$treat %in% c("EH80", "EH40_80", "EH0_80"),]
my$treat <- drop.levels(my$treat);my$treat <- relevel(my$treat, ref = "EH80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH40_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH0_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

# IN 1.20 ----------------------------------------------------------------------
my <- myd[!is.na(myd$dw),]
my <- my[my$mpasp == 1.2 & my$epo %in% c("SALT_A", "SALT_B") & my$treat %in% c("EH80", "EH40_80", "EH0_80"),]
my$treat <- drop.levels(my$treat);my$treat <- relevel(my$treat, ref = "EH80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH40_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH0_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
# --------------------------------------------------------------------------------------------------


# Fishers exact tests ------------------------------------------------------------------------------
# 0.00 -------------------------------------------------------------------------
# 0.00 -- EXTINCT
my <- mySALTspread[c("EH80", "EH40_80", "EH0_80"), c(2,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,2),], alternative = "g") # 80 > 40_80
fisher.test(x = my[c(1,3),], alternative = "g") # 80 > 0_80
fisher.test(x = my[c(2,3),], alternative = "g") # 40_80 > 0_80

# 0.00  -- INCREASE
my <- mySALTspread[c("EH80", "EH40_80", "EH0_80"), c(4,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(2,1),], alternative = "g") # 40_80 > 80
fisher.test(x = my[c(2,3),], alternative = "g") # 40_80 > 0_80
fisher.test(x = my[c(1,3),], alternative = "g") # 80 > 0_80

# 0.00 -- DECREASE -- NO DIFFERENCES IN DECREASE DATA.
my <- mySALTspread[c("EH80", "EH40_80", "EH0_80"), c(6,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,2),], alternative = "g") # 80 > 40_80
fisher.test(x = my[c(1,3),], alternative = "g") # 80 > 0_80
fisher.test(x = my[c(2,3),], alternative = "g") # 40_80 > 0_80


# 0.40 -------------------------------------------------------------------------
# 0.40  -- EXTINCT
my <- mySALTspread[c("EH80", "EH40_80", "EH0_80"), c(11,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,2),], alternative = "g") # 80 > 40_80
fisher.test(x = my[c(1,3),], alternative = "g") # 80 > 0_80
fisher.test(x = my[c(2,3),], alternative = "g") # 40_80 > 0_80


# 0.40  -- INCREASE
my <- mySALTspread[c("EH80", "EH40_80", "EH0_80"), c(13,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(2,3),], alternative = "g") # 40_80 > 0_80
fisher.test(x = my[c(2,1),], alternative = "g") # 40_80 > 80
fisher.test(x = my[c(3,1),], alternative = "g") # 0_80 > 80

# 0.40  -- DECREASE -- NO DIFFERENCES IN DECREASE DATA.
my <- mySALTspread[c("EH80", "EH40_80", "EH0_80"), c(15,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,2),], alternative = "g") # 0_80 > 40_80
fisher.test(x = my[c(3,1),], alternative = "g") # 0_80 > 80
fisher.test(x = my[c(2,1),], alternative = "g") # 40_80 > 80

# 0.80 -------------------------------------------------------------------------
# 0.80  -- EXTINCT
my <- mySALTspread[c("EH80", "EH40_80", "EH0_80"), c(20,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,3),], alternative = "g") # 80 > 0_80
fisher.test(x = my[c(1,2),], alternative = "g") # 80 > 40_80
fisher.test(x = my[c(3,2),], alternative = "g") # 0_80 > 40_80

# 0.80  -- INCREASE
my <- mySALTspread[c("EH80", "EH40_80", "EH0_80"), c(22,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(2,3),], alternative = "g") # 40_80 > 0_80
fisher.test(x = my[c(2,1),], alternative = "g") # 40_80 > 80
fisher.test(x = my[c(3,1),], alternative = "g") # 0_80 > 80

# 0.80  -- DECREASE
my <- mySALTspread[c("EH80", "EH40_80", "EH0_80"), c(24,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,2),], alternative = "g") # 0_80 > 40_80
fisher.test(x = my[c(3,1),], alternative = "g") # 0_80 > 80
fisher.test(x = my[c(2,1),], alternative = "g") # 40_80 > 80


# 1.2 -------------------------------------------------------------------------
# 1.20  -- EXTINCT
my <- mySALTspread[c("EH80", "EH40_80", "EH0_80"), c(29,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,2),], alternative = "g") # 80 > 40_80
fisher.test(x = my[c(1,3),], alternative = "g") # 80 > 0_80
fisher.test(x = my[c(2,3),], alternative = "g") # 40_80 > 0_80

# 1.20  -- INCREASE
my <- mySALTspread[c("EH80", "EH40_80", "EH0_80"), c(31,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(2,1),], alternative = "g") # 40_80 > 80
fisher.test(x = my[c(2,3),], alternative = "g") # 40_80 > 0_80
fisher.test(x = my[c(1,3),], alternative = "g") # 80 > 0_80

# 1.20  -- DECREASE
my <- mySALTspread[c("EH80", "EH40_80", "EH0_80"), c(33,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,2),], alternative = "g") # 80 > 40_80
fisher.test(x = my[c(1,3),], alternative = "g") # 80 > 0_80
fisher.test(x = my[c(2,3),], alternative = "g") # 40_80 > 0_80
```


# 0, 40, 80
``` {r}
# TREAT EFFECTS ------------------------------------------------------------------------------------
# IN 0.00 ----------------------------------------------------------------------
my <- myd[!is.na(myd$dw),]
my <- my[my$mpasp == 0.0 & my$epo %in% c("SALT_A", "SALT_B") & my$treat %in% c("EH0", "EH40", "EH80"),]
my$treat <- drop.levels(my$treat);my$treat <- relevel(my$treat, ref = "EH0")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

# IN 0.40 ----------------------------------------------------------------------
my <- myd[!is.na(myd$dw),]
my <- my[my$mpasp == 0.4 & my$epo %in% c("SALT_A", "SALT_B") & my$treat %in% c("EH0", "EH40", "EH80"),]
my$treat <- drop.levels(my$treat);my$treat <- relevel(my$treat, ref = "EH0")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

# IN 0.80 ----------------------------------------------------------------------
my <- myd[!is.na(myd$dw),]
my <- my[my$mpasp == 0.8 & my$epo %in% c("SALT_A", "SALT_B") & my$treat %in% c("EH0", "EH40", "EH80"),]
my$treat <- drop.levels(my$treat);my$treat <- relevel(my$treat, ref = "EH0")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

# IN 1.20 ----------------------------------------------------------------------
my <- myd[!is.na(myd$dw),]
my <- my[my$mpasp == 1.2 & my$epo %in% c("SALT_A", "SALT_B") & my$treat %in% c("EH0", "EH40", "EH80"),]
my$treat <- drop.levels(my$treat);my$treat <- relevel(my$treat, ref = "EH0")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
# --------------------------------------------------------------------------------------------------


# Fishers exact tests ------------------------------------------------------------------------------
# 0.00 -------------------------------------------------------------------------
# 0.00 -- EXTINCT
my <- mySALTspread[c("EH0", "EH40", "EH80"), c(2,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") # 80 > 0
fisher.test(x = my[c(3,2),], alternative = "g") # 80 > 40
fisher.test(x = my[c(1,2),], alternative = "g") # 0 > 40

# 0.00  -- INCREASE
my <- mySALTspread[c("EH0", "EH40", "EH80"), c(4,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,2),], alternative = "g") # 0 > 40
fisher.test(x = my[c(1,3),], alternative = "g") # 0 > 80
fisher.test(x = my[c(2,3),], alternative = "g") # 40 > 80

# 0.00 -- DECREASE -- NO DIFFERENCES IN DECREASE DATA.
my <- mySALTspread[c("EH0", "EH40", "EH80"), c(6,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,2),], alternative = "g") # 80 > 40
fisher.test(x = my[c(3,1),], alternative = "g") # 80 > 0
fisher.test(x = my[c(2,1),], alternative = "g") # 40 > 0


# 0.40 -------------------------------------------------------------------------
# 0.40  -- EXTINCT
my <- mySALTspread[c("EH0", "EH40", "EH80"), c(11,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,3),], alternative = "g") # 0 > 80
fisher.test(x = my[c(1,2),], alternative = "g") # 0 > 40
fisher.test(x = my[c(3,2),], alternative = "g") # 80 > 40


# 0.40  -- INCREASE
my <- mySALTspread[c("EH0", "EH40", "EH80"), c(13,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,2),], alternative = "g") # 80 > 40
fisher.test(x = my[c(3,1),], alternative = "g") # 80 > 0
fisher.test(x = my[c(2,1),], alternative = "g") # 40 > 0

# 0.40  -- DECREASE -- NO DIFFERENCES IN DECREASE DATA.
my <- mySALTspread[c("EH0", "EH40", "EH80"), c(15,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,3),], alternative = "g") # 0 > 80
fisher.test(x = my[c(1,2),], alternative = "g") # 0 > 40
fisher.test(x = my[c(3,2),], alternative = "g") # 80 > 40

# 0.80 -------------------------------------------------------------------------
# 0.80  -- EXTINCT
my <- mySALTspread[c("EH0", "EH40", "EH80"), c(20,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") # 80 > 0
fisher.test(x = my[c(3,2),], alternative = "g") # 80 > 40
fisher.test(x = my[c(1,2),], alternative = "g") # 0 > 40

# 0.80  -- INCREASE
my <- mySALTspread[c("EH0", "EH40", "EH80"), c(22,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,2),], alternative = "g") # 80 > 40
fisher.test(x = my[c(3,1),], alternative = "g") # 80 > 0
fisher.test(x = my[c(2,1),], alternative = "g") # 40 > 0

# 0.80  -- DECREASE
my <- mySALTspread[c("EH0", "EH40", "EH80"), c(24,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,2),], alternative = "g") # 0 > 40
fisher.test(x = my[c(1,3),], alternative = "g") # 0 > 80
fisher.test(x = my[c(2,3),], alternative = "g") # 40 > 80


# 1.2 -------------------------------------------------------------------------
# 1.20  -- EXTINCT
my <- mySALTspread[c("EH0", "EH40", "EH80"), c(29,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,3),], alternative = "g") # 0 > 80
fisher.test(x = my[c(1,2),], alternative = "g") # 0 > 40
fisher.test(x = my[c(3,2),], alternative = "g") # 80 > 40

# 1.20  -- INCREASE
my <- mySALTspread[c("EH0", "EH40", "EH80"), c(31,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,2),], alternative = "g") # 80 > 40
fisher.test(x = my[c(3,1),], alternative = "g") # 80 > 0
fisher.test(x = my[c(2,1),], alternative = "g") # 40 > 0

# 1.20  -- DECREASE
my <- mySALTspread[c("EH0", "EH40", "EH80"), c(33,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,2),], alternative = "g") # 0 > 40
fisher.test(x = my[c(1,3),], alternative = "g") # 0 > 80
fisher.test(x = my[c(2,3),], alternative = "g") # 40 > 80
```


# 0_40, 20_60, 40_80
``` {r}
# TREAT EFFECTS ------------------------------------------------------------------------------------
# IN 0.00 ----------------------------------------------------------------------
my <- myd[!is.na(myd$dw),]
my <- my[my$mpasp == 0.0 & my$epo %in% c("SALT_A", "SALT_B") & my$treat %in% c("EH0_40", "EH20_60", "EH40_80"),]
my$treat <- drop.levels(my$treat);my$treat <- relevel(my$treat, ref = "EH0_40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH20_60")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH40_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

# IN 0.40 ----------------------------------------------------------------------
my <- myd[!is.na(myd$dw),]
my <- my[my$mpasp == 0.4 & my$epo %in% c("SALT_A", "SALT_B") & my$treat %in% c("EH0_40", "EH20_60", "EH40_80"),]
my$treat <- drop.levels(my$treat);my$treat <- relevel(my$treat, ref = "EH0_40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH20_60")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH40_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

# IN 0.80 ----------------------------------------------------------------------
my <- myd[!is.na(myd$dw),]
my <- my[my$mpasp == 0.8 & my$epo %in% c("SALT_A", "SALT_B") & my$treat %in% c("EH0_40", "EH20_60", "EH40_80"),]
my$treat <- drop.levels(my$treat);my$treat <- relevel(my$treat, ref = "EH0_40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH20_60")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH40_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

# IN 1.20 ----------------------------------------------------------------------
my <- myd[!is.na(myd$dw),]
my <- my[my$mpasp == 1.2 & my$epo %in% c("SALT_A", "SALT_B") & my$treat %in% c("EH0_40", "EH20_60", "EH40_80"),]
my$treat <- drop.levels(my$treat);my$treat <- relevel(my$treat, ref = "EH0_40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH20_60")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH40_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
# --------------------------------------------------------------------------------------------------


# Fishers exact tests ------------------------------------------------------------------------------
# 0.00 -------------------------------------------------------------------------
# 0.00 -- EXTINCT
my <- mySALTspread[c("EH0_40", "EH20_60", "EH40_80"), c(2,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") # 40_80 > 0_40
fisher.test(x = my[c(3,2),], alternative = "g") # 40_80 > 20_60
fisher.test(x = my[c(1,2),], alternative = "g") # 0_40 > 20_60

# 0.00  -- INCREASE
my <- mySALTspread[c("EH0_40", "EH20_60", "EH40_80"), c(4,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,2),], alternative = "g") # 0_40 > 20_60
fisher.test(x = my[c(1,3),], alternative = "g") # 0_40 > 40_80
fisher.test(x = my[c(2,3),], alternative = "g") # 20_60 > 40_80

# 0.00 -- DECREASE -- NO DIFFERENCES IN DECREASE DATA.
my <- mySALTspread[c("EH0_40", "EH20_60", "EH40_80"), c(6,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,2),], alternative = "g") # 80 > 40
fisher.test(x = my[c(3,1),], alternative = "g") # 80 > 0
fisher.test(x = my[c(2,1),], alternative = "g") # 40 > 0


# 0.40 -------------------------------------------------------------------------
# 0.40  -- EXTINCT
my <- mySALTspread[c("EH0_40", "EH20_60", "EH40_80"), c(11,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") # 40_80 > 0_40
fisher.test(x = my[c(3,2),], alternative = "g") # 40_80 > 20_60
fisher.test(x = my[c(1,2),], alternative = "g") # 0_40 > 20_60


# 0.40  -- INCREASE
my <- mySALTspread[c("EH0_40", "EH20_60", "EH40_80"), c(13,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,2),], alternative = "g") # 40_80 > 20_60
fisher.test(x = my[c(3,1),], alternative = "g") # 40_80 > 0_40
fisher.test(x = my[c(2,1),], alternative = "g") # 20_60 > 0_40

# 0.40  -- DECREASE -- NO DIFFERENCES IN DECREASE DATA.
my <- mySALTspread[c("EH0_40", "EH20_60", "EH40_80"), c(15,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,2),], alternative = "g") # 0_40 > 20_60
fisher.test(x = my[c(1,3),], alternative = "g") # 0_40 > 40_80
fisher.test(x = my[c(2,3),], alternative = "g") # 20_60 > 40_80

# 0.80 -------------------------------------------------------------------------
# 0.80  -- EXTINCT
my <- mySALTspread[c("EH0_40", "EH20_60", "EH40_80"), c(20,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") # 40_80 > 0_40
fisher.test(x = my[c(3,2),], alternative = "g") # 40_80 > 20_60
fisher.test(x = my[c(1,2),], alternative = "g") # 0_40 > 20_60

# 0.80  -- INCREASE
my <- mySALTspread[c("EH0_40", "EH20_60", "EH40_80"), c(22,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,2),], alternative = "g") # 40_80 > 20_60
fisher.test(x = my[c(3,1),], alternative = "g") # 40_80 > 0_40
fisher.test(x = my[c(2,1),], alternative = "g") # 20_60 > 0_40

# 0.80  -- DECREASE
my <- mySALTspread[c("EH0_40", "EH20_60", "EH40_80"), c(24,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,2),], alternative = "g") # 0_40 > 20_60
fisher.test(x = my[c(1,3),], alternative = "g") # 0_40 > 40_80
fisher.test(x = my[c(2,3),], alternative = "g") # 20_60 > 40_80


# 1.2 -------------------------------------------------------------------------
# 1.20  -- EXTINCT
my <- mySALTspread[c("EH0_40", "EH20_60", "EH40_80"), c(29,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(2,3),], alternative = "g") # 20_60 > 40_80
fisher.test(x = my[c(2,1),], alternative = "g") # 20_60 > 0_40
fisher.test(x = my[c(3,1),], alternative = "g") # 40_80 > 0_40

# 1.20  -- INCREASE
my <- mySALTspread[c("EH0_40", "EH20_60", "EH40_80"), c(31,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,2),], alternative = "g") # 40_80 > 20_60
fisher.test(x = my[c(3,1),], alternative = "g") # 40_80 > 0_40
fisher.test(x = my[c(2,1),], alternative = "g") # 20_60 > 0_40


# 1.20  -- DECREASE
my <- mySALTspread[c("EH0_40", "EH20_60", "EH40_80"), c(33,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,2),], alternative = "g") # 0_40 > 20_60
fisher.test(x = my[c(1,3),], alternative = "g") # 0_40 > 40_80
fisher.test(x = my[c(2,3),], alternative = "g") # 20_60 > 40_80

```


# 0_40, 20_60, 40_80
``` {r}
# TREAT EFFECTS ------------------------------------------------------------------------------------
# IN 0.00 ----------------------------------------------------------------------
my <- myd[!is.na(myd$dw),]
my <- my[my$mpasp == 0.0 & my$epo %in% c("SALT_A", "SALT_B") & my$treat %in% c("EH0_40", "EH40", "EH40_80"),]
my$treat <- drop.levels(my$treat);my$treat <- relevel(my$treat, ref = "EH0_40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH40_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

# IN 0.40 ----------------------------------------------------------------------
my <- myd[!is.na(myd$dw),]
my <- my[my$mpasp == 0.4 & my$epo %in% c("SALT_A", "SALT_B") & my$treat %in% c("EH0_40", "EH40", "EH40_80"),]
my$treat <- drop.levels(my$treat);my$treat <- relevel(my$treat, ref = "EH0_40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH40_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

# IN 0.80 ----------------------------------------------------------------------
my <- myd[!is.na(myd$dw),]
my <- my[my$mpasp == 0.8 & my$epo %in% c("SALT_A", "SALT_B") & my$treat %in% c("EH0_40", "EH40", "EH40_80"),]
my$treat <- drop.levels(my$treat);my$treat <- relevel(my$treat, ref = "EH0_40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH40_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

# IN 1.20 ----------------------------------------------------------------------
my <- myd[!is.na(myd$dw),]
my <- my[my$mpasp == 1.2 & my$epo %in% c("SALT_A", "SALT_B") & my$treat %in% c("EH0_40", "EH40", "EH40_80"),]
my$treat <- drop.levels(my$treat);my$treat <- relevel(my$treat, ref = "EH0_40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

my$treat <- relevel(my$treat, ref = "EH40_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
# --------------------------------------------------------------------------------------------------


# Fishers exact tests ------------------------------------------------------------------------------
# 0.00 -------------------------------------------------------------------------
# 0.00 -- EXTINCT
my <- mySALTspread[c("EH0_40", "EH40", "EH40_80"), c(2,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") # 40_80 > 0_40
fisher.test(x = my[c(3,2),], alternative = "g") # 40_80 > 40
fisher.test(x = my[c(1,2),], alternative = "g") # 0_40 > 40

# 0.00  -- INCREASE
my <- mySALTspread[c("EH0_40", "EH40", "EH40_80"), c(4,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,2),], alternative = "g") # 40_80 > 40
fisher.test(x = my[c(1,3),], alternative = "g") # 40_80 > 0_40
fisher.test(x = my[c(2,3),], alternative = "g") # 40 > 0_40

# 0.00 -- DECREASE -- NO DIFFERENCES IN DECREASE DATA.
my <- mySALTspread[c("EH0_40", "EH40", "EH40_80"), c(6,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,2),], alternative = "g") # 40_80 > 40
fisher.test(x = my[c(3,1),], alternative = "g") # 40_80 > 0_40
fisher.test(x = my[c(2,1),], alternative = "g") # 40 > 0_40


# 0.40 -------------------------------------------------------------------------
# 0.40  -- EXTINCT
my <- mySALTspread[c("EH0_40", "EH40", "EH40_80"), c(11,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") # 40_80 > 0_40
fisher.test(x = my[c(3,2),], alternative = "g") # 40_80 > 40
fisher.test(x = my[c(1,2),], alternative = "g") # 0_40 > 40


# 0.40  -- INCREASE
my <- mySALTspread[c("EH0_40", "EH40", "EH40_80"), c(13,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,2),], alternative = "g") # 40-80 > 40
fisher.test(x = my[c(3,1),], alternative = "g") # 40_80 > 0_40
fisher.test(x = my[c(2,1),], alternative = "g") # 40 > 0_40

# 0.40  -- DECREASE -- NO DIFFERENCES IN DECREASE DATA.
my <- mySALTspread[c("EH0_40", "EH40", "EH40_80"), c(15,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,2),], alternative = "g") # 0_40 > 40
fisher.test(x = my[c(1,3),], alternative = "g") # 0_40 > 40_80
fisher.test(x = my[c(2,3),], alternative = "g") # 40 > 40_80

# 0.80 -------------------------------------------------------------------------
# 0.80  -- EXTINCT
my <- mySALTspread[c("EH0_40", "EH40", "EH40_80"), c(20,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") # 40_80 > 0_40
fisher.test(x = my[c(3,2),], alternative = "g") # 40_80 > 40
fisher.test(x = my[c(1,2),], alternative = "g") # 0_40 > 40

# 0.80  -- INCREASE
my <- mySALTspread[c("EH0_40", "EH40", "EH40_80"), c(22,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,2),], alternative = "g") # 40-80 > 40
fisher.test(x = my[c(3,1),], alternative = "g") # 40_80 > 0_40
fisher.test(x = my[c(2,1),], alternative = "g") # 40 > 0_40


# 0.80  -- DECREASE
my <- mySALTspread[c("EH0_40", "EH40", "EH40_80"), c(24,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,2),], alternative = "g") # 0_40 > 40
fisher.test(x = my[c(1,3),], alternative = "g") # 0_40 > 40_80
fisher.test(x = my[c(2,3),], alternative = "g") # 40 > 40_80


# 1.2 -------------------------------------------------------------------------
# 1.20  -- EXTINCT
my <- mySALTspread[c("EH0_40", "EH40", "EH40_80"), c(29,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") # 40_80 > 0_40
fisher.test(x = my[c(3,2),], alternative = "g") # 40_80 > 40
fisher.test(x = my[c(1,2),], alternative = "g") # 0_40 > 40


# 1.20  -- INCREASE
my <- mySALTspread[c("EH0_40", "EH40", "EH40_80"), c(31,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,2),], alternative = "g") # 40-80 > 40
fisher.test(x = my[c(3,1),], alternative = "g") # 40_80 > 0_40
fisher.test(x = my[c(2,1),], alternative = "g") # 40 > 0_40


# 1.20  -- DECREASE
my <- mySALTspread[c("EH0_40", "EH40", "EH40_80"), c(33,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,2),], alternative = "g", simulate.p.value = T) # 0_40 > 40
x <- chisq.test(x = my[c(1,2),], simulate.p.value = T)
x$expected
fisher.test(x = my[c(1,3),], alternative = "g") # 0_40 > 40_80
fisher.test(x = my[c(2,3),], alternative = "g") # 40 > 40_80


```