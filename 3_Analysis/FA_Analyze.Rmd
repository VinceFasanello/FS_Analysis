---
title: "FA_Analyze.rmd"
output:
  html_document:
    df_print: paged
---


***
### Begin Code Blocks:

Prepare the workspace: clean, set options, load packages, load and final formatting on inputs.
```{r, warning = FALSE, message=FALSE}
rm(list = ls()) # clear workspace
knitr::opts_chunk$set(tidy = TRUE, collapse = TRUE) # set global knitr options.
# load required packages
require(ggplot2); # used for plotting
require(pwr); # used for power analysis
require(lme4); # used for mixed effects models
require(lmerTest); # used to interpret mixed effects models
require(sjPlot); # used to output tables
require(weights); # used for weighted t.test
require(plyr); # used for dataframe manipulation
require(gridExtra) # used for multipanel plotting
require(barnard)
require(GGally)
require(plotly)
options(scipen = 999) # turn off scientific notation
```
<br/><br/>



Explore extinction and extirpation.
```{r, warning = FALSE, message=FALSE}
load(file = "myd.Rdata")
myd$bc1cts_f_a <- apply(myd, 1, function(x) weighted.mean(as.numeric(x[c( "bc1cts_f_r1a", "bc1cts_f_r2a", "bc1cts_f_r3a", "bc1cts_f_r4a")]), 
                                                  as.numeric(x[c( "re_f_r1a","re_f_r2a","re_f_r3a","re_f_r4a")]), na.rm = T))

```
<br/><br/>



Load datasets
```{r, warning = FALSE, message=FALSE}
my <- myd
# view the most sensitive measure -- those barcodes that are actually omit at generation 500 (not present at start of the fit  assay)
# hist((my$bc1cts_i_e[my$bc1cts_i_e <= 1000000]), breaks = 100)
# hist((my$bc1cts_i_e[my$bc1cts_i_e <= 1000]), breaks = 100)
# hist((my$bc1cts_i_e[my$bc1cts_i_e <= 100]), breaks = 100)
# hist((my$bc1cts_i_e[my$bc1cts_i_e <= 50]), breaks = 100) # lets omit below 15, this look like a natural break -- we will apply this value at 4 timepoints...

# first take a look at how many entries fall w/in each category
# sum(my$bc1cts_i_e <= 15) # entries with generation 500 fitness assay initial counts <= 15 [ANS: 1792 / 7104 (0.2522523)]
# sum(my$bc1cts_f_e <= 15) # "" generation 500 fitness assay final counts "" [ANS: 2605 / 7104 (0.3666948)]
# sum(my$bc1cts_i_a <= 15) # "" generation 0 fitness assay initial counts "" [ANS: 0 / 7104 (0.00)]
# sum(my$bc1cts_f_a <= 15) # "" generation 0 fitness assay final counts "" [ANS: 8 / 7104 (0.001126126)]

my$omit <- FALSE # initially set to false (was T for all < 2 counts originally)
my$omit[my$bc1cts_i_e <= 15 | my$bc1cts_f_e <= 15 | my$bc1cts_i_a <= 15 | my$bc1cts_f_a <= 15] <- T # see prev block comments, just assignment here. 

#my$fit0[my$bc1cts_i_a <= 15 | my$bc1cts_f_a <= 15] <- NA # NA fit data for the 8 entries that are missing complete data
my$re_fit_a[my$bc1cts_i_a <= 15 | my$bc1cts_f_a <= 15] <- NA
my$fit500[my$omit == T] <- NA # na fit500 data for omits
my$dw[my$omit == T] <- NA # na dw data for omits
my$re_dw[my$omit == T] <- NA
my$re_fit_e[my$omit == T] <- NA

myd <- my
```
<br/><br/>



Create helper functions for plotting and data transformation.
```{r, warning = FALSE, message=FALSE}
# expand_residuals creates a modified histogram of residuals. ------------------
# Each entry in the model output is plotted a number of times equal to its reads.
expand_residuals <- function(model, reads){
  myfr <- NA
  for(i in 1:length(residuals(model))){
    times <- (((reads[i] - min(reads, na.rm = T))/(max(reads) - min(reads)))*1000) + 1 
    myfr <- c(myfr, rep(residuals(model)[i], times = times))
  }
  return(myfr)
}



# log transformation for modeling. ---------------------------------------------
log_transform <- function(myvar){
  myvar <- log(((myvar - min(myvar))/(max(myvar) - min(myvar))) + 1) 
  return(myvar)
}



# weighted.var.se --------------------------------------------------------------
# https://stats.stackexchange.com/questions/25895/computing-standard-error-in-weighted-mean-estimation
weighted.var.se <- function(x, w, na.rm=FALSE)
#  Computes the variance of a weighted mean following Cochran 1977 definition
{
  if (na.rm) { w <- w[i <- !is.na(x)]; x <- x[i] }
  n = length(w)
  xWbar = weighted.mean(x,w,na.rm=na.rm)
  wbar = mean(w)
  out = n/((n-1)*sum(w)^2)*(sum((w*x-wbar*xWbar)^2)-2*xWbar*sum((w-wbar)*(w*x-wbar*xWbar))+xWbar^2*sum((w-wbar)^2))
  return(out)
}

# get legend function found on stack exchange ----------------------------------
#   scrapes figure legend for later plotting in multipannel plot
get_legend<-function(myggplot){
  tmp <- ggplot_gtable(ggplot_build(myggplot))
  leg <- which(sapply(tmp$grobs, function(x) x$name) == "guide-box")
  legend <- tmp$grobs[[leg]]
  return(legend)
}


get_se <- function(x){
  tmp <- sd(x, na.rm=TRUE) /  sqrt(length(x[!is.na(x)]))
  return(tmp)
}




```
<br/><br/>



Set color palette options for all plots
```{r}
setpalette <- RColorBrewer::brewer.pal(7, "Dark2") # current preferred palette
#setpalette <- c("#993404","#d95f0e","#fe9929","#41b6c4","#2c7fb8","#253494") # option 2
#setpalette <- c("#8c510a","#d8b365","#f6e8c3", "#c7eae5","#5ab4ac","#01665e") # option 3
ramppalette <- c("#006600", "#9999ff", "#6666ff", "#000066","#ff9999", "#ff6666", "#990000")
incpalette_br_cy <- RColorBrewer::brewer.pal(n = 11, name = "BrBG")[c(11,10,9,8,3,2,1)]
incpalette_re_bl <- RColorBrewer::brewer.pal(n = 11, name = "RdYlBu")[c(11,10,8,6,4,3,2)]
ramppalette_YlOrRd <-  RColorBrewer::brewer.pal(n = 9, name = "YlOrRd")[c(3:9)]
```
<br/><br/>



Plot initial fitness
```{r}
# BLOCK NOTES ------------------------------------------------------------------
# - initial fitness distribution looks hump-shaped 
# - initial fitness distribution shows positive shift in general -- indicates that the chosen ref happened to be lower in fit than most other bcs in our pop, this is no problem. 
# - Initial fitness distribution shifted as salt stress increases -- indicates increasing discrepency between pop and ref with higher salt concentration (good thing we use delta fitness).
# - Initial fitness distribution shows no shift in COPR (Need to plot salt then copr; uncomment myc line; to see this).
# - Initial fitness hump-shape falls apart in copr 120 which may be too stressfull to accurately assess fitness in. (we will see down the line). 
# 
# - PROBLEMS:
#   - The plot shows very different patterns when you plot salt first and when you plot copr first. may be worth looking at both (I describe above though). 
# ------------------------------------------------------------------------------

my <- myd
# Visualize -------------------------------------------------------------------
myx <- my$fit0
myr <- my$re_fit_a / mean(my$re_fit_a, na.rm = T)
myc <- paste0(my$mpamt, my$mpasp); myc <- factor(myc, levels = c("CM0", "COPR0.4", "COPR0.8", "COPR1.2", "SALT0.4", "SALT0.8", "SALT1.2"))
#myc <- paste0(my$mpamt, my$mpasp); myc <- factor(myc, levels = c("CM0", "SALT0.4", "SALT0.8", "SALT1.2","COPR0.4", "COPR0.8", "COPR1.2" ))
mybinwidth <- 0.0025
mytitle <- NULL
myylab <- "Count"
myxlab <- "Ancestral Fitness (in Seven Environments)"
myhighlight <- "black"
myfillapha <- 0.8
mypalette <- ramppalette
mytextsize <- 8
myheight <- 7 
mywidth <- 7

p <- ggplot(my, aes(x=myx,color = myc, fill = myc, weight = myr)) + 
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = 0.05)+
  #xlim(c(-0.06, 0.06)) +
  geom_vline(xintercept = 1.0, linetype = "dashed", color = myhighlight) +
  scale_color_manual(values =mypalette, guide = FALSE) + 
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= c(0.8,0.6)) +
  labs(fill = "Fitness Assay Environment") +
  ggtitle(mytitle)+ ylab(myylab)+ xlab(myxlab)+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))+
  scale_x_continuous(breaks = seq(.75,1.25,by=0.05),
                     labels = c("0.75", "0.8", "0.85", "0.9", "0.95", "1.0","1.05", "1.1","1.15","1.2", "1.25"),
                     limits = c(.75, 1.25))+
  scale_y_continuous(breaks = seq(0, 1000, by = 100), limits = c(0, 700))
p

# figure output ---------------------------------------------------------------
pdf(file = "000_ancfit_cbyenv.pdf", width = mywidth, height = myheight); p; dev.off() # one column wide, equal height


# -----------------------------------------------------------------------------
rm(my, p, mybinwidth, myc, myfillapha, myheight, myhighlight, mypalette, myr, mytextsize,
   mytitle, mywidth, myx, myxlab, myylab)
```
<br/><br/>



fit0 ~ treatment 
```{r}
# BLOCK NOTES ------------------------------------------------------------------
# - all treatment differences within models are nonsignifiant; else COPR120 which has significant differnces among treatments
# - treatment nonsignificant in all models
# 
# - PROBLEMS:
#   - Large eigenvalue warning in all models -- ask CB
# ------------------------------------------------------------------------------

# prep an appropriate dataframe for these tests --------------------------------
#     - The appropriate data frame contains one entry (row) for each fit0 replicate in each environment 
my <- myd[myd$epo %in% c("COPR_A", "SALT_A") & myd$mpar == 1,]
myt1 <- my[,c("epo", "mpasp", "bc1", "treat", "re_fit_r1a", "fit0r1")]; colnames(myt1) <- c("epo", "mpasp", "bc1","treat", "re_fit_a", "fit0")
myt2 <- my[,c("epo", "mpasp", "bc1", "treat", "re_fit_r2a", "fit0r2")]; colnames(myt2) <- c("epo", "mpasp", "bc1","treat", "re_fit_a", "fit0")
myt3 <- my[,c("epo", "mpasp", "bc1", "treat", "re_fit_r3a", "fit0r3")]; colnames(myt3) <- c("epo", "mpasp", "bc1","treat", "re_fit_a", "fit0")
myt4 <- my[,c("epo", "mpasp", "bc1", "treat", "re_fit_r4a", "fit0r4")]; colnames(myt4) <- c("epo", "mpasp", "bc1","treat", "re_fit_a", "fit0")
myt <- rbind(myt1, myt2, myt3, myt4)
myt$treat <- factor(myt$treat, levels = c("EH0", "EH0_40", "EH40", "EH20_60", "EH0_80", "EH40_80", "EH80")) # Relevel the treatments appropriately. 


# in CM ------------------------------------------------------------------------
my <- myt[myt$epo == "SALT_A" & myt$mpasp == 0.0,]
mymod <- lmer(my$fit0 ~ my$treat + (1|my$bc1), weights = my$re_fit_a, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
summary(mymod);anova(mymod)

# in SALT40 ------------------------------------------------------------------------
my <- myt[myt$epo == "SALT_A" & myt$mpasp == 0.4,]
mymod <- lmer(my$fit0 ~ my$treat + (1|my$bc1), weights = my$re_fit_a, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
summary(mymod);anova(mymod)

# in SALT80 ------------------------------------------------------------------------
my <- myt[myt$epo == "SALT_A" & myt$mpasp == 0.8,]
mymod <- lmer(my$fit0 ~ my$treat + (1|my$bc1), weights = my$re_fit_a, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
summary(mymod);anova(mymod)

# in SALT120 ------------------------------------------------------------------------
my <- myt[myt$epo == "SALT_A" & myt$mpasp == 1.2,]
mymod <- lmer(my$fit0 ~ my$treat + (1|my$bc1), weights = my$re_fit_a, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
summary(mymod);anova(mymod)

# in COPR40 ------------------------------------------------------------------------
my <- myt[myt$epo == "COPR_A" & myt$mpasp == 0.4,]
mymod <- lmer(my$fit0 ~ my$treat + (1|my$bc1), weights = my$re_fit_a, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
summary(mymod);anova(mymod)

# in COPR80 ------------------------------------------------------------------------
my <- myt[myt$epo == "COPR_A" & myt$mpasp == 0.8,]
mymod <- lmer(my$fit0 ~ my$treat + (1|my$bc1), weights = my$re_fit_a, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
summary(mymod);anova(mymod)

# in COPR120 ------------------------------------------------------------------------
my <- myt[myt$epo == "COPR_A" & myt$mpasp == 1.2,]
mymod <- lmer(my$fit0 ~ my$treat + (1|my$bc1), weights = my$re_fit_a, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4)))
summary(mymod);anova(mymod)

# ----------------------------
rm(my, mymod, myt, myt1, myt2, myt3, myt4, weights)
```
<br/><br/>


dw associated with weight?
```{r}
# BLOCK NOTES ------------------------------------------------------------------
#  - data distribution is approximately hump shaped with mean near 0 (no change in fitness). Higher weights are likely to have fitness values closer to hump mean. This makes sense -- higher weight means more counts recovered at all timepoints means more confidence in fitness calculation, means less likely to pick up spurious increases / decreases in fitness caused by stocahsticity in sampling.
#  - COPR 1.2 and, to a lesser extent, COPR 0.8 have differnent releationships than the other variables. SALT does not share the trend
#  - for self use only, not for inclusion in any publication. will be hard to explain fully and needlessly confusing to the reader.  
# ------------------------------------------------------------------------------

my <- myd[myd$omit == F,]

# look at everything together --------------------------------------------------
myx <- my$dw
myy <- my$re_dw
myc <- paste0(my$mpamt, my$mpasp); myc <- factor(myc, levels = c("CM0", "COPR0.4", "COPR0.8", "COPR1.2", "SALT0.4", "SALT0.8", "SALT1.2"))
mys <- my$treat
myylab <- "Weight (reads)"
myxlab <- "dw"
myhighlight <- "black"
myptalpha <- 0.35
mypalette <- ramppalette
mytextsize <- 8
myheight <- 7
mywidth <- 7
mystroke <- 1.5

#mymod <- lmer(myy ~ myx + (myx||paste0(my$mpamt, my$mpasp))); summary(mymod)
p <- ggplot(my, aes(x=myx, y=myy, color = myc))+
  geom_point(aes(color=myc, pch = mys), alpha = myptalpha, stroke = mystroke)+
  # geom_line(aes(y=predict(mymod), group = myc, color = myc), size = 1, alpha = myptalpha)+
  scale_shape_manual(values=1:nlevels(mys))+
  geom_rug(alpha = myptalpha)+
  scale_color_manual(values = mypalette)+
  theme_classic() +
  labs(color = "Treatment") +
  ylab(myylab)+ xlab(myxlab) +
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
p
# figure output ----
pdf(file = "000_FitAndWeight_All.pdf", width = mywidth, height = myheight); p; dev.off() # one column wide, equal height


# look at SALT  ----------------------------------------------------------------
my <- myd[myd$epo %in% c("SALT_A", "SALT_B") & myd$omit == F,]
myx <- my$dw
myy <- my$re_dw
myc <- paste0(my$mpamt, my$mpasp); myc <- factor(myc, levels = c("CM0", "SALT0.4", "SALT0.8", "SALT1.2"))
mys <- my$treat
mypalette <- ramppalette[c(1,5,6,7)]
myptalpha <- 0.7

#mymod <- lmer(myy ~ myx + (myx||paste0(my$mpamt, my$mpasp))); summary(mymod)
p <- ggplot(my, aes(x=myx, y=myy, color = myc))+
  geom_point(aes(color=myc, pch = mys), alpha = myptalpha, stroke = mystroke)+
  # geom_line(aes(y=predict(mymod), group = myc, color = myc), size = 1, alpha = myptalpha)+
  scale_shape_manual(values=1:nlevels(mys))+
  geom_rug(alpha = myptalpha)+
  scale_color_manual(values = mypalette)+
  theme_classic() +
  labs(color = "Treatment") +
  ylab(myylab)+ xlab(myxlab) +
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
p
# figure output ----
pdf(file = "000_FitAndWeight_SALT.pdf", width = mywidth, height = myheight); p; dev.off() # one column wide, equal height



# look at COPR  ----------------------------------------------------------------
my <- myd[myd$epo %in% c("COPR_A", "COPR_B") & myd$omit == F,]
myx <- my$dw
myy <- my$re_dw
myc <- paste0(my$mpamt, my$mpasp); myc <- factor(myc, levels = c("CM0", "COPR0.4", "COPR0.8", "COPR1.2"))
mys <- my$treat
mypalette <- ramppalette[c(1,2,3,4)]
myptalpha <- 0.7

#mymod <- lmer(myy ~ myx + (myx||paste0(my$mpamt, my$mpasp))); summary(mymod)
p <- ggplot(my, aes(x=myx, y=myy, color = myc))+
  geom_point(aes(color=myc, pch = mys), alpha = myptalpha, stroke = mystroke)+
  # geom_line(aes(y=predict(mymod), group = myc, color = myc), size = 1, alpha = myptalpha)+
  scale_shape_manual(values=1:nlevels(mys))+
  geom_rug(alpha = myptalpha)+
  scale_color_manual(values = mypalette)+
  theme_classic() +
  labs(color = "Treatment") +
  ylab(myylab)+ xlab(myxlab) +
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
p
# figure output ----
pdf(file = "000_FitAndWeight_COPR.pdf", width = mywidth, height = myheight); p; dev.off() # one column wide, equal height


# ------------------------------------------------------------------------------
rm(my, p, myc, myheight, myhighlight, mypalette, myptalpha, mys, mystroke,
   mytextsize, mywidth, myx, myxlab, myy, myylab)
```
<br/><br/>







6 panel figure: row 1:salt, row2: copr, col1: fit0, col2: fit500 col3: dw
```{r}
my <- myd

# set universal vars -----------------------------------------------------------
mybinwidth <- 0.01
myylab <- "Count"
myxlab <- "fitness"
myhighlight <- "black"
myfillapha <- 0.85
myrugalpha <- 0.2
mypalette_r1 <- ramppalette[c(1,5,6,7)]
mypalette_r2 <- ramppalette[c(1,2,3,4)]
mytextsize <- 8
myheight <- 8
mywidth <- 8.5
myxlim1 <- c(.6, 1.6); myymax1 <- 800
myxlim2 <- myxlim1; myymax2 <- 300
myxlim3 <- c(-.5, .5); myymax3 <- myymax2
myxlim4 <- c(.6, 1.8); myymax4 <- 1250
myxlim5 <- myxlim4; myymax5 <- 400
myxlim6 <- c(-.3, .9); myymax6 <- myymax5



# Row 1: SALT lines ------------------------------------------------------------
# fit0 -----------------------------------------------------
p <- ggplot(my[my$epo %in% c("SALT_A", "SALT_B"),], aes(x=fit0, color = paste0(mpasp), fill = paste0(mpasp), weight = re_fit_a / mean(re_fit_a, na.rm = T))) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = myrugalpha)+
  xlim(myxlim1) +
  ylim(c(NA,myymax1)) +
  scale_color_manual(values =mypalette_r1, guide = FALSE) +
  scale_fill_manual(values =mypalette_r1) +
  theme_classic() +
  theme(legend.position= c(0.8,0.8)) +
  labs(fill = "Assay Environment") +
  ylab(myylab)+ xlab(myxlab)+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
legend <- get_legend(p)
p <- p + theme(legend.position="none")
psanc <- p

# fit500 ---------------------------------------------------
p <- ggplot(my[my$epo %in% c("SALT_A", "SALT_B"),], aes(x=fit500, color = paste0(mpamt, mpasp), fill = paste0(mpasp), weight = re_fit_e / mean(re_fit_e, na.rm = T))) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = myrugalpha)+
  xlim(myxlim2) +
  ylim(c(NA,myymax2)) +
  scale_color_manual(values =mypalette_r1, guide = FALSE) +
  scale_fill_manual(values =mypalette_r1) +
  theme_classic() +
  theme(legend.position= "none") +
  labs(fill = "Significance") +
  ylab(myylab)+ xlab(myxlab)+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
psevo <- p

# dw -------------------------------------------------------
p <- ggplot(my[my$epo %in% c("SALT_A", "SALT_B"),], aes(x=dw, color = paste0(mpamt, mpasp), fill = paste0(mpasp), weight = re_dw / mean(re_dw, na.rm = T))) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = myrugalpha)+
  xlim(myxlim3) +
  ylim(c(NA,myymax3)) +
  scale_color_manual(values =mypalette_r1, guide = FALSE) +
  scale_fill_manual(values =mypalette_r1) +
  theme_classic() +
  theme(legend.position= "none") +
  labs(fill = "Significance") +
  ylab(myylab)+ xlab(myxlab)+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
psdel <- p



# Row 2: COPR lines ------------------------------------------------------------
# fit0 -----------------------------------------------------
p <- ggplot(my[my$epo %in% c("COPR_A", "COPR_B"),], aes(x=fit0, color = paste0(mpamt, mpasp), fill = paste0(mpasp), weight = re_fit_a / mean(re_fit_a, na.rm = T))) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = myrugalpha)+
  xlim(myxlim4) +
  ylim(c(NA,myymax4)) +
  scale_color_manual(values =mypalette_r2, guide = FALSE) +
  scale_fill_manual(values =mypalette_r2) +
  theme_classic() +
  theme(legend.position= "none") +
  labs(fill = "Significance") +
  ylab(myylab)+ xlab(myxlab)+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
pcanc <- p

# fit500 ---------------------------------------------------
p <- ggplot(my[my$epo %in% c("COPR_A", "COPR_B"),], aes(x=fit500, color = paste0(mpamt, mpasp),fill = paste0(mpasp), weight = re_fit_e / mean(re_fit_e, na.rm = T))) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = myrugalpha)+
  xlim(myxlim5) +
  ylim(c(NA,myymax5)) +
  scale_color_manual(values =mypalette_r2, guide = FALSE) +
  scale_fill_manual(values =mypalette_r2) +
  theme_classic() +
  theme(legend.position= "none") +
  labs(fill = "Significance") +
  ylab(myylab)+ xlab(myxlab)+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
pcevo <- p

# dw -------------------------------------------------------
p <- ggplot(my[my$epo %in% c("COPR_A", "COPR_B"),], aes(x=dw, color = paste0(mpamt, mpasp), fill = paste0(mpasp), weight = re_dw / mean(re_dw, na.rm = T))) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = myrugalpha)+
  xlim(myxlim6) +
  ylim(c(NA,myymax6)) +
  scale_color_manual(values =mypalette_r2, guide = FALSE) +
  scale_fill_manual(values =mypalette_r2) +
  theme_classic() +
  theme(legend.position= "none") +
  labs(fill = "Significance") +
  ylab(myylab)+ xlab(myxlab)+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
pcdel <- p



# Plot using grid and output ---------------------------------------------------
pdf(file = "000_fit_cbyenv_full.pdf", width = mywidth, height = myheight)
grid.arrange( grid::textGrob("SALT", gp =grid::gpar(fontsize = 8, fontface = "bold"), rot = 90),
              grid::textGrob("COPR", gp =grid::gpar(fontsize = 8, fontface = "bold"), rot = 90),
              psanc, psevo, psdel,
              pcanc, pcevo, pcdel,
              legend, 
              grid::textGrob("", gp =grid::gpar(fontsize = 8)),
              grid::textGrob("Generation-0", gp =grid::gpar(fontsize = 12, fontface = "bold")),
              grid::textGrob("Generation-500", gp =grid::gpar(fontsize = 12, fontface = "bold")),
              grid::textGrob("Delta", gp =grid::gpar(fontsize = 12, fontface = "bold")),
  layout_matrix = rbind(c(10, 10,11,11,10, 10,12,12,10,  10,13,13,10,  10, 10),
                        c(1,  3,3,3,3,     4,4,4,4,      5,5,5,5,      9, 10),
                        c(1,  3,3,3,3,     4,4,4,4,      5,5,5,5,      10, 10),
                        c(2,  6,6,6,6,     7,7,7,7,      8,8,8,8,      10, 10),
                        c(2,  6,6,6,6,     7,7,7,7,      8,8,8,8,      10, 10)),
  top = grid::textGrob("\n Yeast Fitness in SALT and COPR", gp =grid::gpar(fontsize = 14, fontface = "bold")))
dev.off() # one column wide, equal height

# -----------------------------------------------------------------------------
rm(my, p, mybinwidth, myfillapha, myheight, myhighlight, mytextsize, mywidth, myxlab, myylab,
   legend, pcanc, pcdel, pcevo, psanc, psdel, psevo, mypalette_r1, mypalette_r2, myrugalpha,
   myxlim1, myxlim2, myxlim3, myxlim4, myxlim5, myxlim6, myymax1, myymax2, myymax3, myymax4,
   myymax5, myymax6)
```


# Plot: SALTA SALTB ancestral and evolved fitness in CM,salt40, salt80, salt120
```{R}
my <- myd
my$treat <- factor(my$treat, levels = c("EH0", "EH0_40", "EH40", "EH20_60", "EH0_80", "EH40_80", "EH80")) # reorder the treat factor

# set universal vars -----------------------------------------------------------
mybinwidth <- 0.01
myylab <- "Count"
myxlab <- "fitness"
myhighlight <- "black"
myfillapha <- 0.95
myrugalpha <- 0.2
mypalette <- incpalette_br_cy
mytextsize <- 8
myheight <- 11
mywidth <- 8.5
myxlim_c1_c2 <- c(0.6, 1.6)
myxlim_c3 <- c(-0.5, 0.5)
myymax11 <- 400
myymax12_13 <- 100
myymax21 <- 350
myymax22_23 <- 80
myymax31 <- 250
myymax32_33 <- 40
myymax41 <- 250
myymax42_43 <- 50

# salt anc -----------------------------
# salt anc in 0
p <- ggplot(my[my$mpasp == 0.0 & my$epo %in% c("SALT_A", "SALT_B"),], aes(x=fit0, color = treat, fill = treat), weight = re_fit_a / mean(re_fit_a, na.rm = T)) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = myrugalpha)+
  xlim(myxlim_c1_c2) +
  ylim(c(NA,myymax11)) +
  scale_color_manual(values =mypalette, guide = FALSE) + 
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= c(0.7,0.7), legend.key.size = unit(.20, "cm")) +
  labs(fill = "Treatment") +
  ylab(myylab)+ xlab("")+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
legend <- get_legend(p)
p <- p + theme(legend.position="none")
p_salt_anc_0 <- p

# salt anc in 40
p <- ggplot(my[my$mpasp == 0.4 & my$epo %in% c("SALT_A", "SALT_B"),], aes(x=fit0, color = treat, fill = treat), weight = re_fit_a / mean(re_fit_a, na.rm = T)) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = myrugalpha)+
  xlim(myxlim_c1_c2) +
  ylim(c(NA,myymax21)) +
  scale_color_manual(values =mypalette, guide = FALSE) + 
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= "none") +
  labs(fill = "Significance") +
  ylab(myylab)+ xlab("")+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
p_salt_anc_40 <- p

# salt anc in 80
p <- ggplot(my[my$mpasp == 0.8 & my$epo %in% c("SALT_A", "SALT_B"),], aes(x=fit0, color = treat, fill = treat), weight = re_fit_a / mean(re_fit_a, na.rm = T)) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = myrugalpha)+
  xlim(myxlim_c1_c2) +
  ylim(c(NA,myymax31)) +
  scale_color_manual(values =mypalette, guide = FALSE) + 
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= "none") +
  labs(fill = "Significance") +
  ylab(myylab)+ xlab("")+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
p_salt_anc_80 <- p

# salt anc in 120
p <- ggplot(my[my$mpasp == 1.2 & my$epo %in% c("SALT_A", "SALT_B"),], aes(x=fit0, color = treat, fill = treat), weight = re_fit_a / mean(re_fit_a, na.rm = T)) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = myrugalpha)+
  xlim(myxlim_c1_c2) +
  ylim(c(NA,myymax41)) +
  scale_color_manual(values =mypalette, guide = FALSE) + 
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= "none") +
  labs(fill = "Significance") +
  ylab(myylab)+ xlab(myxlab)+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
p_salt_anc_120 <- p

# salt evo -----------------------------
# salt evo in 0
p <- ggplot(my[my$mpasp == 0.0 & my$epo %in% c("SALT_A", "SALT_B"),], aes(x=fit500, color = treat, fill = treat), weight = re_fit_e / mean(re_fit_e, na.rm = T)) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = myrugalpha)+
  xlim(myxlim_c1_c2) +
  ylim(c(NA,myymax12_13)) +
  scale_color_manual(values =mypalette, guide = FALSE) + 
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= "none") +
  labs(fill = "Significance") +
  ylab("")+ xlab("")+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
p_salt_evo_0 <- p

# salt evo in 40
p <- ggplot(my[my$mpasp == 0.4 & my$epo %in% c("SALT_A", "SALT_B"),], aes(x=fit500, color = treat, fill = treat), weight = re_fit_e / mean(re_fit_e, na.rm = T)) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = myrugalpha)+
  xlim(myxlim_c1_c2) +
  ylim(c(NA,myymax22_23)) +
  scale_color_manual(values =mypalette, guide = FALSE) + 
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= "none") +
  labs(fill = "Significance") +
  ylab("")+ xlab("")+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
p_salt_evo_40 <- p

# salt evo in 80
p <- ggplot(my[my$mpasp == 0.8 & my$epo %in% c("SALT_A", "SALT_B"),], aes(x=fit500, color = treat, fill = treat), weight = re_fit_e / mean(re_fit_e, na.rm = T)) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = myrugalpha)+
  xlim(myxlim_c1_c2) +
  ylim(c(NA,myymax32_33)) +
  scale_color_manual(values =mypalette, guide = FALSE) + 
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= "none") +
  labs(fill = "Significance") +
  ylab("")+ xlab("")+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
p_salt_evo_80 <- p

# salt evo in 120
p <- ggplot(my[my$mpasp == 1.2 & my$epo %in% c("SALT_A", "SALT_B"),], aes(x=fit500, color = treat, fill = treat), weight = re_fit_e / mean(re_fit_e, na.rm = T)) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = myrugalpha)+
  xlim(myxlim_c1_c2) +
  ylim(c(NA,myymax42_43)) +
  scale_color_manual(values =mypalette, guide = FALSE) + 
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= "none") +
  labs(fill = "Significance") +
  ylab("")+ xlab("")+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
p_salt_evo_120 <- p

# salt delta -----------------------------
# salt delta in 0
p <- ggplot(my[my$mpasp == 0.0 & my$epo %in% c("SALT_A", "SALT_B"),], aes(x=dw, color = treat, fill = treat), weight = re_dw / mean(re_dw, na.rm = T)) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = myrugalpha)+
  xlim(myxlim_c3) +
  ylim(c(NA,myymax12_13)) +
  scale_color_manual(values =mypalette, guide = FALSE) + 
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= "none") +
  labs(fill = "Significance") +
  ylab("")+ xlab("")+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
p_salt_del_0 <- p

# salt evo in 40
p <- ggplot(my[my$mpasp == 0.4 & my$epo %in% c("SALT_A", "SALT_B"),], aes(x=dw, color = treat, fill = treat), weight = re_dw / mean(re_dw, na.rm = T)) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = myrugalpha)+
  xlim(myxlim_c3) +
  ylim(c(NA,myymax22_23)) +
  scale_color_manual(values =mypalette, guide = FALSE) + 
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= "none") +
  labs(fill = "Significance") +
  ylab("")+ xlab("")+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
p_salt_del_40 <- p

# salt evo in 80
p <- ggplot(my[my$mpasp == 0.8 & my$epo %in% c("SALT_A", "SALT_B"),], aes(x=dw, color = treat, fill = treat), weight = re_dw / mean(re_dw, na.rm = T)) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = myrugalpha)+
  xlim(myxlim_c3) +
  ylim(c(NA,myymax32_33)) +
  scale_color_manual(values =mypalette, guide = FALSE) + 
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= "none") +
  labs(fill = "Significance") +
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
p_salt_del_80 <- p

# salt evo in 120
p <- ggplot(my[my$mpasp == 1.2 & my$epo %in% c("SALT_A", "SALT_B"),], aes(x=dw, color = treat, fill = treat), weight = re_dw / mean(re_dw, na.rm = T)) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = myrugalpha)+
  xlim(myxlim_c3) +
  ylim(c(NA,myymax42_43)) +
  scale_color_manual(values =mypalette, guide = FALSE) + 
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= "none") +
  labs(fill = "Significance") +
  ylab("")+ xlab("")+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
p_salt_del_120 <- p

# Plot using grid and output ---------------------------------------------------
pdf(file = "000_SALT_fit_byenv_cbytreat_full.pdf", width = mywidth, height = myheight)
grid.arrange( grid::textGrob("CM, No Stress", gp =grid::gpar(fontsize = 8, fontface = "bold"), rot = 90),
              grid::textGrob("CM + Salt 40", gp =grid::gpar(fontsize = 8, fontface = "bold"), rot = 90),
              grid::textGrob("CM + Salt 80", gp =grid::gpar(fontsize = 8, fontface = "bold"), rot = 90),
              grid::textGrob("CM + Salt 120", gp =grid::gpar(fontsize = 8, fontface = "bold"), rot = 90),
              p_salt_anc_0,p_salt_anc_40,p_salt_anc_80,p_salt_anc_120,
              p_salt_evo_0,p_salt_evo_40,p_salt_evo_80,p_salt_evo_120,
              p_salt_del_0,p_salt_del_40,p_salt_del_80,p_salt_del_120,
             legend, 
             grid::textGrob("", gp =grid::gpar(fontsize = 8)),
             grid::textGrob("Generation-0", gp =grid::gpar(fontsize = 12, fontface = "bold")),
             grid::textGrob("Generation-500", gp =grid::gpar(fontsize = 12, fontface = "bold")),
             grid::textGrob("Delta", gp =grid::gpar(fontsize = 12, fontface = "bold")),
  layout_matrix = rbind(c(18, 18,19,19,18, 18,20,20,18,  18,21,21,18,  18, 18),
                        c(1,  5,5,5,5,     9,9,9,9,      13,13,13,13,  17, 18),
                        c(1,  5,5,5,5,     9,9,9,9,      13,13,13,13,  18, 18),
                        c(2,  6,6,6,6,     10,10,10,10,  14,14,14,14,  18, 18),
                        c(2,  6,6,6,6,     10,10,10,10,  14,14,14,14,  18, 18),
                        c(3,  7,7,7,7,     11,11,11,11,  15,15,15,15,  18, 18),
                        c(3,  7,7,7,7,     11,11,11,11,  15,15,15,15,  18, 18),
                        c(4,  8,8,8,8,     12,12,12,12,  16,16,16,16,  18, 18),
                        c(4,  8,8,8,8,     12,12,12,12,  16,16,16,16,  18, 18)),
  top = grid::textGrob("\n Yeast Fitness (SALT) in Complete Media and Salt Stress Environments", gp =grid::gpar(fontsize = 14, fontface = "bold")))
dev.off() # one column wide, equal height

# ----------------------------
rm(legend, my, p, p_salt_anc_0,  p_salt_anc_40,  p_salt_anc_80,  p_salt_anc_120,
    p_salt_evo_0,  p_salt_evo_40,  p_salt_evo_80,  p_salt_evo_120,
    p_salt_del_0,  p_salt_del_40,  p_salt_del_80,  p_salt_del_120, mybinwidth,
   myfillapha, myheight, myhighlight, mypalette, myrugalpha, mytextsize, mywidth,
   myxlab, myxlim_c1_c2, myxlim_c3, myylab, myymax11, myymax12_13, myymax21, myymax22_23,
   myymax31, myymax32_33, myymax41, myymax42_43)
```



# Plot: COPRA COPRB ancestral and evolved fitness in CM,copr40, copr80, copr120
```{R}
my <- myd
my$treat <- factor(my$treat, levels = c("EH0", "EH0_40", "EH40", "EH20_60", "EH0_80", "EH40_80", "EH80")) # reorder the treat factor

# set universal vars -----------------------------------------------------------
mybinwidth <- 0.01
myylab <- "Count"
myxlab <- "fitness"
myhighlight <- "black"
myfillapha <- 0.95
myrugalpha <- 0.2
mypalette <- incpalette_br_cy
mytextsize <- 8
myheight <- 11
mywidth <- 8.5
myxlim_c1_c2 <- c(0.6, 1.8)
myxlim_c3 <- c(-0.5, 0.9)
myymax11 <- 400
myymax12_13 <- 60
myymax21 <- 400
myymax22_23 <- 60
myymax31 <- 400
myymax32_33 <- 20
myymax41 <- 120
myymax42_43 <- 15

# copr anc -----------------------------
# copr anc in 0
p <- ggplot(my[my$mpasp == 0.0 & my$epo %in% c("COPR_A", "COPR_B"),], aes(x=fit0, color = treat, fill = treat), weight = re_fit_a / mean(re_fit_a, na.rm = T)) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = myrugalpha)+
  xlim(myxlim_c1_c2) +
  ylim(c(NA,myymax11)) +
  scale_color_manual(values =mypalette, guide = FALSE) + 
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= c(0.7,0.7), legend.key.size = unit(.20, "cm")) +
  labs(fill = "Treatment") +
  ylab(myylab)+ xlab("")+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
legend <- get_legend(p)
p <- p + theme(legend.position="none")
p_copr_anc_0 <- p

# copr anc in 40
p <- ggplot(my[my$mpasp == 0.4 & my$epo %in% c("COPR_A", "COPR_B"),], aes(x=fit0, color = treat, fill = treat), weight = re_fit_a / mean(re_fit_a, na.rm = T)) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = myrugalpha)+
  xlim(myxlim_c1_c2) +
  ylim(c(NA,myymax21)) +
  scale_color_manual(values =mypalette, guide = FALSE) + 
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= "none") +
  labs(fill = "Significance") +
  ylab(myylab)+ xlab("")+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
p_copr_anc_40 <- p

# copr anc in 80
p <- ggplot(my[my$mpasp == 0.8 & my$epo %in% c("COPR_A", "COPR_B"),], aes(x=fit0, color = treat, fill = treat), weight = re_fit_a / mean(re_fit_a, na.rm = T)) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = myrugalpha)+
  xlim(myxlim_c1_c2) +
  ylim(c(NA,myymax31)) +
  scale_color_manual(values =mypalette, guide = FALSE) + 
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= "none") +
  labs(fill = "Significance") +
  ylab(myylab)+ xlab("")+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
p_copr_anc_80 <- p

# copr anc in 120
p <- ggplot(my[my$mpasp == 1.2 & my$epo %in% c("COPR_A", "COPR_B"),], aes(x=fit0, color = treat, fill = treat), weight = re_fit_a / mean(re_fit_a, na.rm = T)) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = myrugalpha)+
  xlim(myxlim_c1_c2) +
  ylim(c(NA,myymax41)) +
  scale_color_manual(values =mypalette, guide = FALSE) + 
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= "none") +
  labs(fill = "Significance") +
  ylab(myylab)+ xlab(myxlab)+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
p_copr_anc_120 <- p

# copr evo -----------------------------
# copr evo in 0
p <- ggplot(my[my$mpasp == 0.0 & my$epo %in% c("COPR_A", "COPR_B"),], aes(x=fit500, color = treat, fill = treat), weight = re_fit_e / mean(re_fit_e, na.rm = T)) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = myrugalpha)+
  xlim(myxlim_c1_c2) +
  ylim(c(NA,myymax12_13)) +
  scale_color_manual(values =mypalette, guide = FALSE) + 
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= "none") +
  labs(fill = "Significance") +
  ylab("")+ xlab("")+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
p_copr_evo_0 <- p

# copr evo in 40
p <- ggplot(my[my$mpasp == 0.4 & my$epo %in% c("COPR_A", "COPR_B"),], aes(x=fit500, color = treat, fill = treat), weight = re_fit_e / mean(re_fit_e, na.rm = T)) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = myrugalpha)+
  xlim(myxlim_c1_c2) +
  ylim(c(NA,myymax22_23)) +
  scale_color_manual(values =mypalette, guide = FALSE) + 
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= "none") +
  labs(fill = "Significance") +
  ylab("")+ xlab("")+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
p_copr_evo_40 <- p

# copr evo in 80
p <- ggplot(my[my$mpasp == 0.8 & my$epo %in% c("COPR_A", "COPR_B"),], aes(x=fit500, color = treat, fill = treat), weight = re_fit_e / mean(re_fit_e, na.rm = T)) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = myrugalpha)+
  xlim(myxlim_c1_c2) +
  ylim(c(NA,myymax32_33)) +
  scale_color_manual(values =mypalette, guide = FALSE) + 
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= "none") +
  labs(fill = "Significance") +
  ylab("")+ xlab("")+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
p_copr_evo_80 <- p

# copr evo in 120
p <- ggplot(my[my$mpasp == 1.2 & my$epo %in% c("COPR_A", "COPR_B"),], aes(x=fit500, color = treat, fill = treat), weight = re_fit_e / mean(re_fit_e, na.rm = T)) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = myrugalpha)+
  xlim(myxlim_c1_c2) +
  ylim(c(NA,myymax42_43)) +
  scale_color_manual(values =mypalette, guide = FALSE) + 
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= "none") +
  labs(fill = "Significance") +
  ylab("")+ xlab("")+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
p_copr_evo_120 <- p

# copr delta -----------------------------
# copr delta in 0
p <- ggplot(my[my$mpasp == 0.0 & my$epo %in% c("COPR_A", "COPR_B"),], aes(x=dw, color = treat, fill = treat), weight = re_dw / mean(re_dw, na.rm = T)) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = myrugalpha)+
  xlim(myxlim_c3) +
  ylim(c(NA,myymax12_13)) +
  scale_color_manual(values =mypalette, guide = FALSE) + 
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= "none") +
  labs(fill = "Significance") +
  ylab("")+ xlab("")+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
p_copr_del_0 <- p

# copr evo in 40
p <- ggplot(my[my$mpasp == 0.4 & my$epo %in% c("COPR_A", "COPR_B"),], aes(x=dw, color = treat, fill = treat), weight = re_dw / mean(re_dw, na.rm = T)) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = myrugalpha)+
  xlim(myxlim_c3) +
  ylim(c(NA,myymax22_23)) +
  scale_color_manual(values =mypalette, guide = FALSE) + 
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= "none") +
  labs(fill = "Significance") +
  ylab("")+ xlab("")+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
p_copr_del_40 <- p

# copr evo in 80
p <- ggplot(my[my$mpasp == 0.8 & my$epo %in% c("COPR_A", "COPR_B"),], aes(x=dw, color = treat, fill = treat), weight = re_dw / mean(re_dw, na.rm = T)) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = myrugalpha)+
  xlim(myxlim_c3) +
  ylim(c(NA,myymax32_33)) +
  scale_color_manual(values =mypalette, guide = FALSE) + 
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= "none") +
  labs(fill = "Significance") +
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
p_copr_del_80 <- p

# copr evo in 120
p <- ggplot(my[my$mpasp == 1.2 & my$epo %in% c("COPR_A", "COPR_B"),], aes(x=dw, color = treat, fill = treat), weight = re_dw / mean(re_dw, na.rm = T)) +
  geom_histogram(alpha = myfillapha, position = "stack", binwidth = mybinwidth, lwd = 0, lty = 0) +
  geom_rug(alpha = myrugalpha)+
  xlim(myxlim_c3) +
  ylim(c(NA,myymax42_43)) +
  scale_color_manual(values =mypalette, guide = FALSE) + 
  scale_fill_manual(values =mypalette) +
  theme_classic() +
  theme(legend.position= "none") +
  labs(fill = "Significance") +
  ylab("")+ xlab("")+
  theme(axis.title.y = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = mytextsize, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = mytextsize, angle = 0))+
  theme(axis.text.x = element_text(size = mytextsize, angle = 0))+
  theme(legend.title = element_text(size = mytextsize, face = "bold"))+
  theme(legend.text = element_text(size = mytextsize))
p_copr_del_120 <- p

# Plot using grid and output ---------------------------------------------------
pdf(file = "000_COPR_fit_byenv_cbytreat_full.pdf", width = mywidth, height = myheight)
grid.arrange( grid::textGrob("CM, No Stress", gp =grid::gpar(fontsize = 8, fontface = "bold"), rot = 90),
              grid::textGrob("CM + Copr 40", gp =grid::gpar(fontsize = 8, fontface = "bold"), rot = 90),
              grid::textGrob("CM + Copr 80", gp =grid::gpar(fontsize = 8, fontface = "bold"), rot = 90),
              grid::textGrob("CM + Copr 120", gp =grid::gpar(fontsize = 8, fontface = "bold"), rot = 90),
              p_copr_anc_0,p_copr_anc_40,p_copr_anc_80,p_copr_anc_120,
              p_copr_evo_0,p_copr_evo_40,p_copr_evo_80,p_copr_evo_120,
              p_copr_del_0,p_copr_del_40,p_copr_del_80,p_copr_del_120,
             legend, 
             grid::textGrob("", gp =grid::gpar(fontsize = 8)),
             grid::textGrob("Generation-0", gp =grid::gpar(fontsize = 12, fontface = "bold")),
             grid::textGrob("Generation-500", gp =grid::gpar(fontsize = 12, fontface = "bold")),
             grid::textGrob("Delta", gp =grid::gpar(fontsize = 12, fontface = "bold")),
  layout_matrix = rbind(c(18, 18,19,19,18, 18,20,20,18,  18,21,21,18,  18, 18),
                        c(1,  5,5,5,5,     9,9,9,9,      13,13,13,13,  17, 18),
                        c(1,  5,5,5,5,     9,9,9,9,      13,13,13,13,  18, 18),
                        c(2,  6,6,6,6,     10,10,10,10,  14,14,14,14,  18, 18),
                        c(2,  6,6,6,6,     10,10,10,10,  14,14,14,14,  18, 18),
                        c(3,  7,7,7,7,     11,11,11,11,  15,15,15,15,  18, 18),
                        c(3,  7,7,7,7,     11,11,11,11,  15,15,15,15,  18, 18),
                        c(4,  8,8,8,8,     12,12,12,12,  16,16,16,16,  18, 18),
                        c(4,  8,8,8,8,     12,12,12,12,  16,16,16,16,  18, 18)),
  top = grid::textGrob("\n Yeast Fitness (COPR) in Complete Media and Copr Stress Environments", gp =grid::gpar(fontsize = 14, fontface = "bold")))
dev.off() # one column wide, equal height

# ----------------------------
rm(legend, my, p, p_copr_anc_0,  p_copr_anc_40,  p_copr_anc_80,  p_copr_anc_120,
    p_copr_evo_0,  p_copr_evo_40,  p_copr_evo_80,  p_copr_evo_120,
    p_copr_del_0,  p_copr_del_40,  p_copr_del_80,  p_copr_del_120, mybinwidth,
   myfillapha, myheight, myhighlight, mypalette, myrugalpha, mytextsize, mywidth,
   myxlab, myxlim_c1_c2, myxlim_c3, myylab, myymax11, myymax12_13, myymax21, myymax22_23,
   myymax31, myymax32_33, myymax41, myymax42_43)
```








ASSESS: FITNESS CHANGE IN 500 GENERATIONS OF EVOLUTION
First, need to create an appropriate data frame with 1 entry per bcpID (rather than 4 reps)
```{r}
# create the frame, omitting most cols not necessary for these upcoming plots and tests.
my <- myd
my <- my[,c(1:7, 83:88, 112, 123, 126)] # reatain only interst columns
my1 <- my[my$mpar == 1,] # r1
my2 <- my[my$mpar == 2,]; colnames(my2) <- paste0(colnames(my2), "_2") # r2
my3 <- my[my$mpar == 3,]; colnames(my3) <- paste0(colnames(my3), "_3") # r3
my4 <- my[my$mpar == 4,]; colnames(my4) <- paste0(colnames(my4), "_4") # r4
my <- cbind(my1, my2$re_dw_2, my2$dw_2, my3$re_dw_3, my3$dw_3, my4$re_dw_4, my4$dw_4) # zip
colnames(my)[c((ncol(my)-5)):ncol(my)] <- c("re_dw_2", "dw_2", "re_dw_3", "dw_3", "re_dw_4", "dw_4") # name fix
mn_dw <- apply(my, 1, function(x) weighted.mean(as.numeric(x[c( "dw", "dw_2", "dw_3", "dw_4")]), 
                                                  as.numeric(x[c( "re_dw","re_dw_2","re_dw_3","re_dw_4")]), na.rm = T)) # calculate wtd.mean dw across reps
my$mn_dw <- mn_dw; my$mn_dw[is.nan(my$mn_dw)] <- NA # fix nans
my$omit <- F; my$omit[is.na(my$mn_dw)] <- T # update omit field
mn_re_dw <- apply(my, 1, function(x) mean(as.numeric(x[c( "re_dw", "re_dw_2", "re_dw_3", "re_dw_4")]), na.rm =T)) # calculate reads for mn_dw
my$mn_re_dw <- mn_re_dw # assign
mydwc <- my # name frame

# While we are at it lets make a wide version as well, this will be needed later.
my <- mydwc
my0 <- my[my$mpasp == 0.0,]
my40 <- my[my$mpasp == 0.4,]
my80 <- my[my$mpasp == 0.8,]
my120 <- my[my$mpasp == 1.2,]
sum(my0$bcpID != my40$bcpID)
my <- cbind(my0, my40$mn_dw, my40$mn_re_dw, my80$mn_dw, my80$mn_re_dw, my120$mn_dw, my120$mn_re_dw)
colnames(my)[c(23:30)] <- c("mn_dw_0", "mn_re_dw_0","mn_dw_40", "mn_re_dw_40", "mn_dw_80", "mn_re_dw_80", "mn_dw_120", "mn_re_dw_120")
mydwcw <- my

# ------------------
rm(my, my1, my2, my3, my4, mn_dw, mn_re_dw, my0, my40, my80, my120)
```


# SALT first....
# lets set some universal guides for SALT plotting
```{r}
my <- mydwc[!is.na(mydwc$dw),]
my <- my[my$epo %in% c("SALT_A", "SALT_B"),]

mylowlim <- round(min(my$dw, na.rm = T)*1.10, 2)
myhighlim <- round(max(my$dw, na.rm = T)*1.10, 2)
mytitle <- NULL
myylab <- "Fitness change"
myxlab <- "Treatment"
myoutline <-  "grey20"
myfill <-  "grey90"
myptalpha <- 0.5
myrugalpha <- 0.7
mypalette <- setpalette
mytextsize <- 8
myheight <- 3.5
mywidth <- 7
mymeanptsize <- 1
mywtmeanpttype <- 1
mywtmeanptcol <- "black"

# ------------------
rm(my)
```

# SALT evolved in CM
# visualize
```{r}
# data -------------------------------------------------------------------------
my <- mydwc[!is.na(mydwc$mn_dw),]
my <- my[my$mpamt == "CM" & my$mpasp == 0.0 & my$epo %in% c("SALT_A", "SALT_B"),]

# Visualize -------------------------------------------------------------------
my$treat <- factor(my$treat, levels = c("EH0", "EH0_40", "EH40", "EH20_60", "EH0_80", "EH40_80", "EH80"))
myx <- my$treat
myy <- my$mn_dw
myr <- my$mn_re_dw
myc <- my$treat
myptsize <- ((((myr/max(myr))*10)*((myheight*mywidth)/(3.5*7*3))) - min(((myr/max(myr))*10)*((myheight*mywidth)/(3.5*7*3))))+0.5

p <- ggplot(my, aes(x=myx, y=myy, weight = myr, color = myc)) +
  geom_violin(color = myoutline, fill = myfill, draw_quantiles = NULL, inherit.aes = F, aes( x=myx, y=myy), trim = T) + 
  geom_jitter(width =0.15, height = 0, alpha = myptalpha, size = myptsize) +
  geom_rug(sides = "b" , position = position_nudge(x=-0.75), alpha = myrugalpha)+
  geom_point(stat="summary", fun.y="mean", color = mywtmeanptcol, cex = mymeanptsize) + 
  geom_errorbar(stat="summary", fun.data = "mean_se",color = mywtmeanptcol, width = 0.0, lwd =0.5)+
  geom_point(x=7,y = weighted.mean(myy[myx == "EH80"], myr[myx == "EH80"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=6,y = weighted.mean(myy[myx == "EH40_80"], myr[myx == "EH40_80"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=5,y = weighted.mean(myy[myx == "EH0_80"], myr[myx == "EH0_80"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=4,y = weighted.mean(myy[myx == "EH20_60"], myr[myx == "EH20_60"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=3,y = weighted.mean(myy[myx == "EH40"], myr[myx == "EH40"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=2,y = weighted.mean(myy[myx == "EH0_40"], myr[myx == "EH0_40"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=1,y = weighted.mean(myy[myx == "EH0"], myr[myx == "EH0"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  scale_color_manual(values =mypalette) + 
  geom_hline(yintercept = 0, lty = "dotted") + 
  coord_flip() +
  theme_classic()+
  theme(legend.position="none") +
  ggtitle(mytitle) + ylab(myylab) + xlab(myxlab)+
  scale_x_discrete(labels = c("EH0", "EH0_40", "EH40", "EH20_60", "EH0_80", "EH40_80", "EH80")) +
  scale_y_continuous(breaks = seq(mylowlim, myhighlim,by=.05),
                     limits = c(mylowlim, myhighlim),
                     labels = scales::number_format(accuracy = 0.01))+
  theme(axis.title.y = element_text(size = 8, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = 8, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = 8, angle = 0))+
  theme(axis.text.x = element_text(size = 8, angle = 0))
p 
# figure output ---------------------------------------------------------------
pdf(file = "000_SALTinCM.pdf", width = mywidth, height = myheight); p; dev.off()
```

# models
```{r}
# MODELS -----------------------------------------------------------------------
my <- myd[!is.na(myd$dw),] 
my <- my[my$mpamt == "CM" & my$mpasp == 0.0 & my$epo %in% c("SALT_A", "SALT_B"),]

my$treat <- relevel(my$treat, ref = "EH0")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

# model eval ---------------------------
# hist(residuals(mymod), breaks = 100)
# hist(expand_residuals(mymod, my$re_dw), breaks = 100) # this more accurately represents the distribution of residuals in the model output. -- tails look fine here. 
# anova(mymod) # test term significance
# --------------------------------------

# run same model with ea of the 7 treats as base level -------------------------
my$treat <- relevel(my$treat, ref = "EH40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
my$treat <- relevel(my$treat, ref = "EH80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
my$treat <- relevel(my$treat, ref = "EH0_40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
my$treat <- relevel(my$treat, ref = "EH20_60")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
my$treat <- relevel(my$treat, ref = "EH0_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
my$treat <- relevel(my$treat, ref = "EH40_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
# ------------------------------------------------------------------------------

# ------------------
rm(my, myx, myy, myr, myc, myptsize, p, mymod)
```




# SALT evolved in SALT 0.4
# visualize
```{r}
# data -------------------------------------------------------------------------
my <- mydwc[!is.na(mydwc$mn_dw),]
my <- my[my$mpamt == "SALT" & my$mpasp == 0.4 & my$epo %in% c("SALT_A", "SALT_B"),]

# Visualize -------------------------------------------------------------------
my$treat <- factor(my$treat, levels = c("EH0", "EH0_40", "EH40", "EH20_60", "EH0_80", "EH40_80", "EH80"))
myx <- my$treat
myy <- my$mn_dw
myr <- my$mn_re_dw
myc <- my$treat
myptsize <- ((((myr/max(myr))*10)*((myheight*mywidth)/(3.5*7*3))) - min(((myr/max(myr))*10)*((myheight*mywidth)/(3.5*7*3))))+0.5

p <- ggplot(my, aes(x=myx, y=myy, weight = myr, color = myc)) +
  geom_violin(color = myoutline, fill = myfill, draw_quantiles = NULL, inherit.aes = F, aes( x=myx, y=myy), trim = T) + 
  geom_jitter(width =0.15, height = 0, alpha = myptalpha, size = myptsize) +
  geom_rug(sides = "b" , position = position_nudge(x=-0.75), alpha = myrugalpha)+
  geom_point(stat="summary", fun.y="mean", color = mywtmeanptcol, cex = mymeanptsize) + 
  geom_errorbar(stat="summary", fun.data = "mean_se",color = mywtmeanptcol, width = 0.0, lwd =0.5)+
  geom_point(x=7,y = weighted.mean(myy[myx == "EH80"], myr[myx == "EH80"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=6,y = weighted.mean(myy[myx == "EH40_80"], myr[myx == "EH40_80"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=5,y = weighted.mean(myy[myx == "EH0_80"], myr[myx == "EH0_80"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=4,y = weighted.mean(myy[myx == "EH20_60"], myr[myx == "EH20_60"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=3,y = weighted.mean(myy[myx == "EH40"], myr[myx == "EH40"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=2,y = weighted.mean(myy[myx == "EH0_40"], myr[myx == "EH0_40"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=1,y = weighted.mean(myy[myx == "EH0"], myr[myx == "EH0"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  scale_color_manual(values =mypalette) + 
  geom_hline(yintercept = 0, lty = "dotted") + 
  coord_flip() +
  theme_classic()+
  theme(legend.position="none") +
  ggtitle(mytitle) + ylab(myylab) + xlab(myxlab)+
  scale_x_discrete(labels = c("EH0", "EH0_40", "EH40", "EH20_60", "EH0_80", "EH40_80", "EH80")) +
  scale_y_continuous(breaks = seq(mylowlim, myhighlim,by=.05),
                     limits = c(mylowlim, myhighlim),
                     labels = scales::number_format(accuracy = 0.01))+
  theme(axis.title.y = element_text(size = 8, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = 8, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = 8, angle = 0))+
  theme(axis.text.x = element_text(size = 8, angle = 0))
p 
# figure output ---------------------------------------------------------------
pdf(file = "000_SALTinSALT40.pdf", width = mywidth, height = myheight); p; dev.off()
```

# models
```{r}
# MODELS -----------------------------------------------------------------------
my <- myd[!is.na(myd$dw),] 
my <- my[my$mpamt == "SALT" & my$mpasp == 0.4 & my$epo %in% c("SALT_A", "SALT_B"),]

my$treat <- relevel(my$treat, ref = "EH0")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

# model eval ---------------------------
# hist(residuals(mymod), breaks = 100)
# hist(expand_residuals(mymod, my$re_dw), breaks = 100) # this more accurately represents the distribution of residuals in the model output. -- tails look fine here. 
# anova(mymod) # test term significance
# --------------------------------------

# run same model with ea of the 7 treats as base level -------------------------
my$treat <- relevel(my$treat, ref = "EH40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
my$treat <- relevel(my$treat, ref = "EH80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
my$treat <- relevel(my$treat, ref = "EH0_40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
my$treat <- relevel(my$treat, ref = "EH20_60")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
my$treat <- relevel(my$treat, ref = "EH0_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
my$treat <- relevel(my$treat, ref = "EH40_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
# ------------------------------------------------------------------------------

# ------------------
rm(my, myx, myy, myr, myc, myptsize, p, mymod)
```





# SALT evolved in SALT 0.8
# visualize
```{r}
# data -------------------------------------------------------------------------
my <- mydwc[!is.na(mydwc$mn_dw),]
my <- my[my$mpamt == "SALT" & my$mpasp == 0.8 & my$epo %in% c("SALT_A", "SALT_B"),]

# Visualize -------------------------------------------------------------------
my$treat <- factor(my$treat, levels = c("EH0", "EH0_40", "EH40", "EH20_60", "EH0_80", "EH40_80", "EH80"))
myx <- my$treat
myy <- my$mn_dw
myr <- my$mn_re_dw
myc <- my$treat
myptsize <- ((((myr/max(myr))*10)*((myheight*mywidth)/(3.5*7*3))) - min(((myr/max(myr))*10)*((myheight*mywidth)/(3.5*7*3))))+0.5

p <- ggplot(my, aes(x=myx, y=myy, weight = myr, color = myc)) +
  geom_violin(color = myoutline, fill = myfill, draw_quantiles = NULL, inherit.aes = F, aes( x=myx, y=myy), trim = T) + 
  geom_jitter(width =0.15, height = 0, alpha = myptalpha, size = myptsize) +
  geom_rug(sides = "b" , position = position_nudge(x=-0.75), alpha = myrugalpha)+
  geom_point(stat="summary", fun.y="mean", color = mywtmeanptcol, cex = mymeanptsize) + 
  geom_errorbar(stat="summary", fun.data = "mean_se",color = mywtmeanptcol, width = 0.0, lwd =0.5)+
  geom_point(x=7,y = weighted.mean(myy[myx == "EH80"], myr[myx == "EH80"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=6,y = weighted.mean(myy[myx == "EH40_80"], myr[myx == "EH40_80"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=5,y = weighted.mean(myy[myx == "EH0_80"], myr[myx == "EH0_80"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=4,y = weighted.mean(myy[myx == "EH20_60"], myr[myx == "EH20_60"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=3,y = weighted.mean(myy[myx == "EH40"], myr[myx == "EH40"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=2,y = weighted.mean(myy[myx == "EH0_40"], myr[myx == "EH0_40"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=1,y = weighted.mean(myy[myx == "EH0"], myr[myx == "EH0"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  scale_color_manual(values =mypalette) + 
  geom_hline(yintercept = 0, lty = "dotted") + 
  coord_flip() +
  theme_classic()+
  theme(legend.position="none") +
  ggtitle(mytitle) + ylab(myylab) + xlab(myxlab)+
  scale_x_discrete(labels = c("EH0", "EH0_40", "EH40", "EH20_60", "EH0_80", "EH40_80", "EH80")) +
  scale_y_continuous(breaks = seq(mylowlim, myhighlim,by=.05),
                     limits = c(mylowlim, myhighlim),
                     labels = scales::number_format(accuracy = 0.01))+
  theme(axis.title.y = element_text(size = 8, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = 8, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = 8, angle = 0))+
  theme(axis.text.x = element_text(size = 8, angle = 0))
p 
# figure output ---------------------------------------------------------------
pdf(file = "000_SALTinSALT80.pdf", width = mywidth, height = myheight); p; dev.off()
```

# models
```{r}
# MODELS -----------------------------------------------------------------------
my <- myd[!is.na(myd$dw),] 
my <- my[my$mpamt == "SALT" & my$mpasp == 0.8 & my$epo %in% c("SALT_A", "SALT_B"),]

my$treat <- relevel(my$treat, ref = "EH0")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

# model eval ---------------------------
# hist(residuals(mymod), breaks = 100)
# hist(expand_residuals(mymod, my$re_dw), breaks = 100) # this more accurately represents the distribution of residuals in the model output. -- tails look fine here. 
# anova(mymod) # test term significance
# --------------------------------------

# run same model with ea of the 7 treats as base level -------------------------
my$treat <- relevel(my$treat, ref = "EH40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
my$treat <- relevel(my$treat, ref = "EH80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
my$treat <- relevel(my$treat, ref = "EH0_40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
my$treat <- relevel(my$treat, ref = "EH20_60")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
my$treat <- relevel(my$treat, ref = "EH0_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
my$treat <- relevel(my$treat, ref = "EH40_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
# ------------------------------------------------------------------------------

# ------------------
rm(my, myx, myy, myr, myc, myptsize, p, mymod)
```





# SALT evolved in SALT 1.2
# visualize
```{r}
# data -------------------------------------------------------------------------
my <- mydwc[!is.na(mydwc$mn_dw),]
my <- my[my$mpamt == "SALT" & my$mpasp == 1.2 & my$epo %in% c("SALT_A", "SALT_B"),]

# Visualize -------------------------------------------------------------------
my$treat <- factor(my$treat, levels = c("EH0", "EH0_40", "EH40", "EH20_60", "EH0_80", "EH40_80", "EH80"))
myx <- my$treat
myy <- my$mn_dw
myr <- my$mn_re_dw
myc <- my$treat
myptsize <- ((((myr/max(myr))*10)*((myheight*mywidth)/(3.5*7*3))) - min(((myr/max(myr))*10)*((myheight*mywidth)/(3.5*7*3))))+0.5

p <- ggplot(my, aes(x=myx, y=myy, weight = myr, color = myc)) +
  geom_violin(color = myoutline, fill = myfill, draw_quantiles = NULL, inherit.aes = F, aes( x=myx, y=myy), trim = T) + 
  geom_jitter(width =0.15, height = 0, alpha = myptalpha, size = myptsize) +
  geom_rug(sides = "b" , position = position_nudge(x=-0.75), alpha = myrugalpha)+
  geom_point(stat="summary", fun.y="mean", color = mywtmeanptcol, cex = mymeanptsize) + 
  geom_errorbar(stat="summary", fun.data = "mean_se",color = mywtmeanptcol, width = 0.0, lwd =0.5)+
  geom_point(x=7,y = weighted.mean(myy[myx == "EH80"], myr[myx == "EH80"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=6,y = weighted.mean(myy[myx == "EH40_80"], myr[myx == "EH40_80"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=5,y = weighted.mean(myy[myx == "EH0_80"], myr[myx == "EH0_80"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=4,y = weighted.mean(myy[myx == "EH20_60"], myr[myx == "EH20_60"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=3,y = weighted.mean(myy[myx == "EH40"], myr[myx == "EH40"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=2,y = weighted.mean(myy[myx == "EH0_40"], myr[myx == "EH0_40"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=1,y = weighted.mean(myy[myx == "EH0"], myr[myx == "EH0"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  scale_color_manual(values =mypalette) + 
  geom_hline(yintercept = 0, lty = "dotted") + 
  coord_flip() +
  theme_classic()+
  theme(legend.position="none") +
  ggtitle(mytitle) + ylab(myylab) + xlab(myxlab)+
  scale_x_discrete(labels = c("EH0", "EH0_40", "EH40", "EH20_60", "EH0_80", "EH40_80", "EH80")) +
  scale_y_continuous(breaks = seq(mylowlim, myhighlim,by=.05),
                     limits = c(mylowlim, myhighlim),
                     labels = scales::number_format(accuracy = 0.01))+
  theme(axis.title.y = element_text(size = 8, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = 8, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = 8, angle = 0))+
  theme(axis.text.x = element_text(size = 8, angle = 0))
p 
# figure output ---------------------------------------------------------------
pdf(file = "000_SALTinSALT120.pdf", width = mywidth, height = myheight); p; dev.off()
```

# models
```{r}
# MODELS -----------------------------------------------------------------------
my <- myd[!is.na(myd$dw),] 
my <- my[my$mpamt == "SALT" & my$mpasp == 1.2 & my$epo %in% c("SALT_A", "SALT_B"),]

my$treat <- relevel(my$treat, ref = "EH0")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

# model eval ---------------------------
# hist(residuals(mymod), breaks = 100)
# hist(expand_residuals(mymod, my$re_dw), breaks = 100) # this more accurately represents the distribution of residuals in the model output. -- tails look fine here. 
# anova(mymod) # test term significance
# --------------------------------------

# run same model with ea of the 7 treats as base level -------------------------
my$treat <- relevel(my$treat, ref = "EH40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
my$treat <- relevel(my$treat, ref = "EH80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
my$treat <- relevel(my$treat, ref = "EH0_40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
my$treat <- relevel(my$treat, ref = "EH20_60")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
my$treat <- relevel(my$treat, ref = "EH0_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
my$treat <- relevel(my$treat, ref = "EH40_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
# ------------------------------------------------------------------------------

# ------------------
rm(my, myx, myy, myr, myc, myptsize, p, mymod)
```




# COPR next....
# lets set some universal guides for COPR plotting
```{r}
my <- mydwc[!is.na(mydwc$dw),]
my <- my[my$epo %in% c("COPR_A", "COPR_B"),]

mylowlim <- round(min(my$dw, na.rm = T)*1.10, 2)
myhighlim <- round(max(my$dw, na.rm = T)*1.10, 2)
mytitle <- NULL
myylab <- "Fitness change"
myxlab <- "Treatment"
myoutline <-  "grey20"
myfill <-  "grey90"
myptalpha <- 0.5
myrugalpha <- 0.7
mypalette <- setpalette
mytextsize <- 8
myheight <- 3.5
mywidth <- 7
mymeanptsize <- 1
mywtmeanpttype <- 1
mywtmeanptcol <- "black"

# ------------------
rm(my)
```

# COPR evolved in CM
# visualize
```{r}
# data -------------------------------------------------------------------------
my <- mydwc[!is.na(mydwc$mn_dw),]
my <- my[my$mpamt == "CM" & my$mpasp == 0.0 & my$epo %in% c("COPR_A", "COPR_B"),]

# Visualize -------------------------------------------------------------------
my$treat <- factor(my$treat, levels = c("EH0", "EH0_40", "EH40", "EH20_60", "EH0_80", "EH40_80", "EH80"))
myx <- my$treat
myy <- my$mn_dw
myr <- my$mn_re_dw
myc <- my$treat
myptsize <- ((((myr/max(myr))*10)*((myheight*mywidth)/(3.5*7*3))) - min(((myr/max(myr))*10)*((myheight*mywidth)/(3.5*7*3))))+0.5

p <- ggplot(my, aes(x=myx, y=myy, weight = myr, color = myc)) +
  geom_violin(color = myoutline, fill = myfill, draw_quantiles = NULL, inherit.aes = F, aes( x=myx, y=myy), trim = T) + 
  geom_jitter(width =0.15, height = 0, alpha = myptalpha, size = myptsize) +
  geom_rug(sides = "b" , position = position_nudge(x=-0.75), alpha = myrugalpha)+
  geom_point(stat="summary", fun.y="mean", color = mywtmeanptcol, cex = mymeanptsize) + 
  geom_errorbar(stat="summary", fun.data = "mean_se",color = mywtmeanptcol, width = 0.0, lwd =0.5)+
  geom_point(x=7,y = weighted.mean(myy[myx == "EH80"], myr[myx == "EH80"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=6,y = weighted.mean(myy[myx == "EH40_80"], myr[myx == "EH40_80"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=5,y = weighted.mean(myy[myx == "EH0_80"], myr[myx == "EH0_80"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=4,y = weighted.mean(myy[myx == "EH20_60"], myr[myx == "EH20_60"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=3,y = weighted.mean(myy[myx == "EH40"], myr[myx == "EH40"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=2,y = weighted.mean(myy[myx == "EH0_40"], myr[myx == "EH0_40"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=1,y = weighted.mean(myy[myx == "EH0"], myr[myx == "EH0"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  scale_color_manual(values =mypalette) + 
  geom_hline(yintercept = 0, lty = "dotted") + 
  coord_flip() +
  theme_classic()+
  theme(legend.position="none") +
  ggtitle(mytitle) + ylab(myylab) + xlab(myxlab)+
  scale_x_discrete(labels = c("EH0", "EH0_40", "EH40", "EH20_60", "EH0_80", "EH40_80", "EH80")) +
  scale_y_continuous(breaks = seq(mylowlim, myhighlim,by=.05),
                     limits = c(mylowlim, myhighlim),
                     labels = scales::number_format(accuracy = 0.01))+
  theme(axis.title.y = element_text(size = 8, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = 8, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = 8, angle = 0))+
  theme(axis.text.x = element_text(size = 8, angle = 0))
p 
# figure output ---------------------------------------------------------------
pdf(file = "000_COPRinCM.pdf", width = mywidth, height = myheight); p; dev.off()
```

# models
```{r}
# MODELS -----------------------------------------------------------------------
my <- myd[!is.na(myd$dw),] 
my <- my[my$mpamt == "CM" & my$mpasp == 0.0 & my$epo %in% c("COPR_A", "COPR_B"),]

my$treat <- relevel(my$treat, ref = "EH0")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

# model eval ---------------------------
# hist(residuals(mymod), breaks = 100)
# hist(expand_residuals(mymod, my$re_dw), breaks = 100) # this more accurately represents the distribution of residuals in the model output. -- tails look fine here. 
# anova(mymod) # test term significance
# --------------------------------------

# run same model with ea of the 7 treats as base level -------------------------
my$treat <- relevel(my$treat, ref = "EH40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
my$treat <- relevel(my$treat, ref = "EH80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
my$treat <- relevel(my$treat, ref = "EH0_40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
my$treat <- relevel(my$treat, ref = "EH20_60")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
my$treat <- relevel(my$treat, ref = "EH0_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
my$treat <- relevel(my$treat, ref = "EH40_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
# ------------------------------------------------------------------------------

# ------------------
rm(my, myx, myy, myr, myc, myptsize, p, mymod)
```




# COPR evolved in COPR 0.4
# visualize
```{r}
# data -------------------------------------------------------------------------
my <- mydwc[!is.na(mydwc$mn_dw),]
my <- my[my$mpamt == "COPR" & my$mpasp == 0.4 & my$epo %in% c("COPR_A", "COPR_B"),]

# Visualize -------------------------------------------------------------------
my$treat <- factor(my$treat, levels = c("EH0", "EH0_40", "EH40", "EH20_60", "EH0_80", "EH40_80", "EH80"))
myx <- my$treat
myy <- my$mn_dw
myr <- my$mn_re_dw
myc <- my$treat
myptsize <- ((((myr/max(myr))*10)*((myheight*mywidth)/(3.5*7*3))) - min(((myr/max(myr))*10)*((myheight*mywidth)/(3.5*7*3))))+0.5

p <- ggplot(my, aes(x=myx, y=myy, weight = myr, color = myc)) +
  geom_violin(color = myoutline, fill = myfill, draw_quantiles = NULL, inherit.aes = F, aes( x=myx, y=myy), trim = T) + 
  geom_jitter(width =0.15, height = 0, alpha = myptalpha, size = myptsize) +
  geom_rug(sides = "b" , position = position_nudge(x=-0.75), alpha = myrugalpha)+
  geom_point(stat="summary", fun.y="mean", color = mywtmeanptcol, cex = mymeanptsize) + 
  geom_errorbar(stat="summary", fun.data = "mean_se",color = mywtmeanptcol, width = 0.0, lwd =0.5)+
  geom_point(x=7,y = weighted.mean(myy[myx == "EH80"], myr[myx == "EH80"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=6,y = weighted.mean(myy[myx == "EH40_80"], myr[myx == "EH40_80"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=5,y = weighted.mean(myy[myx == "EH0_80"], myr[myx == "EH0_80"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=4,y = weighted.mean(myy[myx == "EH20_60"], myr[myx == "EH20_60"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=3,y = weighted.mean(myy[myx == "EH40"], myr[myx == "EH40"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=2,y = weighted.mean(myy[myx == "EH0_40"], myr[myx == "EH0_40"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=1,y = weighted.mean(myy[myx == "EH0"], myr[myx == "EH0"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  scale_color_manual(values =mypalette) + 
  geom_hline(yintercept = 0, lty = "dotted") + 
  coord_flip() +
  theme_classic()+
  theme(legend.position="none") +
  ggtitle(mytitle) + ylab(myylab) + xlab(myxlab)+
  scale_x_discrete(labels = c("EH0", "EH0_40", "EH40", "EH20_60", "EH0_80", "EH40_80", "EH80")) +
  scale_y_continuous(breaks = seq(mylowlim, myhighlim,by=.05),
                     limits = c(mylowlim, myhighlim),
                     labels = scales::number_format(accuracy = 0.01))+
  theme(axis.title.y = element_text(size = 8, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = 8, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = 8, angle = 0))+
  theme(axis.text.x = element_text(size = 8, angle = 0))
p 
# figure output ---------------------------------------------------------------
pdf(file = "000_COPRinCOPR40.pdf", width = mywidth, height = myheight); p; dev.off()
```

# models
```{r}
# MODELS -----------------------------------------------------------------------
my <- myd[!is.na(myd$dw),] 
my <- my[my$mpamt == "COPR" & my$mpasp == 0.4 & my$epo %in% c("COPR_A", "COPR_B"),]

my$treat <- relevel(my$treat, ref = "EH0")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

# model eval ---------------------------
# hist(residuals(mymod), breaks = 100)
# hist(expand_residuals(mymod, my$re_dw), breaks = 100) # this more accurately represents the distribution of residuals in the model output. -- tails look fine here. 
# anova(mymod) # test term significance
# --------------------------------------

# run same model with ea of the 7 treats as base level -------------------------
my$treat <- relevel(my$treat, ref = "EH40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
my$treat <- relevel(my$treat, ref = "EH80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
my$treat <- relevel(my$treat, ref = "EH0_40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
my$treat <- relevel(my$treat, ref = "EH20_60")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
my$treat <- relevel(my$treat, ref = "EH0_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
my$treat <- relevel(my$treat, ref = "EH40_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
# ------------------------------------------------------------------------------

# ------------------
rm(my, myx, myy, myr, myc, myptsize, p, mymod)
```





# COPR evolved in COPR 0.8
# visualize
```{r}
# data -------------------------------------------------------------------------
my <- mydwc[!is.na(mydwc$mn_dw),]
my <- my[my$mpamt == "COPR" & my$mpasp == 0.8 & my$epo %in% c("COPR_A", "COPR_B"),]

# Visualize -------------------------------------------------------------------
my$treat <- factor(my$treat, levels = c("EH0", "EH0_40", "EH40", "EH20_60", "EH0_80", "EH40_80", "EH80"))
myx <- my$treat
myy <- my$mn_dw
myr <- my$mn_re_dw
myc <- my$treat
myptsize <- ((((myr/max(myr))*10)*((myheight*mywidth)/(3.5*7*3))) - min(((myr/max(myr))*10)*((myheight*mywidth)/(3.5*7*3))))+0.5

p <- ggplot(my, aes(x=myx, y=myy, weight = myr, color = myc)) +
  geom_violin(color = myoutline, fill = myfill, draw_quantiles = NULL, inherit.aes = F, aes( x=myx, y=myy), trim = T) + 
  geom_jitter(width =0.15, height = 0, alpha = myptalpha, size = myptsize) +
  geom_rug(sides = "b" , position = position_nudge(x=-0.75), alpha = myrugalpha)+
  geom_point(stat="summary", fun.y="mean", color = mywtmeanptcol, cex = mymeanptsize) + 
  geom_errorbar(stat="summary", fun.data = "mean_se",color = mywtmeanptcol, width = 0.0, lwd =0.5)+
  geom_point(x=7,y = weighted.mean(myy[myx == "EH80"], myr[myx == "EH80"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=6,y = weighted.mean(myy[myx == "EH40_80"], myr[myx == "EH40_80"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=5,y = weighted.mean(myy[myx == "EH0_80"], myr[myx == "EH0_80"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=4,y = weighted.mean(myy[myx == "EH20_60"], myr[myx == "EH20_60"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=3,y = weighted.mean(myy[myx == "EH40"], myr[myx == "EH40"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=2,y = weighted.mean(myy[myx == "EH0_40"], myr[myx == "EH0_40"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=1,y = weighted.mean(myy[myx == "EH0"], myr[myx == "EH0"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  scale_color_manual(values =mypalette) + 
  geom_hline(yintercept = 0, lty = "dotted") + 
  coord_flip() +
  theme_classic()+
  theme(legend.position="none") +
  ggtitle(mytitle) + ylab(myylab) + xlab(myxlab)+
  scale_x_discrete(labels = c("EH0", "EH0_40", "EH40", "EH20_60", "EH0_80", "EH40_80", "EH80")) +
  scale_y_continuous(breaks = seq(mylowlim, myhighlim,by=.05),
                     limits = c(mylowlim, myhighlim),
                     labels = scales::number_format(accuracy = 0.01))+
  theme(axis.title.y = element_text(size = 8, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = 8, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = 8, angle = 0))+
  theme(axis.text.x = element_text(size = 8, angle = 0))
p 
# figure output ---------------------------------------------------------------
pdf(file = "000_COPRinCOPR80.pdf", width = mywidth, height = myheight); p; dev.off()
```

# models
```{r}
# MODELS -----------------------------------------------------------------------
my <- myd[!is.na(myd$dw),] 
my <- my[my$mpamt == "COPR" & my$mpasp == 0.8 & my$epo %in% c("COPR_A", "COPR_B"),]

my$treat <- relevel(my$treat, ref = "EH0")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

# model eval ---------------------------
# hist(residuals(mymod), breaks = 100)
# hist(expand_residuals(mymod, my$re_dw), breaks = 100) # this more accurately represents the distribution of residuals in the model output. -- tails look fine here. 
# anova(mymod) # test term significance
# --------------------------------------

# run same model with ea of the 7 treats as base level -------------------------
my$treat <- relevel(my$treat, ref = "EH40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
my$treat <- relevel(my$treat, ref = "EH80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
my$treat <- relevel(my$treat, ref = "EH0_40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
my$treat <- relevel(my$treat, ref = "EH20_60")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
my$treat <- relevel(my$treat, ref = "EH0_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
my$treat <- relevel(my$treat, ref = "EH40_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
# ------------------------------------------------------------------------------

# ------------------
rm(my, myx, myy, myr, myc, myptsize, p, mymod)
```





# COPR evolved in COPR 1.2
# visualize
```{r}
# data -------------------------------------------------------------------------
my <- mydwc[!is.na(mydwc$mn_dw),]
my <- my[my$mpamt == "COPR" & my$mpasp == 1.2 & my$epo %in% c("COPR_A", "COPR_B"),]

# Visualize -------------------------------------------------------------------
my$treat <- factor(my$treat, levels = c("EH0", "EH0_40", "EH40", "EH20_60", "EH0_80", "EH40_80", "EH80"))
myx <- my$treat
myy <- my$mn_dw
myr <- my$mn_re_dw
myc <- my$treat
myptsize <- ((((myr/max(myr))*10)*((myheight*mywidth)/(3.5*7*3))) - min(((myr/max(myr))*10)*((myheight*mywidth)/(3.5*7*3))))+0.5

p <- ggplot(my, aes(x=myx, y=myy, weight = myr, color = myc)) +
  geom_violin(color = myoutline, fill = myfill, draw_quantiles = NULL, inherit.aes = F, aes( x=myx, y=myy), trim = T) + 
  geom_jitter(width =0.15, height = 0, alpha = myptalpha, size = myptsize) +
  geom_rug(sides = "b" , position = position_nudge(x=-0.75), alpha = myrugalpha)+
  geom_point(stat="summary", fun.y="mean", color = mywtmeanptcol, cex = mymeanptsize) + 
  geom_errorbar(stat="summary", fun.data = "mean_se",color = mywtmeanptcol, width = 0.0, lwd =0.5)+
  geom_point(x=7,y = weighted.mean(myy[myx == "EH80"], myr[myx == "EH80"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=6,y = weighted.mean(myy[myx == "EH40_80"], myr[myx == "EH40_80"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=5,y = weighted.mean(myy[myx == "EH0_80"], myr[myx == "EH0_80"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=4,y = weighted.mean(myy[myx == "EH20_60"], myr[myx == "EH20_60"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=3,y = weighted.mean(myy[myx == "EH40"], myr[myx == "EH40"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=2,y = weighted.mean(myy[myx == "EH0_40"], myr[myx == "EH0_40"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=1,y = weighted.mean(myy[myx == "EH0"], myr[myx == "EH0"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  scale_color_manual(values =mypalette) + 
  geom_hline(yintercept = 0, lty = "dotted") + 
  coord_flip() +
  theme_classic()+
  theme(legend.position="none") +
  ggtitle(mytitle) + ylab(myylab) + xlab(myxlab)+
  scale_x_discrete(labels = c("EH0", "EH0_40", "EH40", "EH20_60", "EH0_80", "EH40_80", "EH80")) +
  scale_y_continuous(breaks = seq(mylowlim, myhighlim,by=.05),
                     limits = c(mylowlim, myhighlim),
                     labels = scales::number_format(accuracy = 0.01))+
  theme(axis.title.y = element_text(size = 8, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = 8, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = 8, angle = 0))+
  theme(axis.text.x = element_text(size = 8, angle = 0))
p 
# figure output ---------------------------------------------------------------
pdf(file = "000_COPRinCOPR120.pdf", width = mywidth, height = myheight); p; dev.off()
```

# models
```{r}
# MODELS -----------------------------------------------------------------------
my <- myd[!is.na(myd$dw),] 
my <- my[my$mpamt == "COPR" & my$mpasp == 1.2 & my$epo %in% c("COPR_A", "COPR_B"),]

my$treat <- relevel(my$treat, ref = "EH0")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)

# model eval ---------------------------
# hist(residuals(mymod), breaks = 100)
# hist(expand_residuals(mymod, my$re_dw), breaks = 100) # this more accurately represents the distribution of residuals in the model output. -- tails look fine here. 
# anova(mymod) # test term significance
# --------------------------------------

# run same model with ea of the 7 treats as base level -------------------------
my$treat <- relevel(my$treat, ref = "EH40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
my$treat <- relevel(my$treat, ref = "EH80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
my$treat <- relevel(my$treat, ref = "EH0_40")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
my$treat <- relevel(my$treat, ref = "EH20_60")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
my$treat <- relevel(my$treat, ref = "EH0_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
my$treat <- relevel(my$treat, ref = "EH40_80")
mymod <- lmer(my$dw ~ my$treat + (1|my$bcpID), weights = my$re_dw, control=lmerControl(optimizer ="bobyqa",optCtrl=list(maxfun=2e4))); summary(mymod)
# ------------------------------------------------------------------------------

# ------------------
rm(my, myx, myy, myr, myc, myptsize, p, mymod, myfill, myheight, myhighlim, mylowlim, mymeanptsize, myoutline, mypalette, myptalpha, myrugalpha,
   mytextsize, mytitle, mywidth, mywtmeanptcol, mywtmeanpttype, myxlab, myylab)
```




take a look at the rankings of the barcodes in all envs. 
Salt
```{r}
# Set controls for all plots ---------------------------------------------------
mywidth <- 7
myheight <- 7

# SALT in CM -------------------------------------------------------------------
my <- mydwc[mydwc$epo %in% c("SALT_A", "SALT_B") & mydwc$mpasp == 0.0 & mydwc$treat %in% c("EH0","EH0_40","EH40","EH20_60","EH0_80", "EH40_80", "EH80"),] # subset
my$treat <- factor(my$treat, levels = c("EH0", "EH0_40", "EH40", "EH20_60", "EH0_80", "EH40_80", "EH80")) # fix treat levels
my <- my[!is.na(my$mn_dw),] # rm NAs
my <- my[order(my$mn_dw),] # sort so the plot looks good
p<-ggplot(data=my, aes(x=reorder(bcpID, -mn_dw), y=mn_dw, fill = treat)) +
  geom_bar (stat="identity") # plot
p # view plot
pdf(file = "000_rank_SALTinCM.pdf", width = mywidth, height = myheight); p; dev.off() # output plot



# SALT in SALT 040 -------------------------------------------------------------
my <- mydwc[mydwc$epo %in% c("SALT_A", "SALT_B") & mydwc$mpasp == 0.4 & mydwc$treat %in% c("EH0","EH0_40","EH40","EH20_60","EH0_80", "EH40_80", "EH80"),]
my$treat <- factor(my$treat, levels = c("EH0", "EH0_40", "EH40", "EH20_60", "EH0_80", "EH40_80", "EH80"))
my <- my[!is.na(my$mn_dw),]
my <- my[order(my$mn_dw),]
p<-ggplot(data=my, aes(x=reorder(bcpID, -mn_dw), y=mn_dw, fill = treat)) +
  geom_bar (stat="identity")
p
pdf(file = "000_rank_SALTinSALT040.pdf", width = mywidth, height = myheight); p; dev.off()



# SALT in SALT 080 -------------------------------------------------------------
my <- mydwc[mydwc$epo %in% c("SALT_A", "SALT_B") & mydwc$mpasp == 0.8 & mydwc$treat %in% c("EH0","EH0_40","EH40","EH20_60","EH0_80", "EH40_80", "EH80"),]
my$treat <- factor(my$treat, levels = c("EH0", "EH0_40", "EH40", "EH20_60", "EH0_80", "EH40_80", "EH80"))
my <- my[!is.na(my$mn_dw),]
my <- my[order(my$mn_dw),]
p<-ggplot(data=my, aes(x=reorder(bcpID, -mn_dw), y=mn_dw, fill = treat)) +
  geom_bar (stat="identity")
p
pdf(file = "000_rank_SALTinSALT080.pdf", width = mywidth, height = myheight); p; dev.off()



# SALT in SALT 120 -------------------------------------------------------------
my <- mydwc[mydwc$epo %in% c("SALT_A", "SALT_B") & mydwc$mpasp == 1.2 & mydwc$treat %in% c("EH0","EH0_40","EH40","EH20_60","EH0_80", "EH40_80", "EH80"),]
my$treat <- factor(my$treat, levels = c("EH0", "EH0_40", "EH40", "EH20_60", "EH0_80", "EH40_80", "EH80"))
my <- my[!is.na(my$mn_dw),]
my <- my[order(my$mn_dw),]
p<-ggplot(data=my, aes(x=reorder(bcpID, -mn_dw), y=mn_dw, fill = treat)) +
  geom_bar (stat="identity")
p
pdf(file = "000_rank_SALTinSALT120.pdf", width = mywidth, height = myheight); p; dev.off()
```


Copr
```{r}
# Set controls for all plots ---------------------------------------------------
mywidth <- 7
myheight <- 7

# COPR in CM -------------------------------------------------------------------
my <- mydwc[mydwc$epo %in% c("COPR_A", "COPR_B") & mydwc$mpasp == 0.0 & mydwc$treat %in% c("EH0","EH0_40","EH40","EH20_60","EH0_80", "EH40_80", "EH80"),] # subset
my$treat <- factor(my$treat, levels = c("EH0", "EH0_40", "EH40", "EH20_60", "EH0_80", "EH40_80", "EH80")) # fix treat levels
my <- my[!is.na(my$mn_dw),] # rm NAs
my <- my[order(my$mn_dw),] # sort so the plot looks good
p<-ggplot(data=my, aes(x=reorder(bcpID, -mn_dw), y=mn_dw, fill = treat)) +
  geom_bar (stat="identity") # plot
p # view plot
pdf(file = "000_rank_COPRinCM.pdf", width = mywidth, height = myheight); p; dev.off() # output plot



# COPR in COPR 040 -------------------------------------------------------------
my <- mydwc[mydwc$epo %in% c("COPR_A", "COPR_B") & mydwc$mpasp == 0.4 & mydwc$treat %in% c("EH0","EH0_40","EH40","EH20_60","EH0_80", "EH40_80", "EH80"),]
my$treat <- factor(my$treat, levels = c("EH0", "EH0_40", "EH40", "EH20_60", "EH0_80", "EH40_80", "EH80"))
my <- my[!is.na(my$mn_dw),]
my <- my[order(my$mn_dw),]
p<-ggplot(data=my, aes(x=reorder(bcpID, -mn_dw), y=mn_dw, fill = treat)) +
  geom_bar (stat="identity")
p
pdf(file = "000_rank_COPRinCOPR040.pdf", width = mywidth, height = myheight); p; dev.off()



# COPR in COPR 080 -------------------------------------------------------------
my <- mydwc[mydwc$epo %in% c("COPR_A", "COPR_B") & mydwc$mpasp == 0.8 & mydwc$treat %in% c("EH0","EH0_40","EH40","EH20_60","EH0_80", "EH40_80", "EH80"),]
my$treat <- factor(my$treat, levels = c("EH0", "EH0_40", "EH40", "EH20_60", "EH0_80", "EH40_80", "EH80"))
my <- my[!is.na(my$mn_dw),]
my <- my[order(my$mn_dw),]
p<-ggplot(data=my, aes(x=reorder(bcpID, -mn_dw), y=mn_dw, fill = treat)) +
  geom_bar (stat="identity")
p
pdf(file = "000_rank_COPRinCOPR080.pdf", width = mywidth, height = myheight); p; dev.off()



# COPR in COPR 120 -------------------------------------------------------------
my <- mydwc[mydwc$epo %in% c("COPR_A", "COPR_B") & mydwc$mpasp == 1.2 & mydwc$treat %in% c("EH0","EH0_40","EH40","EH20_60","EH0_80", "EH40_80", "EH80"),]
my$treat <- factor(my$treat, levels = c("EH0", "EH0_40", "EH40", "EH20_60", "EH0_80", "EH40_80", "EH80"))
my <- my[!is.na(my$mn_dw),]
my <- my[order(my$mn_dw),]
p<-ggplot(data=my, aes(x=reorder(bcpID, -mn_dw), y=mn_dw, fill = treat)) +
  geom_bar (stat="identity")
p
pdf(file = "000_rank_COPRinCOPR120.pdf", width = mywidth, height = myheight); p; dev.off()

# ----------------------------
rm(myheight, mywidth, my, p)
```



Now for some pairs plots
SALT first. 
```{R}
# Set controls for all plots ---------------------------------------------------
mywidth <- 8
myheight <- mywidth

# ALL ------------------------------------------------------
my <- mydwcw[mydwcw$epo %in% c("SALT_A", "SALT_B"),]
my <- my[,c("treat", "mn_dw_0", "mn_dw_80")]
my$treat <- factor(my$treat, levels = c("EH0", "EH0_40", "EH40", "EH20_60", "EH0_80", "EH40_80", "EH80"))
p <- ggpairs(my,aes(color = treat, alpha = 0.7), title = "ALL")
pdf(file = "000_pairs_SALT_ALL_in_000_&_040.pdf", width = mywidth, height = myheight); p; dev.off()

# specialist vs. generalists: low stress end ---------------
my <- mydwcw[mydwcw$treat %in% c("EH0", "EH40", "EH0_40"),]
my <- my[my$epo %in% c("SALT_A", "SALT_B"),]
my <- my[,c("treat", "mn_dw_0", "mn_dw_40")]
p <- ggpairs(my,aes(color = treat, alpha = 0.7), title = "specialist vs. generalists: low stress end")
pdf(file = "000_pairs_SALT_EH0_EH40_EH0-40_in_000_&_040.pdf", width = mywidth, height = myheight); p; dev.off()

# specialist vs. generalists: full spectrum ----------------
my <- mydwcw[mydwcw$treat %in% c("EH0", "EH80", "EH0_80"),]
my <- my[my$epo %in% c("SALT_A", "SALT_B"),]
my <- my[,c("treat", "mn_dw_0", "mn_dw_80")]
p <- ggpairs(my,aes(color = treat, alpha = 0.7), title = "specialist vs. generalists: full spectrum")
pdf(file = "000_pairs_SALT_EH0_EH80_EH0-80_in_000_&_080.pdf", width = mywidth, height = myheight); p; dev.off()

my <- mydwcw[mydwcw$treat %in% c("EH40", "EH80", "EH40_80"),]
my <- my[my$epo %in% c("SALT_A", "SALT_B"),]
my <- my[,c("treat", "mn_dw_40", "mn_dw_80")]
p <- ggpairs(my,aes(color = treat, alpha = 0.7), title = "specialist vs. generalists: high stress end")
pdf(file = "000_pairs_SALT_EH40_EH80_EH40-80_in_040_&_080.pdf", width = mywidth, height = myheight); p; dev.off()

my <- mydwcw[mydwcw$treat %in% c("EH0", "EH40", "EH80"),]
my <- my[my$epo %in% c("SALT_A", "SALT_B"),]
my <- my[,c("treat", "mn_dw_0", "mn_dw_80")]
p <- ggpairs(my,aes(color = treat, alpha = 0.7), title = "specialists with different means compared")
pdf(file = "000_pairs_SALT_EH0_EH40_EH80_in_000_&_080.pdf", width = mywidth, height = myheight); p; dev.off()

my <- mydwcw[mydwcw$treat %in% c("EH0_40", "EH20_60", "EH40_80"),]
my <- my[my$epo %in% c("SALT_A", "SALT_B"),]
my <- my[,c("treat", "mn_dw_0", "mn_dw_80")]
p <- ggpairs(my,aes(color = treat, alpha = 0.7), title = "generalists with same flux degree, different means compared")
pdf(file = "000_pairs_SALT_EH0-40_EH20-60_EH40-80_in_000_&_080.pdf", width = mywidth, height = myheight); p; dev.off()

my <- mydwcw[mydwcw$treat %in% c("EH0", "EH0_40", "EH0_80"),]
my <- my[my$epo %in% c("SALT_A", "SALT_B"),]
my <- my[,c("treat", "mn_dw_0", "mn_dw_80")]
p <- ggpairs(my,aes(color = treat, alpha = 0.7), title = "shared minimum with variable degree of flux up")
pdf(file = "000_pairs_SALT_EH0_EH0-40_EH0-80_in_000_&_080.pdf", width = mywidth, height = myheight); p; dev.off()

my <- mydwcw[mydwcw$treat %in% c("EH80", "EH40_80", "EH0_80"),]
my <- my[my$epo %in% c("SALT_A", "SALT_B"),]
my <- my[,c("treat", "mn_dw_0", "mn_dw_80")]
p <- ggpairs(my,aes(color = treat, alpha = 0.7), title = "shared maximum with variable degree of flux down")
pdf(file = "000_pairs_SALT_EH80_EH40-80_EH0-80_in_000_&_080.pdf", width = mywidth, height = myheight); p; dev.off()

my <- mydwcw[mydwcw$treat %in% c("EH40", "EH20_60", "EH0_80"),]
my <- my[my$epo %in% c("SALT_A", "SALT_B"),]
my <- my[,c("treat", "mn_dw_0", "mn_dw_80")]
p <- ggpairs(my,aes(color = treat, alpha = 0.7), title = "shared mean with variable degree of flux around mean")
pdf(file = "000_pairs_SALT_EH40_EH20_60_EH0-80_in_000_&_080.pdf", width = mywidth, height = myheight); p; dev.off()

# rm -------------------------
rm(myheight, mywidth, my, p)
```


COPR first. 
```{R}
# Set controls for all plots ---------------------------------------------------
mywidth <- 8
myheight <- mywidth

# ALL ------------------------------------------------------
my <- mydwcw[mydwcw$epo %in% c("COPR_A", "COPR_B"),]
my <- my[,c("treat", "mn_dw_0", "mn_dw_80")]
my$treat <- factor(my$treat, levels = c("EH0", "EH0_40", "EH40", "EH20_60", "EH0_80", "EH40_80", "EH80"))
p <- ggpairs(my,aes(color = treat, alpha = 0.7), title = "ALL")
pdf(file = "000_pairs_COPR_ALL_in_000_&_040.pdf", width = mywidth, height = myheight); p; dev.off()

# specialist vs. generalists: low stress end ---------------
my <- mydwcw[mydwcw$treat %in% c("EH0", "EH40", "EH0_40"),]
my <- my[my$epo %in% c("COPR_A", "COPR_B"),]
my <- my[,c("treat", "mn_dw_0", "mn_dw_40")]
p <- ggpairs(my,aes(color = treat, alpha = 0.7), title = "specialist vs. generalists: low stress end")
pdf(file = "000_pairs_COPR_EH0_EH40_EH0-40_in_000_&_040.pdf", width = mywidth, height = myheight); p; dev.off()

# specialist vs. generalists: full spectrum ----------------
my <- mydwcw[mydwcw$treat %in% c("EH0", "EH80", "EH0_80"),]
my <- my[my$epo %in% c("COPR_A", "COPR_B"),]
my <- my[,c("treat", "mn_dw_0", "mn_dw_80")]
p <- ggpairs(my,aes(color = treat, alpha = 0.7), title = "specialist vs. generalists: full spectrum")
pdf(file = "000_pairs_COPR_EH0_EH80_EH0-80_in_000_&_080.pdf", width = mywidth, height = myheight); p; dev.off()

my <- mydwcw[mydwcw$treat %in% c("EH40", "EH80", "EH40_80"),]
my <- my[my$epo %in% c("COPR_A", "COPR_B"),]
my <- my[,c("treat", "mn_dw_40", "mn_dw_80")]
p <- ggpairs(my,aes(color = treat, alpha = 0.7), title = "specialist vs. generalists: high stress end")
pdf(file = "000_pairs_COPR_EH40_EH80_EH40-80_in_040_&_080.pdf", width = mywidth, height = myheight); p; dev.off()

my <- mydwcw[mydwcw$treat %in% c("EH0", "EH40", "EH80"),]
my <- my[my$epo %in% c("COPR_A", "COPR_B"),]
my <- my[,c("treat", "mn_dw_0", "mn_dw_80")]
p <- ggpairs(my,aes(color = treat, alpha = 0.7), title = "specialists with different means compared")
pdf(file = "000_pairs_COPR_EH0_EH40_EH80_in_000_&_080.pdf", width = mywidth, height = myheight); p; dev.off()

my <- mydwcw[mydwcw$treat %in% c("EH0_40", "EH20_60", "EH40_80"),]
my <- my[my$epo %in% c("COPR_A", "COPR_B"),]
my <- my[,c("treat", "mn_dw_0", "mn_dw_80")]
p <- ggpairs(my,aes(color = treat, alpha = 0.7), title = "generalists with same flux degree, different means compared")
pdf(file = "000_pairs_COPR_EH0-40_EH20-60_EH40-80_in_000_&_080.pdf", width = mywidth, height = myheight); p; dev.off()

my <- mydwcw[mydwcw$treat %in% c("EH0", "EH0_40", "EH0_80"),]
my <- my[my$epo %in% c("COPR_A", "COPR_B"),]
my <- my[,c("treat", "mn_dw_0", "mn_dw_80")]
p <- ggpairs(my,aes(color = treat, alpha = 0.7), title = "shared minimum with variable degree of flux up")
pdf(file = "000_pairs_COPR_EH0_EH0-40_EH0-80_in_000_&_080.pdf", width = mywidth, height = myheight); p; dev.off()

my <- mydwcw[mydwcw$treat %in% c("EH80", "EH40_80", "EH0_80"),]
my <- my[my$epo %in% c("COPR_A", "COPR_B"),]
my <- my[,c("treat", "mn_dw_0", "mn_dw_80")]
p <- ggpairs(my,aes(color = treat, alpha = 0.7), title = "shared maximum with variable degree of flux down")
pdf(file = "000_pairs_COPR_EH80_EH40-80_EH0-80_in_000_&_080.pdf", width = mywidth, height = myheight); p; dev.off()

my <- mydwcw[mydwcw$treat %in% c("EH40", "EH20_60", "EH0_80"),]
my <- my[my$epo %in% c("COPR_A", "COPR_B"),]
my <- my[,c("treat", "mn_dw_0", "mn_dw_80")]
p <- ggpairs(my,aes(color = treat, alpha = 0.7), title = "shared mean with variable degree of flux around mean")
pdf(file = "000_pairs_COPR_EH40_EH20_60_EH0-80_in_000_&_080.pdf", width = mywidth, height = myheight); p; dev.off()

# rm -------------------------
rm(myheight, mywidth, my, p)
```




3d plots
SALT first
```{R}
library(plotly)
Sys.setenv("plotly_username"="vincefasanello")
Sys.setenv("plotly_api_key"="oLHyGo5FrZP6CQ96OZM4")

# all treats -----------------------------------------------
my <-  mydwcw[!is.na(mydwcw$mn_dw_0) &!is.na(mydwcw$mn_dw_40) &!is.na(mydwcw$mn_dw_80) & mydwcw$epo %in% c("SALT_A", "SALT_B"),] 
p <- plot_ly(my, x = ~mn_dw_0, y = ~mn_dw_40, z = ~mn_dw_80, color = ~treat, colors = setpalette, type = "scatter3d", mode = "markers") %>%
  layout(title ="All Treatments"); p
chart_link = api_create(p, filename="000_FS_scatter3d_SALT_AllTreats_000_040_080");chart_link

# specialists vs. generalists ------------------------------
# eh0, eh0_40, eh40 --------------------
my <-  mydwcw[!is.na(mydwcw$mn_dw_0) &!is.na(mydwcw$mn_dw_40) &!is.na(mydwcw$mn_dw_80) & mydwcw$epo %in% c("SALT_A", "SALT_B"),] 
my <- my[my$treat %in% c("EH0", "EH0_40", "EH40"),]
p <- plot_ly(my, x = ~mn_dw_0, y = ~mn_dw_40, z = ~mn_dw_80, color = ~treat, colors = setpalette, type = "scatter3d", mode = "markers") %>%
  layout(title ="specialist vs. generalists: low stress end"); p
chart_link = api_create(p, filename="000_FS_scatter3d_SALT_EH0_EH0-40_EH40_in_000_040_080");chart_link

# eh40, eh40_80, eh80 ------------------
my <-  mydwcw[!is.na(mydwcw$mn_dw_0) &!is.na(mydwcw$mn_dw_40) &!is.na(mydwcw$mn_dw_80) & mydwcw$epo %in% c("SALT_A", "SALT_B"),] 
my <- my[my$treat %in% c("EH40", "EH40_80", "EH80"),]
p <- plot_ly(my, x = ~mn_dw_0, y = ~mn_dw_40, z = ~mn_dw_80, color = ~treat, colors = setpalette, type = "scatter3d", mode = "markers") %>%
  layout(title ="specialist vs. generalists: high stress end"); p
chart_link = api_create(p, filename="000_FS_scatter3d_SALT_EH40_EH40-80_EH80_in_000_040_080");chart_link

# eh0, eh0_80, eh80 --------------------
my <-  mydwcw[!is.na(mydwcw$mn_dw_0) &!is.na(mydwcw$mn_dw_40) &!is.na(mydwcw$mn_dw_80) & mydwcw$epo %in% c("SALT_A", "SALT_B"),]  
my <- my[my$treat %in% c("EH0", "EH0_80", "EH80"),]
p <- plot_ly(my, x = ~mn_dw_0, y = ~mn_dw_40, z = ~mn_dw_80, color = ~treat, colors = setpalette, type = "scatter3d", mode = "markers") %>%
  layout(title ="specialist vs. generalists: full spectrum"); p
chart_link = api_create(p, filename="000_FS_scatter3d_SALT_EH0_EH0-80_EH80_in_000_040_080");chart_link


# Shared mean, variable flux -------------------------------
# eh0_40, eh20_60, eh40_80 -------------
my <-  mydwcw[!is.na(mydwcw$mn_dw_0) &!is.na(mydwcw$mn_dw_40) &!is.na(mydwcw$mn_dw_80) & mydwcw$epo %in% c("SALT_A", "SALT_B"),] 
my <- my[my$treat %in% c("EH40", "EH20_60", "EH0_80"),]
p <- plot_ly(my, x = ~mn_dw_0, y = ~mn_dw_40, z = ~mn_dw_80, color = ~treat, colors = setpalette, type = "scatter3d", mode = "markers") %>%
  layout(title ="shared mean with variable degree of flux around mean"); p
chart_link = api_create(p, filename="000_FS_scatter3d_SALT_EH40_EH20-60_EH0-80_in_000_040_080");chart_link

# Shared min, variable flux -------------------------------
# eh0, eh0_40, eh0_80 ------------------
my <-  mydwcw[!is.na(mydwcw$mn_dw_0) &!is.na(mydwcw$mn_dw_40) &!is.na(mydwcw$mn_dw_80) & mydwcw$epo %in% c("SALT_A", "SALT_B"),] 
my <- my[my$treat %in% c("EH0", "EH0_40", "EH0_80"),]
p <- plot_ly(my, x = ~mn_dw_0, y = ~mn_dw_40, z = ~mn_dw_80, color = ~treat, colors = setpalette, type = "scatter3d", mode = "markers") %>%
  layout(title ="shared minimum with variable degree of flux up"); p
chart_link = api_create(p, filename="000_FS_scatter3d_SALT_EH0_EH0-40_EH0-80_in_000_040_080");chart_link

# # Shared max, variable flux -------------------------------
# eh80, e40_80, eh0_80 -----------------
my <-  mydwcw[!is.na(mydwcw$mn_dw_0) &!is.na(mydwcw$mn_dw_40) &!is.na(mydwcw$mn_dw_80) & mydwcw$epo %in% c("SALT_A", "SALT_B"),] 
my <- my[my$treat %in% c("EH80", "EH40_80", "EH0_80"),]
p <- plot_ly(my, x = ~mn_dw_0, y = ~mn_dw_40, z = ~mn_dw_80, color = ~treat, colors = setpalette, type = "scatter3d", mode = "markers") %>%
  layout(title ="shared maximum with variable degree of flux down"); p
chart_link = api_create(p, filename="000_FS_scatter3d_SALT_EH80_EH40-80_EH0-80_in_000_040_080");chart_link

# variable mean (min, max), shared flux --------------------
# eh0, eh40, eh80 ----------------------
my <-  mydwcw[!is.na(mydwcw$mn_dw_0) &!is.na(mydwcw$mn_dw_40) &!is.na(mydwcw$mn_dw_80) & mydwcw$epo %in% c("SALT_A", "SALT_B"),] 
my <- my[my$treat %in% c("EH0", "EH40", "EH80"),]
p <- plot_ly(my, x = ~mn_dw_0, y = ~mn_dw_40, z = ~mn_dw_80, color = ~treat, colors = setpalette, type = "scatter3d", mode = "markers") %>%
  layout(title ="specialists with different means compared"); p
chart_link = api_create(p, filename="000_FS_scatter3d_SALT_EH0_EH40_EH80_in_000_040_080");chart_link

# eh0_40, eh20_60, eh40_80 -------------
my <-  mydwcw[!is.na(mydwcw$mn_dw_0) &!is.na(mydwcw$mn_dw_40) &!is.na(mydwcw$mn_dw_80) & mydwcw$epo %in% c("SALT_A", "SALT_B"),] 
my <- my[my$treat %in% c("EH0_40", "EH20_60", "EH40_80"),]
p <- plot_ly(my, x = ~mn_dw_0, y = ~mn_dw_40, z = ~mn_dw_80, color = ~treat, colors = setpalette, type = "scatter3d", mode = "markers") %>%
  layout(title ="generalists with same flux degree, different means compared"); p
chart_link = api_create(p, filename="000_FS_scatter3d_SALT_EH0_40_EH20_60_EH40_80_in_000_040_080");chart_link

# ----------------------------
rm(my, p)
```

COPR next
```{R}
library(plotly)
Sys.setenv("plotly_username"="vincefasanello")
Sys.setenv("plotly_api_key"="oLHyGo5FrZP6CQ96OZM4")

# all treats -----------------------------------------------
my <-  mydwcw[!is.na(mydwcw$mn_dw_0) &!is.na(mydwcw$mn_dw_40) &!is.na(mydwcw$mn_dw_80) & mydwcw$epo %in% c("COPR_A", "COPR_B"),] 
p <- plot_ly(my, x = ~mn_dw_0, y = ~mn_dw_40, z = ~mn_dw_80, color = ~treat, colors = setpalette, type = "scatter3d", mode = "markers") %>%
  layout(title ="All Treatments"); p
chart_link = api_create(p, filename="000_FS_scatter3d_COPR_AllTreats_000_040_080");chart_link

# specialists vs. generalists ------------------------------
# eh0, eh0_40, eh40 --------------------
my <-  mydwcw[!is.na(mydwcw$mn_dw_0) &!is.na(mydwcw$mn_dw_40) &!is.na(mydwcw$mn_dw_80) & mydwcw$epo %in% c("COPR_A", "COPR_B"),] 
my <- my[my$treat %in% c("EH0", "EH0_40", "EH40"),]
p <- plot_ly(my, x = ~mn_dw_0, y = ~mn_dw_40, z = ~mn_dw_80, color = ~treat, colors = setpalette, type = "scatter3d", mode = "markers") %>%
  layout(title ="specialist vs. generalists: low stress end"); p
chart_link = api_create(p, filename="000_FS_scatter3d_COPR_EH0_EH0-40_EH40_in_000_040_080");chart_link

# eh40, eh40_80, eh80 ------------------
my <-  mydwcw[!is.na(mydwcw$mn_dw_0) &!is.na(mydwcw$mn_dw_40) &!is.na(mydwcw$mn_dw_80) & mydwcw$epo %in% c("COPR_A", "COPR_B"),] 
my <- my[my$treat %in% c("EH40", "EH40_80", "EH80"),]
p <- plot_ly(my, x = ~mn_dw_0, y = ~mn_dw_40, z = ~mn_dw_80, color = ~treat, colors = setpalette, type = "scatter3d", mode = "markers") %>%
  layout(title ="specialist vs. generalists: high stress end"); p
chart_link = api_create(p, filename="000_FS_scatter3d_COPR_EH40_EH40-80_EH80_in_000_040_080");chart_link

# eh0, eh0_80, eh80 --------------------
my <-  mydwcw[!is.na(mydwcw$mn_dw_0) &!is.na(mydwcw$mn_dw_40) &!is.na(mydwcw$mn_dw_80) & mydwcw$epo %in% c("COPR_A", "COPR_B"),]  
my <- my[my$treat %in% c("EH0", "EH0_80", "EH80"),]
p <- plot_ly(my, x = ~mn_dw_0, y = ~mn_dw_40, z = ~mn_dw_80, color = ~treat, colors = setpalette, type = "scatter3d", mode = "markers") %>%
  layout(title ="specialist vs. generalists: full spectrum"); p
chart_link = api_create(p, filename="000_FS_scatter3d_COPR_EH0_EH0-80_EH80_in_000_040_080");chart_link


# Shared mean, variable flux -------------------------------
# eh0_40, eh20_60, eh40_80 -------------
my <-  mydwcw[!is.na(mydwcw$mn_dw_0) &!is.na(mydwcw$mn_dw_40) &!is.na(mydwcw$mn_dw_80) & mydwcw$epo %in% c("COPR_A", "COPR_B"),] 
my <- my[my$treat %in% c("EH40", "EH20_60", "EH0_80"),]
p <- plot_ly(my, x = ~mn_dw_0, y = ~mn_dw_40, z = ~mn_dw_80, color = ~treat, colors = setpalette, type = "scatter3d", mode = "markers") %>%
  layout(title ="shared mean with variable degree of flux around mean"); p
chart_link = api_create(p, filename="000_FS_scatter3d_COPR_EH40_EH20-60_EH0-80_in_000_040_080");chart_link

# Shared min, variable flux -------------------------------
# eh0, eh0_40, eh0_80 ------------------
my <-  mydwcw[!is.na(mydwcw$mn_dw_0) &!is.na(mydwcw$mn_dw_40) &!is.na(mydwcw$mn_dw_80) & mydwcw$epo %in% c("COPR_A", "COPR_B"),] 
my <- my[my$treat %in% c("EH0", "EH0_40", "EH0_80"),]
p <- plot_ly(my, x = ~mn_dw_0, y = ~mn_dw_40, z = ~mn_dw_80, color = ~treat, colors = setpalette, type = "scatter3d", mode = "markers") %>%
  layout(title ="shared minimum with variable degree of flux up"); p
chart_link = api_create(p, filename="000_FS_scatter3d_COPR_EH0_EH0-40_EH0-80_in_000_040_080");chart_link

# # Shared max, variable flux -------------------------------
# eh80, e40_80, eh0_80 -----------------
my <-  mydwcw[!is.na(mydwcw$mn_dw_0) &!is.na(mydwcw$mn_dw_40) &!is.na(mydwcw$mn_dw_80) & mydwcw$epo %in% c("COPR_A", "COPR_B"),] 
my <- my[my$treat %in% c("EH80", "EH40_80", "EH0_80"),]
p <- plot_ly(my, x = ~mn_dw_0, y = ~mn_dw_40, z = ~mn_dw_80, color = ~treat, colors = setpalette, type = "scatter3d", mode = "markers") %>%
  layout(title ="shared maximum with variable degree of flux down"); p
chart_link = api_create(p, filename="000_FS_scatter3d_COPR_EH80_EH40-80_EH0-80_in_000_040_080");chart_link

# variable mean (min, max), shared flux --------------------
# eh0, eh40, eh80 ----------------------
my <-  mydwcw[!is.na(mydwcw$mn_dw_0) &!is.na(mydwcw$mn_dw_40) &!is.na(mydwcw$mn_dw_80) & mydwcw$epo %in% c("COPR_A", "COPR_B"),] 
my <- my[my$treat %in% c("EH0", "EH40", "EH80"),]
p <- plot_ly(my, x = ~mn_dw_0, y = ~mn_dw_40, z = ~mn_dw_80, color = ~treat, colors = setpalette, type = "scatter3d", mode = "markers") %>%
  layout(title ="specialists with different means compared"); p
chart_link = api_create(p, filename="000_FS_scatter3d_COPR_EH0_EH40_EH80_in_000_040_080");chart_link

# eh0_40, eh20_60, eh40_80 -------------
my <-  mydwcw[!is.na(mydwcw$mn_dw_0) &!is.na(mydwcw$mn_dw_40) &!is.na(mydwcw$mn_dw_80) & mydwcw$epo %in% c("COPR_A", "COPR_B"),] 
my <- my[my$treat %in% c("EH0_40", "EH20_60", "EH40_80"),]
p <- plot_ly(my, x = ~mn_dw_0, y = ~mn_dw_40, z = ~mn_dw_80, color = ~treat, colors = setpalette, type = "scatter3d", mode = "markers") %>%
  layout(title ="generalists with same flux degree, different means compared"); p
chart_link = api_create(p, filename="000_FS_scatter3d_COPR_EH0_40_EH20_60_EH40_80_in_000_040_080");chart_link

# ----------------------------
rm(my, p)
```



Test for fitness increase SALT
```{r}
# BLOCK NOTES ------------------------------------------------------------------
#  - Fitness increase data: analyze by groups externally & use in later blocks
#  - Fitness decrease data: analyze by groups externally & use in later blocks
#  - nleft data: use in later blocks
#  - env specific data frames: use in later blocks
# ------------------------------------------------------------------------------

mysig <- 0.05

# SALT RESULTS OUTPUT TABLES ---------------------------------------------------

mySALTin <- matrix(nrow = 7, ncol = 4) # number of barcodes with significant increase
mySALTdec <- matrix(nrow = 7, ncol = 4) # number of barcodes with significant decrease
mySALTno <- matrix(nrow = 7, ncol = 4) # number of barcodes non-extinct
mySALTtot <- matrix(nrow = 7, ncol = 4) # number of barcodes included in the treatment
rownames(mySALTin) <- c("EH0", "EH40", "EH80", "EH0_40", "EH20_60", "EH0_80", "EH40_80")
rownames(mySALTdec) <- rownames(mySALTin)
rownames(mySALTno) <- rownames(mySALTin)
rownames(mySALTtot) <- rownames(mySALTin)
colnames(mySALTin) <- c(0.0, 0.4, 0.8, 1.2)
colnames(mySALTdec) <- colnames(mySALTin)
colnames(mySALTno) <- colnames(mySALTin)
colnames(mySALTtot) <- colnames(mySALTin)



# SALT in CM -------------------------------------------------------------------
my <- myd[order(myd$bcpID),] 
my <- my[my$epo %in% c("SALT_A", "SALT_B") & my$mpasp == 0.0,]
mySALTtot[,c(1:4)] <- table(my$treat)/4
my <- my[!is.na(my$dw),]

# model & diagnostic plots ---------------------------------
mymod <- lm(my$dw ~ my$bcpID + 0, weights = my$re_dw); # summary(mymod)
# hist(residuals(mymod), breaks = 100); hist(expand_residuals(mymod, my$re_dw), breaks = 100); plot(mymod)

# model output ---------------------------------------------
# tab_model(mymod, digits = 5, digits.p = 8, show.stat = T, wrap.labels = 100, file = "salt_inc_000.html") # table does not have corrected p-values. 

# create results dataframe ---------------------------------
myres <- as.data.frame(coef(summary(mymod)), stringsAsFactors = F)
myres$p1s_l <- pt(coef(summary(mymod))[, 3], mymod$df, lower = T) # one-sided test p-values for lower
myres$p1s_h <- pt(coef(summary(mymod))[, 3], mymod$df, lower = F) # one-sided test p-values for higher
myres$p1s_l.adj <- p.adjust(myres$p1s_l, method = "fdr") # fdr adjusted p value (for 1-sided lower)
myres$p1s_h.adj <- p.adjust(myres$p1s_h, method = "fdr") # fdr adjusted p value (for 1-sided higher)
myres$bcid <-  gsub("^.*?D","",rownames(myres)) # fix barcode id names
myres$treat <- NA
for (i in 1:length(myres$treat)) {
  myres$treat[i] <- as.character(my$treat)[my$bcpID == myres$bcid[i]][1]
}
inc_SALT_000 <- myres

# populate mats --------------------------------------------
tmp <- myres[myres$treat == "EH0",];mySALTdec[1,1] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[1,1] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[1,1] <- nrow(tmp)
tmp <- myres[myres$treat == "EH40",];mySALTdec[2,1] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[2,1] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[2,1] <- nrow(tmp)
tmp <- myres[myres$treat == "EH80",];mySALTdec[3,1] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[3,1] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[3,1] <- nrow(tmp)
tmp <- myres[myres$treat == "EH0_40",];mySALTdec[4,1] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[4,1] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[4,1] <- nrow(tmp)
tmp <- myres[myres$treat == "EH20_60",];mySALTdec[5,1] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[5,1] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[5,1] <- nrow(tmp)
tmp <- myres[myres$treat == "EH0_80",];mySALTdec[6,1] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[6,1] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[6,1] <- nrow(tmp)
tmp <- myres[myres$treat == "EH40_80",];mySALTdec[7,1] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[7,1] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[7,1] <- nrow(tmp)



 # SALT in 40 ------------------------------------------------------------------
my <- myd[order(myd$bcpID),]
my <- my[my$epo %in% c("SALT_A", "SALT_B") & my$mpasp == 0.4 & !is.na(my$dw),] 

# model & diagnostic plots ---------------------------------
mymod <- lm(my$dw ~ my$bcpID + 0, weights = my$re_dw); # summary(mymod)
# hist(residuals(mymod), breaks = 100); hist(expand_residuals(mymod, my$re_dw), breaks = 100); plot(mymod)

# model output ---------------------------------------------
# tab_model(mymod, digits = 5, digits.p = 8, show.stat = T, wrap.labels = 100, file = "salt_inc_040.html") # table does not have corrected p-values. 

# create results dataframe ---------------------------------
myres <- as.data.frame(coef(summary(mymod)), stringsAsFactors = F)
myres$p1s_l <- pt(coef(summary(mymod))[, 3], mymod$df, lower = T) # one-sided test p-values for lower
myres$p1s_h <- pt(coef(summary(mymod))[, 3], mymod$df, lower = F) # one-sided test p-values for higher
myres$p1s_l.adj <- p.adjust(myres$p1s_l, method = "fdr") # fdr adjusted p value (for 1-sided lower)
myres$p1s_h.adj <- p.adjust(myres$p1s_h, method = "fdr") # fdr adjusted p value (for 1-sided higher)
myres$bcid <-  gsub("^.*?D","",rownames(myres)) # fix barcode id names
myres$treat <- NA
for (i in 1:length(myres$treat)) {
  myres$treat[i] <- as.character(my$treat)[my$bcpID == myres$bcid[i]][1]
}
inc_SALT_040 <- myres

# populate mats --------------------------------------------
tmp <- myres[myres$treat == "EH0",];mySALTdec[1,2] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[1,2] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[1,2] <- nrow(tmp)
tmp <- myres[myres$treat == "EH40",];mySALTdec[2,2] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[2,2] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[2,2] <- nrow(tmp)
tmp <- myres[myres$treat == "EH80",];mySALTdec[3,2] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[3,2] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[3,2] <- nrow(tmp)
tmp <- myres[myres$treat == "EH0_40",];mySALTdec[4,2] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[4,2] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[4,2] <- nrow(tmp)
tmp <- myres[myres$treat == "EH20_60",];mySALTdec[5,2] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[5,2] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[5,2] <- nrow(tmp)
tmp <- myres[myres$treat == "EH0_80",];mySALTdec[6,2] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[6,2] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[6,2] <- nrow(tmp)
tmp <- myres[myres$treat == "EH40_80",];mySALTdec[7,2] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[7,2] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[7,2] <- nrow(tmp)



# SALT in 80 -------------------------------------------------------------------
my <- myd[order(myd$bcpID),] 
my <- my[my$epo %in% c("SALT_A", "SALT_B") & my$mpasp == 0.8 & !is.na(my$dw),] 

# model & diagnostic plots ---------------------------------
mymod <- lm(my$dw ~ my$bcpID + 0, weights = my$re_dw); # summary(mymod)
# hist(residuals(mymod), breaks = 100); hist(expand_residuals(mymod, my$re_dw), breaks = 100); plot(mymod)

# model output ---------------------------------------------
# tab_model(mymod, digits = 5, digits.p = 8, show.stat = T, wrap.labels = 100, file = "salt_inc_080.html") # table does not have corrected p-values. 

# create results dataframe ---------------------------------
myres <- as.data.frame(coef(summary(mymod)), stringsAsFactors = F)
myres$p1s_l <- pt(coef(summary(mymod))[, 3], mymod$df, lower = T) # one-sided test p-values for lower
myres$p1s_h <- pt(coef(summary(mymod))[, 3], mymod$df, lower = F) # one-sided test p-values for higher
myres$p1s_l.adj <- p.adjust(myres$p1s_l, method = "fdr") # fdr adjusted p value (for 1-sided lower)
myres$p1s_h.adj <- p.adjust(myres$p1s_h, method = "fdr") # fdr adjusted p value (for 1-sided higher)
myres$bcid <-  gsub("^.*?D","",rownames(myres)) # fix barcode id names
myres$treat <- NA
for (i in 1:length(myres$treat)) {
  myres$treat[i] <- as.character(my$treat)[my$bcpID == myres$bcid[i]][1]
}
inc_SALT_080 <- myres

# populate mats --------------------------------------------
tmp <- myres[myres$treat == "EH0",];mySALTdec[1,3] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[1,3] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[1,3] <- nrow(tmp)
tmp <- myres[myres$treat == "EH40",];mySALTdec[2,3] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[2,3] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[2,3] <- nrow(tmp)
tmp <- myres[myres$treat == "EH80",];mySALTdec[3,3] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[3,3] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[3,3] <- nrow(tmp)
tmp <- myres[myres$treat == "EH0_40",];mySALTdec[4,3] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[4,3] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[4,3] <- nrow(tmp)
tmp <- myres[myres$treat == "EH20_60",];mySALTdec[5,3] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[5,3] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[5,3] <- nrow(tmp)
tmp <- myres[myres$treat == "EH0_80",];mySALTdec[6,3] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[6,3] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[6,3] <- nrow(tmp)
tmp <- myres[myres$treat == "EH40_80",];mySALTdec[7,3] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[7,3] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[7,3] <- nrow(tmp)



# SALT in 120 ------------------------------------------------------------------
my <- myd[order(myd$bcpID),] 
my <- my[my$epo %in% c("SALT_A", "SALT_B") & my$mpasp == 1.2 & !is.na(my$dw),] 

# model & diagnostic plots ---------------------------------
mymod <- lm(my$dw ~ my$bcpID + 0, weights = my$re_dw); # summary(mymod)
# hist(residuals(mymod), breaks = 100); hist(expand_residuals(mymod, my$re_dw), breaks = 100); plot(mymod)

# model output ---------------------------------------------
# tab_model(mymod, digits = 5, digits.p = 8, show.stat = T, wrap.labels = 100, file = "salt_inc_120.html") # table does not have corrected p-values. 

# create results dataframe ---------------------------------
myres <- as.data.frame(coef(summary(mymod)), stringsAsFactors = F)
myres$p1s_l <- pt(coef(summary(mymod))[, 3], mymod$df, lower = T) # one-sided test p-values for lower
myres$p1s_h <- pt(coef(summary(mymod))[, 3], mymod$df, lower = F) # one-sided test p-values for higher
myres$p1s_l.adj <- p.adjust(myres$p1s_l, method = "fdr") # fdr adjusted p value (for 1-sided lower)
myres$p1s_h.adj <- p.adjust(myres$p1s_h, method = "fdr") # fdr adjusted p value (for 1-sided higher)
myres$bcid <-  gsub("^.*?D","",rownames(myres)) # fix barcode id names
myres$treat <- NA
for (i in 1:length(myres$treat)) {
  myres$treat[i] <- as.character(my$treat)[my$bcpID == myres$bcid[i]][1]
}
inc_SALT_120 <- myres

# populate mats --------------------------------------------
tmp <- myres[myres$treat == "EH0",];mySALTdec[1,4] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[1,4] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[1,4] <- nrow(tmp)
tmp <- myres[myres$treat == "EH40",];mySALTdec[2,4] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[2,4] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[2,4] <- nrow(tmp)
tmp <- myres[myres$treat == "EH80",];mySALTdec[3,4] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[3,4] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[3,4] <- nrow(tmp)
tmp <- myres[myres$treat == "EH0_40",];mySALTdec[4,4] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[4,4] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[4,4] <- nrow(tmp)
tmp <- myres[myres$treat == "EH20_60",];mySALTdec[5,4] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[5,4] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[5,4] <- nrow(tmp)
tmp <- myres[myres$treat == "EH0_80",];mySALTdec[6,4] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[6,4] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[6,4] <- nrow(tmp)
tmp <- myres[myres$treat == "EH40_80",];mySALTdec[7,4] <- sum(tmp$p1s_l.adj <= mysig); mySALTin[7,4] <- sum(tmp$p1s_h.adj <= mysig); mySALTno[7,4] <- nrow(tmp)


# ----------------------------
mySALTnleft <- mySALTno; rm(mySALTno)  # give a clearer name. 
mySALText <- mySALTtot - mySALTnleft; rm(mySALTnleft) # now subtract from tot to get n extinct in each treat
mySALTunc <- mySALTtot - (mySALTdec + mySALTin + mySALText)

# ----------------------------
rm(inc_SALT_000, inc_SALT_040, inc_SALT_080, inc_SALT_120) # uncomment if you want to retain these results. 
rm(my, mymod, myres, tmp, i, mysig)
```
<br/><br/>



Test for fitness increase COPR
```{r}
# BLOCK NOTES ------------------------------------------------------------------
#  - Fitness increase data: analyze by groups externally & use in later blocks
#  - Fitness decrease data: analyze by groups externally & use in later blocks
#  - nleft data: use in later blocks
#  - env specific data frames: use in later blocks
# ------------------------------------------------------------------------------

mysig <- 0.05

# COPR RESULTS OUTPUT TABLES ---------------------------------------------------

myCOPRin <- matrix(nrow = 7, ncol = 4) # number of barcodes with significant increase
myCOPRdec <- matrix(nrow = 7, ncol = 4) # number of barcodes with significant decrease
myCOPRno <- matrix(nrow = 7, ncol = 4) # number of barcodes non-extinct
myCOPRtot <- matrix(nrow = 7, ncol = 4) # number of barcodes included in the treatment
rownames(myCOPRin) <- c("EH0", "EH40", "EH80", "EH0_40", "EH20_60", "EH0_80", "EH40_80")
rownames(myCOPRdec) <- rownames(myCOPRin)
rownames(myCOPRno) <- rownames(myCOPRin)
rownames(myCOPRtot) <- rownames(myCOPRin)
colnames(myCOPRin) <- c(0.0, 0.4, 0.8, 1.2)
colnames(myCOPRdec) <- colnames(myCOPRin)
colnames(myCOPRno) <- colnames(myCOPRin)
colnames(myCOPRtot) <- colnames(myCOPRin)



# COPR in CM -------------------------------------------------------------------
my <- myd[order(myd$bcpID),] 
my <- my[my$epo %in% c("COPR_A", "COPR_B") & my$mpasp == 0.0,]
myCOPRtot[,c(1:4)] <- table(my$treat)/4
my <- my[!is.na(my$dw),]

# model & diagnostic plots ---------------------------------
mymod <- lm(my$dw ~ my$bcpID + 0, weights = my$re_dw); # summary(mymod)
# hist(residuals(mymod), breaks = 100); hist(expand_residuals(mymod, my$re_dw), breaks = 100); plot(mymod)

# model output ---------------------------------------------
# tab_model(mymod, digits = 5, digits.p = 8, show.stat = T, wrap.labels = 100, file = "copr_inc_000.html") # table does not have corrected p-values. 

# create results dataframe ---------------------------------
myres <- as.data.frame(coef(summary(mymod)), stringsAsFactors = F)
myres$p1s_l <- pt(coef(summary(mymod))[, 3], mymod$df, lower = T) # one-sided test p-values for lower
myres$p1s_h <- pt(coef(summary(mymod))[, 3], mymod$df, lower = F) # one-sided test p-values for higher
myres$p1s_l.adj <- p.adjust(myres$p1s_l, method = "fdr") # fdr adjusted p value (for 1-sided lower)
myres$p1s_h.adj <- p.adjust(myres$p1s_h, method = "fdr") # fdr adjusted p value (for 1-sided higher)
myres$bcid <-  gsub("^.*?D","",rownames(myres)) # fix barcode id names
myres$treat <- NA
for (i in 1:length(myres$treat)) {
  myres$treat[i] <- as.character(my$treat)[my$bcpID == myres$bcid[i]][1]
}
inc_COPR_000 <- myres

# populate mats --------------------------------------------
tmp <- myres[myres$treat == "EH0",];myCOPRdec[1,1] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[1,1] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[1,1] <- nrow(tmp)
tmp <- myres[myres$treat == "EH40",];myCOPRdec[2,1] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[2,1] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[2,1] <- nrow(tmp)
tmp <- myres[myres$treat == "EH80",];myCOPRdec[3,1] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[3,1] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[3,1] <- nrow(tmp)
tmp <- myres[myres$treat == "EH0_40",];myCOPRdec[4,1] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[4,1] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[4,1] <- nrow(tmp)
tmp <- myres[myres$treat == "EH20_60",];myCOPRdec[5,1] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[5,1] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[5,1] <- nrow(tmp)
tmp <- myres[myres$treat == "EH0_80",];myCOPRdec[6,1] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[6,1] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[6,1] <- nrow(tmp)
tmp <- myres[myres$treat == "EH40_80",];myCOPRdec[7,1] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[7,1] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[7,1] <- nrow(tmp)



 # COPR in 40 ------------------------------------------------------------------
my <- myd[order(myd$bcpID),]
my <- my[my$epo %in% c("COPR_A", "COPR_B") & my$mpasp == 0.4 & !is.na(my$dw),] 

# model & diagnostic plots ---------------------------------
mymod <- lm(my$dw ~ my$bcpID + 0, weights = my$re_dw); # summary(mymod)
# hist(residuals(mymod), breaks = 100); hist(expand_residuals(mymod, my$re_dw), breaks = 100); plot(mymod)

# model output ---------------------------------------------
# tab_model(mymod, digits = 5, digits.p = 8, show.stat = T, wrap.labels = 100, file = "copr_inc_040.html") # table does not have corrected p-values. 

# create results dataframe ---------------------------------
myres <- as.data.frame(coef(summary(mymod)), stringsAsFactors = F)
myres$p1s_l <- pt(coef(summary(mymod))[, 3], mymod$df, lower = T) # one-sided test p-values for lower
myres$p1s_h <- pt(coef(summary(mymod))[, 3], mymod$df, lower = F) # one-sided test p-values for higher
myres$p1s_l.adj <- p.adjust(myres$p1s_l, method = "fdr") # fdr adjusted p value (for 1-sided lower)
myres$p1s_h.adj <- p.adjust(myres$p1s_h, method = "fdr") # fdr adjusted p value (for 1-sided higher)
myres$bcid <-  gsub("^.*?D","",rownames(myres)) # fix barcode id names
myres$treat <- NA
for (i in 1:length(myres$treat)) {
  myres$treat[i] <- as.character(my$treat)[my$bcpID == myres$bcid[i]][1]
}
inc_COPR_040 <- myres

# populate mats --------------------------------------------
tmp <- myres[myres$treat == "EH0",];myCOPRdec[1,2] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[1,2] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[1,2] <- nrow(tmp)
tmp <- myres[myres$treat == "EH40",];myCOPRdec[2,2] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[2,2] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[2,2] <- nrow(tmp)
tmp <- myres[myres$treat == "EH80",];myCOPRdec[3,2] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[3,2] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[3,2] <- nrow(tmp)
tmp <- myres[myres$treat == "EH0_40",];myCOPRdec[4,2] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[4,2] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[4,2] <- nrow(tmp)
tmp <- myres[myres$treat == "EH20_60",];myCOPRdec[5,2] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[5,2] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[5,2] <- nrow(tmp)
tmp <- myres[myres$treat == "EH0_80",];myCOPRdec[6,2] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[6,2] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[6,2] <- nrow(tmp)
tmp <- myres[myres$treat == "EH40_80",];myCOPRdec[7,2] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[7,2] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[7,2] <- nrow(tmp)



# COPR in 80 -------------------------------------------------------------------
my <- myd[order(myd$bcpID),] 
my <- my[my$epo %in% c("COPR_A", "COPR_B") & my$mpasp == 0.8 & !is.na(my$dw),] 

# model & diagnostic plots ---------------------------------
mymod <- lm(my$dw ~ my$bcpID + 0, weights = my$re_dw); # summary(mymod)
# hist(residuals(mymod), breaks = 100); hist(expand_residuals(mymod, my$re_dw), breaks = 100); plot(mymod)

# model output ---------------------------------------------
# tab_model(mymod, digits = 5, digits.p = 8, show.stat = T, wrap.labels = 100, file = "copr_inc_080.html") # table does not have corrected p-values. 

# create results dataframe ---------------------------------
myres <- as.data.frame(coef(summary(mymod)), stringsAsFactors = F)
myres$p1s_l <- pt(coef(summary(mymod))[, 3], mymod$df, lower = T) # one-sided test p-values for lower
myres$p1s_h <- pt(coef(summary(mymod))[, 3], mymod$df, lower = F) # one-sided test p-values for higher
myres$p1s_l.adj <- p.adjust(myres$p1s_l, method = "fdr") # fdr adjusted p value (for 1-sided lower)
myres$p1s_h.adj <- p.adjust(myres$p1s_h, method = "fdr") # fdr adjusted p value (for 1-sided higher)
myres$bcid <-  gsub("^.*?D","",rownames(myres)) # fix barcode id names
myres$treat <- NA
for (i in 1:length(myres$treat)) {
  myres$treat[i] <- as.character(my$treat)[my$bcpID == myres$bcid[i]][1]
}
inc_COPR_080 <- myres

# populate mats --------------------------------------------
tmp <- myres[myres$treat == "EH0",];myCOPRdec[1,3] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[1,3] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[1,3] <- nrow(tmp)
tmp <- myres[myres$treat == "EH40",];myCOPRdec[2,3] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[2,3] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[2,3] <- nrow(tmp)
tmp <- myres[myres$treat == "EH80",];myCOPRdec[3,3] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[3,3] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[3,3] <- nrow(tmp)
tmp <- myres[myres$treat == "EH0_40",];myCOPRdec[4,3] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[4,3] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[4,3] <- nrow(tmp)
tmp <- myres[myres$treat == "EH20_60",];myCOPRdec[5,3] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[5,3] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[5,3] <- nrow(tmp)
tmp <- myres[myres$treat == "EH0_80",];myCOPRdec[6,3] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[6,3] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[6,3] <- nrow(tmp)
tmp <- myres[myres$treat == "EH40_80",];myCOPRdec[7,3] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[7,3] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[7,3] <- nrow(tmp)



# COPR in 120 ------------------------------------------------------------------
my <- myd[order(myd$bcpID),] 
my <- my[my$epo %in% c("COPR_A", "COPR_B") & my$mpasp == 1.2 & !is.na(my$dw),] 

# model & diagnostic plots ---------------------------------
mymod <- lm(my$dw ~ my$bcpID + 0, weights = my$re_dw); # summary(mymod)
# hist(residuals(mymod), breaks = 100); hist(expand_residuals(mymod, my$re_dw), breaks = 100); plot(mymod)

# model output ---------------------------------------------
# tab_model(mymod, digits = 5, digits.p = 8, show.stat = T, wrap.labels = 100, file = "copr_inc_120.html") # table does not have corrected p-values. 

# create results dataframe ---------------------------------
myres <- as.data.frame(coef(summary(mymod)), stringsAsFactors = F)
myres$p1s_l <- pt(coef(summary(mymod))[, 3], mymod$df, lower = T) # one-sided test p-values for lower
myres$p1s_h <- pt(coef(summary(mymod))[, 3], mymod$df, lower = F) # one-sided test p-values for higher
myres$p1s_l.adj <- p.adjust(myres$p1s_l, method = "fdr") # fdr adjusted p value (for 1-sided lower)
myres$p1s_h.adj <- p.adjust(myres$p1s_h, method = "fdr") # fdr adjusted p value (for 1-sided higher)
myres$bcid <-  gsub("^.*?D","",rownames(myres)) # fix barcode id names
myres$treat <- NA
for (i in 1:length(myres$treat)) {
  myres$treat[i] <- as.character(my$treat)[my$bcpID == myres$bcid[i]][1]
}
inc_COPR_120 <- myres

# populate mats --------------------------------------------
tmp <- myres[myres$treat == "EH0",];myCOPRdec[1,4] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[1,4] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[1,4] <- nrow(tmp)
tmp <- myres[myres$treat == "EH40",];myCOPRdec[2,4] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[2,4] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[2,4] <- nrow(tmp)
tmp <- myres[myres$treat == "EH80",];myCOPRdec[3,4] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[3,4] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[3,4] <- nrow(tmp)
tmp <- myres[myres$treat == "EH0_40",];myCOPRdec[4,4] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[4,4] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[4,4] <- nrow(tmp)
tmp <- myres[myres$treat == "EH20_60",];myCOPRdec[5,4] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[5,4] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[5,4] <- nrow(tmp)
tmp <- myres[myres$treat == "EH0_80",];myCOPRdec[6,4] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[6,4] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[6,4] <- nrow(tmp)
tmp <- myres[myres$treat == "EH40_80",];myCOPRdec[7,4] <- sum(tmp$p1s_l.adj <= mysig); myCOPRin[7,4] <- sum(tmp$p1s_h.adj <= mysig); myCOPRno[7,4] <- nrow(tmp)


# ----------------------------
myCOPRnleft <- myCOPRno; rm(myCOPRno)  # give a clearer name. 
myCOPRext <- myCOPRtot - myCOPRnleft; rm(myCOPRnleft) # now subtract from tot to get n extinct in each treat
myCOPRunc <- myCOPRtot - (myCOPRdec + myCOPRin + myCOPRext)

# ----------------------------
rm(inc_COPR_000, inc_COPR_040, inc_COPR_080, inc_COPR_120) # uncomment if you want to retain these results. 
rm(my, mymod, myres, tmp, i, mysig)
```
<br/><br/>






















































# lets take a look at extinction in salt...
```{R}
my <- mySALTspread[,c("ext_0.0", "ext_p_0.0", "ext_0.4", "ext_p_0.4", "ext_0.8", "ext_p_0.8", "ext_1.2", "ext_p_1.2")]
my <- mySALTspread[,c("ext_0.0", "ext_0.4", "ext_0.8", "ext_1.2")]
myres <- matrix(nrow = 7, ncol = 3); rownames(myres) <- rownames(my)
colnames(myres) <- c("ext_n", "ext_se", "ext_p")
myres[,1] <- apply(my, 1, mean)
myres[,2] <- apply(my, 1, sjstats::se)
myres[,3] <- myres[,1] / mySALTspread[,"tot_0.0"]

```













# explore the new analysis framework. 

# 0, 0_40, 40 (in .00, .40, .80. 1.20)
```{r}
# Fishers exact tests ------------------------------------------------------------------------------
# 0.00 -------------------------------------------------------------------------
# 0.00 -- EXTINCT
my <- mySALTspread[c("EH0", "EH0_40", "EH40"), c(2,1)]; my[,2] <- my[,2] - my[,1]
my
Barnard::barnard.test(n1 = my[1,1], my[2,1], my[1,2], my[2,2])
Barnard::barnard.test(n1 = my[1,2], my[2,2], my[1,1], my[2,1])

fisher.test(x = my[c(1,3),], alternative = "g") #EH0 > #EH40? YES! 
fisher.test(x = my[c(1,2),], alternative = "g") #EH0 > #EH0_40?  NO! -- fail to reject equality
fisher.test(x = my[c(2,3),], alternative = "g") #EH0_40 > #EH40? YES! 

# 0.00  -- INCREASE
my <- mySALTspread[c("EH0", "EH0_40", "EH40"), c(4,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,3),], alternative = "g") #EH0 > #EH40? YES!
fisher.test(x = my[c(1,2),], alternative = "g") #EH0 > #EH0_40? YES!
fisher.test(x = my[c(2,3),], alternative = "g") #EH0_40 > #EH40? NO! -- fail to reject equality

# 0.00 -- DECREASE -- NO DIFFERENCES IN DECREASE DATA.
my <- mySALTspread[c("EH0", "EH0_40", "EH40"), c(6,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,2),], alternative = "g") # 40 > 0_40
fisher.test(x = my[c(3,1),], alternative = "g") # 40 > 0
fisher.test(x = my[c(2,1),], alternative = "g") # 0_40 > 0

# 0.40 -------------------------------------------------------------------------
# 0.40  -- EXTINCT
my <- mySALTspread[c("EH0", "EH0_40", "EH40"), c(11,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,3),], alternative = "g") #EH0 > #EH40? YES! 
fisher.test(x = my[c(1,2),], alternative = "g") #EH0 > #EH0_40?  NO! -- fail to reject equality
fisher.test(x = my[c(2,3),], alternative = "g") #EH0_40 > #EH40? YES! 

# 0.40  -- INCREASE
my <- mySALTspread[c("EH0", "EH0_40", "EH40"), c(13,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") #EH40 > #EH0?  NO! -- fail to reject equality
fisher.test(x = my[c(3,2),], alternative = "g") #EH40 > #EH0_40? YES!
fisher.test(x = my[c(1,2),], alternative = "g") #EH0 > #EH0_40? NO! -- fail to reject equality

# 0.40  -- DECREASE -- NO DIFFERENCES IN DECREASE DATA.
my <- mySALTspread[c("EH0", "EH0_40", "EH40"), c(15,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,2),], alternative = "g") # 0 > 0_40
fisher.test(x = my[c(1,3),], alternative = "g") # 0 > 40
fisher.test(x = my[c(2,3),], alternative = "g") # 0_40 > 40

# 0.80 -------------------------------------------------------------------------
# 0.80  -- EXTINCT
my <- mySALTspread[c("EH0", "EH0_40", "EH40"), c(20,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,3),], alternative = "g") #EH0 > #EH40? YES! 
fisher.test(x = my[c(1,2),], alternative = "g") #EH0 > #EH0_40?  NO! -- fail to reject equality
fisher.test(x = my[c(2,3),], alternative = "g") #EH0_40 > #EH40?  NO! -- fail to reject equality

# 0.80  -- INCREASE
my <- mySALTspread[c("EH0", "EH0_40", "EH40"), c(22,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") #EH40 > #EH0? YES!
fisher.test(x = my[c(3,2),], alternative = "g") #EH40 > #EH0_40? YES!
fisher.test(x = my[c(2,1),], alternative = "g") #EH0_40 > #EH0? NO! -- fail to reject equality

# 0.80  -- DECREASE
my <- mySALTspread[c("EH0", "EH0_40", "EH40"), c(24,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,3),], alternative = "g") #EH0 > #EH40? YES!
fisher.test(x = my[c(2,3),], alternative = "g") #EH0_40 > #EH40? NO! -- fail to reject equality
fisher.test(x = my[c(1,3),], alternative = "g") #EH0 > #EH0_40? YES!


# 1.2 -------------------------------------------------------------------------
# 1.20  -- EXTINCT
my <- mySALTspread[c("EH0", "EH0_40", "EH40"), c(29,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,3),], alternative = "g") #EH0 > #EH40? YES! 
fisher.test(x = my[c(1,2),], alternative = "g") #EH0 > #EH0_40?  NO! -- fail to reject equality
fisher.test(x = my[c(2,3),], alternative = "g") #EH0_40 > #EH40?  YES!

# 1.20  -- INCREASE
my <- mySALTspread[c("EH0", "EH0_40", "EH40"), c(31,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") #EH40 > #EH0? YES!
fisher.test(x = my[c(3,2),], alternative = "g") #EH40 > #EH0_40? YES!
fisher.test(x = my[c(2,1),], alternative = "g") #EH0_40 > #EH0? NO! -- fail to reject equality

# 1.20  -- DECREASE
my <- mySALTspread[c("EH0", "EH0_40", "EH40"), c(33,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,3),], alternative = "g") #EH0 > #EH40? YES!
fisher.test(x = my[c(2,3),], alternative = "g") #EH0_40 > #EH40? NO! -- fail to reject equality
fisher.test(x = my[c(1,2),], alternative = "g") #EH0 > #EH0_40? NO! -- fail to reject equality


# 0.0 + 0.4 --------------------------------------------------------------------
# inc
my1 <- mySALTspread[c("EH0", "EH0_40", "EH40"), c(4,1)]; my[,2] <- my[,2] - my[,1]
my2 <- mySALTspread[c("EH0", "EH0_40", "EH40"), c(13,1)]; my[,2] <- my[,2] - my[,1]
my <- my1 + my2
my
fisher.test(x = my[c(1,3),], alternative = "g") # 0 > 40
fisher.test(x = my[c(1,2),], alternative = "g") # 0 > 0_40
fisher.test(x = my[c(3,2),], alternative = "g") # 40 > 0_40

# dec
my1 <- mySALTspread[c("EH0", "EH0_40", "EH40"), c(6,1)]; my[,2] <- my[,2] - my[,1]
my2 <- mySALTspread[c("EH0", "EH0_40", "EH40"), c(15,1)]; my[,2] <- my[,2] - my[,1]
my <- my1 + my2
my
fisher.test(x = my[c(2,3),], alternative = "g") # 0_40 > 40
fisher.test(x = my[c(2,1),], alternative = "g") # 0_40 > 0
fisher.test(x = my[c(3,1),], alternative = "g") # 40 > 0


```



# 0, 0_80, 80
``` {r}
# Fishers exact tests ------------------------------------------------------------------------------
# 0.00 -------------------------------------------------------------------------
# 0.00 -- EXTINCT
my <- mySALTspread[c("EH0", "EH0_80", "EH80"), c(2,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") #EH80 > #EH0? 
fisher.test(x = my[c(3,2),], alternative = "g") #EH80 > #EH0_80?
fisher.test(x = my[c(1,2),], alternative = "g") #EH0 > #EH0_80? 

# 0.00  -- INCREASE
my <- mySALTspread[c("EH0", "EH0_80", "EH80"), c(4,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,3),], alternative = "g") #EH0 > #EH80?
fisher.test(x = my[c(1,2),], alternative = "g") #EH0 > #EH0_80?
fisher.test(x = my[c(2,3),], alternative = "g") #EH0_80 > #EH80

# 0.00 -- DECREASE -- NO DIFFERENCES IN DECREASE DATA.
my <- mySALTspread[c("EH0", "EH0_80", "EH80"), c(6,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") #EH80 > #EH0?
fisher.test(x = my[c(3,2),], alternative = "g") #EH80 > #EH0_80?
fisher.test(x = my[c(2,1),], alternative = "g") #EH0_80 > #EH0


# 0.40 -------------------------------------------------------------------------
# 0.40  -- EXTINCT
my <- mySALTspread[c("EH0", "EH0_80", "EH80"), c(11,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,3),], alternative = "g") #EH0 > #EH80? 
fisher.test(x = my[c(1,2),], alternative = "g") #EH0 > #EH0_80?  
fisher.test(x = my[c(3,2),], alternative = "g") #EH80 > #EH0_80? 

# 0.40  -- INCREASE
my <- mySALTspread[c("EH0", "EH0_80", "EH80"), c(13,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") #EH80 > #EH0?  
fisher.test(x = my[c(2,1),], alternative = "g") #EH0_80 > #EH0? 
fisher.test(x = my[c(2,3),], alternative = "g") #EH0_80 > #EH80? 

# 0.40  -- DECREASE -- NO DIFFERENCES IN DECREASE DATA.
my <- mySALTspread[c("EH0", "EH0_80", "EH80"), c(15,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,3),], alternative = "g") #EH0 > #EH80?  
fisher.test(x = my[c(1,2),], alternative = "g") #EH0 > #EH0_80? 
fisher.test(x = my[c(2,3),], alternative = "g") #EH0_80 > #EH80? 

# 0.80 -------------------------------------------------------------------------
# 0.80  -- EXTINCT
my <- mySALTspread[c("EH0", "EH0_80", "EH80"), c(20,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,3),], alternative = "g") #EH0 > #EH80? 
fisher.test(x = my[c(1,2),], alternative = "g") #EH0 > #EH0_80?  
fisher.test(x = my[c(3,2),], alternative = "g") #EH80 > #EH0_80? 

# 0.80  -- INCREASE
my <- mySALTspread[c("EH0", "EH0_80", "EH80"), c(22,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") #EH80 > #EH0?  
fisher.test(x = my[c(2,1),], alternative = "g") #EH0_80 > #EH0? 
fisher.test(x = my[c(2,3),], alternative = "g") #EH0_80 > #EH80? 

# 0.80  -- DECREASE
my <- mySALTspread[c("EH0", "EH0_80", "EH80"), c(24,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,3),], alternative = "g") #EH0 > #EH80?  
fisher.test(x = my[c(1,2),], alternative = "g") #EH0 > #EH0_80? 
fisher.test(x = my[c(2,3),], alternative = "g") #EH0_80 > #EH80? 


# 1.2 -------------------------------------------------------------------------
# 1.20  -- EXTINCT
my <- mySALTspread[c("EH0", "EH0_80", "EH80"), c(29,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,3),], alternative = "g") #EH0 > #EH80? 
fisher.test(x = my[c(1,2),], alternative = "g") #EH0 > #EH0_80?  
fisher.test(x = my[c(3,2),], alternative = "g") #EH80 > #EH0_80? 

# 1.20  -- INCREASE
my <- mySALTspread[c("EH0", "EH0_80", "EH80"), c(31,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") #EH80 > #EH0?  
fisher.test(x = my[c(2,1),], alternative = "g") #EH0_80 > #EH0? 
fisher.test(x = my[c(3,2),], alternative = "g") #EH80 > #EH0_80? 

# 1.20  -- DECREASE
my <- mySALTspread[c("EH0", "EH0_80", "EH80"), c(33,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,3),], alternative = "g") #EH0 > #EH80?  
fisher.test(x = my[c(1,2),], alternative = "g") #EH0 > #EH0_80? 
fisher.test(x = my[c(2,3),], alternative = "g") #EH0_80 > #EH80? 


# 0.0 + 0.8 --------------------------------------------------------------------
# inc
my1 <- mySALTspread[c("EH0", "EH0_80", "EH80"), c(4,1)]; my[,2] <- my[,2] - my[,1]
my2 <- mySALTspread[c("EH0", "EH0_80", "EH80"), c(22,1)]; my[,2] <- my[,2] - my[,1]
my <- my1 + my2
my
fisher.test(x = my[c(2,3),], alternative = "g") # 80 > 0
fisher.test(x = my[c(2,1),], alternative = "g") # 80 > 0_80
fisher.test(x = my[c(3,1),], alternative = "g") # 0 > 0_80

# dec
my1 <- mySALTspread[c("EH0", "EH0_80", "EH80"), c(6,1)]; my[,2] <- my[,2] - my[,1]
my2 <- mySALTspread[c("EH0", "EH0_80", "EH80"), c(24,1)]; my[,2] <- my[,2] - my[,1]
my <- my1 + my2
my
fisher.test(x = my[c(3,1),], alternative = "g") # 80 > 0
fisher.test(x = my[c(3,2),], alternative = "g") # 80 > 0_80
fisher.test(x = my[c(1,2),], alternative = "g") # 0 > 0_80
```


# 40, 40_80, 80
``` {r}
# Fishers exact tests ------------------------------------------------------------------------------
# 0.00 -------------------------------------------------------------------------
# 0.00 -- EXTINCT
my <- mySALTspread[c("EH40", "EH40_80", "EH80"), c(2,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") #EH80 > #EH40? 
fisher.test(x = my[c(3,2),], alternative = "g") #EH80 > #EH40_80?
fisher.test(x = my[c(2,1),], alternative = "g") #EH40_80 > #EH40? 

# 0.00  -- INCREASE
my <- mySALTspread[c("EH40", "EH40_80", "EH80"), c(4,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,2),], alternative = "g") #EH40 > #EH40_80?
fisher.test(x = my[c(1,3),], alternative = "g") #EH40 > #EH80?
fisher.test(x = my[c(2,3),], alternative = "g") #EH40_80 > #EH80

# 0.00 -- DECREASE -- NO DIFFERENCES IN DECREASE DATA.
my <- mySALTspread[c("EH40", "EH40_80", "EH80"), c(6,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") #EH80 > #EH40?
fisher.test(x = my[c(3,2),], alternative = "g") #EH80 > #EH40_80?
fisher.test(x = my[c(2,1),], alternative = "g") #EH40_80 > #EH40


# 0.40 -------------------------------------------------------------------------
# 0.40  -- EXTINCT
my <- mySALTspread[c("EH40", "EH40_80", "EH80"), c(11,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") #EH80 > #EH40? 
fisher.test(x = my[c(3,2),], alternative = "g") #EH80 > 40_80?
fisher.test(x = my[c(2,1),], alternative = "g") #EH40_80 > #EH80? 

# 0.40  -- INCREASE
my <- mySALTspread[c("EH40", "EH40_80", "EH80"), c(13,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") #EH80 > #EH40?  
fisher.test(x = my[c(2,1),], alternative = "g") #EH40_80 > #EH40? 
fisher.test(x = my[c(2,3),], alternative = "g") #EH40_80 > #EH80? 

# 0.40  -- DECREASE -- NO DIFFERENCES IN DECREASE DATA.
my <- mySALTspread[c("EH40", "EH40_80", "EH80"), c(15,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") #80 > 40
fisher.test(x = my[c(2,1),], alternative = "g") #40_80 > #40? 
fisher.test(x = my[c(2,3),], alternative = "g") #40_80 > #80? 

# 0.80 -------------------------------------------------------------------------
# 0.80  -- EXTINCT
my <- mySALTspread[c("EH40", "EH40_80", "EH80"), c(20,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") #EH80 > #EH40? 
fisher.test(x = my[c(3,2),], alternative = "g") #EH80 > 40_80?
fisher.test(x = my[c(2,1),], alternative = "g") #EH40_80 > #EH80? 

# 0.80  -- INCREASE
my <- mySALTspread[c("EH40", "EH40_80", "EH80"), c(22,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") #EH80 > #EH40?  
fisher.test(x = my[c(2,1),], alternative = "g") #EH40_80 > #EH40? 
fisher.test(x = my[c(2,3),], alternative = "g") #EH40_80 > #EH80? 

# 0.80  -- DECREASE
my <- mySALTspread[c("EH40", "EH40_80", "EH80"), c(24,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,3),], alternative = "g") #EH40 > #EH80?  
fisher.test(x = my[c(1,2),], alternative = "g") #EH40 > #EH40_80? 
fisher.test(x = my[c(2,3),], alternative = "g") #EH40_80 > #EH80? 


# 1.2 -------------------------------------------------------------------------
# 1.20  -- EXTINCT
my <- mySALTspread[c("EH40", "EH40_80", "EH80"), c(29,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") #EH80 > #EH40? 
fisher.test(x = my[c(3,2),], alternative = "g") #EH80 > 40_80?
fisher.test(x = my[c(2,1),], alternative = "g") #EH40_80 > #EH80? 

# 1.20  -- INCREASE
my <- mySALTspread[c("EH40", "EH40_80", "EH80"), c(31,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") #EH80 > #EH40?  
fisher.test(x = my[c(2,1),], alternative = "g") #EH40_80 > #EH40? 
fisher.test(x = my[c(2,3),], alternative = "g") #EH40_80 > #EH80? 

# 1.20  -- DECREASE
my <- mySALTspread[c("EH40", "EH40_80", "EH80"), c(33,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,3),], alternative = "g") #EH40 > #EH80?  
fisher.test(x = my[c(1,2),], alternative = "g") #EH40 > #EH40_80? 
fisher.test(x = my[c(2,3),], alternative = "g") #EH40_80 > #EH80? 


# 0.4 + 0.8 --------------------------------------------------------------------
# inc
my1 <- mySALTspread[c("EH40", "EH40_80", "EH80"), c(13,1)]; my[,2] <- my[,2] - my[,1]
my2 <- mySALTspread[c("EH40", "EH40_80", "EH80"), c(22,1)]; my[,2] <- my[,2] - my[,1]
my <- my1 + my2
my
fisher.test(x = my[c(2,3),], alternative = "g") # 40_80 > 80
fisher.test(x = my[c(2,1),], alternative = "g") # 40_80 > 40
fisher.test(x = my[c(3,1),], alternative = "g") # 80 > 40

# dec
my1 <- mySALTspread[c("EH40", "EH40_80", "EH80"), c(15,1)]; my[,2] <- my[,2] - my[,1]
my2 <- mySALTspread[c("EH40", "EH40_80", "EH80"), c(24,1)]; my[,2] <- my[,2] - my[,1]
my <- my1 + my2
my
fisher.test(x = my[c(1,3),], alternative = "g") #EH40 > #EH80?  
fisher.test(x = my[c(1,2),], alternative = "g") #EH40 > #EH40_80? 
fisher.test(x = my[c(2,3),], alternative = "g") #EH40_80 > #EH80? 
```

# 40, 20_60, 40_80
``` {r}
# Fishers exact tests ------------------------------------------------------------------------------
# 0.00 -------------------------------------------------------------------------
# 0.00 -- EXTINCT
my <- mySALTspread[c("EH40", "EH20_60", "EH0_80"), c(2,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") # 0_80 > 40
fisher.test(x = my[c(3,2),], alternative = "g") # 0_80 > 20_60
fisher.test(x = my[c(2,1),], alternative = "g") # 20_60 > 40

# 0.00  -- INCREASE
my <- mySALTspread[c("EH40", "EH20_60", "EH0_80"), c(4,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,2),], alternative = "g") # 40 > 20_60
fisher.test(x = my[c(1,3),], alternative = "g") # 40 > 0_80
fisher.test(x = my[c(2,3),], alternative = "g") # 20_60 > 0_80

# 0.00 -- DECREASE -- NO DIFFERENCES IN DECREASE DATA.
my <- mySALTspread[c("EH40", "EH20_60", "EH0_80"), c(6,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(2,1),], alternative = "g") # 20_60 > 40
fisher.test(x = my[c(3,1),], alternative = "g") # 0_80 > 40
fisher.test(x = my[c(3,2),], alternative = "g") # 0_80 > 20_60


# 0.40 -------------------------------------------------------------------------
# 0.40  -- EXTINCT
my <- mySALTspread[c("EH40", "EH20_60", "EH0_80"), c(11,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") # 0_80 > 40
fisher.test(x = my[c(3,2),], alternative = "g") # 0_80 > 20_60
fisher.test(x = my[c(2,1),], alternative = "g") # 20_60 > 40

# 0.40  -- INCREASE
my <- mySALTspread[c("EH40", "EH20_60", "EH0_80"), c(13,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") # 0_80 > 40
fisher.test(x = my[c(3,2),], alternative = "g") # 0_80 > 20_60
fisher.test(x = my[c(2,1),], alternative = "g") # 20_60 > 40

# 0.40  -- DECREASE -- NO DIFFERENCES IN DECREASE DATA.
my <- mySALTspread[c("EH40", "EH20_60", "EH0_80"), c(15,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(2,1),], alternative = "g") # 20_60 > 40
fisher.test(x = my[c(3,1),], alternative = "g") # 0_80 > 40
fisher.test(x = my[c(3,2),], alternative = "g") # 0_80 > 20_60

# 0.80 -------------------------------------------------------------------------
# 0.80  -- EXTINCT
my <- mySALTspread[c("EH40", "EH20_60", "EH0_80"), c(20,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") # 0_80 > 40
fisher.test(x = my[c(3,2),], alternative = "g") # 0_80 > 20_60
fisher.test(x = my[c(2,1),], alternative = "g") # 20_60 > 40

# 0.80  -- INCREASE
my <- mySALTspread[c("EH40", "EH20_60", "EH0_80"), c(22,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") # 0_80 > 40
fisher.test(x = my[c(3,2),], alternative = "g") # 0_80 > 20_60
fisher.test(x = my[c(2,1),], alternative = "g") # 20_60 > 40

# 0.80  -- DECREASE
my <- mySALTspread[c("EH40", "EH20_60", "EH0_80"), c(24,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(2,1),], alternative = "g") # 20_60 > 40
fisher.test(x = my[c(3,1),], alternative = "g") # 0_80 > 40
fisher.test(x = my[c(3,2),], alternative = "g") # 0_80 > 20_60


# 1.2 -------------------------------------------------------------------------
# 1.20  -- EXTINCT
my <- mySALTspread[c("EH40", "EH20_60", "EH0_80"), c(29,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") # 0_80 > 40
fisher.test(x = my[c(2,3),], alternative = "g") # 20_60 > 0_80
fisher.test(x = my[c(2,1),], alternative = "g") # 20_60 > 40

# 1.20  -- INCREASE
my <- mySALTspread[c("EH40", "EH20_60", "EH0_80"), c(31,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") # 0_80 > 40
fisher.test(x = my[c(2,3),], alternative = "g") # 20_60 > 0_80
fisher.test(x = my[c(2,1),], alternative = "g") # 20_60 > 40

# 1.20  -- DECREASE
my <- mySALTspread[c("EH40", "EH20_60", "EH0_80"), c(33,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(2,1),], alternative = "g") # 20_60 > 40
fisher.test(x = my[c(3,1),], alternative = "g") # 0_80 > 40
fisher.test(x = my[c(3,2),], alternative = "g") # 0_80 > 20_60 
```



# 0, 0_40, 0_80
``` {r}
# Fishers exact tests ------------------------------------------------------------------------------
# 0.00 -------------------------------------------------------------------------
# 0.00 -- EXTINCT
my <- mySALTspread[c("EH0", "EH0_40", "EH0_80"), c(2,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,2),], alternative = "g") # 0 > 0_40
fisher.test(x = my[c(1,3),], alternative = "g") # 0 > 0_80
fisher.test(x = my[c(2,3),], alternative = "g") # 0_40 > 0_80

# 0.00  -- INCREASE
my <- mySALTspread[c("EH0", "EH0_40", "EH0_80"), c(4,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,2),], alternative = "g") # 0 > 0_40
fisher.test(x = my[c(1,3),], alternative = "g") # 0 > 0_80
fisher.test(x = my[c(2,3),], alternative = "g") # 0_40 > 0_80

# 0.00 -- DECREASE -- NO DIFFERENCES IN DECREASE DATA.
my <- mySALTspread[c("EH0", "EH0_40", "EH0_80"), c(6,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") # 0_80 > 0
fisher.test(x = my[c(3,2),], alternative = "g") # 0_80 > 0_40
fisher.test(x = my[c(2,1),], alternative = "g") # 0_40 > 0


# 0.40 -------------------------------------------------------------------------
# 0.40  -- EXTINCT
my <- mySALTspread[c("EH0", "EH0_40", "EH0_80"), c(11,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,2),], alternative = "g") # 0 > 0_40
fisher.test(x = my[c(1,3),], alternative = "g") # 0 > 0_80
fisher.test(x = my[c(2,3),], alternative = "g") # 0_40 > 0_80

# 0.40  -- INCREASE
my <- mySALTspread[c("EH0", "EH0_40", "EH0_80"), c(13,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") # 0_80 > 0
fisher.test(x = my[c(3,2),], alternative = "g") # 0_80 > 0_40
fisher.test(x = my[c(1,2),], alternative = "g") # 0 > 0.40

# 0.40  -- DECREASE -- NO DIFFERENCES IN DECREASE DATA.
my <- mySALTspread[c("EH0", "EH0_40", "EH0_80"), c(15,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,3),], alternative = "g") # 0 > 0_80
fisher.test(x = my[c(2,3),], alternative = "g") # 0_40 > 0_80
fisher.test(x = my[c(1,2),], alternative = "g") # 0 > 0_40

# 0.80 -------------------------------------------------------------------------
# 0.80  -- EXTINCT
my <- mySALTspread[c("EH0", "EH0_40", "EH0_80"), c(20,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,3),], alternative = "g") # 0 > 0_80
fisher.test(x = my[c(1,2),], alternative = "g") # 0 > 0_40
fisher.test(x = my[c(3,2),], alternative = "g") # 0_80 > 0_40

# 0.80  -- INCREASE
my <- mySALTspread[c("EH0", "EH0_40", "EH0_80"), c(22,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") # 0_80 > 0
fisher.test(x = my[c(3,2),], alternative = "g") # 0_80 > 0_40
fisher.test(x = my[c(2,1),], alternative = "g") # 0_40 > 0

# 0.80  -- DECREASE
my <- mySALTspread[c("EH0", "EH0_40", "EH0_80"), c(24,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,2),], alternative = "g") # 0 > 0_40
fisher.test(x = my[c(1,3),], alternative = "g") # 0 > 0_80
fisher.test(x = my[c(2,3),], alternative = "g") # 0_40 > 0_80


# 1.2 -------------------------------------------------------------------------
# 1.20  -- EXTINCT
my <- mySALTspread[c("EH0", "EH0_40", "EH0_80"), c(29,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,3),], alternative = "g") # 0 > 0_80
fisher.test(x = my[c(1,2),], alternative = "g") # 0 > 0_40
fisher.test(x = my[c(2,3),], alternative = "g") # 0_40 > 0_80

# 1.20  -- INCREASE
my <- mySALTspread[c("EH0", "EH0_40", "EH0_80"), c(31,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") # 0_80 > 0
fisher.test(x = my[c(3,2),], alternative = "g") # 0_80 > 0_40
fisher.test(x = my[c(2,1),], alternative = "g") # 0_40 > 0

# 1.20  -- DECREASE
my <- mySALTspread[c("EH0", "EH0_40", "EH0_80"), c(33,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,2),], alternative = "g") # 0 > 0_40
fisher.test(x = my[c(1,3),], alternative = "g") # 0 > 0_80
fisher.test(x = my[c(2,3),], alternative = "g") # 0_40 > 0_80
```




# 80, 40_80, 0_80
``` {r}
# Fishers exact tests ------------------------------------------------------------------------------
# 0.00 -------------------------------------------------------------------------
# 0.00 -- EXTINCT
my <- mySALTspread[c("EH80", "EH40_80", "EH0_80"), c(2,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,2),], alternative = "g") # 80 > 40_80
fisher.test(x = my[c(1,3),], alternative = "g") # 80 > 0_80
fisher.test(x = my[c(2,3),], alternative = "g") # 40_80 > 0_80

# 0.00  -- INCREASE
my <- mySALTspread[c("EH80", "EH40_80", "EH0_80"), c(4,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(2,1),], alternative = "g") # 40_80 > 80
fisher.test(x = my[c(2,3),], alternative = "g") # 40_80 > 0_80
fisher.test(x = my[c(1,3),], alternative = "g") # 80 > 0_80

# 0.00 -- DECREASE -- NO DIFFERENCES IN DECREASE DATA.
my <- mySALTspread[c("EH80", "EH40_80", "EH0_80"), c(6,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,2),], alternative = "g") # 80 > 40_80
fisher.test(x = my[c(1,3),], alternative = "g") # 80 > 0_80
fisher.test(x = my[c(2,3),], alternative = "g") # 40_80 > 0_80


# 0.40 -------------------------------------------------------------------------
# 0.40  -- EXTINCT
my <- mySALTspread[c("EH80", "EH40_80", "EH0_80"), c(11,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,2),], alternative = "g") # 80 > 40_80
fisher.test(x = my[c(1,3),], alternative = "g") # 80 > 0_80
fisher.test(x = my[c(2,3),], alternative = "g") # 40_80 > 0_80


# 0.40  -- INCREASE
my <- mySALTspread[c("EH80", "EH40_80", "EH0_80"), c(13,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(2,3),], alternative = "g") # 40_80 > 0_80
fisher.test(x = my[c(2,1),], alternative = "g") # 40_80 > 80
fisher.test(x = my[c(3,1),], alternative = "g") # 0_80 > 80

# 0.40  -- DECREASE -- NO DIFFERENCES IN DECREASE DATA.
my <- mySALTspread[c("EH80", "EH40_80", "EH0_80"), c(15,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,2),], alternative = "g") # 0_80 > 40_80
fisher.test(x = my[c(3,1),], alternative = "g") # 0_80 > 80
fisher.test(x = my[c(2,1),], alternative = "g") # 40_80 > 80

# 0.80 -------------------------------------------------------------------------
# 0.80  -- EXTINCT
my <- mySALTspread[c("EH80", "EH40_80", "EH0_80"), c(20,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,3),], alternative = "g") # 80 > 0_80
fisher.test(x = my[c(1,2),], alternative = "g") # 80 > 40_80
fisher.test(x = my[c(3,2),], alternative = "g") # 0_80 > 40_80

# 0.80  -- INCREASE
my <- mySALTspread[c("EH80", "EH40_80", "EH0_80"), c(22,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(2,3),], alternative = "g") # 40_80 > 0_80
fisher.test(x = my[c(2,1),], alternative = "g") # 40_80 > 80
fisher.test(x = my[c(3,1),], alternative = "g") # 0_80 > 80

# 0.80  -- DECREASE
my <- mySALTspread[c("EH80", "EH40_80", "EH0_80"), c(24,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,2),], alternative = "g") # 0_80 > 40_80
fisher.test(x = my[c(3,1),], alternative = "g") # 0_80 > 80
fisher.test(x = my[c(2,1),], alternative = "g") # 40_80 > 80


# 1.2 -------------------------------------------------------------------------
# 1.20  -- EXTINCT
my <- mySALTspread[c("EH80", "EH40_80", "EH0_80"), c(29,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,2),], alternative = "g") # 80 > 40_80
fisher.test(x = my[c(1,3),], alternative = "g") # 80 > 0_80
fisher.test(x = my[c(2,3),], alternative = "g") # 40_80 > 0_80

# 1.20  -- INCREASE
my <- mySALTspread[c("EH80", "EH40_80", "EH0_80"), c(31,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(2,1),], alternative = "g") # 40_80 > 80
fisher.test(x = my[c(2,3),], alternative = "g") # 40_80 > 0_80
fisher.test(x = my[c(1,3),], alternative = "g") # 80 > 0_80

# 1.20  -- DECREASE
my <- mySALTspread[c("EH80", "EH40_80", "EH0_80"), c(33,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,2),], alternative = "g") # 80 > 40_80
fisher.test(x = my[c(1,3),], alternative = "g") # 80 > 0_80
fisher.test(x = my[c(2,3),], alternative = "g") # 40_80 > 0_80
```


# 0, 40, 80
``` {r}
# Fishers exact tests ------------------------------------------------------------------------------
# 0.00 -------------------------------------------------------------------------
# 0.00 -- EXTINCT
my <- mySALTspread[c("EH0", "EH40", "EH80"), c(2,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") # 80 > 0
fisher.test(x = my[c(3,2),], alternative = "g") # 80 > 40
fisher.test(x = my[c(1,2),], alternative = "g") # 0 > 40

# 0.00  -- INCREASE
my <- mySALTspread[c("EH0", "EH40", "EH80"), c(4,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,2),], alternative = "g") # 0 > 40
fisher.test(x = my[c(1,3),], alternative = "g") # 0 > 80
fisher.test(x = my[c(2,3),], alternative = "g") # 40 > 80

# 0.00 -- DECREASE -- NO DIFFERENCES IN DECREASE DATA.
my <- mySALTspread[c("EH0", "EH40", "EH80"), c(6,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,2),], alternative = "g") # 80 > 40
fisher.test(x = my[c(3,1),], alternative = "g") # 80 > 0
fisher.test(x = my[c(2,1),], alternative = "g") # 40 > 0


# 0.40 -------------------------------------------------------------------------
# 0.40  -- EXTINCT
my <- mySALTspread[c("EH0", "EH40", "EH80"), c(11,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,3),], alternative = "g") # 0 > 80
fisher.test(x = my[c(1,2),], alternative = "g") # 0 > 40
fisher.test(x = my[c(3,2),], alternative = "g") # 80 > 40


# 0.40  -- INCREASE
my <- mySALTspread[c("EH0", "EH40", "EH80"), c(13,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,2),], alternative = "g") # 80 > 40
fisher.test(x = my[c(3,1),], alternative = "g") # 80 > 0
fisher.test(x = my[c(2,1),], alternative = "g") # 40 > 0

# 0.40  -- DECREASE -- NO DIFFERENCES IN DECREASE DATA.
my <- mySALTspread[c("EH0", "EH40", "EH80"), c(15,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,3),], alternative = "g") # 0 > 80
fisher.test(x = my[c(1,2),], alternative = "g") # 0 > 40
fisher.test(x = my[c(3,2),], alternative = "g") # 80 > 40

# 0.80 -------------------------------------------------------------------------
# 0.80  -- EXTINCT
my <- mySALTspread[c("EH0", "EH40", "EH80"), c(20,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") # 80 > 0
fisher.test(x = my[c(3,2),], alternative = "g") # 80 > 40
fisher.test(x = my[c(1,2),], alternative = "g") # 0 > 40

# 0.80  -- INCREASE
my <- mySALTspread[c("EH0", "EH40", "EH80"), c(22,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,2),], alternative = "g") # 80 > 40
fisher.test(x = my[c(3,1),], alternative = "g") # 80 > 0
fisher.test(x = my[c(2,1),], alternative = "g") # 40 > 0

# 0.80  -- DECREASE
my <- mySALTspread[c("EH0", "EH40", "EH80"), c(24,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,2),], alternative = "g") # 0 > 40
fisher.test(x = my[c(1,3),], alternative = "g") # 0 > 80
fisher.test(x = my[c(2,3),], alternative = "g") # 40 > 80


# 1.2 -------------------------------------------------------------------------
# 1.20  -- EXTINCT
my <- mySALTspread[c("EH0", "EH40", "EH80"), c(29,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,3),], alternative = "g") # 0 > 80
fisher.test(x = my[c(1,2),], alternative = "g") # 0 > 40
fisher.test(x = my[c(3,2),], alternative = "g") # 80 > 40

# 1.20  -- INCREASE
my <- mySALTspread[c("EH0", "EH40", "EH80"), c(31,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,2),], alternative = "g") # 80 > 40
fisher.test(x = my[c(3,1),], alternative = "g") # 80 > 0
fisher.test(x = my[c(2,1),], alternative = "g") # 40 > 0

# 1.20  -- DECREASE
my <- mySALTspread[c("EH0", "EH40", "EH80"), c(33,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,2),], alternative = "g") # 0 > 40
fisher.test(x = my[c(1,3),], alternative = "g") # 0 > 80
fisher.test(x = my[c(2,3),], alternative = "g") # 40 > 80
```


# 0_40, 20_60, 40_80
``` {r}
# Fishers exact tests ------------------------------------------------------------------------------
# 0.00 -------------------------------------------------------------------------
# 0.00 -- EXTINCT
my <- mySALTspread[c("EH0_40", "EH20_60", "EH40_80"), c(2,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") # 40_80 > 0_40
fisher.test(x = my[c(3,2),], alternative = "g") # 40_80 > 20_60
fisher.test(x = my[c(1,2),], alternative = "g") # 0_40 > 20_60

# 0.00  -- INCREASE
my <- mySALTspread[c("EH0_40", "EH20_60", "EH40_80"), c(4,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,2),], alternative = "g") # 0_40 > 20_60
fisher.test(x = my[c(1,3),], alternative = "g") # 0_40 > 40_80
fisher.test(x = my[c(2,3),], alternative = "g") # 20_60 > 40_80

# 0.00 -- DECREASE -- NO DIFFERENCES IN DECREASE DATA.
my <- mySALTspread[c("EH0_40", "EH20_60", "EH40_80"), c(6,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,2),], alternative = "g") # 80 > 40
fisher.test(x = my[c(3,1),], alternative = "g") # 80 > 0
fisher.test(x = my[c(2,1),], alternative = "g") # 40 > 0


# 0.40 -------------------------------------------------------------------------
# 0.40  -- EXTINCT
my <- mySALTspread[c("EH0_40", "EH20_60", "EH40_80"), c(11,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") # 40_80 > 0_40
fisher.test(x = my[c(3,2),], alternative = "g") # 40_80 > 20_60
fisher.test(x = my[c(1,2),], alternative = "g") # 0_40 > 20_60


# 0.40  -- INCREASE
my <- mySALTspread[c("EH0_40", "EH20_60", "EH40_80"), c(13,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,2),], alternative = "g") # 40_80 > 20_60
fisher.test(x = my[c(3,1),], alternative = "g") # 40_80 > 0_40
fisher.test(x = my[c(2,1),], alternative = "g") # 20_60 > 0_40

# 0.40  -- DECREASE -- NO DIFFERENCES IN DECREASE DATA.
my <- mySALTspread[c("EH0_40", "EH20_60", "EH40_80"), c(15,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,2),], alternative = "g") # 0_40 > 20_60
fisher.test(x = my[c(1,3),], alternative = "g") # 0_40 > 40_80
fisher.test(x = my[c(2,3),], alternative = "g") # 20_60 > 40_80

# 0.80 -------------------------------------------------------------------------
# 0.80  -- EXTINCT
my <- mySALTspread[c("EH0_40", "EH20_60", "EH40_80"), c(20,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") # 40_80 > 0_40
fisher.test(x = my[c(3,2),], alternative = "g") # 40_80 > 20_60
fisher.test(x = my[c(1,2),], alternative = "g") # 0_40 > 20_60

# 0.80  -- INCREASE
my <- mySALTspread[c("EH0_40", "EH20_60", "EH40_80"), c(22,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,2),], alternative = "g") # 40_80 > 20_60
fisher.test(x = my[c(3,1),], alternative = "g") # 40_80 > 0_40
fisher.test(x = my[c(2,1),], alternative = "g") # 20_60 > 0_40

# 0.80  -- DECREASE
my <- mySALTspread[c("EH0_40", "EH20_60", "EH40_80"), c(24,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,2),], alternative = "g") # 0_40 > 20_60
fisher.test(x = my[c(1,3),], alternative = "g") # 0_40 > 40_80
fisher.test(x = my[c(2,3),], alternative = "g") # 20_60 > 40_80


# 1.2 -------------------------------------------------------------------------
# 1.20  -- EXTINCT
my <- mySALTspread[c("EH0_40", "EH20_60", "EH40_80"), c(29,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(2,3),], alternative = "g") # 20_60 > 40_80
fisher.test(x = my[c(2,1),], alternative = "g") # 20_60 > 0_40
fisher.test(x = my[c(3,1),], alternative = "g") # 40_80 > 0_40

# 1.20  -- INCREASE
my <- mySALTspread[c("EH0_40", "EH20_60", "EH40_80"), c(31,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,2),], alternative = "g") # 40_80 > 20_60
fisher.test(x = my[c(3,1),], alternative = "g") # 40_80 > 0_40
fisher.test(x = my[c(2,1),], alternative = "g") # 20_60 > 0_40


# 1.20  -- DECREASE
my <- mySALTspread[c("EH0_40", "EH20_60", "EH40_80"), c(33,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,2),], alternative = "g") # 0_40 > 20_60
fisher.test(x = my[c(1,3),], alternative = "g") # 0_40 > 40_80
fisher.test(x = my[c(2,3),], alternative = "g") # 20_60 > 40_80

```


# 0_40, 20_60, 40_80
``` {r}
# Fishers exact tests ------------------------------------------------------------------------------
# 0.00 -------------------------------------------------------------------------
# 0.00 -- EXTINCT
my <- mySALTspread[c("EH0_40", "EH40", "EH40_80"), c(2,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") # 40_80 > 0_40
fisher.test(x = my[c(3,2),], alternative = "g") # 40_80 > 40
fisher.test(x = my[c(1,2),], alternative = "g") # 0_40 > 40

# 0.00  -- INCREASE
my <- mySALTspread[c("EH0_40", "EH40", "EH40_80"), c(4,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,2),], alternative = "g") # 40_80 > 40
fisher.test(x = my[c(1,3),], alternative = "g") # 40_80 > 0_40
fisher.test(x = my[c(2,3),], alternative = "g") # 40 > 0_40

# 0.00 -- DECREASE -- NO DIFFERENCES IN DECREASE DATA.
my <- mySALTspread[c("EH0_40", "EH40", "EH40_80"), c(6,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,2),], alternative = "g") # 40_80 > 40
fisher.test(x = my[c(3,1),], alternative = "g") # 40_80 > 0_40
fisher.test(x = my[c(2,1),], alternative = "g") # 40 > 0_40


# 0.40 -------------------------------------------------------------------------
# 0.40  -- EXTINCT
my <- mySALTspread[c("EH0_40", "EH40", "EH40_80"), c(11,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") # 40_80 > 0_40
fisher.test(x = my[c(3,2),], alternative = "g") # 40_80 > 40
fisher.test(x = my[c(1,2),], alternative = "g") # 0_40 > 40


# 0.40  -- INCREASE
my <- mySALTspread[c("EH0_40", "EH40", "EH40_80"), c(13,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,2),], alternative = "g") # 40-80 > 40
fisher.test(x = my[c(3,1),], alternative = "g") # 40_80 > 0_40
fisher.test(x = my[c(2,1),], alternative = "g") # 40 > 0_40

# 0.40  -- DECREASE -- NO DIFFERENCES IN DECREASE DATA.
my <- mySALTspread[c("EH0_40", "EH40", "EH40_80"), c(15,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,2),], alternative = "g") # 0_40 > 40
fisher.test(x = my[c(1,3),], alternative = "g") # 0_40 > 40_80
fisher.test(x = my[c(2,3),], alternative = "g") # 40 > 40_80

# 0.80 -------------------------------------------------------------------------
# 0.80  -- EXTINCT
my <- mySALTspread[c("EH0_40", "EH40", "EH40_80"), c(20,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") # 40_80 > 0_40
fisher.test(x = my[c(3,2),], alternative = "g") # 40_80 > 40
fisher.test(x = my[c(1,2),], alternative = "g") # 0_40 > 40

# 0.80  -- INCREASE
my <- mySALTspread[c("EH0_40", "EH40", "EH40_80"), c(22,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,2),], alternative = "g") # 40-80 > 40
fisher.test(x = my[c(3,1),], alternative = "g") # 40_80 > 0_40
fisher.test(x = my[c(2,1),], alternative = "g") # 40 > 0_40


# 0.80  -- DECREASE
my <- mySALTspread[c("EH0_40", "EH40", "EH40_80"), c(24,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,2),], alternative = "g") # 0_40 > 40
fisher.test(x = my[c(1,3),], alternative = "g") # 0_40 > 40_80
fisher.test(x = my[c(2,3),], alternative = "g") # 40 > 40_80


# 1.2 -------------------------------------------------------------------------
# 1.20  -- EXTINCT
my <- mySALTspread[c("EH0_40", "EH40", "EH40_80"), c(29,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,1),], alternative = "g") # 40_80 > 0_40
fisher.test(x = my[c(3,2),], alternative = "g") # 40_80 > 40
fisher.test(x = my[c(1,2),], alternative = "g") # 0_40 > 40


# 1.20  -- INCREASE
my <- mySALTspread[c("EH0_40", "EH40", "EH40_80"), c(31,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(3,2),], alternative = "g") # 40-80 > 40
fisher.test(x = my[c(3,1),], alternative = "g") # 40_80 > 0_40
fisher.test(x = my[c(2,1),], alternative = "g") # 40 > 0_40


# 1.20  -- DECREASE
my <- mySALTspread[c("EH0_40", "EH40", "EH40_80"), c(33,1)]; my[,2] <- my[,2] - my[,1]
my
fisher.test(x = my[c(1,2),], alternative = "g", simulate.p.value = T) # 0_40 > 40
x <- chisq.test(x = my[c(1,2),], simulate.p.value = T)
x$expected
fisher.test(x = my[c(1,3),], alternative = "g") # 0_40 > 40_80
fisher.test(x = my[c(2,3),], alternative = "g") # 40 > 40_80


```