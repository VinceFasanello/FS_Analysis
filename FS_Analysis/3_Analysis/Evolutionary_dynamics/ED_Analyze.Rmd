---
title: "ED_Analyze.rmd"
output:
  html_document:
    df_print: paged
---

nrow(welldata[welldata$treat == "EH0_80" & welldata$epo %in% c("SALT_A", "SALT_B") & welldata$mpasp == 0.0,])
***
### Begin Code Blocks:

Prepare the workspace: clean, set options, load packages, load and final formatting on inputs.
```{r, warning = FALSE, message=FALSE}
rm(list = ls()) # clear workspace
knitr::opts_chunk$set(tidy = TRUE, collapse = TRUE) # set global knitr options.
# load required packages
require(ggplot2); # used for plotting
require(pwr); # used for power analysis
require(lme4); # used for mixed effects models
require(lmerTest); # used to interpret mixed effects models
require(sjPlot); # used to output tables
require(weights); # used for weighted t.test
require(plyr); # used for dataframe manipulation
require(gridExtra) # used for multipanel plotting
require(barnard)
require(GGally)
require(plotly)
require(dplyr)
require(tidyr)
require(ggthemes)
require(viridis)
require(gtable)
require(cowplot)
options(scipen = 999) # turn off scientific notation
```
<br/><br/>



Load data
```{r, warning = FALSE, message=FALSE}
load(file = "myd.Rdata")
```
<br/><br/>

Assess Fixation rate for wells that started between 50:50 and 25:75 prop. denom is all wells with init props less extreme than 25:75
```{r, warning = FALSE, message=FALSE}
mymin <- c(0,20,0,0,40,20,0,60,40,80,100)
mymax <- c(0,20,40,60,40,60,80,60,80,80,100)

my_fix <- myd[myd$plate %in% c("SALT_A", "SALT_B"),] %>%
  group_by(treat) %>%
  summarize(sumtreat = length(treat[diff0 <= .25]),
            fixedtreat = length(treat[fixed]),
            fixedprop = fixedtreat/sumtreat)
my_fix$min <- mymin; my_fix$max <- mymax; my_fix$mn <- rowMeans(my_fix[c("min", "max")])
my_fix_SALT <- my_fix



my_fix <- myd[myd$plate %in% c("COPR_A", "COPR_B"),] %>%
  group_by(treat) %>%
  summarize(sumtreat = length(treat[diff0 <= .25]),
            fixedtreat = length(treat[fixed]),
            fixedprop = fixedtreat/sumtreat)
my_fix$min <- mymin; my_fix$max <- mymax; my_fix$mn <- rowMeans(my_fix[c("min", "max")])
my_fix_COPR <- my_fix



my_fix <- myd[myd$plate %in% c("SULF_A", "SULF_B"),] %>%
  group_by(treat) %>%
  summarize(sumtreat = length(treat[diff0 <= .25]),
            fixedtreat = length(treat[fixed]),
            fixedprop = fixedtreat/sumtreat)
my_fix$min <- mymin; my_fix$max <- mymax; my_fix$mn <- rowMeans(my_fix[c("min", "max")])
my_fix_SULF <- my_fix


write.csv(my_fix_SALT,  file = "my_fix_SALT7525.csv")
write.csv(my_fix_COPR,  file = "my_fix_COPR7525.csv")
write.csv(my_fix_SULF,  file = "my_fix_SULF7525.csv")


rm(my_fix, mymax, mymin)
```
<br/><br/>

Assess Fixation rate for wells that started between 50:50 and 25:75 prop. denom is all wells with init props less extreme than 25:75
```{r, warning = FALSE, message=FALSE}
mymin <- c(0,20,0,0,40,20,0,60,40,80,100)
mymax <- c(0,20,40,60,40,60,80,60,80,80,100)

my_fix <- myd[myd$plate %in% c("SALT_A", "SALT_B"),] %>%
  group_by(treat) %>%
  summarize(sumtreat = length(treat[diff0 <= .45]),
            fixedtreat = length(treat[fixed]),
            fixedprop = fixedtreat/sumtreat)
my_fix$min <- mymin; my_fix$max <- mymax; my_fix$mn <- rowMeans(my_fix[c("min", "max")])
my_fix_SALT <- my_fix



my_fix <- myd[myd$plate %in% c("COPR_A", "COPR_B"),] %>%
  group_by(treat) %>%
  summarize(sumtreat = length(treat[diff0 <= .45]),
            fixedtreat = length(treat[fixed]),
            fixedprop = fixedtreat/sumtreat)
my_fix$min <- mymin; my_fix$max <- mymax; my_fix$mn <- rowMeans(my_fix[c("min", "max")])
my_fix_COPR <- my_fix



my_fix <- myd[myd$plate %in% c("SULF_A", "SULF_B"),] %>%
  group_by(treat) %>%
  summarize(sumtreat = length(treat[diff0 <= .45]),
            fixedtreat = length(treat[fixed]),
            fixedprop = fixedtreat/sumtreat)
my_fix$min <- mymin; my_fix$max <- mymax; my_fix$mn <- rowMeans(my_fix[c("min", "max")])
my_fix_SULF <- my_fix


write.csv(my_fix_SALT,  file = "my_fix_SALT9010.csv")
write.csv(my_fix_COPR,  file = "my_fix_COPR9010.csv")
write.csv(my_fix_SULF,  file = "my_fix_SULF9010.csv")


rm(my_fix, mymax, mymin)
```
<br/><br/>



Assess Fixation rate with no starting limit on initial props. denom is al wells in treat
```{r, warning = FALSE, message=FALSE}
mymin <- c(0,20,0,0,40,20,0,60,40,80,100)
mymax <- c(0,20,40,60,40,60,80,60,80,80,100)

my_fix <- myd[myd$plate %in% c("SALT_A", "SALT_B"),] %>%
  group_by(treat) %>%
  summarize(sumtreat = n(),
            fixedtreat = length(treat[fixednsl]),
            fixedprop = fixedtreat/sumtreat)
my_fix$min <- mymin; my_fix$max <- mymax; my_fix$mn <- rowMeans(my_fix[c("min", "max")])
my_fixnsl_SALT <- my_fix

my_fix <- myd[myd$plate %in% c("COPR_A", "COPR_B"),] %>%
  group_by(treat) %>%
  summarize(sumtreat = n(),
            fixedtreat = length(treat[fixednsl]),
            fixedprop = fixedtreat/sumtreat)
my_fix$min <- mymin; my_fix$max <- mymax; my_fix$mn <- rowMeans(my_fix[c("min", "max")])
my_fixnsl_COPR <- my_fix

my_fix <- myd[myd$plate %in% c("SULF_A", "SULF_B"),] %>%
  group_by(treat) %>%
  summarize(sumtreat = n(),
            fixedtreat = length(treat[fixednsl]),
            fixedprop = fixedtreat/sumtreat)
my_fix$min <- mymin; my_fix$max <- mymax; my_fix$mn <- rowMeans(my_fix[c("min", "max")])
my_fixnsl_SULF <- my_fix


# high correpsondance between the restricted dataset results and the full dataset. 
cor(my_fix_SALT$fixedprop, my_fixnsl_SALT$fixedprop)
cor(my_fix_COPR$fixedprop, my_fixnsl_COPR$fixedprop)
cor(my_fix_SULF$fixedprop, my_fixnsl_SULF$fixedprop)


write.csv(my_fixnsl_SALT,  file = "my_fixnsl_SALT.csv")
write.csv(my_fixnsl_COPR,  file = "my_fixnsl_COPR.csv")
write.csv(my_fixnsl_SULF,  file = "my_fixnsl_SULF.csv")

rm(my_fix, mymax, mymin)
```




```{r, warning = FALSE, message=FALSE}
# https://stackoverflow.com/questions/54438495/shift-legend-into-empty-facets-of-a-faceted-plot-in-ggplot2
shift_legend <- function(p){

  # check if p is a valid object
  if(!"gtable" %in% class(p)){
    if("ggplot" %in% class(p)){
      gp <- ggplotGrob(p) # convert to grob
    } else {
      message("This is neither a ggplot object nor a grob generated from ggplotGrob. Returning original plot.")
      return(p)
    }
  } else {
    gp <- p
  }

  # check for unfilled facet panels
  facet.panels <- grep("^panel", gp[["layout"]][["name"]])
  empty.facet.panels <- sapply(facet.panels, function(i) "zeroGrob" %in% class(gp[["grobs"]][[i]]))
  empty.facet.panels <- facet.panels[empty.facet.panels]
  if(length(empty.facet.panels) == 0){
    message("There are no unfilled facet panels to shift legend into. Returning original plot.")
    return(p)
  }

  # establish extent of unfilled facet panels (including any axis cells in between)
  empty.facet.panels <- gp[["layout"]][empty.facet.panels, ]
  empty.facet.panels <- list(min(empty.facet.panels[["t"]]), min(empty.facet.panels[["l"]]),
                             max(empty.facet.panels[["b"]]), max(empty.facet.panels[["r"]]))
  names(empty.facet.panels) <- c("t", "l", "b", "r")

  # extract legend & copy over to location of unfilled facet panels
  guide.grob <- which(gp[["layout"]][["name"]] == "guide-box")
  if(length(guide.grob) == 0){
    message("There is no legend present. Returning original plot.")
    return(p)
  }
  gp <- gtable_add_grob(x = gp,
                        grobs = gp[["grobs"]][[guide.grob]],
                        t = empty.facet.panels[["t"]],
                        l = empty.facet.panels[["l"]],
                        b = empty.facet.panels[["b"]],
                        r = empty.facet.panels[["r"]],
                        name = "new-guide-box")

  # squash the original guide box's row / column (whichever applicable)
  # & empty its cell
  guide.grob <- gp[["layout"]][guide.grob, ]
  if(guide.grob[["l"]] == guide.grob[["r"]]){
    gp <- gtable_squash_cols(gp, cols = guide.grob[["l"]])
  }
  if(guide.grob[["t"]] == guide.grob[["b"]]){
    gp <- gtable_squash_rows(gp, rows = guide.grob[["t"]])
  }
  gp <- gtable_remove_grobs(gp, "guide-box")

  return(gp)
}





# log transformation for modeling. ---------------------------------------------
log_transform <- function(myvar){
  myvar <- log(((myvar - min(myvar))/(max(myvar) - min(myvar))) + 1) 
  return(myvar)
}


```


SALT
DIFF heatmaps [truncated]
```{r, warning = FALSE, message=FALSE}
my <- myd[myd$plate %in% c("SALT_A", "SALT_B") & myd$diff0 <= 0.25,]
my$diff0_ret <- my$diff0
my <- my[,c("treat","diff0_ret","plate","bc1", "diff0", "diff7", "diff13", "diff19", "diff25", "diff31", "diff37", "diff43", "diff49")]
myl <- gather(my, condition, measurement, diff0, diff7, diff13, diff19, diff25, diff31, diff37, diff43, diff49)


myl <- myl[order(myl$treat, -myl$diff0_ret),]
myl$x <- paste0(myl$bc1, myl$plate, myl$diff0_ret); myl$x <- factor(myl$x, levels = unique(myl$x))
myl$condition <- factor(myl$condition, levels = c("diff0", "diff7", "diff13", "diff19", "diff25", "diff31", "diff37", "diff43", "diff49"))


pdf(file = "SALT_diff_trunc.pdf", width = 10, height = 10)
p <- ggplot(myl, aes(x = condition, y = x, fill = measurement)) + 
  geom_tile()+
  theme_tufte(base_family="Helvetica")+
  facet_wrap(~treat, switch = "y", scales = "free_y", ncol = 3) + 
  theme(axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        plot.title = element_text(face = "bold"),
        axis.title = element_text(face = "bold"))+
  ylab("Treatment") +
  xlab("Day")+
  ggtitle("SALT: Deviation from 50:50 proportion [TRUNCATED]")+
  scale_x_discrete(labels=c("diff0" = "0", "diff7" = "7", "diff13" = "13", "diff19" = "19",
                            "diff25" = "25", "diff31" = "31", "diff37" = "37", "diff43" = "43", 
                            "diff49" = "49"))

p.new <- p + scale_fill_viridis(limits = c(0,0.5), 
                                breaks = c(0,0.1,0.2,0.3,0.4,0.5 ), 
                                name = "Deviation from 50:50 Prop")+
  guides(fill = guide_colorbar(title.position = "top",
                               label.position = "bottom")) +
  theme(legend.direction = "horizontal")
grid::grid.draw(shift_legend(p.new))

dev.off()

rm(my, myl, p, p.new)
```

SALT
DIFF heatmaps [full]
```{r, warning = FALSE, message=FALSE}
my <- myd[myd$plate %in% c("SALT_A", "SALT_B"),]
my$diff0_ret <- my$diff0
my <- my[,c("treat","diff0_ret","plate","bc1", "diff0", "diff7", "diff13", "diff19", "diff25", "diff31", "diff37", "diff43", "diff49")]
myl <- gather(my, condition, measurement, diff0, diff7, diff13, diff19, diff25, diff31, diff37, diff43, diff49)


myl <- myl[order(myl$treat, -myl$diff0_ret),]
myl$x <- paste0(myl$bc1, myl$plate, myl$diff0_ret); myl$x <- factor(myl$x, levels = unique(myl$x))
myl$condition <- factor(myl$condition, levels = c("diff0", "diff7", "diff13", "diff19", "diff25", "diff31", "diff37", "diff43", "diff49"))


pdf(file = "SALT_diff_full.pdf", width = 10, height = 10)
p <- ggplot(myl, aes(x = condition, y = x, fill = measurement)) + 
  geom_tile()+
  theme_tufte(base_family="Helvetica")+
  facet_wrap(~treat, switch = "y", scales = "free_y", ncol = 3) + 
  theme(axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        plot.title = element_text(face = "bold"),
        axis.title = element_text(face = "bold"))+
  ylab("Treatment") +
  xlab("Day")+
  ggtitle("SALT: Deviation from 50:50 proportion [FULL]")+
  scale_x_discrete(labels=c("diff0" = "0", "diff7" = "7", "diff13" = "13", "diff19" = "19",
                            "diff25" = "25", "diff31" = "31", "diff37" = "37", "diff43" = "43", 
                            "diff49" = "49"))

p.new <- p + scale_fill_viridis(limits = c(0,0.5), 
                                breaks = c(0,0.1,0.2,0.3,0.4,0.5 ), 
                                name = "Deviation from 50:50 Prop")+
  guides(fill = guide_colorbar(title.position = "top",
                               label.position = "bottom")) +
  theme(legend.direction = "horizontal")
grid::grid.draw(shift_legend(p.new))

dev.off()

rm(my, myl, p, p.new)
```



COPR
DIFF heatmaps [truncated]
```{r, warning = FALSE, message=FALSE}
my <- myd[myd$plate %in% c("COPR_A", "COPR_B") & myd$diff0 <= 0.25,]
my$diff0_ret <- my$diff0
my <- my[,c("treat","diff0_ret","plate","bc1", "diff0", "diff7", "diff13", "diff19", "diff25", "diff31", "diff37", "diff43", "diff49")]
myl <- gather(my, condition, measurement, diff0, diff7, diff13, diff19, diff25, diff31, diff37, diff43, diff49)


myl <- myl[order(myl$treat, -myl$diff0_ret),]
myl$x <- paste0(myl$bc1, myl$plate, myl$diff0_ret); myl$x <- factor(myl$x, levels = unique(myl$x))
myl$condition <- factor(myl$condition, levels = c("diff0", "diff7", "diff13", "diff19", "diff25", "diff31", "diff37", "diff43", "diff49"))


pdf(file = "COPR_diff_trunc.pdf", width = 10, height = 10)
p <- ggplot(myl, aes(x = condition, y = x, fill = measurement)) + 
  geom_tile()+
  theme_tufte(base_family="Helvetica")+
  facet_wrap(~treat, switch = "y", scales = "free_y", ncol = 3) + 
  theme(axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        plot.title = element_text(face = "bold"),
        axis.title = element_text(face = "bold"))+
  ylab("Treatment") +
  xlab("Day")+
  ggtitle("COPR: Deviation from 50:50 proportion [TRUNCATED]")+
  scale_x_discrete(labels=c("diff0" = "0", "diff7" = "7", "diff13" = "13", "diff19" = "19",
                            "diff25" = "25", "diff31" = "31", "diff37" = "37", "diff43" = "43", 
                            "diff49" = "49"))

p.new <- p + scale_fill_viridis(limits = c(0,0.5), 
                                breaks = c(0,0.1,0.2,0.3,0.4,0.5 ), 
                                name = "Deviation from 50:50 Prop")+
  guides(fill = guide_colorbar(title.position = "top",
                               label.position = "bottom")) +
  theme(legend.direction = "horizontal")
grid::grid.draw(shift_legend(p.new))

dev.off()

rm(my, myl, p, p.new)
```

COPR
DIFF heatmaps [full]
```{r, warning = FALSE, message=FALSE}
my <- myd[myd$plate %in% c("COPR_A", "COPR_B"),]
my$diff0_ret <- my$diff0
my <- my[,c("treat","diff0_ret","plate","bc1", "diff0", "diff7", "diff13", "diff19", "diff25", "diff31", "diff37", "diff43", "diff49")]
myl <- gather(my, condition, measurement, diff0, diff7, diff13, diff19, diff25, diff31, diff37, diff43, diff49)


myl <- myl[order(myl$treat, -myl$diff0_ret),]
myl$x <- paste0(myl$bc1, myl$plate, myl$diff0_ret); myl$x <- factor(myl$x, levels = unique(myl$x))
myl$condition <- factor(myl$condition, levels = c("diff0", "diff7", "diff13", "diff19", "diff25", "diff31", "diff37", "diff43", "diff49"))


pdf(file = "COPR_diff_full.pdf", width = 10, height = 10)
p <- ggplot(myl, aes(x = condition, y = x, fill = measurement)) + 
  geom_tile()+
  theme_tufte(base_family="Helvetica")+
  facet_wrap(~treat, switch = "y", scales = "free_y", ncol = 3) + 
  theme(axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        plot.title = element_text(face = "bold"),
        axis.title = element_text(face = "bold"))+
  ylab("Treatment") +
  xlab("Day")+
  ggtitle("COPR: Deviation from 50:50 proportion [FULL]")+
  scale_x_discrete(labels=c("diff0" = "0", "diff7" = "7", "diff13" = "13", "diff19" = "19",
                            "diff25" = "25", "diff31" = "31", "diff37" = "37", "diff43" = "43", 
                            "diff49" = "49"))

p.new <- p + scale_fill_viridis(limits = c(0,0.5), 
                                breaks = c(0,0.1,0.2,0.3,0.4,0.5 ), 
                                name = "Deviation from 50:50 Prop")+
  guides(fill = guide_colorbar(title.position = "top",
                               label.position = "bottom")) +
  theme(legend.direction = "horizontal")
grid::grid.draw(shift_legend(p.new))

dev.off()

rm(my, myl, p, p.new)
```



SULF
DIFF heatmaps [truncated]
```{r, warning = FALSE, message=FALSE}
my <- myd[myd$plate %in% c("SULF_A", "SULF_B") & myd$diff0 <= 0.25,]
my$diff0_ret <- my$diff0
my <- my[,c("treat","diff0_ret","plate","bc1", "diff0", "diff7", "diff13", "diff19", "diff25", "diff31", "diff37", "diff43", "diff49")]
myl <- gather(my, condition, measurement, diff0, diff7, diff13, diff19, diff25, diff31, diff37, diff43, diff49)


myl <- myl[order(myl$treat, -myl$diff0_ret),]
myl$x <- paste0(myl$bc1, myl$plate, myl$diff0_ret); myl$x <- factor(myl$x, levels = unique(myl$x))
myl$condition <- factor(myl$condition, levels = c("diff0", "diff7", "diff13", "diff19", "diff25", "diff31", "diff37", "diff43", "diff49"))


pdf(file = "SULF_diff_trunc.pdf", width = 10, height = 10)
p <- ggplot(myl, aes(x = condition, y = x, fill = measurement)) + 
  geom_tile()+
  theme_tufte(base_family="Helvetica")+
  facet_wrap(~treat, switch = "y", scales = "free_y", ncol = 3) + 
  theme(axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        plot.title = element_text(face = "bold"),
        axis.title = element_text(face = "bold"))+
  ylab("Treatment") +
  xlab("Day")+
  ggtitle("SULF: Deviation from 50:50 proportion [TRUNCATED]")+
  scale_x_discrete(labels=c("diff0" = "0", "diff7" = "7", "diff13" = "13", "diff19" = "19",
                            "diff25" = "25", "diff31" = "31", "diff37" = "37", "diff43" = "43", 
                            "diff49" = "49"))

p.new <- p + scale_fill_viridis(limits = c(0,0.5), 
                                breaks = c(0,0.1,0.2,0.3,0.4,0.5 ), 
                                name = "Deviation from 50:50 Prop")+
  guides(fill = guide_colorbar(title.position = "top",
                               label.position = "bottom")) +
  theme(legend.direction = "horizontal")
grid::grid.draw(shift_legend(p.new))

dev.off()

rm(my, myl, p, p.new)
```

SULF
DIFF heatmaps [full]
```{r, warning = FALSE, message=FALSE}
my <- myd[myd$plate %in% c("SULF_A", "SULF_B"),]
my$diff0_ret <- my$diff0
my <- my[,c("treat","diff0_ret","plate","bc1", "diff0", "diff7", "diff13", "diff19", "diff25", "diff31", "diff37", "diff43", "diff49")]
myl <- gather(my, condition, measurement, diff0, diff7, diff13, diff19, diff25, diff31, diff37, diff43, diff49)


myl <- myl[order(myl$treat, -myl$diff0_ret),]
myl$x <- paste0(myl$bc1, myl$plate, myl$diff0_ret); myl$x <- factor(myl$x, levels = unique(myl$x))
myl$condition <- factor(myl$condition, levels = c("diff0", "diff7", "diff13", "diff19", "diff25", "diff31", "diff37", "diff43", "diff49"))


pdf(file = "SULF_diff_full.pdf", width = 10, height = 10)
p <- ggplot(myl, aes(x = condition, y = x, fill = measurement)) + 
  geom_tile()+
  theme_tufte(base_family="Helvetica")+
  facet_wrap(~treat, switch = "y", scales = "free_y", ncol = 3) + 
  theme(axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        plot.title = element_text(face = "bold"),
        axis.title = element_text(face = "bold"))+
  ylab("Treatment") +
  xlab("Day")+
  ggtitle("SULF: Deviation from 50:50 proportion [FULL]")+
  scale_x_discrete(labels=c("diff0" = "0", "diff7" = "7", "diff13" = "13", "diff19" = "19",
                            "diff25" = "25", "diff31" = "31", "diff37" = "37", "diff43" = "43", 
                            "diff49" = "49"))

p.new <- p + scale_fill_viridis(limits = c(0,0.5), 
                                breaks = c(0,0.1,0.2,0.3,0.4,0.5 ), 
                                name = "Deviation from 50:50 Prop")+
  guides(fill = guide_colorbar(title.position = "top",
                               label.position = "bottom")) +
  theme(legend.direction = "horizontal")
grid::grid.draw(shift_legend(p.new))

dev.off()

rm(my, myl, p, p.new)
```






SALT
rate heatmaps [trunc]
```{r, warning = FALSE, message=FALSE}
my <- myd[myd$plate %in% c("SALT_A", "SALT_B") & myd$diff0 <= 0.25,]
my$diff0_ret <- my$diff0
my <- my[,c("treat","diff0_ret","plate","bc1", "dp0_7", "dp7_13", "dp13_19", "dp19_25", "dp25_31", "dp31_37", "dp37_43", "dp43_49")]
myl <- gather(my, condition, measurement, dp0_7, dp7_13, dp13_19, dp19_25, dp25_31, dp31_37, dp37_43, dp43_49)


myl <- myl[order(myl$treat, -myl$diff0_ret),]
myl$x <- paste0(myl$bc1, myl$plate, myl$diff0_ret); myl$x <- factor(myl$x, levels = unique(myl$x))
myl$condition <- factor(myl$condition, levels = c("dp0_7", "dp7_13", "dp13_19", "dp19_25", "dp25_31", "dp31_37", "dp37_43", "dp43_49"))
myl$measurement <- abs(myl$measurement)
# myl$measurement <- log_transform(myl$measurement)
# hist(myl$measurement)

pdf(file = "SALT_dp_trunc.pdf", width = 10, height = 10)
p <- ggplot(myl, aes(x = condition, y = x, fill = measurement)) + 
  geom_tile()+
  theme_tufte(base_family="Helvetica")+
  facet_wrap(~treat, switch = "y", scales = "free_y", ncol = 3) + 
  theme(axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        plot.title = element_text(face = "bold"),
        axis.title = element_text(face = "bold"))+
  ylab("Treatment") +
  xlab("Day")+
  ggtitle("SALT: Rate of Change in BC Prop [FULL]")+
  scale_x_discrete(labels=c("dp0_7" = "0_7", "dp7_13" = "7_13", "dp13_19" = "13_19", "dp19_25" = "19_25",
                            "dp25_31" = "25_31", "dp31_37" = "31_37", "dp37_43" = "37_43", "dp43_49" = "43_49"))

# p.new <- p + scale_fill_viridis(limits = c(0,0.5), 
#                                 breaks = c(0,0.1,0.2,0.3,0.4,0.5 ), 
#                                 name = "Rate of Change in BC Prop")+
p.new <- p + scale_fill_viridis(name = "Rate of Change in BC Prop")+
  guides(fill = guide_colorbar(title.position = "top",
                               label.position = "bottom")) +
  theme(legend.direction = "horizontal")
grid::grid.draw(shift_legend(p.new))

dev.off()

rm(my, myl, p, p.new)
```

SALT
rate heatmaps [full]
```{r, warning = FALSE, message=FALSE}
my <- myd[myd$plate %in% c("SALT_A", "SALT_B"),]
my$diff0_ret <- my$diff0
my <- my[,c("treat","diff0_ret","plate","bc1", "dp0_7", "dp7_13", "dp13_19", "dp19_25", "dp25_31", "dp31_37", "dp37_43", "dp43_49")]
myl <- gather(my, condition, measurement, dp0_7, dp7_13, dp13_19, dp19_25, dp25_31, dp31_37, dp37_43, dp43_49)


myl <- myl[order(myl$treat, -myl$diff0_ret),]
myl$x <- paste0(myl$bc1, myl$plate, myl$diff0_ret); myl$x <- factor(myl$x, levels = unique(myl$x))
myl$condition <- factor(myl$condition, levels = c("dp0_7", "dp7_13", "dp13_19", "dp19_25", "dp25_31", "dp31_37", "dp37_43", "dp43_49"))
myl$measurement <- abs(myl$measurement)
# myl$measurement <- log_transform(myl$measurement)
# hist(myl$measurement)

pdf(file = "SALT_dp_full.pdf", width = 10, height = 10)
p <- ggplot(myl, aes(x = condition, y = x, fill = measurement)) + 
  geom_tile()+
  theme_tufte(base_family="Helvetica")+
  facet_wrap(~treat, switch = "y", scales = "free_y", ncol = 3) + 
  theme(axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        plot.title = element_text(face = "bold"),
        axis.title = element_text(face = "bold"))+
  ylab("Treatment") +
  xlab("Day")+
  ggtitle("SALT: Rate of Change in BC Prop [FULL]")+
  scale_x_discrete(labels=c("dp0_7" = "0_7", "dp7_13" = "7_13", "dp13_19" = "13_19", "dp19_25" = "19_25",
                            "dp25_31" = "25_31", "dp31_37" = "31_37", "dp37_43" = "37_43", "dp43_49" = "43_49"))

# p.new <- p + scale_fill_viridis(limits = c(0,0.5), 
#                                 breaks = c(0,0.1,0.2,0.3,0.4,0.5 ), 
#                                 name = "Rate of Change in BC Prop")+
p.new <- p + scale_fill_viridis(name = "Rate of Change in BC Prop")+
  guides(fill = guide_colorbar(title.position = "top",
                               label.position = "bottom")) +
  theme(legend.direction = "horizontal")
grid::grid.draw(shift_legend(p.new))

dev.off()

rm(my, myl, p, p.new)
```



COPR
rate heatmaps [trunc]
```{r, warning = FALSE, message=FALSE}
my <- myd[myd$plate %in% c("COPR_A", "COPR_B") & myd$diff0 <= 0.25,]
my$diff0_ret <- my$diff0
my <- my[,c("treat","diff0_ret","plate","bc1", "dp0_7", "dp7_13", "dp13_19", "dp19_25", "dp25_31", "dp31_37", "dp37_43", "dp43_49")]
myl <- gather(my, condition, measurement, dp0_7, dp7_13, dp13_19, dp19_25, dp25_31, dp31_37, dp37_43, dp43_49)


myl <- myl[order(myl$treat, -myl$diff0_ret),]
myl$x <- paste0(myl$bc1, myl$plate, myl$diff0_ret); myl$x <- factor(myl$x, levels = unique(myl$x))
myl$condition <- factor(myl$condition, levels = c("dp0_7", "dp7_13", "dp13_19", "dp19_25", "dp25_31", "dp31_37", "dp37_43", "dp43_49"))
myl$measurement <- abs(myl$measurement)
# myl$measurement <- log_transform(myl$measurement)
# hist(myl$measurement)

pdf(file = "COPR_dp_trunc.pdf", width = 10, height = 10)
p <- ggplot(myl, aes(x = condition, y = x, fill = measurement)) + 
  geom_tile()+
  theme_tufte(base_family="Helvetica")+
  facet_wrap(~treat, switch = "y", scales = "free_y", ncol = 3) + 
  theme(axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        plot.title = element_text(face = "bold"),
        axis.title = element_text(face = "bold"))+
  ylab("Treatment") +
  xlab("Day")+
  ggtitle("COPR: Rate of Change in BC Prop [FULL]")+
  scale_x_discrete(labels=c("dp0_7" = "0_7", "dp7_13" = "7_13", "dp13_19" = "13_19", "dp19_25" = "19_25",
                            "dp25_31" = "25_31", "dp31_37" = "31_37", "dp37_43" = "37_43", "dp43_49" = "43_49"))

# p.new <- p + scale_fill_viridis(limits = c(0,0.5), 
#                                 breaks = c(0,0.1,0.2,0.3,0.4,0.5 ), 
#                                 name = "Rate of Change in BC Prop")+
p.new <- p + scale_fill_viridis(name = "Rate of Change in BC Prop")+
  guides(fill = guide_colorbar(title.position = "top",
                               label.position = "bottom")) +
  theme(legend.direction = "horizontal")
grid::grid.draw(shift_legend(p.new))

dev.off()

rm(my, myl, p, p.new)
```

COPR
rate heatmaps [full]
```{r, warning = FALSE, message=FALSE}
my <- myd[myd$plate %in% c("COPR_A", "COPR_B"),]
my$diff0_ret <- my$diff0
my <- my[,c("treat","diff0_ret","plate","bc1", "dp0_7", "dp7_13", "dp13_19", "dp19_25", "dp25_31", "dp31_37", "dp37_43", "dp43_49")]
myl <- gather(my, condition, measurement, dp0_7, dp7_13, dp13_19, dp19_25, dp25_31, dp31_37, dp37_43, dp43_49)


myl <- myl[order(myl$treat, -myl$diff0_ret),]
myl$x <- paste0(myl$bc1, myl$plate, myl$diff0_ret); myl$x <- factor(myl$x, levels = unique(myl$x))
myl$condition <- factor(myl$condition, levels = c("dp0_7", "dp7_13", "dp13_19", "dp19_25", "dp25_31", "dp31_37", "dp37_43", "dp43_49"))
myl$measurement <- abs(myl$measurement)
# myl$measurement <- log_transform(myl$measurement)
# hist(myl$measurement)

pdf(file = "COPR_dp_full.pdf", width = 10, height = 10)
p <- ggplot(myl, aes(x = condition, y = x, fill = measurement)) + 
  geom_tile()+
  theme_tufte(base_family="Helvetica")+
  facet_wrap(~treat, switch = "y", scales = "free_y", ncol = 3) + 
  theme(axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        plot.title = element_text(face = "bold"),
        axis.title = element_text(face = "bold"))+
  ylab("Treatment") +
  xlab("Day")+
  ggtitle("COPR: Rate of Change in BC Prop [FULL]")+
  scale_x_discrete(labels=c("dp0_7" = "0_7", "dp7_13" = "7_13", "dp13_19" = "13_19", "dp19_25" = "19_25",
                            "dp25_31" = "25_31", "dp31_37" = "31_37", "dp37_43" = "37_43", "dp43_49" = "43_49"))

# p.new <- p + scale_fill_viridis(limits = c(0,0.5), 
#                                 breaks = c(0,0.1,0.2,0.3,0.4,0.5 ), 
#                                 name = "Rate of Change in BC Prop")+
p.new <- p + scale_fill_viridis(name = "Rate of Change in BC Prop")+
  guides(fill = guide_colorbar(title.position = "top",
                               label.position = "bottom")) +
  theme(legend.direction = "horizontal")
grid::grid.draw(shift_legend(p.new))

dev.off()

rm(my, myl, p, p.new)
```




SULF
rate heatmaps [trunc]
```{r, warning = FALSE, message=FALSE}
my <- myd[myd$plate %in% c("SULF_A", "SULF_B") & myd$diff0 <= 0.25,]
my$diff0_ret <- my$diff0
my <- my[,c("treat","diff0_ret","plate","bc1", "dp0_7", "dp7_13", "dp13_19", "dp19_25", "dp25_31", "dp31_37", "dp37_43", "dp43_49")]
myl <- gather(my, condition, measurement, dp0_7, dp7_13, dp13_19, dp19_25, dp25_31, dp31_37, dp37_43, dp43_49)


myl <- myl[order(myl$treat, -myl$diff0_ret),]
myl$x <- paste0(myl$bc1, myl$plate, myl$diff0_ret); myl$x <- factor(myl$x, levels = unique(myl$x))
myl$condition <- factor(myl$condition, levels = c("dp0_7", "dp7_13", "dp13_19", "dp19_25", "dp25_31", "dp31_37", "dp37_43", "dp43_49"))
myl$measurement <- abs(myl$measurement)
# myl$measurement <- log_transform(myl$measurement)
# hist(myl$measurement)

pdf(file = "SULF_dp_trunc.pdf", width = 10, height = 10)
p <- ggplot(myl, aes(x = condition, y = x, fill = measurement)) + 
  geom_tile()+
  theme_tufte(base_family="Helvetica")+
  facet_wrap(~treat, switch = "y", scales = "free_y", ncol = 3) + 
  theme(axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        plot.title = element_text(face = "bold"),
        axis.title = element_text(face = "bold"))+
  ylab("Treatment") +
  xlab("Day")+
  ggtitle("SULF: Rate of Change in BC Prop [FULL]")+
  scale_x_discrete(labels=c("dp0_7" = "0_7", "dp7_13" = "7_13", "dp13_19" = "13_19", "dp19_25" = "19_25",
                            "dp25_31" = "25_31", "dp31_37" = "31_37", "dp37_43" = "37_43", "dp43_49" = "43_49"))

# p.new <- p + scale_fill_viridis(limits = c(0,0.5), 
#                                 breaks = c(0,0.1,0.2,0.3,0.4,0.5 ), 
#                                 name = "Rate of Change in BC Prop")+
p.new <- p + scale_fill_viridis(name = "Rate of Change in BC Prop")+
  guides(fill = guide_colorbar(title.position = "top",
                               label.position = "bottom")) +
  theme(legend.direction = "horizontal")
grid::grid.draw(shift_legend(p.new))

dev.off()

rm(my, myl, p, p.new)
```

SULF
rate heatmaps [full]
```{r, warning = FALSE, message=FALSE}
my <- myd[myd$plate %in% c("SULF_A", "SULF_B"),]
my$diff0_ret <- my$diff0
my <- my[,c("treat","diff0_ret","plate","bc1", "dp0_7", "dp7_13", "dp13_19", "dp19_25", "dp25_31", "dp31_37", "dp37_43", "dp43_49")]
myl <- gather(my, condition, measurement, dp0_7, dp7_13, dp13_19, dp19_25, dp25_31, dp31_37, dp37_43, dp43_49)


myl <- myl[order(myl$treat, -myl$diff0_ret),]
myl$x <- paste0(myl$bc1, myl$plate, myl$diff0_ret); myl$x <- factor(myl$x, levels = unique(myl$x))
myl$condition <- factor(myl$condition, levels = c("dp0_7", "dp7_13", "dp13_19", "dp19_25", "dp25_31", "dp31_37", "dp37_43", "dp43_49"))
myl$measurement <- abs(myl$measurement)
# myl$measurement <- log_transform(myl$measurement)
# hist(myl$measurement)

pdf(file = "SULF_dp_full.pdf", width = 10, height = 10)
p <- ggplot(myl, aes(x = condition, y = x, fill = measurement)) + 
  geom_tile()+
  theme_tufte(base_family="Helvetica")+
  facet_wrap(~treat, switch = "y", scales = "free_y", ncol = 3) + 
  theme(axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        plot.title = element_text(face = "bold"),
        axis.title = element_text(face = "bold"))+
  ylab("Treatment") +
  xlab("Day")+
  ggtitle("SULF: Rate of Change in BC Prop [FULL]")+
  scale_x_discrete(labels=c("dp0_7" = "0_7", "dp7_13" = "7_13", "dp13_19" = "13_19", "dp19_25" = "19_25",
                            "dp25_31" = "25_31", "dp31_37" = "31_37", "dp37_43" = "37_43", "dp43_49" = "43_49"))

# p.new <- p + scale_fill_viridis(limits = c(0,0.5), 
#                                 breaks = c(0,0.1,0.2,0.3,0.4,0.5 ), 
#                                 name = "Rate of Change in BC Prop")+
p.new <- p + scale_fill_viridis(name = "Rate of Change in BC Prop")+
  guides(fill = guide_colorbar(title.position = "top",
                               label.position = "bottom")) +
  theme(legend.direction = "horizontal")
grid::grid.draw(shift_legend(p.new))

dev.off()

rm(my, myl, p, p.new)
```












SALT
dpz heatmaps [trunc]
```{r, warning = FALSE, message=FALSE}
my <- myd[myd$plate %in% c("SALT_A", "SALT_B") & myd$diff0 <= 0.25,]
my$diff0_ret <- my$diff0
my <- my[,c("treat","diff0_ret","plate","bc1", "dpz_7", "dpz_13", "dpz_19", "dpz_25", "dpz_31", "dpz_37", "dpz_43", "dpz_49")]
myl <- gather(my, condition, measurement, dpz_7, dpz_13, dpz_19, dpz_25, dpz_31, dpz_37, dpz_43, dpz_49)


myl <- myl[order(myl$treat, -myl$diff0_ret),]
myl$x <- paste0(myl$bc1, myl$plate, myl$diff0_ret); myl$x <- factor(myl$x, levels = unique(myl$x))
myl$condition <- factor(myl$condition, levels = c("dpz_7", "dpz_13", "dpz_19", "dpz_25", "dpz_31", "dpz_37", "dpz_43", "dpz_49"))
myl$measurement <- abs(myl$measurement)
# myl$measurement <- log_transform(myl$measurement)
# hist(myl$measurement)

pdf(file = "SALT_dpz_trunc.pdf", width = 10, height = 10)
p <- ggplot(myl, aes(x = condition, y = x, fill = measurement)) + 
  geom_tile()+
  theme_tufte(base_family="Helvetica")+
  facet_wrap(~treat, switch = "y", scales = "free_y", ncol = 3, shrink = T) + 
  theme(axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        plot.title = element_text(face = "bold"),
        axis.title = element_text(face = "bold"))+
  ylab("Treatment") +
  xlab("Day")+
  ggtitle("SALT: Change in BC Prop relative to Day 0 [FULL]")+
  scale_x_discrete(labels=c("dpz_7" = "_7", "dpz_13" = "_13", "dpz_19" = "_19", "dpz_25" = "_25",
                            "dpz_31" = "_31", "dpz_37" = "_37", "dpz_43" = "_43", "dpz_49" = "_49"))

# p.new <- p + scale_fill_viridis(limits = c(0,0.5), 
#                                 breaks = c(0,0.1,0.2,0.3,0.4,0.5 ), 
#                                 name = "Rate of Change in BC Prop")+
p.new <- p + scale_fill_viridis(name = "Change in BC Prop relative to Day 0")+
  guides(fill = guide_colorbar(title.position = "top",
                               label.position = "bottom")) +
  theme(legend.direction = "horizontal")
grid::grid.draw(shift_legend(p.new))

dev.off()

rm(my, myl, p, p.new)
```

SALT
dpz heatmaps [full]
```{r, warning = FALSE, message=FALSE}
my <- myd[myd$plate %in% c("SALT_A", "SALT_B"),]
my$diff0_ret <- my$diff0
my <- my[,c("treat","diff0_ret","plate","bc1", "dpz_7", "dpz_13", "dpz_19", "dpz_25", "dpz_31", "dpz_37", "dpz_43", "dpz_49")]
myl <- gather(my, condition, measurement, dpz_7, dpz_13, dpz_19, dpz_25, dpz_31, dpz_37, dpz_43, dpz_49)


myl <- myl[order(myl$treat, -myl$diff0_ret),]
myl$x <- paste0(myl$bc1, myl$plate, myl$diff0_ret); myl$x <- factor(myl$x, levels = unique(myl$x))
myl$condition <- factor(myl$condition, levels = c("dpz_7", "dpz_13", "dpz_19", "dpz_25", "dpz_31", "dpz_37", "dpz_43", "dpz_49"))
myl$measurement <- abs(myl$measurement)
# myl$measurement <- log_transform(myl$measurement)
# hist(myl$measurement)

pdf(file = "SALT_dpz_full.pdf", width = 10, height = 10)
p <- ggplot(myl, aes(x = condition, y = x, fill = measurement)) + 
  geom_tile()+
  theme_tufte(base_family="Helvetica")+
  facet_wrap(~treat, switch = "y", scales = "free_y", ncol = 3, shrink = T) + 
  theme(axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        plot.title = element_text(face = "bold"),
        axis.title = element_text(face = "bold"))+
  ylab("Treatment") +
  xlab("Day")+
  ggtitle("SALT: Change in BC Prop relative to Day 0 [FULL]")+
  scale_x_discrete(labels=c("dpz_7" = "_7", "dpz_13" = "_13", "dpz_19" = "_19", "dpz_25" = "_25",
                            "dpz_31" = "_31", "dpz_37" = "_37", "dpz_43" = "_43", "dpz_49" = "_49"))

# p.new <- p + scale_fill_viridis(limits = c(0,0.5), 
#                                 breaks = c(0,0.1,0.2,0.3,0.4,0.5 ), 
#                                 name = "Rate of Change in BC Prop")+
p.new <- p + scale_fill_viridis(name = "Change in BC Prop relative to Day 0")+
  guides(fill = guide_colorbar(title.position = "top",
                               label.position = "bottom")) +
  theme(legend.direction = "horizontal")
grid::grid.draw(shift_legend(p.new))

dev.off()

rm(my, myl, p, p.new)
```




COPR
dpz heatmaps [trunc]
```{r, warning = FALSE, message=FALSE}
my <- myd[myd$plate %in% c("COPR_A", "COPR_B") & myd$diff0 <= 0.25,]
my$diff0_ret <- my$diff0
my <- my[,c("treat","diff0_ret","plate","bc1", "dpz_7", "dpz_13", "dpz_19", "dpz_25", "dpz_31", "dpz_37", "dpz_43", "dpz_49")]
myl <- gather(my, condition, measurement, dpz_7, dpz_13, dpz_19, dpz_25, dpz_31, dpz_37, dpz_43, dpz_49)


myl <- myl[order(myl$treat, -myl$diff0_ret),]
myl$x <- paste0(myl$bc1, myl$plate, myl$diff0_ret); myl$x <- factor(myl$x, levels = unique(myl$x))
myl$condition <- factor(myl$condition, levels = c("dpz_7", "dpz_13", "dpz_19", "dpz_25", "dpz_31", "dpz_37", "dpz_43", "dpz_49"))
myl$measurement <- abs(myl$measurement)
# myl$measurement <- log_transform(myl$measurement)
# hist(myl$measurement)

pdf(file = "COPR_dpz_trunc.pdf", width = 10, height = 10)
p <- ggplot(myl, aes(x = condition, y = x, fill = measurement)) + 
  geom_tile()+
  theme_tufte(base_family="Helvetica")+
  facet_wrap(~treat, switch = "y", scales = "free_y", ncol = 3) + 
  theme(axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        plot.title = element_text(face = "bold"),
        axis.title = element_text(face = "bold"))+
  ylab("Treatment") +
  xlab("Day")+
  ggtitle("COPR: Change in BC Prop relative to Day 0 [FULL]")+
  scale_x_discrete(labels=c("dpz_7" = "_7", "dpz_13" = "_13", "dpz_19" = "_19", "dpz_25" = "_25",
                            "dpz_31" = "_31", "dpz_37" = "_37", "dpz_43" = "_43", "dpz_49" = "_49"))

# p.new <- p + scale_fill_viridis(limits = c(0,0.5), 
#                                 breaks = c(0,0.1,0.2,0.3,0.4,0.5 ), 
#                                 name = "Rate of Change in BC Prop")+
p.new <- p + scale_fill_viridis(name = "Change in BC Prop relative to Day 0")+
  guides(fill = guide_colorbar(title.position = "top",
                               label.position = "bottom")) +
  theme(legend.direction = "horizontal")
grid::grid.draw(shift_legend(p.new))

dev.off()

rm(my, myl, p, p.new)
```

COPR
dpz heatmaps [full]
```{r, warning = FALSE, message=FALSE}
my <- myd[myd$plate %in% c("COPR_A", "COPR_B"),]
my$diff0_ret <- my$diff0
my <- my[,c("treat","diff0_ret","plate","bc1", "dpz_7", "dpz_13", "dpz_19", "dpz_25", "dpz_31", "dpz_37", "dpz_43", "dpz_49")]
myl <- gather(my, condition, measurement, dpz_7, dpz_13, dpz_19, dpz_25, dpz_31, dpz_37, dpz_43, dpz_49)


myl <- myl[order(myl$treat, -myl$diff0_ret),]
myl$x <- paste0(myl$bc1, myl$plate, myl$diff0_ret); myl$x <- factor(myl$x, levels = unique(myl$x))
myl$condition <- factor(myl$condition, levels = c("dpz_7", "dpz_13", "dpz_19", "dpz_25", "dpz_31", "dpz_37", "dpz_43", "dpz_49"))
myl$measurement <- abs(myl$measurement)
# myl$measurement <- log_transform(myl$measurement)
# hist(myl$measurement)

pdf(file = "COPR_dpz_full.pdf", width = 10, height = 10)
p <- ggplot(myl, aes(x = condition, y = x, fill = measurement)) + 
  geom_tile()+
  theme_tufte(base_family="Helvetica")+
  facet_wrap(~treat, switch = "y", scales = "free_y", ncol = 3) + 
  theme(axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        plot.title = element_text(face = "bold"),
        axis.title = element_text(face = "bold"))+
  ylab("Treatment") +
  xlab("Day")+
  ggtitle("COPR: Change in BC Prop relative to Day 0 [FULL]")+
  scale_x_discrete(labels=c("dpz_7" = "_7", "dpz_13" = "_13", "dpz_19" = "_19", "dpz_25" = "_25",
                            "dpz_31" = "_31", "dpz_37" = "_37", "dpz_43" = "_43", "dpz_49" = "_49"))

# p.new <- p + scale_fill_viridis(limits = c(0,0.5), 
#                                 breaks = c(0,0.1,0.2,0.3,0.4,0.5 ), 
#                                 name = "Rate of Change in BC Prop")+
p.new <- p + scale_fill_viridis(name = "Change in BC Prop relative to Day 0")+
  guides(fill = guide_colorbar(title.position = "top",
                               label.position = "bottom")) +
  theme(legend.direction = "horizontal")
grid::grid.draw(shift_legend(p.new))

dev.off()

rm(my, myl, p, p.new)
```



SULF
dpz heatmaps [trunc]
```{r, warning = FALSE, message=FALSE}
my <- myd[myd$plate %in% c("SULF_A", "SULF_B") & myd$diff0 <= 0.25,]
my$diff0_ret <- my$diff0
my <- my[,c("treat","diff0_ret","plate","bc1", "dpz_7", "dpz_13", "dpz_19", "dpz_25", "dpz_31", "dpz_37", "dpz_43", "dpz_49")]
myl <- gather(my, condition, measurement, dpz_7, dpz_13, dpz_19, dpz_25, dpz_31, dpz_37, dpz_43, dpz_49)


myl <- myl[order(myl$treat, -myl$diff0_ret),]
myl$x <- paste0(myl$bc1, myl$plate, myl$diff0_ret); myl$x <- factor(myl$x, levels = unique(myl$x))
myl$condition <- factor(myl$condition, levels = c("dpz_7", "dpz_13", "dpz_19", "dpz_25", "dpz_31", "dpz_37", "dpz_43", "dpz_49"))
myl$measurement <- abs(myl$measurement)
# myl$measurement <- log_transform(myl$measurement)
# hist(myl$measurement)

pdf(file = "SULF_dpz_trunc.pdf", width = 10, height = 10)
p <- ggplot(myl, aes(x = condition, y = x, fill = measurement)) + 
  geom_tile()+
  theme_tufte(base_family="Helvetica")+
  facet_wrap(~treat, switch = "y", scales = "free_y", ncol = 3) + 
  theme(axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        plot.title = element_text(face = "bold"),
        axis.title = element_text(face = "bold"))+
  ylab("Treatment") +
  xlab("Day")+
  ggtitle("SULF: Change in BC Prop relative to Day 0 [FULL]")+
  scale_x_discrete(labels=c("dpz_7" = "_7", "dpz_13" = "_13", "dpz_19" = "_19", "dpz_25" = "_25",
                            "dpz_31" = "_31", "dpz_37" = "_37", "dpz_43" = "_43", "dpz_49" = "_49"))

# p.new <- p + scale_fill_viridis(limits = c(0,0.5), 
#                                 breaks = c(0,0.1,0.2,0.3,0.4,0.5 ), 
#                                 name = "Rate of Change in BC Prop")+
p.new <- p + scale_fill_viridis(name = "Change in BC Prop relative to Day 0")+
  guides(fill = guide_colorbar(title.position = "top",
                               label.position = "bottom")) +
  theme(legend.direction = "horizontal")
grid::grid.draw(shift_legend(p.new))

dev.off()

rm(my, myl, p, p.new)
```

SULF
dpz heatmaps [full]
```{r, warning = FALSE, message=FALSE}
my <- myd[myd$plate %in% c("SULF_A", "SULF_B"),]
my$diff0_ret <- my$diff0
my <- my[,c("treat","diff0_ret","plate","bc1", "dpz_7", "dpz_13", "dpz_19", "dpz_25", "dpz_31", "dpz_37", "dpz_43", "dpz_49")]
myl <- gather(my, condition, measurement, dpz_7, dpz_13, dpz_19, dpz_25, dpz_31, dpz_37, dpz_43, dpz_49)


myl <- myl[order(myl$treat, -myl$diff0_ret),]
myl$x <- paste0(myl$bc1, myl$plate, myl$diff0_ret); myl$x <- factor(myl$x, levels = unique(myl$x))
myl$condition <- factor(myl$condition, levels = c("dpz_7", "dpz_13", "dpz_19", "dpz_25", "dpz_31", "dpz_37", "dpz_43", "dpz_49"))
myl$measurement <- abs(myl$measurement)
# myl$measurement <- log_transform(myl$measurement)
# hist(myl$measurement)

pdf(file = "SULF_dpz_full.pdf", width = 10, height = 10)
p <- ggplot(myl, aes(x = condition, y = x, fill = measurement)) + 
  geom_tile()+
  theme_tufte(base_family="Helvetica")+
  facet_wrap(~treat, switch = "y", scales = "free_y", ncol = 3) + 
  theme(axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        plot.title = element_text(face = "bold"),
        axis.title = element_text(face = "bold"))+
  ylab("Treatment") +
  xlab("Day")+
  ggtitle("SULF: Change in BC Prop relative to Day 0 [FULL]")+
  scale_x_discrete(labels=c("dpz_7" = "_7", "dpz_13" = "_13", "dpz_19" = "_19", "dpz_25" = "_25",
                            "dpz_31" = "_31", "dpz_37" = "_37", "dpz_43" = "_43", "dpz_49" = "_49"))

# p.new <- p + scale_fill_viridis(limits = c(0,0.5), 
#                                 breaks = c(0,0.1,0.2,0.3,0.4,0.5 ), 
#                                 name = "Rate of Change in BC Prop")+
p.new <- p + scale_fill_viridis(name = "Change in BC Prop relative to Day 0")+
  guides(fill = guide_colorbar(title.position = "top",
                               label.position = "bottom")) +
  theme(legend.direction = "horizontal")
grid::grid.draw(shift_legend(p.new))

dev.off()

rm(my, myl, p, p.new)
```


NEW NEW NEW NEW

MODELS!
SALT

shared viz settings for all salt plots
```{r, warning = FALSE, message=FALSE}
dichrompalette_br_cy <- RColorBrewer::brewer.pal(n = 11, name = "BrBG")
mypalette <- dichrompalette_br_cy
myoutline <- "grey20"
myfill <- "grey90"
myptalpha <- 0.5
myrugalpha <- 0.7
mywtmeanptcol <- "black"
mymeanptsize <- 1
mywtmeanpttype <- 1
myheight <- 7
mywidth <- 7
```

tmaxdev
```{r, warning = FALSE, message=FALSE}
my <- myd[myd$plate %in% c("SALT_A", "SALT_B"),]

# model and store results ------------------------------------------------------
# create matrix to store results outputs
myres <- matrix(nrow = 11, ncol=11)
rownames(myres) <- c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40","my$treatEH20_60",
                     "my$treatEH0_80", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")
colnames(myres) <- rownames(myres)
myres_p <- myres; myres_est <- myres

# EH0
mymod <- lm(my$tmaxdev ~ my$treat + I(scale(my$diff0)), weights = my$rmaxdev_rt0); summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40","my$treatEH20_60",
                     "my$treatEH0_80", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH0",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH0",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH20
my$treat <- relevel(my$treat, ref = "EH20")
mymod <- lm(my$tmaxdev ~ my$treat + I(scale(my$diff0)), weights = my$rmaxdev_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH0_40","my$treatEH0_60","my$treatEH40","my$treatEH20_60",
                     "my$treatEH0_80", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH20",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH20",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH0_40
my$treat <- relevel(my$treat, ref = "EH0_40")
mymod <- lm(my$tmaxdev ~ my$treat + I(scale(my$diff0)), weights = my$rmaxdev_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_60","my$treatEH40","my$treatEH20_60",
                     "my$treatEH0_80", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH0_40",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH0_40",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH0_60
my$treat <- relevel(my$treat, ref = "EH0_60")
mymod <- lm(my$tmaxdev ~ my$treat + I(scale(my$diff0)), weights = my$rmaxdev_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH40","my$treatEH20_60",
                     "my$treatEH0_80", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH0_60",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH0_60",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH40
my$treat <- relevel(my$treat, ref = "EH40")
mymod <- lm(my$tmaxdev ~ my$treat + I(scale(my$diff0)), weights = my$rmaxdev_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH20_60",
                     "my$treatEH0_80", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH40",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH40",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH20_60
my$treat <- relevel(my$treat, ref = "EH20_60")
mymod <- lm(my$tmaxdev ~ my$treat + I(scale(my$diff0)), weights = my$rmaxdev_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40",
                     "my$treatEH0_80", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH20_60",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH20_60",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH0_80
my$treat <- relevel(my$treat, ref = "EH0_80")
mymod <- lm(my$tmaxdev ~ my$treat + I(scale(my$diff0)), weights = my$rmaxdev_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40",
                     "my$treatEH20_60", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH0_80",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH0_80",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH60
my$treat <- relevel(my$treat, ref = "EH60")
mymod <- lm(my$tmaxdev ~ my$treat + I(scale(my$diff0)), weights = my$rmaxdev_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40",
                     "my$treatEH20_60", "my$treatEH0_80","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH60",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH60",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH40_80
my$treat <- relevel(my$treat, ref = "EH40_80")
mymod <- lm(my$tmaxdev ~ my$treat + I(scale(my$diff0)), weights = my$rmaxdev_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40",
                     "my$treatEH20_60", "my$treatEH0_80","my$treatEH60","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH40_80",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH40_80",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH80
my$treat <- relevel(my$treat, ref = "EH80")
mymod <- lm(my$tmaxdev ~ my$treat + I(scale(my$diff0)), weights = my$rmaxdev_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40",
                     "my$treatEH20_60", "my$treatEH0_80","my$treatEH60","my$treatEH40_80", "my$treatEH100")){
  myres_est["my$treatEH80",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH80",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH100
my$treat <- relevel(my$treat, ref = "EH100")
mymod <- lm(my$tmaxdev ~ my$treat + I(scale(my$diff0)), weights = my$rmaxdev_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40",
                     "my$treatEH20_60", "my$treatEH0_80","my$treatEH60","my$treatEH40_80", "my$treatEH80")){
  myres_est["my$treatEH100",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH100",i] <- mysumm[i, "Pr(>|t|)"]
}



# Visualize -------------------------------------------------------------------
mytitle <- NULL
myylab <- "T-maxdev (Generations)"
myxlab <- "Treatment"

my$treat <- factor(my$treat, levels = c("EH0", "EH20", "EH0_40","EH0_60", "EH40", "EH20_60", "EH0_80", "EH60", "EH40_80", "EH80", "EH100"))
myx <- my$treat
myy <- my$tmaxdev
myr <- my$rmaxdev
myc <- my$treat

mylowlim <- 0
myhighlim <- 500
myby <- 50
myxextend <- 500
myhmround <- 0
myptsize <- ((((myr/max(myr))*10)*((myheight*mywidth)/(3.5*7*3))) - min(((myr/max(myr))*10)*((myheight*mywidth)/(3.5*7*3))))+0.5

p <- ggplot(my, aes(x=myx, y=myy, weight = myr, color = myc)) +
  geom_violin(color = myoutline, fill = myfill, draw_quantiles = NULL, inherit.aes = F, aes( x=myx, y=myy), trim = T) + 
  geom_jitter(width =0.15, height = 0, alpha = myptalpha, size = myptsize) +
  geom_rug(sides = "b" , position = position_nudge(x=-0.75), alpha = myrugalpha)+
  geom_point(stat="summary", fun.y="mean", color = mywtmeanptcol, cex = mymeanptsize) + 
  geom_errorbar(stat="summary", fun.data = "mean_se",color = mywtmeanptcol, width = 0.0, lwd =0.5)+
  geom_point(x=11,y = weighted.mean(myy[myx == "EH100"], myr[myx == "EH100"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=10,y = weighted.mean(myy[myx == "EH80"], myr[myx == "EH80"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=9,y = weighted.mean(myy[myx == "EH40_80"], myr[myx == "EH40_80"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=8,y = weighted.mean(myy[myx == "EH60"], myr[myx == "EH60"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=7,y = weighted.mean(myy[myx == "EH0_80"], myr[myx == "EH0_80"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=6,y = weighted.mean(myy[myx == "EH20_60"], myr[myx == "EH20_60"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=5,y = weighted.mean(myy[myx == "EH40"], myr[myx == "EH40"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=4,y = weighted.mean(myy[myx == "EH0_60"], myr[myx == "EH0_60"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=3,y = weighted.mean(myy[myx == "EH0_40"], myr[myx == "EH0_40"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=2,y = weighted.mean(myy[myx == "EH20"], myr[myx == "EH20"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=1,y = weighted.mean(myy[myx == "EH0"], myr[myx == "EH0"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  scale_color_manual(values =mypalette) + 
  # geom_hline(yintercept = 0, lty = "dotted") + 
  coord_flip() +
  theme_classic()+
  theme(legend.position="none") +
  ggtitle(mytitle) + ylab(myylab) + xlab(myxlab)+
  scale_x_discrete(labels = c("EH0", "EH20", "EH0_40","EH0_60", "EH40", "EH20_60", "EH0_80", "EH60", "EH40_80", "EH80", "EH100")) +
  scale_y_continuous(breaks = seq(mylowlim, myhighlim,by=myby),
                     limits = c(mylowlim, myhighlim+myxextend),
                     labels = scales::number_format(accuracy = 1))+
  theme(axis.title.y = element_text(size = 8, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = 8, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = 8, angle = 0))+
  theme(axis.text.x = element_text(size = 8, angle = 0))

myp <- 0.05
myres_est[myres_p >= myp] <- NA
m <- round(myres_est, myhmround)
colnames(m) <- c("EH0", "EH20", "EH0_40","EH0_60", "EH40", "EH20_60", "EH0_80", "EH60", "EH40_80", "EH80", "EH100")
rownames(m) <- colnames(m)
# m <- get_lower_tri(m) # uncomment for just lower triangle
melt_m <- reshape::melt(m)
melt_m$X1 <- factor(melt_m$X1, levels = c("EH0", "EH20", "EH0_40","EH0_60", "EH40", "EH20_60", "EH0_80", "EH60", "EH40_80", "EH80", "EH100"))
melt_m$X2 <- factor(melt_m$X2, levels = c("EH0", "EH20", "EH0_40","EH0_60", "EH40", "EH20_60", "EH0_80", "EH60", "EH40_80", "EH80", "EH100"))

pp <- ggplot(melt_m, aes(x = X1, y = X2, fill = value)) + 
  geom_tile(show.legend = F)+
  geom_text(aes(X1, X2, label = value), color = "black", size = 2, angle = 0) +
  theme_tufte(base_family="Helvetica")+
  scale_y_discrete(position = "right")+
  theme(axis.ticks = element_blank(),
        plot.title = element_text(face = "bold"),
        panel.background = element_rect(colour = NA, fill = "transparent"),
        plot.background = element_rect(fill = "transparent",colour = NA),
        axis.title = element_blank(),
        axis.text = element_text(size = 6),
        axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5, margin = margin(t=-2.5, b = -2.5)),
        axis.text.y.left = element_text(angle = 0, hjust = 0, vjust = 0.5, margin = margin(l=-2.5, r = -2.5), debug = T))+
  scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
                       midpoint = 0, limit = c(min(melt_m$value),max(melt_m$value)), space = "Lab", 
                       name="Estimate", na.value = "transparent")

m2 <- m; m2[1:length(m2)] <- 0
# m2 <- get_lower_tri(m2) # uncomment for just lower triangle
melt_m2 <- reshape::melt(m2)
melt_m2$X1 <- factor(melt_m2$X1, levels = c("EH0", "EH20", "EH0_40","EH0_60", "EH40", "EH20_60", "EH0_80", "EH60", "EH40_80", "EH80", "EH100"))
melt_m2$X2 <- factor(melt_m2$X2, levels = c("EH0", "EH20", "EH0_40","EH0_60", "EH40", "EH20_60", "EH0_80", "EH60", "EH40_80", "EH80", "EH100"))

ppp <- ggplot(melt_m2, aes(x = X1, y = X2, fill = value)) + 
  geom_tile(show.legend = F)+
  geom_text(aes(X1, X2, label = value), color = "gray", size = 2, angle = 0) +
  theme_tufte(base_family="Helvetica")+
  scale_y_discrete(position = "right")+
 theme(axis.ticks = element_blank(),
        plot.title = element_text(face = "bold"),
        panel.background = element_rect(colour = NA, fill = "transparent"),
        plot.background = element_rect(fill = "transparent",colour = NA),
        axis.title = element_blank(),
        axis.text = element_text(size = 6, colour = "white"),
        axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5, margin = margin(t=-2.5, b = -2.5)),
        axis.text.y.left = element_text(angle = 0, hjust = 0, vjust = 0.5, margin = margin(l=-2.5, r = -2.5), debug = T))+
  scale_fill_gradient2(low = "blue", high = "red", mid = "gray", 
                       midpoint = 0, limit = c(min(melt_m$value),max(melt_m$value)), space = "Lab", 
                       name="Estimate", na.value = "transparent")

pppp <- p + annotation_custom(ggplotGrob(ppp), ymin = 550, ymax = 1050, xmin = 3, xmax = 9)
pppp <- pppp + annotation_custom(ggplotGrob(pp), ymin = 550, ymax = 1050, xmin = 3, xmax = 9)
pppp

# figure output ---------------------------------------------------------------
pdf(file = "000_SALT_tmaxdev.pdf", width = mywidth, height = myheight); pppp; dev.off()
```

mmaxdev
```{r, warning = FALSE, message=FALSE}
my <- myd[myd$plate %in% c("SALT_A", "SALT_B"),]

# model and store results ------------------------------------------------------
# create matrix to store results outputs
myres <- matrix(nrow = 11, ncol=11)
rownames(myres) <- c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40","my$treatEH20_60",
                     "my$treatEH0_80", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")
colnames(myres) <- rownames(myres)
myres_p <- myres; myres_est <- myres

# EH0
mymod <- lm(my$mmaxdev ~ my$treat + I(scale(my$diff0)), weights = my$rmaxdev_rt0); summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40","my$treatEH20_60",
                     "my$treatEH0_80", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH0",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH0",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH20
my$treat <- relevel(my$treat, ref = "EH20")
mymod <- lm(my$mmaxdev ~ my$treat + I(scale(my$diff0)), weights = my$rmaxdev_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH0_40","my$treatEH0_60","my$treatEH40","my$treatEH20_60",
                     "my$treatEH0_80", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH20",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH20",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH0_40
my$treat <- relevel(my$treat, ref = "EH0_40")
mymod <- lm(my$mmaxdev ~ my$treat + I(scale(my$diff0)), weights = my$rmaxdev_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_60","my$treatEH40","my$treatEH20_60",
                     "my$treatEH0_80", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH0_40",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH0_40",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH0_60
my$treat <- relevel(my$treat, ref = "EH0_60")
mymod <- lm(my$mmaxdev ~ my$treat + I(scale(my$diff0)), weights = my$rmaxdev_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH40","my$treatEH20_60",
                     "my$treatEH0_80", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH0_60",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH0_60",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH40
my$treat <- relevel(my$treat, ref = "EH40")
mymod <- lm(my$mmaxdev ~ my$treat + I(scale(my$diff0)), weights = my$rmaxdev_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH20_60",
                     "my$treatEH0_80", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH40",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH40",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH20_60
my$treat <- relevel(my$treat, ref = "EH20_60")
mymod <- lm(my$mmaxdev ~ my$treat + I(scale(my$diff0)), weights = my$rmaxdev_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40",
                     "my$treatEH0_80", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH20_60",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH20_60",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH0_80
my$treat <- relevel(my$treat, ref = "EH0_80")
mymod <- lm(my$mmaxdev ~ my$treat + I(scale(my$diff0)), weights = my$rmaxdev_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40",
                     "my$treatEH20_60", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH0_80",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH0_80",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH60
my$treat <- relevel(my$treat, ref = "EH60")
mymod <- lm(my$mmaxdev ~ my$treat + I(scale(my$diff0)), weights = my$rmaxdev_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40",
                     "my$treatEH20_60", "my$treatEH0_80","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH60",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH60",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH40_80
my$treat <- relevel(my$treat, ref = "EH40_80")
mymod <- lm(my$mmaxdev ~ my$treat + I(scale(my$diff0)), weights = my$rmaxdev_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40",
                     "my$treatEH20_60", "my$treatEH0_80","my$treatEH60","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH40_80",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH40_80",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH80
my$treat <- relevel(my$treat, ref = "EH80")
mymod <- lm(my$mmaxdev ~ my$treat + I(scale(my$diff0)), weights = my$rmaxdev_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40",
                     "my$treatEH20_60", "my$treatEH0_80","my$treatEH60","my$treatEH40_80", "my$treatEH100")){
  myres_est["my$treatEH80",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH80",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH100
my$treat <- relevel(my$treat, ref = "EH100")
mymod <- lm(my$mmaxdev ~ my$treat + I(scale(my$diff0)), weights = my$rmaxdev_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40",
                     "my$treatEH20_60", "my$treatEH0_80","my$treatEH60","my$treatEH40_80", "my$treatEH80")){
  myres_est["my$treatEH100",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH100",i] <- mysumm[i, "Pr(>|t|)"]
}



# Visualize -------------------------------------------------------------------
mytitle <- NULL
myylab <- "M-maxdev"
myxlab <- "Treatment"
myylabacc <- 0.01

my$treat <- factor(my$treat, levels = c("EH0", "EH20", "EH0_40","EH0_60", "EH40", "EH20_60", "EH0_80", "EH60", "EH40_80", "EH80", "EH100"))
myx <- my$treat
myy <- my$mmaxdev
myr <- my$rmaxdev
myc <- my$treat

mylowlim <- 0
myhighlim <- 1
myby <- 0.1
myxextend <- 1
myhmround <- 2
myptsize <- ((((myr/max(myr))*10)*((myheight*mywidth)/(3.5*7*3))) - min(((myr/max(myr))*10)*((myheight*mywidth)/(3.5*7*3))))+0.5

p <- ggplot(my, aes(x=myx, y=myy, weight = myr, color = myc)) +
  geom_violin(color = myoutline, fill = myfill, draw_quantiles = NULL, inherit.aes = F, aes( x=myx, y=myy), trim = T) + 
  geom_jitter(width =0.15, height = 0, alpha = myptalpha, size = myptsize) +
  geom_rug(sides = "b" , position = position_nudge(x=-0.75), alpha = myrugalpha)+
  geom_point(stat="summary", fun.y="mean", color = mywtmeanptcol, cex = mymeanptsize) + 
  geom_errorbar(stat="summary", fun.data = "mean_se",color = mywtmeanptcol, width = 0.0, lwd =0.5)+
  geom_point(x=11,y = weighted.mean(myy[myx == "EH100"], myr[myx == "EH100"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=10,y = weighted.mean(myy[myx == "EH80"], myr[myx == "EH80"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=9,y = weighted.mean(myy[myx == "EH40_80"], myr[myx == "EH40_80"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=8,y = weighted.mean(myy[myx == "EH60"], myr[myx == "EH60"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=7,y = weighted.mean(myy[myx == "EH0_80"], myr[myx == "EH0_80"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=6,y = weighted.mean(myy[myx == "EH20_60"], myr[myx == "EH20_60"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=5,y = weighted.mean(myy[myx == "EH40"], myr[myx == "EH40"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=4,y = weighted.mean(myy[myx == "EH0_60"], myr[myx == "EH0_60"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=3,y = weighted.mean(myy[myx == "EH0_40"], myr[myx == "EH0_40"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=2,y = weighted.mean(myy[myx == "EH20"], myr[myx == "EH20"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=1,y = weighted.mean(myy[myx == "EH0"], myr[myx == "EH0"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  scale_color_manual(values =mypalette) + 
  # geom_hline(yintercept = 0, lty = "dotted") + 
  coord_flip() +
  theme_classic()+
  theme(legend.position="none") +
  ggtitle(mytitle) + ylab(myylab) + xlab(myxlab)+
  scale_x_discrete(labels = c("EH0", "EH20", "EH0_40","EH0_60", "EH40", "EH20_60", "EH0_80", "EH60", "EH40_80", "EH80", "EH100")) +
  scale_y_continuous(breaks = seq(mylowlim, myhighlim,by=myby),
                     limits = c(mylowlim, myhighlim+myxextend),
                     labels = scales::number_format(accuracy = myylabacc))+
  theme(axis.title.y = element_text(size = 8, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = 8, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = 8, angle = 0))+
  theme(axis.text.x = element_text(size = 8, angle = 0))

myp <- 0.05
myres_est[myres_p >= myp] <- NA
m <- round(myres_est, myhmround)
colnames(m) <- c("EH0", "EH20", "EH0_40","EH0_60", "EH40", "EH20_60", "EH0_80", "EH60", "EH40_80", "EH80", "EH100")
rownames(m) <- colnames(m)
# m <- get_lower_tri(m) # uncomment for just lower triangle
melt_m <- reshape::melt(m)
melt_m$X1 <- factor(melt_m$X1, levels = c("EH0", "EH20", "EH0_40","EH0_60", "EH40", "EH20_60", "EH0_80", "EH60", "EH40_80", "EH80", "EH100"))
melt_m$X2 <- factor(melt_m$X2, levels = c("EH0", "EH20", "EH0_40","EH0_60", "EH40", "EH20_60", "EH0_80", "EH60", "EH40_80", "EH80", "EH100"))

pp <- ggplot(melt_m, aes(x = X1, y = X2, fill = value)) + 
  geom_tile(show.legend = F)+
  geom_text(aes(X1, X2, label = value), color = "black", size = 2, angle = 0) +
  theme_tufte(base_family="Helvetica")+
  scale_y_discrete(position = "right")+
  theme(axis.ticks = element_blank(),
        plot.title = element_text(face = "bold"),
        panel.background = element_rect(colour = NA, fill = "transparent"),
        plot.background = element_rect(fill = "transparent",colour = NA),
        axis.title = element_blank(),
        axis.text = element_text(size = 6),
        axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5, margin = margin(t=-2.5, b = -2.5)),
        axis.text.y.left = element_text(angle = 0, hjust = 0, vjust = 0.5, margin = margin(l=-2.5, r = -2.5), debug = T))+
  scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
                       midpoint = 0, limit = c(min(melt_m$value),max(melt_m$value)), space = "Lab", 
                       name="Estimate", na.value = "transparent")

m2 <- m; m2[1:length(m2)] <- 0
# m2 <- get_lower_tri(m2) # uncomment for just lower triangle
melt_m2 <- reshape::melt(m2)
melt_m2$X1 <- factor(melt_m2$X1, levels = c("EH0", "EH20", "EH0_40","EH0_60", "EH40", "EH20_60", "EH0_80", "EH60", "EH40_80", "EH80", "EH100"))
melt_m2$X2 <- factor(melt_m2$X2, levels = c("EH0", "EH20", "EH0_40","EH0_60", "EH40", "EH20_60", "EH0_80", "EH60", "EH40_80", "EH80", "EH100"))

ppp <- ggplot(melt_m2, aes(x = X1, y = X2, fill = value)) + 
  geom_tile(show.legend = F)+
  geom_text(aes(X1, X2, label = value), color = "gray", size = 2, angle = 0) +
  theme_tufte(base_family="Helvetica")+
  scale_y_discrete(position = "right")+
 theme(axis.ticks = element_blank(),
        plot.title = element_text(face = "bold"),
        panel.background = element_rect(colour = NA, fill = "transparent"),
        plot.background = element_rect(fill = "transparent",colour = NA),
        axis.title = element_blank(),
        axis.text = element_text(size = 6, colour = "white"),
        axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5, margin = margin(t=-2.5, b = -2.5)),
        axis.text.y.left = element_text(angle = 0, hjust = 0, vjust = 0.5, margin = margin(l=-2.5, r = -2.5), debug = T))+
  scale_fill_gradient2(low = "blue", high = "red", mid = "gray", 
                       midpoint = 0, limit = c(min(melt_m$value),max(melt_m$value)), space = "Lab", 
                       name="Estimate", na.value = "transparent")

pppp <- p + annotation_custom(ggplotGrob(ppp), ymin = 1, ymax = 2, xmin = 3, xmax = 9)
pppp <- pppp + annotation_custom(ggplotGrob(pp), ymin = 1, ymax = 2, xmin = 3, xmax = 9)
pppp

# figure output ---------------------------------------------------------------
pdf(file = "000_SALT_mmaxdev.pdf", width = mywidth, height = myheight); pppp; dev.off()
```

tmaxrate
```{r, warning = FALSE, message=FALSE}
my <- myd[myd$plate %in% c("SALT_A", "SALT_B"),]

# model and store results ------------------------------------------------------
# create matrix to store results outputs
myres <- matrix(nrow = 11, ncol=11)
rownames(myres) <- c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40","my$treatEH20_60",
                     "my$treatEH0_80", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")
colnames(myres) <- rownames(myres)
myres_p <- myres; myres_est <- myres

# EH0
mymod <- lm(my$tmaxrate ~ my$treat + I(scale(my$diff0)), weights = my$rmaxrate_rt0); summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40","my$treatEH20_60",
                     "my$treatEH0_80", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH0",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH0",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH20
my$treat <- relevel(my$treat, ref = "EH20")
mymod <- lm(my$tmaxrate ~ my$treat + I(scale(my$diff0)), weights = my$rmaxrate_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH0_40","my$treatEH0_60","my$treatEH40","my$treatEH20_60",
                     "my$treatEH0_80", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH20",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH20",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH0_40
my$treat <- relevel(my$treat, ref = "EH0_40")
mymod <- lm(my$tmaxrate ~ my$treat + I(scale(my$diff0)), weights = my$rmaxrate_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_60","my$treatEH40","my$treatEH20_60",
                     "my$treatEH0_80", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH0_40",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH0_40",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH0_60
my$treat <- relevel(my$treat, ref = "EH0_60")
mymod <- lm(my$tmaxrate ~ my$treat + I(scale(my$diff0)), weights = my$rmaxrate_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH40","my$treatEH20_60",
                     "my$treatEH0_80", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH0_60",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH0_60",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH40
my$treat <- relevel(my$treat, ref = "EH40")
mymod <- lm(my$tmaxrate ~ my$treat + I(scale(my$diff0)), weights = my$rmaxrate_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH20_60",
                     "my$treatEH0_80", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH40",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH40",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH20_60
my$treat <- relevel(my$treat, ref = "EH20_60")
mymod <- lm(my$tmaxrate ~ my$treat + I(scale(my$diff0)), weights = my$rmaxrate_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40",
                     "my$treatEH0_80", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH20_60",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH20_60",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH0_80
my$treat <- relevel(my$treat, ref = "EH0_80")
mymod <- lm(my$tmaxrate ~ my$treat + I(scale(my$diff0)), weights = my$rmaxrate_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40",
                     "my$treatEH20_60", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH0_80",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH0_80",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH60
my$treat <- relevel(my$treat, ref = "EH60")
mymod <- lm(my$tmaxrate ~ my$treat + I(scale(my$diff0)), weights = my$rmaxrate_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40",
                     "my$treatEH20_60", "my$treatEH0_80","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH60",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH60",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH40_80
my$treat <- relevel(my$treat, ref = "EH40_80")
mymod <- lm(my$tmaxrate ~ my$treat + I(scale(my$diff0)), weights = my$rmaxrate_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40",
                     "my$treatEH20_60", "my$treatEH0_80","my$treatEH60","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH40_80",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH40_80",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH80
my$treat <- relevel(my$treat, ref = "EH80")
mymod <- lm(my$tmaxrate ~ my$treat + I(scale(my$diff0)), weights = my$rmaxrate_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40",
                     "my$treatEH20_60", "my$treatEH0_80","my$treatEH60","my$treatEH40_80", "my$treatEH100")){
  myres_est["my$treatEH80",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH80",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH100
my$treat <- relevel(my$treat, ref = "EH100")
mymod <- lm(my$tmaxrate ~ my$treat + I(scale(my$diff0)), weights = my$rmaxrate_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40",
                     "my$treatEH20_60", "my$treatEH0_80","my$treatEH60","my$treatEH40_80", "my$treatEH80")){
  myres_est["my$treatEH100",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH100",i] <- mysumm[i, "Pr(>|t|)"]
}



# Visualize -------------------------------------------------------------------
mytitle <- NULL
myylab <- "T-maxrate (Generations)"
myxlab <- "Treatment"

my$treat <- factor(my$treat, levels = c("EH0", "EH20", "EH0_40","EH0_60", "EH40", "EH20_60", "EH0_80", "EH60", "EH40_80", "EH80", "EH100"))
myx <- my$treat
myy <- my$tmaxrate
myr <- my$rmaxrate
myc <- my$treat

mylowlim <- 0
myhighlim <- 500
myby <- 50
myxextend <- 500
myhmround <- 0
myptsize <- ((((myr/max(myr))*10)*((myheight*mywidth)/(3.5*7*3))) - min(((myr/max(myr))*10)*((myheight*mywidth)/(3.5*7*3))))+0.5

p <- ggplot(my, aes(x=myx, y=myy, weight = myr, color = myc)) +
  geom_violin(color = myoutline, fill = myfill, draw_quantiles = NULL, inherit.aes = F, aes( x=myx, y=myy), trim = T) + 
  geom_jitter(width =0.15, height = 0, alpha = myptalpha, size = myptsize) +
  geom_rug(sides = "b" , position = position_nudge(x=-0.75), alpha = myrugalpha)+
  geom_point(stat="summary", fun.y="mean", color = mywtmeanptcol, cex = mymeanptsize) + 
  geom_errorbar(stat="summary", fun.data = "mean_se",color = mywtmeanptcol, width = 0.0, lwd =0.5)+
  geom_point(x=11,y = weighted.mean(myy[myx == "EH100"], myr[myx == "EH100"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=10,y = weighted.mean(myy[myx == "EH80"], myr[myx == "EH80"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=9,y = weighted.mean(myy[myx == "EH40_80"], myr[myx == "EH40_80"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=8,y = weighted.mean(myy[myx == "EH60"], myr[myx == "EH60"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=7,y = weighted.mean(myy[myx == "EH0_80"], myr[myx == "EH0_80"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=6,y = weighted.mean(myy[myx == "EH20_60"], myr[myx == "EH20_60"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=5,y = weighted.mean(myy[myx == "EH40"], myr[myx == "EH40"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=4,y = weighted.mean(myy[myx == "EH0_60"], myr[myx == "EH0_60"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=3,y = weighted.mean(myy[myx == "EH0_40"], myr[myx == "EH0_40"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=2,y = weighted.mean(myy[myx == "EH20"], myr[myx == "EH20"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=1,y = weighted.mean(myy[myx == "EH0"], myr[myx == "EH0"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  scale_color_manual(values =mypalette) + 
  # geom_hline(yintercept = 0, lty = "dotted") + 
  coord_flip() +
  theme_classic()+
  theme(legend.position="none") +
  ggtitle(mytitle) + ylab(myylab) + xlab(myxlab)+
  scale_x_discrete(labels = c("EH0", "EH20", "EH0_40","EH0_60", "EH40", "EH20_60", "EH0_80", "EH60", "EH40_80", "EH80", "EH100")) +
  scale_y_continuous(breaks = seq(mylowlim, myhighlim,by=myby),
                     limits = c(mylowlim, myhighlim+myxextend),
                     labels = scales::number_format(accuracy = 1))+
  theme(axis.title.y = element_text(size = 8, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = 8, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = 8, angle = 0))+
  theme(axis.text.x = element_text(size = 8, angle = 0))

myp <- 0.05
myres_est[myres_p >= myp] <- NA
m <- round(myres_est, myhmround)
colnames(m) <- c("EH0", "EH20", "EH0_40","EH0_60", "EH40", "EH20_60", "EH0_80", "EH60", "EH40_80", "EH80", "EH100")
rownames(m) <- colnames(m)
# m <- get_lower_tri(m) # uncomment for just lower triangle
melt_m <- reshape::melt(m)
melt_m$X1 <- factor(melt_m$X1, levels = c("EH0", "EH20", "EH0_40","EH0_60", "EH40", "EH20_60", "EH0_80", "EH60", "EH40_80", "EH80", "EH100"))
melt_m$X2 <- factor(melt_m$X2, levels = c("EH0", "EH20", "EH0_40","EH0_60", "EH40", "EH20_60", "EH0_80", "EH60", "EH40_80", "EH80", "EH100"))

pp <- ggplot(melt_m, aes(x = X1, y = X2, fill = value)) + 
  geom_tile(show.legend = F)+
  geom_text(aes(X1, X2, label = value), color = "black", size = 2, angle = 0) +
  theme_tufte(base_family="Helvetica")+
  scale_y_discrete(position = "right")+
  theme(axis.ticks = element_blank(),
        plot.title = element_text(face = "bold"),
        panel.background = element_rect(colour = NA, fill = "transparent"),
        plot.background = element_rect(fill = "transparent",colour = NA),
        axis.title = element_blank(),
        axis.text = element_text(size = 6),
        axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5, margin = margin(t=-2.5, b = -2.5)),
        axis.text.y.left = element_text(angle = 0, hjust = 0, vjust = 0.5, margin = margin(l=-2.5, r = -2.5), debug = T))+
  scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
                       midpoint = 0, limit = c(min(melt_m$value),max(melt_m$value)), space = "Lab", 
                       name="Estimate", na.value = "transparent")

m2 <- m; m2[1:length(m2)] <- 0
# m2 <- get_lower_tri(m2) # uncomment for just lower triangle
melt_m2 <- reshape::melt(m2)
melt_m2$X1 <- factor(melt_m2$X1, levels = c("EH0", "EH20", "EH0_40","EH0_60", "EH40", "EH20_60", "EH0_80", "EH60", "EH40_80", "EH80", "EH100"))
melt_m2$X2 <- factor(melt_m2$X2, levels = c("EH0", "EH20", "EH0_40","EH0_60", "EH40", "EH20_60", "EH0_80", "EH60", "EH40_80", "EH80", "EH100"))

ppp <- ggplot(melt_m2, aes(x = X1, y = X2, fill = value)) + 
  geom_tile(show.legend = F)+
  geom_text(aes(X1, X2, label = value), color = "gray", size = 2, angle = 0) +
  theme_tufte(base_family="Helvetica")+
  scale_y_discrete(position = "right")+
 theme(axis.ticks = element_blank(),
        plot.title = element_text(face = "bold"),
        panel.background = element_rect(colour = NA, fill = "transparent"),
        plot.background = element_rect(fill = "transparent",colour = NA),
        axis.title = element_blank(),
        axis.text = element_text(size = 6, colour = "white"),
        axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5, margin = margin(t=-2.5, b = -2.5)),
        axis.text.y.left = element_text(angle = 0, hjust = 0, vjust = 0.5, margin = margin(l=-2.5, r = -2.5), debug = T))+
  scale_fill_gradient2(low = "blue", high = "red", mid = "gray", 
                       midpoint = 0, limit = c(min(melt_m$value),max(melt_m$value)), space = "Lab", 
                       name="Estimate", na.value = "transparent")

pppp <- p + annotation_custom(ggplotGrob(ppp), ymin = 550, ymax = 1050, xmin = 3, xmax = 9)
pppp <- pppp + annotation_custom(ggplotGrob(pp), ymin = 550, ymax = 1050, xmin = 3, xmax = 9)
pppp

# figure output ---------------------------------------------------------------
pdf(file = "000_SALT_tmaxrate.pdf", width = mywidth, height = myheight); pppp; dev.off()
```

mmaxrate
```{r, warning = FALSE, message=FALSE}
my <- myd[myd$plate %in% c("SALT_A", "SALT_B"),]

# model and store results ------------------------------------------------------
# create matrix to store results outputs
myres <- matrix(nrow = 11, ncol=11)
rownames(myres) <- c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40","my$treatEH20_60",
                     "my$treatEH0_80", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")
colnames(myres) <- rownames(myres)
myres_p <- myres; myres_est <- myres

# EH0
mymod <- lm(my$mmaxrate ~ my$treat + I(scale(my$diff0)), weights = my$rmaxrate_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40","my$treatEH20_60",
                     "my$treatEH0_80", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH0",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH0",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH20
my$treat <- relevel(my$treat, ref = "EH20")
mymod <- lm(my$mmaxrate ~ my$treat + I(scale(my$diff0)), weights = my$rmaxrate_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH0_40","my$treatEH0_60","my$treatEH40","my$treatEH20_60",
                     "my$treatEH0_80", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH20",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH20",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH0_40
my$treat <- relevel(my$treat, ref = "EH0_40")
mymod <- lm(my$mmaxrate ~ my$treat + I(scale(my$diff0)), weights = my$rmaxrate_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_60","my$treatEH40","my$treatEH20_60",
                     "my$treatEH0_80", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH0_40",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH0_40",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH0_60
my$treat <- relevel(my$treat, ref = "EH0_60")
mymod <- lm(my$mmaxrate ~ my$treat + I(scale(my$diff0)), weights = my$rmaxrate_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH40","my$treatEH20_60",
                     "my$treatEH0_80", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH0_60",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH0_60",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH40
my$treat <- relevel(my$treat, ref = "EH40")
mymod <- lm(my$mmaxrate ~ my$treat + I(scale(my$diff0)), weights = my$rmaxrate_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH20_60",
                     "my$treatEH0_80", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH40",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH40",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH20_60
my$treat <- relevel(my$treat, ref = "EH20_60")
mymod <- lm(my$mmaxrate ~ my$treat + I(scale(my$diff0)), weights = my$rmaxrate_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40",
                     "my$treatEH0_80", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH20_60",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH20_60",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH0_80
my$treat <- relevel(my$treat, ref = "EH0_80")
mymod <- lm(my$mmaxrate ~ my$treat + I(scale(my$diff0)), weights = my$rmaxrate_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40",
                     "my$treatEH20_60", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH0_80",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH0_80",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH60
my$treat <- relevel(my$treat, ref = "EH60")
mymod <- lm(my$mmaxrate ~ my$treat + I(scale(my$diff0)), weights = my$rmaxrate_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40",
                     "my$treatEH20_60", "my$treatEH0_80","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH60",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH60",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH40_80
my$treat <- relevel(my$treat, ref = "EH40_80")
mymod <- lm(my$mmaxrate ~ my$treat + I(scale(my$diff0)), weights = my$rmaxrate_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40",
                     "my$treatEH20_60", "my$treatEH0_80","my$treatEH60","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH40_80",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH40_80",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH80
my$treat <- relevel(my$treat, ref = "EH80")
mymod <- lm(my$mmaxrate ~ my$treat + I(scale(my$diff0)), weights = my$rmaxrate_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40",
                     "my$treatEH20_60", "my$treatEH0_80","my$treatEH60","my$treatEH40_80", "my$treatEH100")){
  myres_est["my$treatEH80",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH80",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH100
my$treat <- relevel(my$treat, ref = "EH100")
mymod <- lm(my$mmaxrate ~ my$treat + I(scale(my$diff0)), weights = my$rmaxrate_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40",
                     "my$treatEH20_60", "my$treatEH0_80","my$treatEH60","my$treatEH40_80", "my$treatEH80")){
  myres_est["my$treatEH100",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH100",i] <- mysumm[i, "Pr(>|t|)"]
}



# Visualize -------------------------------------------------------------------
mytitle <- NULL
myylab <- "M-maxrate"
myxlab <- "Treatment"
myylabacc <- 0.01

my$treat <- factor(my$treat, levels = c("EH0", "EH20", "EH0_40","EH0_60", "EH40", "EH20_60", "EH0_80", "EH60", "EH40_80", "EH80", "EH100"))
myx <- my$treat
myy <- my$mmaxrate
myr <- my$rmaxrate
myc <- my$treat

mylowlim <- 0.0001
myhighlim <- 0.012
myby <- 0.025
myxextend <- 0.012
myhmround <- 4
myptsize <- ((((myr/max(myr))*10)*((myheight*mywidth)/(3.5*7*3))) - min(((myr/max(myr))*10)*((myheight*mywidth)/(3.5*7*3))))+0.5

p <- ggplot(my, aes(x=myx, y=myy, weight = myr, color = myc)) +
  geom_violin(color = myoutline, fill = myfill, draw_quantiles = NULL, inherit.aes = F, aes( x=myx, y=myy), trim = T) + 
  geom_jitter(width =0.15, height = 0, alpha = myptalpha, size = myptsize) +
  geom_rug(sides = "b" , position = position_nudge(x=-0.75), alpha = myrugalpha)+
  geom_point(stat="summary", fun.y="mean", color = mywtmeanptcol, cex = mymeanptsize) + 
  geom_errorbar(stat="summary", fun.data = "mean_se",color = mywtmeanptcol, width = 0.0, lwd =0.5)+
  geom_point(x=11,y = weighted.mean(myy[myx == "EH100"], myr[myx == "EH100"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=10,y = weighted.mean(myy[myx == "EH80"], myr[myx == "EH80"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=9,y = weighted.mean(myy[myx == "EH40_80"], myr[myx == "EH40_80"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=8,y = weighted.mean(myy[myx == "EH60"], myr[myx == "EH60"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=7,y = weighted.mean(myy[myx == "EH0_80"], myr[myx == "EH0_80"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=6,y = weighted.mean(myy[myx == "EH20_60"], myr[myx == "EH20_60"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=5,y = weighted.mean(myy[myx == "EH40"], myr[myx == "EH40"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=4,y = weighted.mean(myy[myx == "EH0_60"], myr[myx == "EH0_60"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=3,y = weighted.mean(myy[myx == "EH0_40"], myr[myx == "EH0_40"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=2,y = weighted.mean(myy[myx == "EH20"], myr[myx == "EH20"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=1,y = weighted.mean(myy[myx == "EH0"], myr[myx == "EH0"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  scale_color_manual(values =mypalette) + 
  # geom_hline(yintercept = 0, lty = "dotted") + 
  coord_flip() +
  theme_classic()+
  theme(legend.position="none") +
  ggtitle(mytitle) + ylab(myylab) + xlab(myxlab)+
  scale_x_discrete(labels = c("EH0", "EH20", "EH0_40","EH0_60", "EH40", "EH20_60", "EH0_80", "EH60", "EH40_80", "EH80", "EH100")) +
  scale_y_continuous(breaks = seq(mylowlim, myhighlim,by=myby),
                     limits = c(mylowlim, myhighlim+myxextend),
                     labels = scales::number_format(accuracy = myylabacc))+
  theme(axis.title.y = element_text(size = 8, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = 8, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = 8, angle = 0))+
  theme(axis.text.x = element_text(size = 8, angle = 0))

myp <- 0.05
myres_est[myres_p >= myp] <- NA
m <- round(myres_est, myhmround)
colnames(m) <- c("EH0", "EH20", "EH0_40","EH0_60", "EH40", "EH20_60", "EH0_80", "EH60", "EH40_80", "EH80", "EH100")
rownames(m) <- colnames(m)
# m <- get_lower_tri(m) # uncomment for just lower triangle
melt_m <- reshape::melt(m)
melt_m$X1 <- factor(melt_m$X1, levels = c("EH0", "EH20", "EH0_40","EH0_60", "EH40", "EH20_60", "EH0_80", "EH60", "EH40_80", "EH80", "EH100"))
melt_m$X2 <- factor(melt_m$X2, levels = c("EH0", "EH20", "EH0_40","EH0_60", "EH40", "EH20_60", "EH0_80", "EH60", "EH40_80", "EH80", "EH100"))

pp <- ggplot(melt_m, aes(x = X1, y = X2, fill = value)) + 
  geom_tile(show.legend = F)+
  geom_text(aes(X1, X2, label = value), color = "black", size = 2, angle = 0) +
  theme_tufte(base_family="Helvetica")+
  scale_y_discrete(position = "right")+
  theme(axis.ticks = element_blank(),
        plot.title = element_text(face = "bold"),
        panel.background = element_rect(colour = NA, fill = "transparent"),
        plot.background = element_rect(fill = "transparent",colour = NA),
        axis.title = element_blank(),
        axis.text = element_text(size = 6),
        axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5, margin = margin(t=-2.5, b = -2.5)),
        axis.text.y.left = element_text(angle = 0, hjust = 0, vjust = 0.5, margin = margin(l=-2.5, r = -2.5), debug = T))+
  scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
                       midpoint = 0, limit = c(min(melt_m$value),max(melt_m$value)), space = "Lab", 
                       name="Estimate", na.value = "transparent")

m2 <- m; m2[1:length(m2)] <- 0
# m2 <- get_lower_tri(m2) # uncomment for just lower triangle
melt_m2 <- reshape::melt(m2)
melt_m2$X1 <- factor(melt_m2$X1, levels = c("EH0", "EH20", "EH0_40","EH0_60", "EH40", "EH20_60", "EH0_80", "EH60", "EH40_80", "EH80", "EH100"))
melt_m2$X2 <- factor(melt_m2$X2, levels = c("EH0", "EH20", "EH0_40","EH0_60", "EH40", "EH20_60", "EH0_80", "EH60", "EH40_80", "EH80", "EH100"))

ppp <- ggplot(melt_m2, aes(x = X1, y = X2, fill = value)) + 
  geom_tile(show.legend = F)+
  geom_text(aes(X1, X2, label = value), color = "gray", size = 2, angle = 0) +
  theme_tufte(base_family="Helvetica")+
  scale_y_discrete(position = "right")+
 theme(axis.ticks = element_blank(),
        plot.title = element_text(face = "bold"),
        panel.background = element_rect(colour = NA, fill = "transparent"),
        plot.background = element_rect(fill = "transparent",colour = NA),
        axis.title = element_blank(),
        axis.text = element_text(size = 6, colour = "white"),
        axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5, margin = margin(t=-2.5, b = -2.5)),
        axis.text.y.left = element_text(angle = 0, hjust = 0, vjust = 0.5, margin = margin(l=-2.5, r = -2.5), debug = T))+
  scale_fill_gradient2(low = "blue", high = "red", mid = "gray", 
                       midpoint = 0, limit = c(min(melt_m$value),max(melt_m$value)), space = "Lab", 
                       name="Estimate", na.value = "transparent")

pppp <- p + annotation_custom(ggplotGrob(ppp), ymin = 0.012, ymax = 0.024, xmin = 3, xmax = 9)
pppp <- pppp + annotation_custom(ggplotGrob(pp), ymin = 0.012, ymax = 0.024, xmin = 3, xmax = 9)
pppp

# figure output ---------------------------------------------------------------
pdf(file = "000_SALT_mmaxrate.pdf", width = mywidth, height = myheight); pppp; dev.off()
```

tmaxdiff
```{r, warning = FALSE, message=FALSE}
my <- myd[myd$plate %in% c("SALT_A", "SALT_B"),]

# model and store results ------------------------------------------------------
# create matrix to store results outputs
myres <- matrix(nrow = 11, ncol=11)
rownames(myres) <- c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40","my$treatEH20_60",
                     "my$treatEH0_80", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")
colnames(myres) <- rownames(myres)
myres_p <- myres; myres_est <- myres

# EH0
mymod <- lm(my$tmaxdiff ~ my$treat + I(scale(my$diff0)), weights = my$rmaxdiff_rt0); summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40","my$treatEH20_60",
                     "my$treatEH0_80", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH0",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH0",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH20
my$treat <- relevel(my$treat, ref = "EH20")
mymod <- lm(my$tmaxdiff ~ my$treat + I(scale(my$diff0)), weights = my$rmaxdiff_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH0_40","my$treatEH0_60","my$treatEH40","my$treatEH20_60",
                     "my$treatEH0_80", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH20",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH20",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH0_40
my$treat <- relevel(my$treat, ref = "EH0_40")
mymod <- lm(my$tmaxdiff ~ my$treat + I(scale(my$diff0)), weights = my$rmaxdiff_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_60","my$treatEH40","my$treatEH20_60",
                     "my$treatEH0_80", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH0_40",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH0_40",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH0_60
my$treat <- relevel(my$treat, ref = "EH0_60")
mymod <- lm(my$tmaxdiff ~ my$treat + I(scale(my$diff0)), weights = my$rmaxdiff_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH40","my$treatEH20_60",
                     "my$treatEH0_80", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH0_60",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH0_60",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH40
my$treat <- relevel(my$treat, ref = "EH40")
mymod <- lm(my$tmaxdiff ~ my$treat + I(scale(my$diff0)), weights = my$rmaxdiff_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH20_60",
                     "my$treatEH0_80", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH40",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH40",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH20_60
my$treat <- relevel(my$treat, ref = "EH20_60")
mymod <- lm(my$tmaxdiff ~ my$treat + I(scale(my$diff0)), weights = my$rmaxdiff_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40",
                     "my$treatEH0_80", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH20_60",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH20_60",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH0_80
my$treat <- relevel(my$treat, ref = "EH0_80")
mymod <- lm(my$tmaxdiff ~ my$treat + I(scale(my$diff0)), weights = my$rmaxdiff_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40",
                     "my$treatEH20_60", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH0_80",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH0_80",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH60
my$treat <- relevel(my$treat, ref = "EH60")
mymod <- lm(my$tmaxdiff ~ my$treat + I(scale(my$diff0)), weights = my$rmaxdiff_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40",
                     "my$treatEH20_60", "my$treatEH0_80","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH60",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH60",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH40_80
my$treat <- relevel(my$treat, ref = "EH40_80")
mymod <- lm(my$tmaxdiff ~ my$treat + I(scale(my$diff0)), weights = my$rmaxdiff_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40",
                     "my$treatEH20_60", "my$treatEH0_80","my$treatEH60","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH40_80",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH40_80",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH80
my$treat <- relevel(my$treat, ref = "EH80")
mymod <- lm(my$tmaxdiff ~ my$treat + I(scale(my$diff0)), weights = my$rmaxdiff_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40",
                     "my$treatEH20_60", "my$treatEH0_80","my$treatEH60","my$treatEH40_80", "my$treatEH100")){
  myres_est["my$treatEH80",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH80",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH100
my$treat <- relevel(my$treat, ref = "EH100")
mymod <- lm(my$tmaxdiff ~ my$treat + I(scale(my$diff0)), weights = my$rmaxdiff_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40",
                     "my$treatEH20_60", "my$treatEH0_80","my$treatEH60","my$treatEH40_80", "my$treatEH80")){
  myres_est["my$treatEH100",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH100",i] <- mysumm[i, "Pr(>|t|)"]
}



# Visualize -------------------------------------------------------------------
mytitle <- NULL
myylab <- "T-maxdiff (Generations)"
myxlab <- "Treatment"

my$treat <- factor(my$treat, levels = c("EH0", "EH20", "EH0_40","EH0_60", "EH40", "EH20_60", "EH0_80", "EH60", "EH40_80", "EH80", "EH100"))
myx <- my$treat
myy <- my$tmaxdiff
myr <- my$rmaxdiff
myc <- my$treat

mylowlim <- 0
myhighlim <- 500
myby <- 50
myxextend <- 500
myhmround <- 0
myptsize <- ((((myr/max(myr))*10)*((myheight*mywidth)/(3.5*7*3))) - min(((myr/max(myr))*10)*((myheight*mywidth)/(3.5*7*3))))+0.5

p <- ggplot(my, aes(x=myx, y=myy, weight = myr, color = myc)) +
  geom_violin(color = myoutline, fill = myfill, draw_quantiles = NULL, inherit.aes = F, aes( x=myx, y=myy), trim = T) + 
  geom_jitter(width =0.15, height = 0, alpha = myptalpha, size = myptsize) +
  geom_rug(sides = "b" , position = position_nudge(x=-0.75), alpha = myrugalpha)+
  geom_point(stat="summary", fun.y="mean", color = mywtmeanptcol, cex = mymeanptsize) + 
  geom_errorbar(stat="summary", fun.data = "mean_se",color = mywtmeanptcol, width = 0.0, lwd =0.5)+
  geom_point(x=11,y = weighted.mean(myy[myx == "EH100"], myr[myx == "EH100"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=10,y = weighted.mean(myy[myx == "EH80"], myr[myx == "EH80"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=9,y = weighted.mean(myy[myx == "EH40_80"], myr[myx == "EH40_80"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=8,y = weighted.mean(myy[myx == "EH60"], myr[myx == "EH60"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=7,y = weighted.mean(myy[myx == "EH0_80"], myr[myx == "EH0_80"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=6,y = weighted.mean(myy[myx == "EH20_60"], myr[myx == "EH20_60"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=5,y = weighted.mean(myy[myx == "EH40"], myr[myx == "EH40"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=4,y = weighted.mean(myy[myx == "EH0_60"], myr[myx == "EH0_60"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=3,y = weighted.mean(myy[myx == "EH0_40"], myr[myx == "EH0_40"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=2,y = weighted.mean(myy[myx == "EH20"], myr[myx == "EH20"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=1,y = weighted.mean(myy[myx == "EH0"], myr[myx == "EH0"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  scale_color_manual(values =mypalette) + 
  # geom_hline(yintercept = 0, lty = "dotted") + 
  coord_flip() +
  theme_classic()+
  theme(legend.position="none") +
  ggtitle(mytitle) + ylab(myylab) + xlab(myxlab)+
  scale_x_discrete(labels = c("EH0", "EH20", "EH0_40","EH0_60", "EH40", "EH20_60", "EH0_80", "EH60", "EH40_80", "EH80", "EH100")) +
  scale_y_continuous(breaks = seq(mylowlim, myhighlim,by=myby),
                     limits = c(mylowlim, myhighlim+myxextend),
                     labels = scales::number_format(accuracy = 1))+
  theme(axis.title.y = element_text(size = 8, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = 8, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = 8, angle = 0))+
  theme(axis.text.x = element_text(size = 8, angle = 0))

myp <- 0.05
myres_est[myres_p >= myp] <- NA
m <- round(myres_est, myhmround)
colnames(m) <- c("EH0", "EH20", "EH0_40","EH0_60", "EH40", "EH20_60", "EH0_80", "EH60", "EH40_80", "EH80", "EH100")
rownames(m) <- colnames(m)
# m <- get_lower_tri(m) # uncomment for just lower triangle
melt_m <- reshape::melt(m)
melt_m$X1 <- factor(melt_m$X1, levels = c("EH0", "EH20", "EH0_40","EH0_60", "EH40", "EH20_60", "EH0_80", "EH60", "EH40_80", "EH80", "EH100"))
melt_m$X2 <- factor(melt_m$X2, levels = c("EH0", "EH20", "EH0_40","EH0_60", "EH40", "EH20_60", "EH0_80", "EH60", "EH40_80", "EH80", "EH100"))

pp <- ggplot(melt_m, aes(x = X1, y = X2, fill = value)) + 
  geom_tile(show.legend = F)+
  geom_text(aes(X1, X2, label = value), color = "black", size = 2, angle = 0) +
  theme_tufte(base_family="Helvetica")+
  scale_y_discrete(position = "right")+
  theme(axis.ticks = element_blank(),
        plot.title = element_text(face = "bold"),
        panel.background = element_rect(colour = NA, fill = "transparent"),
        plot.background = element_rect(fill = "transparent",colour = NA),
        axis.title = element_blank(),
        axis.text = element_text(size = 6),
        axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5, margin = margin(t=-2.5, b = -2.5)),
        axis.text.y.left = element_text(angle = 0, hjust = 0, vjust = 0.5, margin = margin(l=-2.5, r = -2.5), debug = T))+
  scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
                       midpoint = 0, limit = c(min(melt_m$value),max(melt_m$value)), space = "Lab", 
                       name="Estimate", na.value = "transparent")

m2 <- m; m2[1:length(m2)] <- 0
# m2 <- get_lower_tri(m2) # uncomment for just lower triangle
melt_m2 <- reshape::melt(m2)
melt_m2$X1 <- factor(melt_m2$X1, levels = c("EH0", "EH20", "EH0_40","EH0_60", "EH40", "EH20_60", "EH0_80", "EH60", "EH40_80", "EH80", "EH100"))
melt_m2$X2 <- factor(melt_m2$X2, levels = c("EH0", "EH20", "EH0_40","EH0_60", "EH40", "EH20_60", "EH0_80", "EH60", "EH40_80", "EH80", "EH100"))

ppp <- ggplot(melt_m2, aes(x = X1, y = X2, fill = value)) + 
  geom_tile(show.legend = F)+
  geom_text(aes(X1, X2, label = value), color = "gray", size = 2, angle = 0) +
  theme_tufte(base_family="Helvetica")+
  scale_y_discrete(position = "right")+
 theme(axis.ticks = element_blank(),
        plot.title = element_text(face = "bold"),
        panel.background = element_rect(colour = NA, fill = "transparent"),
        plot.background = element_rect(fill = "transparent",colour = NA),
        axis.title = element_blank(),
        axis.text = element_text(size = 6, colour = "white"),
        axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5, margin = margin(t=-2.5, b = -2.5)),
        axis.text.y.left = element_text(angle = 0, hjust = 0, vjust = 0.5, margin = margin(l=-2.5, r = -2.5), debug = T))+
  scale_fill_gradient2(low = "blue", high = "red", mid = "gray", 
                       midpoint = 0, limit = c(min(melt_m$value),max(melt_m$value)), space = "Lab", 
                       name="Estimate", na.value = "transparent")

pppp <- p + annotation_custom(ggplotGrob(ppp), ymin = 550, ymax = 1050, xmin = 3, xmax = 9)
pppp <- pppp + annotation_custom(ggplotGrob(pp), ymin = 550, ymax = 1050, xmin = 3, xmax = 9)
pppp

# figure output ---------------------------------------------------------------
pdf(file = "000_SALT_tmaxdiff.pdf", width = mywidth, height = myheight); pppp; dev.off()
```

mmaxdiff
```{r, warning = FALSE, message=FALSE}
my <- myd[myd$plate %in% c("SALT_A", "SALT_B"),]

# model and store results ------------------------------------------------------
# create matrix to store results outputs
myres <- matrix(nrow = 11, ncol=11)
rownames(myres) <- c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40","my$treatEH20_60",
                     "my$treatEH0_80", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")
colnames(myres) <- rownames(myres)
myres_p <- myres; myres_est <- myres

# EH0
mymod <- lm(my$mmaxdiff ~ my$treat + I(scale(my$diff0)), weights = my$rmaxdiff_rt0); summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40","my$treatEH20_60",
                     "my$treatEH0_80", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH0",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH0",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH20
my$treat <- relevel(my$treat, ref = "EH20")
mymod <- lm(my$mmaxdiff ~ my$treat + I(scale(my$diff0)), weights = my$rmaxdiff_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH0_40","my$treatEH0_60","my$treatEH40","my$treatEH20_60",
                     "my$treatEH0_80", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH20",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH20",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH0_40
my$treat <- relevel(my$treat, ref = "EH0_40")
mymod <- lm(my$mmaxdiff ~ my$treat + I(scale(my$diff0)), weights = my$rmaxdiff_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_60","my$treatEH40","my$treatEH20_60",
                     "my$treatEH0_80", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH0_40",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH0_40",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH0_60
my$treat <- relevel(my$treat, ref = "EH0_60")
mymod <- lm(my$mmaxdiff ~ my$treat + I(scale(my$diff0)), weights = my$rmaxdiff_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH40","my$treatEH20_60",
                     "my$treatEH0_80", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH0_60",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH0_60",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH40
my$treat <- relevel(my$treat, ref = "EH40")
mymod <- lm(my$mmaxdiff ~ my$treat + I(scale(my$diff0)), weights = my$rmaxdiff_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH20_60",
                     "my$treatEH0_80", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH40",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH40",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH20_60
my$treat <- relevel(my$treat, ref = "EH20_60")
mymod <- lm(my$mmaxdiff ~ my$treat + I(scale(my$diff0)), weights = my$rmaxdiff_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40",
                     "my$treatEH0_80", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH20_60",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH20_60",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH0_80
my$treat <- relevel(my$treat, ref = "EH0_80")
mymod <- lm(my$mmaxdiff ~ my$treat + I(scale(my$diff0)), weights = my$rmaxdiff_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40",
                     "my$treatEH20_60", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH0_80",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH0_80",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH60
my$treat <- relevel(my$treat, ref = "EH60")
mymod <- lm(my$mmaxdiff ~ my$treat + I(scale(my$diff0)), weights = my$rmaxdiff_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40",
                     "my$treatEH20_60", "my$treatEH0_80","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH60",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH60",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH40_80
my$treat <- relevel(my$treat, ref = "EH40_80")
mymod <- lm(my$mmaxdiff ~ my$treat + I(scale(my$diff0)), weights = my$rmaxdiff_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40",
                     "my$treatEH20_60", "my$treatEH0_80","my$treatEH60","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH40_80",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH40_80",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH80
my$treat <- relevel(my$treat, ref = "EH80")
mymod <- lm(my$mmaxdiff ~ my$treat + I(scale(my$diff0)), weights = my$rmaxdiff_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40",
                     "my$treatEH20_60", "my$treatEH0_80","my$treatEH60","my$treatEH40_80", "my$treatEH100")){
  myres_est["my$treatEH80",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH80",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH100
my$treat <- relevel(my$treat, ref = "EH100")
mymod <- lm(my$mmaxdiff ~ my$treat + I(scale(my$diff0)), weights = my$rmaxdiff_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40",
                     "my$treatEH20_60", "my$treatEH0_80","my$treatEH60","my$treatEH40_80", "my$treatEH80")){
  myres_est["my$treatEH100",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH100",i] <- mysumm[i, "Pr(>|t|)"]
}



# Visualize -------------------------------------------------------------------
mytitle <- NULL
myylab <- "M-maxdiff"
myxlab <- "Treatment"
myylabacc <- 0.01

my$treat <- factor(my$treat, levels = c("EH0", "EH20", "EH0_40","EH0_60", "EH40", "EH20_60", "EH0_80", "EH60", "EH40_80", "EH80", "EH100"))
myx <- my$treat
myy <- my$mmaxdiff
myr <- my$rmaxdiff
myc <- my$treat

mylowlim <- 0
myhighlim <- 0.5
myby <- 0.025
myxextend <- 0.5
myhmround <- 3
myptsize <- ((((myr/max(myr))*10)*((myheight*mywidth)/(3.5*7*3))) - min(((myr/max(myr))*10)*((myheight*mywidth)/(3.5*7*3))))+0.5

p <- ggplot(my, aes(x=myx, y=myy, weight = myr, color = myc)) +
  geom_violin(color = myoutline, fill = myfill, draw_quantiles = NULL, inherit.aes = F, aes( x=myx, y=myy), trim = T) + 
  geom_jitter(width =0.15, height = 0, alpha = myptalpha, size = myptsize) +
  geom_rug(sides = "b" , position = position_nudge(x=-0.75), alpha = myrugalpha)+
  geom_point(stat="summary", fun.y="mean", color = mywtmeanptcol, cex = mymeanptsize) + 
  geom_errorbar(stat="summary", fun.data = "mean_se",color = mywtmeanptcol, width = 0.0, lwd =0.5)+
  geom_point(x=11,y = weighted.mean(myy[myx == "EH100"], myr[myx == "EH100"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=10,y = weighted.mean(myy[myx == "EH80"], myr[myx == "EH80"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=9,y = weighted.mean(myy[myx == "EH40_80"], myr[myx == "EH40_80"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=8,y = weighted.mean(myy[myx == "EH60"], myr[myx == "EH60"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=7,y = weighted.mean(myy[myx == "EH0_80"], myr[myx == "EH0_80"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=6,y = weighted.mean(myy[myx == "EH20_60"], myr[myx == "EH20_60"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=5,y = weighted.mean(myy[myx == "EH40"], myr[myx == "EH40"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=4,y = weighted.mean(myy[myx == "EH0_60"], myr[myx == "EH0_60"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=3,y = weighted.mean(myy[myx == "EH0_40"], myr[myx == "EH0_40"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=2,y = weighted.mean(myy[myx == "EH20"], myr[myx == "EH20"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=1,y = weighted.mean(myy[myx == "EH0"], myr[myx == "EH0"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  scale_color_manual(values =mypalette) + 
  # geom_hline(yintercept = 0, lty = "dotted") + 
  coord_flip() +
  theme_classic()+
  theme(legend.position="none") +
  ggtitle(mytitle) + ylab(myylab) + xlab(myxlab)+
  scale_x_discrete(labels = c("EH0", "EH20", "EH0_40","EH0_60", "EH40", "EH20_60", "EH0_80", "EH60", "EH40_80", "EH80", "EH100")) +
  scale_y_continuous(breaks = seq(mylowlim, myhighlim,by=myby),
                     limits = c(mylowlim, myhighlim+myxextend),
                     labels = scales::number_format(accuracy = myylabacc))+
  theme(axis.title.y = element_text(size = 8, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = 8, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = 8, angle = 0))+
  theme(axis.text.x = element_text(size = 8, angle = 0))

myp <- 0.05
myres_est[myres_p >= myp] <- NA
m <- round(myres_est, myhmround)
colnames(m) <- c("EH0", "EH20", "EH0_40","EH0_60", "EH40", "EH20_60", "EH0_80", "EH60", "EH40_80", "EH80", "EH100")
rownames(m) <- colnames(m)
# m <- get_lower_tri(m) # uncomment for just lower triangle
melt_m <- reshape::melt(m)
melt_m$X1 <- factor(melt_m$X1, levels = c("EH0", "EH20", "EH0_40","EH0_60", "EH40", "EH20_60", "EH0_80", "EH60", "EH40_80", "EH80", "EH100"))
melt_m$X2 <- factor(melt_m$X2, levels = c("EH0", "EH20", "EH0_40","EH0_60", "EH40", "EH20_60", "EH0_80", "EH60", "EH40_80", "EH80", "EH100"))

pp <- ggplot(melt_m, aes(x = X1, y = X2, fill = value)) + 
  geom_tile(show.legend = F)+
  geom_text(aes(X1, X2, label = value), color = "black", size = 2, angle = 0) +
  theme_tufte(base_family="Helvetica")+
  scale_y_discrete(position = "right")+
  theme(axis.ticks = element_blank(),
        plot.title = element_text(face = "bold"),
        panel.background = element_rect(colour = NA, fill = "transparent"),
        plot.background = element_rect(fill = "transparent",colour = NA),
        axis.title = element_blank(),
        axis.text = element_text(size = 6),
        axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5, margin = margin(t=-2.5, b = -2.5)),
        axis.text.y.left = element_text(angle = 0, hjust = 0, vjust = 0.5, margin = margin(l=-2.5, r = -2.5), debug = T))+
  scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
                       midpoint = 0, limit = c(min(melt_m$value),max(melt_m$value)), space = "Lab", 
                       name="Estimate", na.value = "transparent")

m2 <- m; m2[1:length(m2)] <- 0
# m2 <- get_lower_tri(m2) # uncomment for just lower triangle
melt_m2 <- reshape::melt(m2)
melt_m2$X1 <- factor(melt_m2$X1, levels = c("EH0", "EH20", "EH0_40","EH0_60", "EH40", "EH20_60", "EH0_80", "EH60", "EH40_80", "EH80", "EH100"))
melt_m2$X2 <- factor(melt_m2$X2, levels = c("EH0", "EH20", "EH0_40","EH0_60", "EH40", "EH20_60", "EH0_80", "EH60", "EH40_80", "EH80", "EH100"))

ppp <- ggplot(melt_m2, aes(x = X1, y = X2, fill = value)) + 
  geom_tile(show.legend = F)+
  geom_text(aes(X1, X2, label = value), color = "gray", size = 2, angle = 0) +
  theme_tufte(base_family="Helvetica")+
  scale_y_discrete(position = "right")+
 theme(axis.ticks = element_blank(),
        plot.title = element_text(face = "bold"),
        panel.background = element_rect(colour = NA, fill = "transparent"),
        plot.background = element_rect(fill = "transparent",colour = NA),
        axis.title = element_blank(),
        axis.text = element_text(size = 6, colour = "white"),
        axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5, margin = margin(t=-2.5, b = -2.5)),
        axis.text.y.left = element_text(angle = 0, hjust = 0, vjust = 0.5, margin = margin(l=-2.5, r = -2.5), debug = T))+
  scale_fill_gradient2(low = "blue", high = "red", mid = "gray", 
                       midpoint = 0, limit = c(min(melt_m$value),max(melt_m$value)), space = "Lab", 
                       name="Estimate", na.value = "transparent")

pppp <- p + annotation_custom(ggplotGrob(ppp), ymin = 0.55, ymax = 1.05, xmin = 3, xmax = 9)
pppp <- pppp + annotation_custom(ggplotGrob(pp), ymin = 0.55, ymax = 1.05, xmin = 3, xmax = 9)
pppp

# figure output ---------------------------------------------------------------
pdf(file = "000_SALT_mmaxdiff.pdf", width = mywidth, height = myheight); pppp; dev.off()
p
```


tcc
```{r, warning = FALSE, message=FALSE}
my <- myd[myd$plate %in% c("SALT_A", "SALT_B"),]

# model and store results ------------------------------------------------------
# create matrix to store results outputs
myres <- matrix(nrow = 11, ncol=11)
rownames(myres) <- c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40","my$treatEH20_60",
                     "my$treatEH0_80", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")
colnames(myres) <- rownames(myres)
myres_p <- myres; myres_est <- myres

# EH0
mymod <- lm(my$tcc ~ my$treat + I(scale(my$diff0)), weights = my$rtcc_rt0); summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40","my$treatEH20_60",
                     "my$treatEH0_80", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH0",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH0",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH20
my$treat <- relevel(my$treat, ref = "EH20")
mymod <- lm(my$tcc ~ my$treat + I(scale(my$diff0)), weights = my$rtcc_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH0_40","my$treatEH0_60","my$treatEH40","my$treatEH20_60",
                     "my$treatEH0_80", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH20",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH20",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH0_40
my$treat <- relevel(my$treat, ref = "EH0_40")
mymod <- lm(my$tcc ~ my$treat + I(scale(my$diff0)), weights = my$rtcc_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_60","my$treatEH40","my$treatEH20_60",
                     "my$treatEH0_80", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH0_40",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH0_40",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH0_60
my$treat <- relevel(my$treat, ref = "EH0_60")
mymod <- lm(my$tcc ~ my$treat + I(scale(my$diff0)), weights = my$rtcc_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH40","my$treatEH20_60",
                     "my$treatEH0_80", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH0_60",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH0_60",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH40
my$treat <- relevel(my$treat, ref = "EH40")
mymod <- lm(my$tcc ~ my$treat + I(scale(my$diff0)), weights = my$rtcc_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH20_60",
                     "my$treatEH0_80", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH40",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH40",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH20_60
my$treat <- relevel(my$treat, ref = "EH20_60")
mymod <- lm(my$tcc ~ my$treat + I(scale(my$diff0)), weights = my$rtcc_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40",
                     "my$treatEH0_80", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH20_60",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH20_60",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH0_80
my$treat <- relevel(my$treat, ref = "EH0_80")
mymod <- lm(my$tcc ~ my$treat + I(scale(my$diff0)), weights = my$rtcc_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40",
                     "my$treatEH20_60", "my$treatEH60","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH0_80",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH0_80",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH60
my$treat <- relevel(my$treat, ref = "EH60")
mymod <- lm(my$tcc ~ my$treat + I(scale(my$diff0)), weights = my$rtcc_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40",
                     "my$treatEH20_60", "my$treatEH0_80","my$treatEH40_80","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH60",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH60",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH40_80
my$treat <- relevel(my$treat, ref = "EH40_80")
mymod <- lm(my$tcc ~ my$treat + I(scale(my$diff0)), weights = my$rtcc_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40",
                     "my$treatEH20_60", "my$treatEH0_80","my$treatEH60","my$treatEH80", "my$treatEH100")){
  myres_est["my$treatEH40_80",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH40_80",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH80
my$treat <- relevel(my$treat, ref = "EH80")
mymod <- lm(my$tcc ~ my$treat + I(scale(my$diff0)), weights = my$rtcc_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40",
                     "my$treatEH20_60", "my$treatEH0_80","my$treatEH60","my$treatEH40_80", "my$treatEH100")){
  myres_est["my$treatEH80",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH80",i] <- mysumm[i, "Pr(>|t|)"]
}

# EH100
my$treat <- relevel(my$treat, ref = "EH100")
mymod <- lm(my$tcc ~ my$treat + I(scale(my$diff0)), weights = my$rtcc_rt0);# summary(mymod)
mysumm <- summary(mymod)$coefficients
for(i in c("my$treatEH0","my$treatEH20","my$treatEH0_40","my$treatEH0_60","my$treatEH40",
                     "my$treatEH20_60", "my$treatEH0_80","my$treatEH60","my$treatEH40_80", "my$treatEH80")){
  myres_est["my$treatEH100",i] <- mysumm[i, "Estimate"]
  myres_p["my$treatEH100",i] <- mysumm[i, "Pr(>|t|)"]
}



# Visualize -------------------------------------------------------------------
mytitle <- NULL
myylab <- "tcc"
myxlab <- "Treatment"
myylabacc <- 0.01

my$treat <- factor(my$treat, levels = c("EH0", "EH20", "EH0_40","EH0_60", "EH40", "EH20_60", "EH0_80", "EH60", "EH40_80", "EH80", "EH100"))
myx <- my$treat
myy <- my$tcc
myr <- my$rtcc
myc <- my$treat

mylowlim <- 0
myhighlim <- 0.03
myby <- 0.005
myxextend <- 0.03
myhmround <- 4
myptsize <- ((((myr/max(myr))*10)*((myheight*mywidth)/(3.5*7*3))) - min(((myr/max(myr))*10)*((myheight*mywidth)/(3.5*7*3))))+0.5

p <- ggplot(my, aes(x=myx, y=myy, weight = myr, color = myc)) +
  geom_violin(color = myoutline, fill = myfill, draw_quantiles = NULL, inherit.aes = F, aes( x=myx, y=myy), trim = T) + 
  geom_jitter(width =0.15, height = 0, alpha = myptalpha, size = myptsize) +
  geom_rug(sides = "b" , position = position_nudge(x=-0.75), alpha = myrugalpha)+
  geom_point(stat="summary", fun.y="mean", color = mywtmeanptcol, cex = mymeanptsize) + 
  geom_errorbar(stat="summary", fun.data = "mean_se",color = mywtmeanptcol, width = 0.0, lwd =0.5)+
  geom_point(x=11,y = weighted.mean(myy[myx == "EH100"], myr[myx == "EH100"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=10,y = weighted.mean(myy[myx == "EH80"], myr[myx == "EH80"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=9,y = weighted.mean(myy[myx == "EH40_80"], myr[myx == "EH40_80"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=8,y = weighted.mean(myy[myx == "EH60"], myr[myx == "EH60"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=7,y = weighted.mean(myy[myx == "EH0_80"], myr[myx == "EH0_80"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=6,y = weighted.mean(myy[myx == "EH20_60"], myr[myx == "EH20_60"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=5,y = weighted.mean(myy[myx == "EH40"], myr[myx == "EH40"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=4,y = weighted.mean(myy[myx == "EH0_60"], myr[myx == "EH0_60"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=3,y = weighted.mean(myy[myx == "EH0_40"], myr[myx == "EH0_40"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=2,y = weighted.mean(myy[myx == "EH20"], myr[myx == "EH20"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  geom_point(x=1,y = weighted.mean(myy[myx == "EH0"], myr[myx == "EH0"], na.rm = T), color = mywtmeanptcol, pch = mywtmeanpttype, size = mymeanptsize) +
  scale_color_manual(values =mypalette) + 
  # geom_hline(yintercept = 0, lty = "dotted") + 
  coord_flip() +
  theme_classic()+
  theme(legend.position="none") +
  ggtitle(mytitle) + ylab(myylab) + xlab(myxlab)+
  scale_x_discrete(labels = c("EH0", "EH20", "EH0_40","EH0_60", "EH40", "EH20_60", "EH0_80", "EH60", "EH40_80", "EH80", "EH100")) +
  scale_y_continuous(breaks = seq(mylowlim, myhighlim,by=myby),
                     limits = c(mylowlim, myhighlim+myxextend),
                     labels = scales::number_format(accuracy = myylabacc))+
  theme(axis.title.y = element_text(size = 8, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.title.x = element_text(size = 8, face = "bold", margin = margin(0,0,0,0, "pt")))+
  theme(axis.text.y = element_text(size = 8, angle = 0))+
  theme(axis.text.x = element_text(size = 8, angle = 0))

myp <- 0.05
myres_est[myres_p >= myp] <- NA
m <- round(myres_est, myhmround)
colnames(m) <- c("EH0", "EH20", "EH0_40","EH0_60", "EH40", "EH20_60", "EH0_80", "EH60", "EH40_80", "EH80", "EH100")
rownames(m) <- colnames(m)
# m <- get_lower_tri(m) # uncomment for just lower triangle
melt_m <- reshape::melt(m)
melt_m$X1 <- factor(melt_m$X1, levels = c("EH0", "EH20", "EH0_40","EH0_60", "EH40", "EH20_60", "EH0_80", "EH60", "EH40_80", "EH80", "EH100"))
melt_m$X2 <- factor(melt_m$X2, levels = c("EH0", "EH20", "EH0_40","EH0_60", "EH40", "EH20_60", "EH0_80", "EH60", "EH40_80", "EH80", "EH100"))

pp <- ggplot(melt_m, aes(x = X1, y = X2, fill = value)) + 
  geom_tile(show.legend = F)+
  geom_text(aes(X1, X2, label = value), color = "black", size = 2, angle = 0) +
  theme_tufte(base_family="Helvetica")+
  scale_y_discrete(position = "right")+
  theme(axis.ticks = element_blank(),
        plot.title = element_text(face = "bold"),
        panel.background = element_rect(colour = NA, fill = "transparent"),
        plot.background = element_rect(fill = "transparent",colour = NA),
        axis.title = element_blank(),
        axis.text = element_text(size = 6),
        axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5, margin = margin(t=-2.5, b = -2.5)),
        axis.text.y.left = element_text(angle = 0, hjust = 0, vjust = 0.5, margin = margin(l=-2.5, r = -2.5), debug = T))+
  scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
                       midpoint = 0, limit = c(min(melt_m$value),max(melt_m$value)), space = "Lab", 
                       name="Estimate", na.value = "transparent")

m2 <- m; m2[1:length(m2)] <- 0
# m2 <- get_lower_tri(m2) # uncomment for just lower triangle
melt_m2 <- reshape::melt(m2)
melt_m2$X1 <- factor(melt_m2$X1, levels = c("EH0", "EH20", "EH0_40","EH0_60", "EH40", "EH20_60", "EH0_80", "EH60", "EH40_80", "EH80", "EH100"))
melt_m2$X2 <- factor(melt_m2$X2, levels = c("EH0", "EH20", "EH0_40","EH0_60", "EH40", "EH20_60", "EH0_80", "EH60", "EH40_80", "EH80", "EH100"))

ppp <- ggplot(melt_m2, aes(x = X1, y = X2, fill = value)) + 
  geom_tile(show.legend = F)+
  geom_text(aes(X1, X2, label = value), color = "gray", size = 2, angle = 0) +
  theme_tufte(base_family="Helvetica")+
  scale_y_discrete(position = "right")+
 theme(axis.ticks = element_blank(),
        plot.title = element_text(face = "bold"),
        panel.background = element_rect(colour = NA, fill = "transparent"),
        plot.background = element_rect(fill = "transparent",colour = NA),
        axis.title = element_blank(),
        axis.text = element_text(size = 6, colour = "white"),
        axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5, margin = margin(t=-2.5, b = -2.5)),
        axis.text.y.left = element_text(angle = 0, hjust = 0, vjust = 0.5, margin = margin(l=-2.5, r = -2.5), debug = T))+
  scale_fill_gradient2(low = "blue", high = "red", mid = "gray", 
                       midpoint = 0, limit = c(min(melt_m$value),max(melt_m$value)), space = "Lab", 
                       name="Estimate", na.value = "transparent")

pppp <- p + annotation_custom(ggplotGrob(ppp), ymin = 0.03, ymax = 0.06, xmin = 3, xmax = 9)
pppp <- pppp + annotation_custom(ggplotGrob(pp), ymin = 0.03, ymax = 0.06, xmin = 3, xmax = 9)
pppp

# figure output ---------------------------------------------------------------
pdf(file = "000_SALT_tcc.pdf", width = mywidth, height = myheight); pppp; dev.off()
```
